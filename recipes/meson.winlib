export NAME="Meson"
export STATUS=
export URL=http://mesonbuild.com/
export BASENAME=meson
export DESCRIPTION="Meson is an open source build system meant to be both extremely fast, and, even more importantly, as user friendly as possible."
export CATEGORY=development
export TYPE=application
#export VERSION=0.29.0
#export VERSIONDATE=20160204
#export VERSION=0.30.0
#export VERSIONDATE=20160405
#export VERSION=0.31.0
#export VERSIONDATE=20160414
#export VERSION=0.32.0
#export VERSIONDATE=20160606
#export VERSION=0.33.0
#export VERSIONDATE=20160801
#export VERSION=0.34.0
#export VERSIONDATE=20160906
#export VERSION=0.35.0
#export VERSIONDATE=20161004
#export VERSION=0.35.1
#export VERSIONDATE=20161018
#export VERSION=0.36.0
#export VERSIONDATE=20161115
#export VERSION=0.37.0
#export VERSIONDATE=20161219
#export VERSION=0.37.1
#export VERSIONDATE=20161221
#export VERSION=0.38.0
#export VERSIONDATE=20170130
#export VERSION=0.38.1
#export VERSIONDATE=20170208
#export VERSION=0.39.0
#export VERSIONDATE=20170306
#export VERSION=0.39.1
#export VERSIONDATE=20170316
#export VERSION=0.40.0
#export VERSIONDATE=20170423
#export VERSION=0.40.1
#export VERSIONDATE=20170429
#export VERSION=0.41.0
#export VERSIONDATE=20170613
#export VERSION=0.41.1
#export VERSIONDATE=20170620
#export VERSION=0.41.2
#export VERSIONDATE=20170719
#export VERSION=0.42.0
#export VERSIONDATE=20170815
#export VERSION=0.42.1
#export VERSIONDATE=20170913
#export VERSION=0.43.0
#export VERSIONDATE=20171009
#export VERSION=0.44.0
#export VERSIONDATE=20171211
#export VERSION=0.44.1
#export VERSIONDATE=20180221
#export VERSION=0.45.0
#export VERSIONDATE=20180305
#export VERSION=0.45.1
#export VERSIONDATE=20180322
#export VERSION=0.46.0
#export VERSIONDATE=20180423
#export VERSION=0.46.1
#export VERSIONDATE=20180517
#export VERSION=0.47.0
#export VERSIONDATE=20180703
#export VERSION=0.47.1
#export VERSIONDATE=20180711
#export VERSION=0.47.2
#export VERSIONDATE=20180825
#export VERSION=0.48.0
#export VERSIONDATE=20180923
#export VERSION=0.48.1
#export VERSIONDATE=20181018
#export VERSION=0.48.2
#export VERSIONDATE=20181109
#export VERSION=0.49.0
#export VERSIONDATE=20181210
#export VERSION=0.49.1
#export VERSIONDATE=20190124
#export VERSION=0.49.2
#export VERSIONDATE=20190205
#export VERSION=0.50.0
#export VERSIONDATE=20190311
#export VERSION=0.50.1
#export VERSIONDATE=20190417
#export VERSION=0.51.0
#export VERSIONDATE=20190617
#export VERSION=0.51.1
#export VERSIONDATE=20190710
#export VERSION=0.51.2
#export VERSIONDATE=20190827
#export VERSION=0.52.0
#export VERSIONDATE=20191007
#export VERSION=0.52.1
#export VERSIONDATE=20191129
#export VERSION=0.53.0
#export VERSIONDATE=20200108
#export VERSION=0.53.1
#export VERSIONDATE=20200124
####SyntaxError: invalid syntax
####requires Python 3
#export VERSION=0.53.2
#export VERSIONDATE=20200226
#export VERSION=0.54.0
#export VERSIONDATE=20200330
#export VERSION=0.54.1
#export VERSIONDATE=20200426
####ninja: fatal: CreateProcess: %1 is not a valid Win32 application
#export VERSION=0.54.2
#export VERSIONDATE=20200515
#export VERSION=0.54.3
#export VERSIONDATE=20200616
#export VERSION=0.55.0
#export VERSIONDATE=20200713
#export VERSION=0.55.1
#export VERSIONDATE=20200816
#export VERSION=0.55.2
#export VERSIONDATE=20200911
#export VERSION=0.55.3
#export VERSIONDATE=20200912
#export VERSION=0.56.0
#export VERSIONDATE=20201030
#export VERSION=0.56.1
#export VERSIONDATE=20210106
#export VERSION=0.56.2
#export VERSIONDATE=20210110
#export VERSION=0.57.0
#export VERSIONDATE=20210215
#export VERSION=0.57.1
#export VERSIONDATE=20210220
#export VERSION=0.57.2
#export VERSIONDATE=20210410
#export VERSION=0.58.0
#export VERSIONDATE=20210502
#export VERSION=0.58.1
#export VERSIONDATE=20210608
####OSError: [WinError 1] Incorrect function
#export VERSION=0.59.0
#export VERSIONDATE=20210718
#export VERSION=0.59.1
#export VERSIONDATE=20210819
#export VERSION=0.59.2
#export VERSIONDATE=20210929
#export VERSION=0.59.3
#export VERSIONDATE=20211024
#export VERSION=0.59.4
#export VERSIONDATE=20211028
#export VERSION=0.60.1
#export VERSIONDATE=20211103
#export VERSION=0.60.2
#export VERSIONDATE=20211126
#export VERSION=0.60.3
#export VERSIONDATE=20211223
#export VERSION=0.61.0
#export VERSIONDATE=20220111
#export VERSION=0.61.1
#export VERSIONDATE=20220117
#export VERSION=0.61.2
#export VERSIONDATE=20220215
#export VERSION=0.61.3
#export VERSIONDATE=20220315
#export VERSION=0.61.4
#export VERSIONDATE=20220326
#export VERSION=0.61.5
#export VERSIONDATE=20220608
#export VERSION=0.62.0
#export VERSIONDATE=20220322
#export VERSION=0.62.1
#export VERSIONDATE=20220423
#export VERSION=0.62.2
#export VERSIONDATE=20220603
#export VERSION=0.63.0
#export VERSIONDATE=20220704
#export VERSION=0.63.1
#export VERSIONDATE=20220813
#export VERSION=0.63.2
#export VERSIONDATE=20220904
#export VERSION=0.63.3
#export VERSIONDATE=20221006
export VERSION=0.64.0
export VERSIONDATE=20221107
wl-showstatus --package-version
export DEPENDANCIES=ninja
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=Apache
export DOWNLOADURL="https://github.com/mesonbuild/meson/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=https://github.com/mesonbuild/meson/releases/download/$VERSION/$BASENAME\_$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://github.com/mesonbuild/meson/releases/download/$VERSION/$BASENAME-$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://github.com/mesonbuild/meson/archive/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#mv $TARBALLDIR/$BASENAME/$VERSION.tar.gz $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
wl-wait4deps
wl-showstatus extract
#tar xfz $TARBALLDIR/$BASENAME/$BASENAME\_$VERSION.tar.gz
#tar xfz $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
tar xfz $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
## remove fix to replace backslashes with forward slashes (version >= 0.51.2)
#patch -ulbf mesonbuild/backend/backends.py << EOF
#@@ -1016,3 +1016,3 @@
#         # https://github.com/mesonbuild/meson/pull/737
#-        cmd = [i.replace('\\\\', '/') for i in cmd]
#+        #cmd = [i.replace('\\\\', '/') for i in cmd]
#         return inputs, outputs, cmd
#EOF
## fix issues with ImDisk RAM disk in mesonbuild/interpreter.py (version = 0.54.0)
#patch -ulbf mesonbuild/interpreter.py << EOF
#@@ -2426,3 +2426,6 @@
#             builddir = Path(self.environment.get_build_dir())
#-            f = Path(f).resolve()
#+            if mesonlib.is_windows():
#+                f = Path(os.path.normpath(f))
#+            else:
#+                f = Path(f).resolve()
#             if builddir in f.parents:
#EOF
## fix mesonbuild/interpreter.py (version >= 0.54.3 <= 0.57.2)
#patch -ulbf mesonbuild/interpreter.py << EOF
#@@ -2438,2 +2438,4 @@
#                     f = f.parent.resolve() / f.name
#+                elif mesonlib.is_windows():
#+                    f = Path(os.path.normpath(f))
#                 else:
#EOF
## fix mesonbuild/interpreter/interpreter.py (version >= 0.58.0)
#patch -ulbf mesonbuild/interpreter/interpreter.py << EOF
#@@ -2438,2 +2438,4 @@
#                     f = f.parent.resolve() / f.name
#+                elif mesonlib.is_windows():
#+                    f = Path(os.path.normpath(f))
#                 else:
#EOF
## fix mesonbuild/interpreter.py (version >= 0.56.0 <= 0.58.1)
#sed -i.bak -e "s/self\.validate_within_subproject(self\.subdir, s)/#&/" mesonbuild/interpreter.py
## add shebang check to mesonbuild/scripts/meson_exe.py (version >= 0.54.3 <= 0.55.3)
#patch -ulbf mesonbuild/scripts/meson_exe.py << EOF
#@@ -48,2 +48,11 @@
#         cmd_args = exe.cmd_args
#+        if is_windows():
#+            try:
#+                with open(cmd_args[0], 'r') as exefile:
#+                    if exefile.read(2) == '#!':
#+                        cmd_args = exefile.readline().split() + cmd_args
#+                        if cmd_args[0] == '/usr/bin/env':
#+                            cmd_args.pop(0)
#+            except:
#+                pass
#     child_env = os.environ.copy()
#EOF
## fix mesonbuild/cmake/toolchain.py (version >= 0.57.1 <= 0.58.1)
#####bug reported: https://github.com/mesonbuild/meson/issues/8406
#patch -ulbf mesonbuild/cmake/toolchain.py << EOF
#@@ -58,3 +58,3 @@
#         self.toolchain_file = out_dir / 'CMakeMesonToolchainFile.cmake'
#-        self.toolchain_file = self.toolchain_file.resolve()
#+        #self.toolchain_file = self.toolchain_file.resolve()
#         self.minfo          = self.env.machines[self.for_machine]
#EOF
##mkdir -p build
##$PYDIR/python.exe meson.py --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library shared . build &&
#wl-showstatus build &&
# $PYDIR/python.exe setup.py build &&
# wl-showstatus install &&
# #$PYDIR/python.exe setup.py install &&
# mkdir -p $INSTALLPREFIX/bin &&
# #cp -rf build/scripts*/* $INSTALLPREFIX/bin/ &&
# cp -rf build/scripts*/* $INSTALLPREFIX/bin/ &&
# cp -rf build/lib $INSTALLPREFIX/ &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
wl-showstatus build-install &&
 $PYDIR/python.exe setup.py --no-user-cfg build --force --build-base $INSTALLPREFIX &&
 mkdir -p $INSTALLPREFIX/bin &&
 # install meson.py and fix relative path of library files
 sed -e "s?meson_exe.parent?&.parent / 'lib'?" meson.py > $INSTALLPREFIX/bin/meson.py &&
 # install meson command
 echo '#!/bin/sh' > $INSTALLPREFIX/bin/meson &&
 echo "\$PYDIR/python.exe \$0.py \$*" >> $INSTALLPREFIX/bin/meson &&
 # change python3 to python
 sed -i -e "s/^\(#\!.*python\)3$/\1/" $(grep -l "^#\!.*python3$" $(find $INSTALLPREFIX -name '*.py')) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####$PYDIR/python.exe $MINGWPREFIX/bin/meson.py --help
####Test cases for checking meson: p11-kit, gssdp, gexiv2, (pulseaudio), (harfbuzz)
####OSError: [WinError 1] Incorrect function (when running on RAM drive), see: https://github.com/mesonbuild/meson/issues/7295



