#export NAME="mediastreamer2"
#export STATUS=
#export URL=http://www.antisip.com/as/toolkit.php
#export BASENAME=mediastreamer2
#export DESCRIPTION="mediastreamer2 toolkit for RTP streaming"
#export CATEGORY=audio,communication
#export TYPE=library
##export VERSION=4.3.3-rc2
##export VERSIONDATE=
##export VERSION=2.5.0
##export VERSIONDATE=20111214
##export DEPENDENCIES=libortp,srtp,libspeex,libgsm,portaudio,libdl,pthreads,openssl
######src/base/msfactory.c:169:27: error: passing argument 1 of 'ortp_set_log_level_mask' makes pointer from integer without a cast [-Werror=int-conversion]
#export VERSION=2.14.0
#export VERSIONDATE=20170720
#wl-showstatus --package-version
#export DEPENDENCIES=libortp,libopus,srtp,libspeex,libspeexdsp,libgsm,portaudio,libdl,pthreads,openssl,bctoolbox
#export OPTIONALDEPENDENCIES=pulseaudio
##export OPTIONALDEPENDENCIES=pulseaudio,libupnp
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
##export DOWNLOADURL="http://www.antisip.com/download/mediastreamer2/ mediastreamer2-antisip-"
##export DOWNLOADURL="http://www.antisip.com/download/mediastreamer2/ mediastreamer-"
#export DOWNLOADURL="http://download.savannah.gnu.org/releases/linphone/mediastreamer/ mediastreamer-"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#wl-wait4deps
##export DOWNLOADSOURCEURL=http://www.antisip.com/download/mediastreamer2/$BASENAME-antisip-$VERSION.tar.gz
##export DOWNLOADSOURCEURL=http://www.antisip.com/download/mediastreamer2/mediastreamer-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=http://download.savannah.gnu.org/releases/linphone/mediastreamer/mediastreamer-$VERSION.tar.gz
#wl-showstatus download
##wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
##tar xz --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-antisip-$VERSION.tar.gz
#tar xz --force-local -f $TARBALLDIR/$BASENAME/mediastreamer-$VERSION.tar.gz
##cd $BASENAME-antisip-$VERSION/mediastreamer2
#cd mediastreamer-$VERSION
## fix missing includes in src/msfileplayer.c
#mv src/msfileplayer.c src/msfileplayer.c.bak
#echo "#include <fcntl.h>" > src/msfileplayer.c
#cat src/msfileplayer.c.bak >> src/msfileplayer.c
## fix missing UInt16 in src/ice.c
#mv src/ice.c src/ice.c.bak
#sed -e "s/UInt16/uint16_t/g" src/ice.c.bak > src/ice.c
## fix missin alloca in src/msresample.c (version >= 2.5.0)
#mv src/msresample.c src/msresample.c.bak
#echo "#include <malloc.h>" > src/msresample.c
#cat src/msresample.c.bak >> src/msresample.c
## fix missin alloca in src/pasnd.c (version >= 2.5.0)
#mv src/pasnd.c src/pasnd.c.bak
#echo "#include <malloc.h>" > src/pasnd.c
#cat src/pasnd.c.bak >> src/pasnd.c
## fix missin alloca in src/gsm.c (version >= 2.5.0)
#mv src/gsm.c src/gsm.c.bak
#echo "#include <malloc.h>" > src/gsm.c
#cat src/gsm.c.bak >> src/gsm.c
## fix missing swprintf_s in src/mscommon.c (version >= 2.5.0)
#patch -ulbf src/mscommon.c << EOF
#--- src/mscommon.c  2011-02-16 13:56:06 +0100
#+++ src/mscommon.c  2012-11-05 13:32:36 +0100
#@@ -297,3 +297,3 @@
#
#-               swprintf_s(wUnicodePluginFile, 2048, L"%s\\\\%s", wUnicodeDirPath, FileData.cFileName);
#+               swprintf(wUnicodePluginFile, 2048, L"%s\\\\%s", wUnicodeDirPath, FileData.cFileName);
#                WideCharToMultiByte(CP_UTF8,0,wUnicodePluginFile,-1,szPluginFile,sizeof(szPluginFile),0,0);
#EOF
### fix missing ortp_strerror in include/mediastreamer2/mscommon.h (version >= 2.5.0)
##echo "#define ortp_strerror strerror" >> include/mediastreamer2/mscommon.h
## fix missing parameter to ortp_set_log_level_mask in src/mscommon.c (version >= 2.5.0)
#mv src/mscommon.c src/mscommon.c.bak &&
#sed -e "s/\(ortp_set_log_level_mask(\)\([^,]*\)$/\1NULL, \2/" src/mscommon.c.bak > src/mscommon.c
## fix missing parameter to ortp_logv in include/mediastreamer2/mscommon.h (version >= 2.5.0)
#mv include/mediastreamer2/mscommon.h include/mediastreamer2/mscommon.h.bak &&
#sed -e "s/\(ortp_logv(\)\([^,]*,[^,]*,[^,]*\)$/\1NULL, \2/" include/mediastreamer2/mscommon.h.bak > include/mediastreamer2/mscommon.h
## fix format issue in src/voip/stun.c (version >= 2.14.0)
#patch -ulbf src/voip/stun.c << EOF
#@@ -727,4 +727,4 @@
#        if ((ms_stun_message_get_length(msg) + STUN_MESSAGE_HEADER_LENGTH) != bufsize) {
#-               ms_warning("STUN message header length does not match message size: %i - %zd",
#-                       ms_stun_message_get_length(msg), bufsize);
#+               ms_warning("STUN message header length does not match message size: %i - %ld",
#+                       ms_stun_message_get_length(msg), (long)bufsize);
#                goto error;
#EOF
## fix extra argument to bctbx_ssl_config_set_ca_chain in src/crypto/dtls_srtp.c (version >= 2.14.0)
#patch -ulbf src/crypto/dtls_srtp.c << EOF
#@@ -708 +708 @@
#-       bctbx_ssl_config_set_ca_chain(dtlsContext->ssl_config, dtlsContext->crt, NULL);
#+       bctbx_ssl_config_set_ca_chain(dtlsContext->ssl_config, dtlsContext->crt);
#EOF
## fix pointer conversion issues in src/audiofilters/winsnd3.c (version >= 2.5.0)
#mv src/audiofilters/winsnd3.c src/audiofilters/winsnd3.c.bak
#cat > src/audiofilters/winsnd3.c << EOF
##define UNICODE
##define _UNICODE
##include <winsock2.h>
##include <windows.h>
##include <mmreg.h>
#EOF
#sed -e "s/incaps.szPname/(LPCWCH)&/; s/(DWORD)/(DWORD_PTR)/g; s/DWORD \(dwInstance\|dwParam\)/DWORD_PTR \1/g" src/audiofilters/winsnd3.c.bak >> src/audiofilters/winsnd3.c
### fix missing winsock2.h include in include/mediastreamer2/upnp_igd.h (version >= 2.14.0)
##mv include/mediastreamer2/upnp_igd.h include/mediastreamer2/upnp_igd.h.bak &&
##echo "#include <winsock2.h>" > include/mediastreamer2/upnp_igd.h &&
##cat include/mediastreamer2/upnp_igd.h.bak >> include/mediastreamer2/upnp_igd.h
### fix _FILE_OFFSET_BITS in src/upnp/upnp_igd.c (version >= 2.14.0)
##mv src/upnp/upnp_igd.c src/upnp/upnp_igd.c.bak &&
##echo "#define _FILE_OFFSET_BITS 64" > src/upnp/upnp_igd.c &&
##cat src/upnp/upnp_igd.c.bak >> src/upnp/upnp_igd.c
## fix src/audiofilters/pasnd.c (version >= 2.14.0)
#patch -ulbf src/audiofilters/pasnd.c << EOF
#@@ -78,3 +78,3 @@
#     ms_warning("Extra data for sound card (total:%i %ims)",
#-              device->bufferizer->size, (device->bufferizer->size*20)/320);
#+              (int)device->bufferizer->size, (int)(device->bufferizer->size*20)/320);
#     err=ms_bufferizer_read(device->bufferizer,wtmpbuff, framesPerBuffer*2);
#@@ -85,3 +85,3 @@
#     ms_warning("Extra data for sound card removed (total:%i %ims)",
#-              device->bufferizer->size, (device->bufferizer->size*20)/320);
#+              (int)device->bufferizer->size, (int)(device->bufferizer->size*20)/320);
#   }
#EOF
## fix deprecated bctbx_list_remove_link (version >= 2.14.0)
#sed -i.bak -e "s/bctbx_list_remove_link(/bctbx_list_unlink(/" $(grep -l "bctbx_list_remove_link(" -r $(find -name '*.c'))
## skip building test
#cat > tests/Makefile.in << EOF
#all:
#depend:
#links:
#generate:
#install:
#EOF
## fix invalid use of -pthread and -rdynamic
#mv configure configure.bak
#sed -e "s/-pthread/-lpthread/g; s/-rdynamic/--export-dynamic/g" configure.bak > configure
## fix invalid use of -pthread and -rdynamic
#sed -i.bak2 -e "s/\n\(-Wall\|-Werror\)\b//g" configure
### remove dependancy on dynamic libstdc++ (GCC 4)
##mv libtool libtool.bak &&
##sed -e "s/-lstdc++/-lstdc++_s -lsupc++/" libtool.bak > libtool &&
#wl-showstatus configure &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-portaudio --enable-external-ortp --disable-video &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-portaudio --enable-external-ortp --disable-video LDFLAGS="-Wl,--enable-auto-import" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-portaudio --disable-external-ortp --disable-video LDFLAGS="-Wl,--enable-auto-import" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-portaudio --enable-external-ortp --disable-upnp --disable-video --disable-spandsp --disable-zrtp --disable-documentation CFLAGS="-Dbctbx_list_remove_link=bctbx_list_erase_link" CFLAGS="-I$MINGWPREFIX/include/libdl-win32" LDFLAGS="-Wl,--as-needed -lsrtp2" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-portaudio --enable-external-ortp --disable-video --disable-spandsp --disable-zrtp --disable-documentation CFLAGS="-Dbctbx_list_remove_link=bctbx_list_erase_link" CFLAGS="-I$MINGWPREFIX/include/libdl-win32" LDFLAGS="-Wl,--as-needed -lsrtp2" &&
# # fix building DLLs
# mv libtool libtool.bak &&
# sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
# wl-showstatus build-install &&
# ( make install-strip || make install-strip CC="${CC:-gcc} -Wno-error=implicit-function-declaration -Wno-error=int-conversion" || make install-strip CC="${CC:-gcc} -Wno-error=implicit-function-declaration -Wno-error=int-conversion -Wno-error=stringop-truncation -Wno-error=stringop-overflow" ) &&
# #make -j1 CC="${CC:-gcc} -Wno-strict-prototypes -Wno-error=incompatible-pointer-types"
# #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd ../.. && rm -rf $BASENAME-antisip-$VERSION
# #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd ../.. && wl-showstatus cleanup && rm -rf mediastreamer-$VERSION
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf mediastreamer-$VERSION



#export NAME="mediastreamer2"
#export STATUS=
#export URL=http://www.linphone.org/technical-corner/mediastreamer2
##export URL=https://github.com/BelledonneCommunications/mediastreamer2
#export BASENAME=mediastreamer2
#export DESCRIPTION="Mediastreamer2 is a powerful and lightweight streaming engine for voice/video telephony applications. This media processing and streaming toolkit is responsible for receiving and sending all multimedia streams in Linphone, including voice/video capture, encoding and decoding, and rendering."
#export CATEGORY=
#export TYPE=library
##export VERSION=4.4.24
##export VERSIONDATE=20210127
##export VERSION=4.4.25
##export VERSIONDATE=20210204
##export VERSION=4.4.26
##export VERSIONDATE=20210204
##export VERSION=4.4.27
##export VERSIONDATE=20210206
##export VERSION=4.4.28
##export VERSIONDATE=20210212
##export VERSION=4.4.29
##export VERSIONDATE=20210216
##export VERSION=4.4.31
##export VERSIONDATE=20210218
##export VERSION=4.4.32
##export VERSIONDATE=20210220
##export VERSION=4.4.33
##export VERSIONDATE=20210304
##export VERSION=4.4.34
##export VERSIONDATE=20210309
##export VERSION=4.4.35
##export VERSIONDATE=20210319
##export VERSION=4.5.0
##export VERSIONDATE=20210329
##export VERSION=4.5.1
##export VERSIONDATE=20210401
##export VERSION=4.5.3
##export VERSIONDATE=20210415
##export VERSION=4.5.7
##export VERSIONDATE=20210421
##export VERSION=4.5.10
##export VERSIONDATE=20210427
##export VERSION=4.5.13
##export VERSIONDATE=20210504
##export VERSION=4.5.14
##export VERSIONDATE=20210511
##export VERSION=4.5.15
##export VERSIONDATE=20210513
##export VERSION=4.5.16
##export VERSIONDATE=20210518
##export VERSION=4.5.20
##export VERSIONDATE=20210615
##export VERSION=4.5.22
##export VERSIONDATE=20210625
#####src/videofilters/msmfoundationcap.cpp:406:30: error: 'MF_READWRITE_DISABLE_CONVERTERS' was not declared in this scope
##export VERSION=5.0.0
##export VERSIONDATE=20210708
##export VERSION=5.0.3
##export VERSIONDATE=20210730
##export VERSION=5.0.6
##export VERSIONDATE=20210811
##export VERSION=5.0.8
##export VERSIONDATE=20210819
##export VERSION=5.0.10
##export VERSIONDATE=20210827
##export VERSION=5.0.11
##export VERSIONDATE=20210827
##export VERSION=5.0.13
##export VERSIONDATE=20210831
##export VERSION=5.0.16
##export VERSIONDATE=20210902
##export VERSION=5.0.18
##export VERSIONDATE=20210906
##export VERSION=5.0.22
##export VERSIONDATE=20210910
##export VERSION=5.0.23
##export VERSIONDATE=20210917
##export VERSION=5.0.24
##export VERSIONDATE=20210922
##export VERSION=5.0.26
##export VERSIONDATE=20210925
##export VERSION=5.0.27
##export VERSIONDATE=20210928
##export VERSION=5.0.28
##export VERSIONDATE=20210930
##export VERSION=5.0.32
##export VERSIONDATE=20211005
##export VERSION=5.0.35
##export VERSIONDATE=20211015
##export VERSION=5.0.37
##export VERSIONDATE=20211022
##export VERSION=5.0.66
##export VERSIONDATE=20220122
##export VERSION=5.0.67
##export VERSIONDATE=20220201
##export VERSION=5.0.68
##export VERSIONDATE=20220202
##export VERSION=5.0.70
##export VERSIONDATE=20220216
##export VERSION=5.0.71
##export VERSIONDATE=20220309
##export VERSION=5.1.0
##export VERSIONDATE=20220209
##export VERSION=5.1.2
##export VERSIONDATE=20220216
##export VERSION=5.1.3
##export VERSIONDATE=20220225
##export VERSION=5.1.10
##export VERSIONDATE=20220314
##export VERSION=5.1.12
##export VERSIONDATE=20220316
##export VERSION=5.1.15
##export VERSIONDATE=20220322
##export VERSION=5.1.18
##export VERSIONDATE=20220401
##export VERSION=5.1.20
##export VERSIONDATE=20220407
##export VERSION=5.1.28
##export VERSIONDATE=20220504
##export VERSION=5.1.29
##export VERSIONDATE=20220505
##export VERSION=5.1.30
##export VERSIONDATE=20220513
##export VERSION=5.1.31
##export VERSIONDATE=20220519
##export VERSION=5.1.43
##export VERSIONDATE=20220616
##export VERSION=5.1.45
##export VERSIONDATE=20220620
##export VERSION=5.1.51
##export VERSIONDATE=20220728
##export VERSION=5.1.55
##export VERSIONDATE=20220805
##export VERSION=5.1.58
##export VERSIONDATE=20220908
##export VERSION=5.1.61
##export VERSIONDATE=20220917
##export VERSION=5.1.64
##export VERSIONDATE=20220930
##export VERSION=5.1.66
##export VERSIONDATE=20221021
##export VERSION=5.1.67
##export VERSIONDATE=20221027
##export VERSION=5.1.71
##export VERSIONDATE=20221119
##export VERSION=5.1.72
##export VERSIONDATE=20221130
##export VERSION=5.2.0
##export VERSIONDATE=20221206
##export VERSION=5.2.1
##export VERSIONDATE=20221219
##export VERSION=5.2.2
##export VERSIONDATE=20221221
##export VERSION=5.2.4
##export VERSIONDATE=20221222
##export VERSION=5.2.6
##export VERSIONDATE=20221226
##export VERSION=5.2.9
##export VERSIONDATE=20230109
##export VERSION=5.2.11
##export VERSIONDATE=20230113
##export VERSION=5.2.12
##export VERSIONDATE=20230114
##export VERSION=5.2.13
##export VERSIONDATE=20230117
##export VERSION=5.2.15
##export VERSIONDATE=20230117
##export VERSION=5.2.16
##export VERSIONDATE=20230121
##export VERSION=5.2.21
##export VERSIONDATE=20230215
##export VERSION=5.2.22
##export VERSIONDATE=20230216
##export VERSION=5.2.23
##export VERSIONDATE=20230217
##export VERSION=5.2.24
##export VERSIONDATE=20230221
##export VERSION=5.2.25
##export VERSIONDATE=20230222
##export VERSION=5.2.27
##export VERSIONDATE=20230227
##export VERSION=5.2.28
##export VERSIONDATE=20230228
##export VERSION=5.2.29
##export VERSIONDATE=20230303
##export VERSION=5.2.30
##export VERSIONDATE=20230308
##export VERSION=5.2.32
##export VERSIONDATE=20230311
##export VERSION=5.2.33
##export VERSIONDATE=20230314
##export VERSION=5.2.34
##export VERSIONDATE=20230315
##export VERSION=5.2.37
##export VERSIONDATE=20230318
##export VERSION=5.2.42
##export VERSIONDATE=20230328
##export VERSION=5.2.43
##export VERSIONDATE=20230330
##export VERSION=5.2.45
##export VERSIONDATE=20230330
##export VERSION=5.2.48
##export VERSIONDATE=20230405
##export VERSION=5.2.49
##export VERSIONDATE=20230406
##export VERSION=5.2.51
##export VERSIONDATE=20230414
##export VERSION=5.2.52
##export VERSIONDATE=20230426
##export VERSION=5.2.53
##export VERSIONDATE=20230428
##export VERSION=5.2.54
##export VERSIONDATE=20230504
##export VERSION=5.2.55
##export VERSIONDATE=20230504
##export VERSION=5.2.57
##export VERSIONDATE=20230506
##export VERSION=5.2.58
##export VERSIONDATE=20230510
##export VERSION=5.2.59
##export VERSIONDATE=20230511
##export VERSION=5.2.61
##export VERSIONDATE=20230517
##export VERSION=5.2.62
##export VERSIONDATE=20230523
#####include/mediastreamer2/msogl_functions.h:45:14: fatal error: GLES2/gl2.h: No such file or directory
##export VERSION=5.2.64
##export VERSIONDATE=20230525
##export VERSION=5.2.70
##export VERSIONDATE=20230610
##export VERSION=5.2.71
##export VERSIONDATE=20230613
##export VERSION=5.2.73
##export VERSIONDATE=20230614
##export VERSION=5.2.75
##export VERSIONDATE=20230615
##export VERSION=5.2.81
##export VERSIONDATE=20230628
##export VERSION=5.2.83
##export VERSIONDATE=20230630
##export VERSION=5.2.86
##export VERSIONDATE=20230704
##export VERSION=5.2.87
##export VERSIONDATE=20230710
##export VERSION=5.2.88
##export VERSIONDATE=20230710
#####Could NOT find SRTP: Found unsuitable version "1", but required is at least "2"
##export VERSION=5.2.89
##export VERSIONDATE=20230712
##export VERSION=5.2.90
##export VERSIONDATE=20230717
##export VERSION=5.2.91
##export VERSIONDATE=20230718
##export VERSION=5.2.93
##export VERSIONDATE=20230725
##export VERSION=5.2.94
##export VERSIONDATE=20230729
##export VERSION=5.2.95
##export VERSIONDATE=20230809
##export VERSION=5.2.97
##export VERSIONDATE=20230822
##export VERSION=5.2.98
##export VERSIONDATE=20230824
##export VERSION=5.2.100
##export VERSIONDATE=20230905
##export VERSION=5.2.102
##export VERSIONDATE=20230908
##export VERSION=5.2.105
##export VERSIONDATE=20230919
##export VERSION=5.2.106
##export VERSIONDATE=20230920
##export VERSION=5.2.107
##export VERSIONDATE=20230922
##export VERSION=5.2.108
##export VERSIONDATE=20230926
##export VERSION=5.2.109
##export VERSIONDATE=20230929
##export VERSION=5.2.111
##export VERSIONDATE=20231030
#export VERSION=5.2.112
#export VERSIONDATE=20231208
##export VERSION=5.2.113
##export VERSIONDATE=20240214
##export VERSION=5.2.114
##export VERSIONDATE=20240307
#wl-showstatus --package-version
#export DEPENDENCIES=libdl,bcg729,bctoolbox,ffmpeg4,libbzrtp,libgsm,libopus,libortp,portaudio,pulseaudio,libspeex,libspeexdsp,sqlite3,srtp,libtheora,libxml2,libvpx
##export DEPENDENCIES=libdl,bcg729,bctoolbox,ffmpeg4,libbzrtp,libgsm,libopus,libortp,portaudio,pulseaudio,libspeex,libspeexdsp,sqlite3,srtp,libtheora,libxml2,libvpx,khronos-opengl-registry
#export OPTIONALDEPENDENCIES=bv16-floatingpoint,libjpeg-turbo,libyuv
##bcmatroska2,zxingcpp
#export BUILDDEPENDENCIES=cmake,ninja
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=LICENSE.txt
#export LICENSETYPE=GPL
##export DOWNLOADURL="https://github.com/BelledonneCommunications/mediastreamer2/releases"
#export DOWNLOADURL="https://github.com/BelledonneCommunications/mediastreamer2/tags"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=https://github.com/BelledonneCommunications/mediastreamer2/archive/$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://github.com/BelledonneCommunications/mediastreamer2/archive/refs/tags/$VERSION.tar.gz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#wl-showstatus extract
#tar xz --force-local -f $TARBALLDIR/$BASENAME/$VERSION.tar.gz
#cd $BASENAME-$VERSION
### fix src/videofilters/msmfoundationcap.cpp (version >= 4.5.1)
##patch -ulbf src/videofilters/msmfoundationcap.cpp << EOF
##@@ -404,4 +404,6 @@
##                hr = MFCreateAttributes(&attributes, 2);
##+#ifdef MF_READWRITE_DISABLE_CONVERTERS
##        if (SUCCEEDED(hr)) //get attributes
##                hr = attributes->SetUINT32(MF_READWRITE_DISABLE_CONVERTERS, TRUE);
##+#endif
##        if (SUCCEEDED(hr)) // Set the callback pointer.
##EOF
## fix missing src/videofilters/drawdib-display.c (version >= 4.4.24)
#sed -i.bak -e "s/GWL_USERDATA/GWLP_USERDATA/" src/videofilters/drawdib-display.c
### fix src/videofilters/msmfoundationcap.cpp (version >= 4.5.3)
##patch -ulbf src/videofilters/msmfoundationcap.cpp << EOF
##@@ -404,4 +404,6 @@
##                hr = MFCreateAttributes(&attributes, 2);
##+#ifdef MF_READWRITE_DISABLE_CONVERTERS
##        if (SUCCEEDED(hr)) //get attributes
##                hr = attributes->SetUINT32(MF_READWRITE_DISABLE_CONVERTERS, TRUE);
##+#endif
##        if (SUCCEEDED(hr)) // Set the callback pointer.
##EOF
## fix src/videofilters/msmfoundationcap.cpp (version >= 5.2.64)
#patch -ulbf src/videofilters/msmfoundationcap.cpp << EOF
#@@ -1384,2 +1384,3 @@
#                ms_error("[MSMFoundationCapDesk] Cannot create source reader because of failing attributes allocation [%X]", hr);
#+#ifdef MF_READWRITE_DISABLE_CONVERTERS
#        if (SUCCEEDED(hr)) //get attributes
#@@ -1388,2 +1389,3 @@
#                ms_error("[MSMFoundationCapDesk] Cannot create source reader because of failing attributes setting [%X]", hr);
#+#endif
#        if (SUCCEEDED(hr)) // Set the callback pointer.
#EOF
### fix undefined __in in src/utils/opengles_display.c (version >= 5.1.2)
##patch -ulbf src/utils/opengles_display.c << EOF
##@@ -996,3 +996,3 @@
##
##-LRESULT CALLBACK WindowProc(__in HWND hWindow,__in UINT uMsg,__in WPARAM wParam,__in LPARAM lParam) {
##+LRESULT CALLBACK WindowProc(HWND hWindow, UINT uMsg, WPARAM wParam, LPARAM lParam) {
##     switch (uMsg)
##EOF
## fix src/utils/opengles_display.c (version >= 5.2.64)
#patch -ulbf src/utils/opengles_display.c << EOF
#@@ -1045,2 +1045,5 @@
#
#+#ifndef __in
#+#define __in
#+#endif
# LRESULT CALLBACK WindowProc(__in HWND hWindow,__in UINT uMsg,__in WPARAM wParam,__in LPARAM lParam) {
#EOF
## fix invalid compiler flag -Wno-shorten-64-to-32 (version >= 4.5.0)
#sed -i.bak -e "s/-Wno-shorten-64-to-32//" CMakeLists.txt
## avoid precompiled header issue
#sed -i.bak -e "s?videofilters/msmfoundationcap\.h??" src/CMakeLists.txt
#mkdir -p build_win &&
# wl-showstatus configure &&
# #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DENABLE_STATIC:BOOL=ON -DENABLE_SHARED:BOOL=ON -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=OFF -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:STRING="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DCMAKE_C_FLAGS:STRING="-I$MINGWPREFIX/include/libdl-win32" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32" -S. -Bbuild_win &&
# #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DENABLE_STATIC:BOOL=ON -DENABLE_SHARED:BOOL=ON -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:STRING="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DCMAKE_C_FLAGS:STRING="-I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_win &&
# C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DENABLE_STATIC:BOOL=ON -DENABLE_SHARED:BOOL=ON -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:STRING="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DFFMPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/ffmpeg4/include -DLIBAVCODEC_INCLUDE_DIRS:PATH=$MINGWPREFIX/ffmpeg4/include -DLIBAVUTIL_INCLUDE_DIRS:PATH=$MINGWPREFIX/ffmpeg4/include -DLIBSWSCALE_INCLUDE_DIRS:PATH=$MINGWPREFIX/ffmpeg4/include -DCMAKE_C_FLAGS:STRING="-I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_win &&
# #-DENABLE_QRCODE:BOOL=ON -DCMAKE_CXX_FLAGS:STRING="-Dzxing=ZXing"
# #-DENABLE_MKV:BOOL=ON 
# #-DENABLE_GL:BOOL=ON
# # fix missing MFVideoFormat_NV12/MFCreateAttributes/MFEnumDeviceSources/QISearch
# #sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.* -ladvapi32/& -Wl,--as-needed -lmfplat -lmf -lmfreadwrite -lmfuuid -lshlwapi/" build_win/build.ninja &&
# # fix missing libraries (version >= 5.2.64)
# sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.* -ladvapi32/& -Wl,--as-needed -lmfplat -lmf -lmfreadwrite -lmfuuid -lshlwapi -lopengl32/" build_win/build.ninja &&
# # avoid precompiled header issue (version >= 5.2.64)
# sed -i.bak2 -e "s?^\(build src/libmediastreamer\.dll.*\) [^ ]*/msmfoundationcap\.h\.obj?\1?" build_win/build.ninja &&
# wl-showstatus build-install &&
# #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ninja -Cbuild_win install/strip &&
# C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} CXX_INCLUDE_PATH=$MINGWPREFIX/include/khronos${CXX_INCLUDE_PATH:+:$CXX_INCLUDE_PATH} ninja -Cbuild_win install/strip &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
#####TO DO: fix bcmatroska2 with -DENABLE_MKV:BOOL=ON
#####TO DO: fix precompiled header issues with build_win/src/CMakeFiles/mediastreamer.dir/videofilters/msmfoundationcap.h.obj
#####echo ""|g++ -c -xc++ - -o build_win/src/CMakeFiles/mediastreamer.dir/videofilters/msmfoundationcap.h.obj



export NAME="mediastreamer2"
export STATUS=
export URL=https://github.com/BelledonneCommunications/mediastreamer2
export BASENAME=mediastreamer2
export DESCRIPTION="Mediastreamer2 is a powerful and lightweight streaming engine for voice/video telephony applications. This media processing and streaming toolkit is responsible for receiving and sending all multimedia streams in Linphone, including voice/video capture, encoding and decoding, and rendering."
export CATEGORY=
export TYPE=library
#export VERSION=5.3.0
#export VERSIONDATE=20231221
#export VERSION=5.3.1
#export VERSIONDATE=20231222
#export VERSION=5.3.4
#export VERSIONDATE=20231226
#export VERSION=5.3.5
#export VERSIONDATE=20231229
#export VERSION=5.3.6
#export VERSIONDATE=20240103
#export VERSION=5.3.7
#export VERSIONDATE=20240105
#export VERSION=5.3.9
#export VERSIONDATE=20240113
#export VERSION=5.3.10
#export VERSIONDATE=20240116
#export VERSION=5.3.11
#export VERSIONDATE=20240123
#export VERSION=5.3.12
#export VERSIONDATE=20240123
#export VERSION=5.3.13
#export VERSIONDATE=20240125
#export VERSION=5.3.14
#export VERSIONDATE=20240131
#export VERSION=5.3.15
#export VERSIONDATE=20240202
#export VERSION=5.3.19
#export VERSIONDATE=20240205
#export VERSION=5.3.21
#export VERSIONDATE=20240216
#export VERSION=5.3.22
#export VERSIONDATE=20240221
#export VERSION=5.3.23
#export VERSIONDATE=20240222
#export VERSION=5.3.24
#export VERSIONDATE=20240227
#export VERSION=5.3.25
#export VERSIONDATE=20240228
#export VERSION=5.3.26
#export VERSIONDATE=20240301
#export VERSION=5.3.27
#export VERSIONDATE=20240307
#export VERSION=5.3.29
#export VERSIONDATE=20240307
#export VERSION=5.3.30
#export VERSIONDATE=20240309
#export VERSION=5.3.34
#export VERSIONDATE=20240311
#export VERSION=5.3.35
#export VERSIONDATE=20240320
#export VERSION=5.3.36
#export VERSIONDATE=20240321
#export VERSION=5.3.37
#export VERSIONDATE=20240326
#export VERSION=5.3.38
#export VERSIONDATE=20240329
#export VERSION=5.3.40
#export VERSIONDATE=20240404
#export VERSION=5.3.41
#export VERSIONDATE=20240409
#export VERSION=5.3.42
#export VERSIONDATE=20240416
#export VERSION=5.3.44
#export VERSIONDATE=20240419
#export VERSION=5.3.45
#export VERSIONDATE=20240426
#export VERSION=5.3.46
#export VERSIONDATE=20240430
#export VERSION=5.3.49
#export VERSIONDATE=20240515
#export VERSION=5.3.50
#export VERSIONDATE=20240516
#export VERSION=5.3.51
#export VERSIONDATE=20240522
#export VERSION=5.3.52
#export VERSIONDATE=20240523
#export VERSION=5.3.53
#export VERSIONDATE=20240528
#export VERSION=5.3.54
#export VERSIONDATE=20240530
#export VERSION=5.3.55
#export VERSIONDATE=20240603
#export VERSION=5.3.56
#export VERSIONDATE=20240604
#export VERSION=5.3.57
#export VERSIONDATE=20240608
#export VERSION=5.3.58
#export VERSIONDATE=20240618
#export VERSION=5.3.60
#export VERSIONDATE=20240620
#export VERSION=5.3.61
#export VERSIONDATE=20240626
#export VERSION=5.3.62
#export VERSIONDATE=20240629
#export VERSION=5.3.63
#export VERSIONDATE=20240708
#export VERSION=5.3.65
#export VERSIONDATE=20240709
#export VERSION=5.3.67
#export VERSIONDATE=20240710
#export VERSION=5.3.69
#export VERSIONDATE=20240712
#export VERSION=5.3.70
#export VERSIONDATE=20240716
#export VERSION=5.3.71
#export VERSIONDATE=20240717
#export VERSION=5.3.72
#export VERSIONDATE=20240719
#export VERSION=5.3.73
#export VERSIONDATE=20240725
#export VERSION=5.3.74
#export VERSIONDATE=20240726
#export VERSION=5.3.75
#export VERSIONDATE=20240808
#export VERSION=5.3.77
#export VERSIONDATE=20240821
#export VERSION=5.3.78
#export VERSIONDATE=20240823
#export VERSION=5.3.79
#export VERSIONDATE=20240903
#export VERSION=5.3.81
#export VERSIONDATE=20240907
#export VERSION=5.3.83
#export VERSIONDATE=20240913
#export VERSION=5.3.84
#export VERSIONDATE=20240918
#export VERSION=5.3.85
#export VERSIONDATE=20240919
#export VERSION=5.3.86
#export VERSIONDATE=20240927
#export VERSION=5.3.87
#export VERSIONDATE=20241002
#export VERSION=5.3.88
#export VERSIONDATE=20241003
#export VERSION=5.3.89
#export VERSIONDATE=20241010
#export VERSION=5.3.90
#export VERSIONDATE=20241015
#export VERSION=5.3.92
#export VERSIONDATE=20241023
#export VERSION=5.3.93
#export VERSIONDATE=20241025
#export VERSION=5.3.94
#export VERSIONDATE=20241029
#export VERSION=5.3.95
#export VERSIONDATE=20241107
#export VERSION=5.3.96
#export VERSIONDATE=20241130
#export VERSION=5.3.97
#export VERSIONDATE=20241206
#export VERSION=5.3.99
#export VERSIONDATE=20241216
#export VERSION=5.3.100
#export VERSIONDATE=20241219
#export VERSION=5.3.101
#export VERSIONDATE=20250106
#export VERSION=5.3.102
#export VERSIONDATE=20250110
#export VERSION=5.3.103
#export VERSIONDATE=20250114
#export VERSION=5.3.104
#export VERSIONDATE=20250123
#export VERSION=5.3.105
#export VERSIONDATE=20250211
#export VERSION=5.3.106
#export VERSIONDATE=20250305
#export VERSION=5.3.107
#export VERSIONDATE=20250317
#export VERSION=5.3.111
#export VERSIONDATE=20250620
#export VERSION=5.3.112
#export VERSIONDATE=20250814
#export VERSION=5.3.113
#export VERSIONDATE=20251222
#export VERSION=5.4.0
#export VERSIONDATE=20250311
#export VERSION=5.4.7
#export VERSIONDATE=20250408
#export VERSION=5.4.9
#export VERSIONDATE=20250416
#export VERSION=5.4.11
#export VERSIONDATE=20250424
#export VERSION=5.4.12
#export VERSIONDATE=20250429
#export VERSION=5.4.13
#export VERSIONDATE=20250502
#export VERSION=5.4.14
#export VERSIONDATE=20250506
#export VERSION=5.4.16
#export VERSIONDATE=20250514
#export VERSION=5.4.17
#export VERSIONDATE=20250516
#export VERSION=5.4.18
#export VERSIONDATE=20250519
#export VERSION=5.4.19
#export VERSIONDATE=20250523
#export VERSION=5.4.20
#export VERSIONDATE=20250527
####Could NOT find QtAngle (missing: QtAngle_INCLUDE_DIRS)
#export VERSION=5.4.21
#export VERSIONDATE=20250606
#export VERSION=5.4.23
#export VERSIONDATE=20250618
#export VERSION=5.4.24
#export VERSIONDATE=20250625
#export VERSION=5.4.26
#export VERSIONDATE=20250711
#export VERSION=5.4.28
#export VERSIONDATE=20250723
#export VERSION=5.4.29
#export VERSIONDATE=20250723
#export VERSION=5.4.30
#export VERSIONDATE=20250726
#export VERSION=5.4.31
#export VERSIONDATE=20250730
#export VERSION=5.4.33
#export VERSIONDATE=20250801
#export VERSION=5.4.34
#export VERSIONDATE=20250807
#export VERSION=5.4.35
#export VERSIONDATE=20250811
#export VERSION=5.4.36
#export VERSIONDATE=20250813
#export VERSION=5.4.37
#export VERSIONDATE=20250813
#export VERSION=5.4.38
#export VERSIONDATE=20250821
#export VERSION=5.4.40
#export VERSIONDATE=20250830
#export VERSION=5.4.42
#export VERSIONDATE=20250905
#export VERSION=5.4.43
#export VERSIONDATE=20250910
#export VERSION=5.4.44
#export VERSIONDATE=20250915
#export VERSION=5.4.45
#export VERSIONDATE=20250923
#export VERSION=5.4.46
#export VERSIONDATE=20250925
#export VERSION=5.4.47
#export VERSIONDATE=20251001
#export VERSION=5.4.48
#export VERSIONDATE=20251010
#export VERSION=5.4.49
#export VERSIONDATE=20251013
#export VERSION=5.4.50
#export VERSIONDATE=20251016
#export VERSION=5.4.51
#export VERSIONDATE=20251029
#export VERSION=5.4.52
#export VERSIONDATE=20251030
#export VERSION=5.4.53
#export VERSIONDATE=20251031
#export VERSION=5.4.54
#export VERSIONDATE=20251101
#export VERSION=5.4.55
#export VERSIONDATE=20251101
#export VERSION=5.4.56
#export VERSIONDATE=20251103
#export VERSION=5.4.57
#export VERSIONDATE=20251106
#export VERSION=5.4.58
#export VERSIONDATE=20251112
####src/voip/audiostream.c:272:35: error: implicit declaration of function 'rtp_bundle_get_session_mid'
#export VERSION=5.4.59
#export VERSIONDATE=20251113
#export VERSION=5.4.60
#export VERSIONDATE=20251114
#export VERSION=5.4.61
#export VERSIONDATE=20251124
#export VERSION=5.4.63
#export VERSIONDATE=20251128
#export VERSION=5.4.64
#export VERSIONDATE=20251128
#export VERSION=5.4.65
#export VERSIONDATE=20251129
#export VERSION=5.4.66
#export VERSIONDATE=20251202
#export VERSION=5.4.67
#export VERSIONDATE=20251203
#export VERSION=5.4.68
#export VERSIONDATE=20251216
#export VERSION=5.4.69
#export VERSIONDATE=20251219
#export VERSION=5.4.71
#export VERSIONDATE=20251222
#export VERSION=5.4.72
#export VERSIONDATE=20251225
#export VERSION=5.4.73
#export VERSIONDATE=20260106
export VERSION=5.4.74
export VERSIONDATE=20260112
wl-showstatus --package-version
export DEPENDENCIES=libdl,bcg729,bctoolbox,ffmpeg4,libbzrtp,libgsm,libopus,libortp,portaudio,pulseaudio,libspeex,libspeexdsp,sqlite3,srtp,libtheora,libxml2,libvpx
#export DEPENDENCIES=libdl,bcg729,bctoolbox,ffmpeg4,libbzrtp,libgsm,libopus,libortp,portaudio,pulseaudio,libspeex,libspeexdsp,sqlite3,srtp,libtheora,libxml2,libvpx,khronos-opengl-registry
export OPTIONALDEPENDENCIES=bv16-floatingpoint,libjpeg-turbo,libyuv
#bcmatroska2,zxingcpp
export BUILDDEPENDENCIES=cmake,ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE.txt
export LICENSETYPE=GPL
export DOWNLOADURL="https://github.com/BelledonneCommunications/mediastreamer2/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/BelledonneCommunications/mediastreamer2/archive/refs/tags/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix ffmpeg issues in src/utils/ffmpeg-priv.h (version >= 5.3.0)
mv src/utils/ffmpeg-priv.h src/utils/ffmpeg-priv.h.bak
cat > src/utils/ffmpeg-priv.h << EOF
#include <libavutil/pixfmt.h>
#include <libswscale/swscale.h>
#include <libavcodec/avcodec.h>
#include <libavcodec/codec_id.h>
#include <libavcodec/version.h>
#define HAVE_FUN_avcodec_encode_video2
#define HAVE_FUN_avcodec_get_context_defaults3
#define HAVE_FUN_avcodec_open2
#define HAVE_FUN_av_frame_alloc
#define HAVE_FUN_av_frame_free
#define HAVE_FUN_av_frame_unref
#define HAVE_LIBAVCODEC_AVCODEC_H
#define HAVE_LIBSWSCALE_SWSCALE_H
EOF
cat src/utils/ffmpeg-priv.h.bak >> src/utils/ffmpeg-priv.h
# fix src/videofilters/ffmpegjpegwriter.c (version >= 5.3.0)
patch -ulbf src/videofilters/ffmpegjpegwriter.c << EOF
@@ -213,2 +213,3 @@

+end:
        freemsg(m);
EOF
# fix undefined __in in src/utils/opengles_display.c (version >= 5.3.0)
sed -i.bak -e "s/__in //g" src/utils/opengles_display.c
# fix missing min() and ceil() in src/videofilters/msmfoundationcap.cpp (version >= 5.4.43)
patch -ulbf src/videofilters/msmfoundationcap.cpp << EOF
@@ -32,4 +32,7 @@
 #include <vector>
+#include <math.h>

+#ifndef __MINGW32__
 #pragma comment(lib, "mfuuid.lib") // MFVideoFormat symbols
+#endif

@@ -1136,3 +1139,3 @@
                } else {
-                       ms_error("[MSMFoundationCapDesk] Cannot get devices because of failed CoInitialize [%X]", hr);
+                       ms_error("[MSMFoundationCapDesk] Cannot get devices because of failed CoInitialize [%X]", (uintptr_t)hr);
                        return hr;
@@ -1468,4 +1471,5 @@
                                        // One or more sample requests are still pending. Try to stop and go.
-                                       int oneFrameTimeout =
-                                           min(1000, ceil(1000 / (static_cast<float>(oldFpsNumerator) / oldFpsDenominator)));
+                                       int oneFrameTimeout = ceil(1000 / (static_cast<float>(oldFpsNumerator) / oldFpsDenominator));
+                                        if (oneFrameTimeout > 1000)
+                                                   oneFrameTimeout = 1000;
                                        stop(0);
EOF
# fix src/utils/opengles_display.cpp (version >= 5.4.54)
patch -ulbf src/utils/opengles_display.cpp << EOF
@@ -1272,2 +1272,5 @@

+#ifndef __in
+#define __in
+#endif
 LRESULT CALLBACK WindowProc(__in HWND hWindow, __in UINT uMsg, __in WPARAM wParam, __in LPARAM lParam) {
EOF
# fix IMPORTED_LOCATION not set errors (version >= 5.3.0)
sed -i.bak -e "s/\(if(\)WIN32/\1MSVC/" $(grep -l "if(WIN32)" cmake/*.cmake)
# fix missing -lm in cmake/FindOpus.cmake (version >= 5.3.1)
patch -ulbf cmake/FindOpus.cmake << EOF
@@ -63,3 +63,3 @@
        find_library(_Opus_LIBRARY NAMES opus)
-       if(_Opus_LIBRARY)
+       if(_Opus_LIBRARY AND NOT MINGW)
                find_library(_m_LIBRARY NAMES m)
EOF
mkdir -p build_static build_shared &&
 wl-showstatus configure &&
 #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DCMAKE_C_FLAGS:STRING="-I$(cygpath -m $MINGWPREFIX/include/libdl-win32) -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_static &&
 C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DCMAKE_C_FLAGS:STRING="-I$(cygpath -m $MINGWPREFIX/include/libdl-win32) -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPython3_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_static &&
 #-DPython3_EXECUTABLE:FILEPATH=$PYDIR/python.exe 
 #-DENABLE_QRCODE:BOOL=ON -DCMAKE_CXX_FLAGS:STRING="-Dzxing=ZXing"
 #-DENABLE_MKV:BOOL=ON 
 #-DENABLE_GL:BOOL=ON
 # fix missing libraries (version >= 5.3.0)
 sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.* -ladvapi32/& -Wl,--as-needed -lmfplat -lmfreadwrite -lmfuuid -lmf -lopengl32 -lshlwapi/" build_static/build.ninja &&
 #wl-showstatus configure &&
 #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DCMAKE_C_FLAGS:STRING="-I$(cygpath -m $MINGWPREFIX/include/libdl-win32) -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_shared &&
 ##C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_STRICT:BOOL=OFF -DENABLE_PORTAUDIO:BOOL=ON -DENABLE_PULSEAUDIO:BOOL=ON -DENABLE_GL:BOOL=ON -DENABLE_BV16:BOOL=ON -DENABLE_QRCODE:BOOL=OFF -DENABLE_MKV:BOOL=OFF -DENABLE_TOOLS:BOOL=ON -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DCMAKE_C_FLAGS:STRING="-I$(cygpath -m $MINGWPREFIX/include/libdl-win32) -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DCMAKE_CXX_FLAGS:STRING="-fpermissive -DWIN32 -I$MINGWPREFIX/include/libdl-win32 -I$(cygpath -m $MINGWPREFIX/ffmpeg4/include) -I$(cygpath -m $MINGWPREFIX/include/khronos)" -DPython3_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_shared &&
 ## fix missing libraries (version >= 5.3.0)
 #sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.* -ladvapi32/& -Wl,--as-needed -lmfplat -lmfreadwrite -lmfuuid -lmf -lopengl32 -lshlwapi/" build_shared/build.ninja &&
 wl-showstatus build-install &&
 C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} CXX_INCLUDE_PATH=$MINGWPREFIX/include/khronos${CXX_INCLUDE_PATH:+:$CXX_INCLUDE_PATH} ninja -Cbuild_static install/strip &&
 #wl-showstatus build-install &&
 #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/include/khronos${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} CXX_INCLUDE_PATH=$MINGWPREFIX/include/khronos${CXX_INCLUDE_PATH:+:$CXX_INCLUDE_PATH} ninja -Cbuild_shared install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



