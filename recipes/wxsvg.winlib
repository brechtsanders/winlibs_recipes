export NAME="wxSVG"
export STATUS=
export URL=http://wxsvg.sourceforge.net/
export BASENAME=wxsvg
export DESCRIPTION="wxSVG is C++ library to create, manipulate and render SVG files."
export CATEGORY=graphics,fileformat
export TYPE=library
#export VERSION=1.5.22
#export VERSIONDATE=20210510
export VERSION=1.5.23
export VERSIONDATE=20211103
wl-showstatus --package-version
#export DEPENDANCIES=expat,libexif,cairo,wxwidgets,libdl,libav
export DEPENDANCIES=expat,libexif,cairo,wxwidgets,libdl,ffmpeg4
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=wx-config-win
export LICENSEFILE=COPYING
export LICENSETYPE="wxWindows Library License"
export DOWNLOADURL="https://sourceforge.net/projects/wxsvg/files/wxsvg/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://downloads.sourceforge.net/project/wxsvg/wxsvg/$VERSION/$BASENAME-$VERSION.tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
cd $BASENAME-$VERSION
# fix ambiguous byte in src/mediadec_ffmpeg.cpp (version >= 1.5.22)
mv src/mediadec_ffmpeg.cpp src/mediadec_ffmpeg.cpp.bak &&
echo "#define UNICODE" > src/mediadec_ffmpeg.cpp &&
echo "#include <windows.h>" >> src/mediadec_ffmpeg.cpp &&
cat src/mediadec_ffmpeg.cpp.bak >> src/mediadec_ffmpeg.cpp
wl-showstatus configure &&
 #WXCFG=gcc_dll/mswu ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-libav --enable-render=cairo --with-wx-config=$(which wx-config.exe) LIBAV_CFLAGS="-I$MINGWPREFIX/libav/include" LIBAV_LIBS="-Wl,--as-needed -L$MINGWPREFIX/libav/lib -lswscale -lavformat -lavutil -lavcodec" CFLAGS="-I$MINGWPREFIX/include/libdl-win32" LDFLAGS="-L$MINGWPREFIX/wx/lib/gcc_dll -Wl,--as-needed -ldl" &&
 WXCFG=gcc_dll/mswu ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-libav --enable-render=cairo --with-wx-config=$(which wx-config.exe) LIBAV_CFLAGS="-I$MINGWPREFIX/ffmpeg4/include" LIBAV_LIBS="-Wl,--as-needed -L$MINGWPREFIX/ffmpeg4/lib -lswscale -lavformat -lavutil -lavcodec" CFLAGS="-I$MINGWPREFIX/include/libdl-win32" LDFLAGS="-L$MINGWPREFIX/wx/lib/gcc_dll -Wl,--as-needed -ldl" &&
 ## fix building DLLs
 #sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 ## fix detection of shared libraries
 #sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1file_magic ^x86 archive import|^x86 DLL|PE32+* executable (DLL)|pe-i386|pe-x86-64/; s/'file format pe-i386[^']*'/\"\$deplibs_check_method\"/" libtool &&
 #sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1none/" libtool &&
 #wl-showstatus build &&
 #make &&
 wl-showstatus build-install &&
 make install-strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####PATH=$PATH:$MINGWPREFIX/libav/bin:$MINGWPREFIX/wx/lib/gcc_dll svgview.exe
####PATH=$PATH:$MINGWPREFIX/ffmpeg4/bin:$MINGWPREFIX/wx/lib/gcc_dll svgview.exe



