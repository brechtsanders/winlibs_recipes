#export NAME="evince"
#export STATUS=
#export URL=http://www.gnome.org/projects/evince
#export BASENAME=evince
#export DESCRIPTION="Evince is a document viewer for multiple document formats. The goal of evince is to replace the multiple document viewers that exist on the GNOME Desktop with a single simple application."
#export CATEGORY=fileformat
#export TYPE=application
##export VERSION=3.0.0
##export VERSIONDATE=20110405
##export VERSION=3.0.2
##export VERSIONDATE=20110524
##export VERSION=3.1.2
##export VERSIONDATE=20110614
##export VERSION=3.2.0
##export VERSIONDATE=20110927
##export VERSION=3.2.1
##export VERSIONDATE=20111018
##export VERSION=3.3.2
##export VERSIONDATE=20111123
##export VERSION=3.3.3.1
##export VERSIONDATE=20120116
##export VERSION=3.3.4
##export VERSIONDATE=20120117
##export VERSION=3.3.5
##export VERSIONDATE=20120207
##export VERSION=3.3.90
##export VERSIONDATE=20120222
##export VERSION=3.3.92
##export VERSIONDATE=20120319
##export VERSION=3.4.0
##export VERSIONDATE=20120326
##export VERSION=3.5.2
##export VERSIONDATE=20120606
#####include/w32api/winnt.h:476:6: error: missing binary operator before token "be"
##export VERSION=3.5.3
##export VERSIONDATE=20120626
##export VERSION=3.5.4
##export VERSIONDATE=20120717
##export VERSION=3.5.5
##export VERSIONDATE=20120808
##export VERSION=3.5.92
##export VERSIONDATE=20120918
#####cut-n-paste/toolbar-editor/egg-toolbars-model.c:740: undefined reference to `g_type_ensure'
##export VERSION=3.6.0
##export VERSIONDATE=20120927
##export VERSION=3.6.1
##export VERSIONDATE=20121015
##export VERSION=3.7.1
##export VERSIONDATE=20121023
##export VERSION=3.7.4
##export VERSIONDATE=20130113
##export VERSION=3.7.5
##export VERSIONDATE=20130203
##export VERSION=3.8.0
##export VERSIONDATE=20130326
##export VERSION=3.8.2
##export VERSIONDATE=20130515
##export VERSION=3.8.3
##export VERSIONDATE=20130709
##export VERSION=3.9.2
##export VERSIONDATE=20130529
##export VERSION=3.9.3
##export VERSIONDATE=20130619
##export VERSION=3.9.4
##export VERSIONDATE=20130709
##export VERSION=3.9.5
##export VERSIONDATE=20130731
##export VERSION=3.10.0
##export VERSIONDATE=20130924
##export VERSION=3.10.2
##export VERSIONDATE=20131112
##export VERSION=3.10.3
##export VERSIONDATE=20131116
#####cut-n-paste/smclient/eggsmclient-win32.c:287:1: error: no previous prototype for 'sm_client_win32_window_procedure' [-Werror=missing-prototypes]
##export VERSION=3.11.1
##export VERSIONDATE=20131030
##export VERSION=3.11.3
##export VERSIONDATE=20131219
#####configure: error: gdbus-codegen not found
##export VERSION=3.12.0
##export VERSIONDATE=20140326
##export VERSION=3.12.1
##export VERSIONDATE=20140418
#export VERSION=3.12.2
#export VERSIONDATE=20140808
##### GLib-GIO-ERROR **: Settings schema 'org.gnome.system.proxy' is not installed
##export VERSION=3.13.3.1
##export VERSIONDATE=20140625
#####Requested 'gtk+-3.0 >= 3.10.0' but version of GTK+ is 3.8.9
##export VERSION=3.14.0
##export VERSIONDATE=20140924
##export VERSION=3.14.1
##export VERSIONDATE=20141014
#####browser-plugin/npapi/npfunctions.h:294:73: error: conflicting declaration 'typedef NPError (* NP_InitializeFunc)(NPNetscapeFuncs*, NPPluginFuncs*)'
##export VERSION=3.14.2
##export VERSIONDATE=20150308
#####configure: error: glib-compile-resources not found
##export VERSION=3.16.0
##export VERSIONDATE=20150324
##export VERSION=3.16.1
##export VERSIONDATE=20150527
##export VERSION=3.17.1
##export VERSIONDATE=20150430
##export VERSION=3.17.2
##export VERSIONDATE=20150527
##export VERSION=3.17.3
##export VERSIONDATE=20150622
##export VERSION=3.17.4
##export VERSIONDATE=20150721
#####browser-plugin/npapi/npfunctions.h:294:73: error: conflicting declaration 'typedef NPError (* NP_InitializeFunc)(NPNetscapeFuncs*, NPPluginFuncs*)'
##export VERSION=3.18.0
##export VERSIONDATE=20150922
#####backend/pdf/ev-poppler.cc:3699:33: error: 'write' was not declared in this scope
##export VERSION=3.18.1
##export VERSIONDATE=20151022
##export VERSION=3.18.2
##export VERSIONDATE=20151112
##export VERSION=3.20.0
##export VERSIONDATE=20160322
##export VERSION=3.20.1
##export VERSIONDATE=20160624
##export VERSION=3.20.2
##export VERSIONDATE=20170724
##export VERSION=3.21.3
##export VERSIONDATE=20160621
##export VERSION=3.21.4
##export VERSIONDATE=20160720
##export VERSION=3.22.0
##export VERSIONDATE=20160921
##export VERSION=3.22.1
##export VERSIONDATE=20161012
##export VERSION=3.22.2
##export VERSIONDATE=20170724
##export VERSION=3.24.0
##export VERSIONDATE=20170320
##export VERSION=3.24.1
##export VERSIONDATE=20170724
##export VERSION=3.24.2
##export VERSIONDATE=20170930
##export VERSION=3.25.4
##export VERSIONDATE=20170724
##export VERSION=3.26.0
##export VERSIONDATE=20170912
##export VERSION=3.28.0
##export VERSIONDATE=20180313
##export VERSION=3.28.2
##export VERSIONDATE=20180410
##export VERSION=3.28.3
##export VERSIONDATE=20180903
##export VERSION=3.28.4
##export VERSIONDATE=20180930
##export VERSION=3.28.5
##export VERSIONDATE=20181024
##export VERSION=3.29.1
##export VERSIONDATE=20180717
#####browser-plugin/npapi/npfunctions.h:294:73: error: conflicting declaration 'typedef NPError (* NP_InitializeFunc)(NPNetscapeFuncs*, NPPluginFuncs*)'
##export VERSION=3.30.0
##export VERSIONDATE=20180804
##export VERSION=3.30.1
##export VERSIONDATE=20180930
##export VERSION=3.30.2
##export VERSIONDATE=20181024
##export VERSION=3.31.1
##export VERSIONDATE=20181009
##export VERSION=3.31.2
##export VERSIONDATE=20181114
##export VERSION=3.31.3
##export VERSIONDATE=20181212
##export VERSION=3.31.4
##export VERSIONDATE=20190108
##export VERSION=3.32.0
##export VERSIONDATE=20190314
##export VERSION=3.34.0
##export VERSIONDATE=20190930
##export VERSION=3.34.1
##export VERSIONDATE=20191008
##export VERSION=3.34.2
##export VERSIONDATE=20191124
##export VERSION=3.35.1
##export VERSIONDATE=20191124
##export VERSION=3.36.0
##export VERSIONDATE=20200307
##export VERSION=3.36.1
##export VERSIONDATE=20200519
##export VERSION=3.36.2
##export VERSIONDATE=20200530
##export VERSION=3.36.3
##export VERSIONDATE=20200531
##export VERSION=3.36.4
##export VERSIONDATE=20200610
##export VERSION=3.36.5
##export VERSIONDATE=20200612
##export VERSION=3.36.6
##export VERSIONDATE=20200619
##export VERSION=3.36.7
##export VERSIONDATE=20200704
##export VERSION=3.36.8
##export VERSIONDATE=20210125
##export VERSION=3.36.9
##export VERSIONDATE=20210201
##export VERSION=3.36.10
##export VERSIONDATE=20210214
#####msgfmt: cannot locate ITS rules for backend/evince-djvudocument.metainfo.xml.in
##export VERSION=3.37.1
##export VERSIONDATE=20200530
##export VERSION=3.37.2
##export VERSIONDATE=20200531
##export VERSION=3.37.3
##export VERSIONDATE=20200705
##export VERSION=3.38.0
##export VERSIONDATE=20200913
##export VERSION=3.38.1
##export VERSIONDATE=20210125
##export VERSION=3.38.2
##export VERSIONDATE=20210214
##export VERSION=3.39.1
##export VERSIONDATE=20210125
##export VERSION=3.39.2
##export VERSIONDATE=20210214
#####libdocument/ev-file-helpers.c:142:36: error: 'O_CLOEXEC' undeclared (first use in this function)
##export VERSION=40.0
##export VERSIONDATE=20210326
##export VERSION=40.1
##export VERSIONDATE=20210327
##export VERSION=40.2
##export VERSIONDATE=20210609
##export VERSION=40.3
##export VERSIONDATE=20210713
##export VERSION=40.4
##export VERSIONDATE=20210716
##export VERSION=41.2
##export VERSIONDATE=20211010
##export VERSION=41.3
##export VERSIONDATE=20211121
#####msgfmt: cannot locate ITS rules for backend/evince-comicsdocument.metainfo.xml.in
#wl-showstatus --package-version
#export DEPENDANCIES=atk,cairo,pango,gail,glib2,gtk3,poppler,libxml2,zlib,gettext
##export DEPENDANCIES=atk,cairo,pango,gail,glib2,gtk3,poppler,libxml2,zlib,gettext,libhandy
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=itstool
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/evince/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix shell/main.c
#mv shell/main.c shell/main.c.bak
#echo "#define _WIN32_WINNT 0x0501" > shell/main.c
#cat shell/main.c.bak >> shell/main.c
## fix thumbnailer/evince-thumbnailer.c
#mv thumbnailer/evince-thumbnailer.c thumbnailer/evince-thumbnailer.c.bak
#echo "#define _WIN32_WINNT 0x0501" > thumbnailer/evince-thumbnailer.c
#cat thumbnailer/evince-thumbnailer.c.bak >> thumbnailer/evince-thumbnailer.c
## fix missing gtk_widget_get_window in cut-n-paste/totem-screensaver/totem-scrsaver.c
#patch -ulbf cut-n-paste/totem-screensaver/totem-scrsaver.c << EOF
#--- cut-n-paste/totem-screensaver/totem-scrsaver.c
#+++ cut-n-paste/totem-screensaver/totem-scrsaver.c
#@@ -163,8 +163,12 @@ screensaver_inhibit_dbus (TotemScrsaver *scr,
#    xid = 0;
#    if (scr->priv->window != NULL) {
#      window = gtk_widget_get_window (GTK_WIDGET (scr->priv->window));
#+#ifdef GDK_WINDOWING_X11
#      if (window != NULL)
#        xid = gdk_x11_window_get_xid (window);
#+#else
#+#warning Unimplemented
#+#endif
#    }
#EOF
## fix missing ATTACH_PARENT_PROCESS (version >= 3.3.2)
#mv previewer/ev-previewer.c previewer/ev-previewer.c.bak
#echo "#define _WIN32_WINNT 0x0501" > previewer/ev-previewer.c
#cat previewer/ev-previewer.c.bak >> previewer/ev-previewer.c
## fix missing write in backend/pdf/ev-poppler.cc (version >= 3.18.0)
#mv backend/pdf/ev-poppler.cc backend/pdf/ev-poppler.cc.bak
#echo "#include <io.h>" > backend/pdf/ev-poppler.cc
#cat backend/pdf/ev-poppler.cc.bak >> backend/pdf/ev-poppler.cc
## fix missing folder (version >= 3.31.4)
#mkdir -p include
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
#wl-showstatus configure &&
### remove dependancy on dynamic libstdc++ (GCC 4)
##mv libtool libtool.bak &&
##sed -e "s/-lstdc++/-lstdc++_s -lsupc++/" libtool.bak > libtool &&
##INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-platform=win32 --disable-introspection LDFLAGS="-no-undefined -Wl,-no-undefined -Wl,--as-needed -lz" &&
##PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-platform=win32 --disable-introspection LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lz" &&
##INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-platform=win32 --disable-introspection LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lz" &&
#INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-platform=win32 --disable-introspection CFLAGS="-Wno-error=format-y2k -Wno-error=format-nonliteral" LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lz" &&
# wl-showstatus build-install &&
# #( make install-strip || make -j1 install-strip || make -j1 install-strip LIBS="-Wl,--as-needed -lgmodule-2.0" ) &&
# #(
# # PATH=$PATH:$PERLDIR/../c/bin make install-strip || 
# # PATH=$PATH:$PERLDIR/../c/bin make -j1 install-strip || 
# # make -j1 install-strip LIBS="-Wl,--as-needed -lgmodule-2.0" ||
# # PATH=$PATH:$PERLDIR/../c/bin PYTHONPATH=$PYTHONPATH:$MINGWPREFIX/python/lib/site-packages make -j1 install-strip ITSTOOL="$PYDIR/python.exe $(which itstool)" gtk_update_icon_cache="$(which true)"
# #) &&
# (
#  PATH=$PYDIR:$PATH:$PERLDIR/../c/bin make install-strip || 
#  PATH=$PYDIR:$PATH:$PERLDIR/../c/bin make -j1 install-strip || 
#  make -j1 install-strip LIBS="-Wl,--as-needed -lgmodule-2.0" ||
#  PATH=$PYDIR:$PATH:$PERLDIR/../c/bin PYTHONPATH=$PYTHONPATH:$MINGWPREFIX/python/lib/site-packages make -j1 install-strip ITSTOOL="$PYDIR/python.exe $(which itstool)" gtk_update_icon_cache="$(which true)"
# ) &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
#####shell/crsaver.c:167: undefined reference to `gdk_x11_window_get_xid'
#####*** Icon cache not updated.  After (un)install, run this: gtk-update-icon-cache -f -t $MINGWPREFIX/share/icons/hicolor



export NAME="evince"
export STATUS=
export URL=http://www.gnome.org/projects/evince
export BASENAME=evince
export DESCRIPTION="Evince is a document viewer for multiple document formats. The goal of evince is to replace the multiple document viewers that exist on the GNOME Desktop with a single simple application."
export CATEGORY=fileformat
export TYPE=application
#export VERSION=40.0
#export VERSIONDATE=20210326
#export VERSION=40.1
#export VERSIONDATE=20210327
#export VERSION=40.2
#export VERSIONDATE=20210609
#export VERSION=40.3
#export VERSIONDATE=20210713
#export VERSION=40.4
#export VERSIONDATE=20210716
#export VERSION=41.2
#export VERSIONDATE=20211010
####msgfmt: cannot locate ITS rules for backend/evince-comicsdocument.metainfo.xml.in
#export VERSION=41.3
#export VERSIONDATE=20211121
export VERSION=41.4
export VERSIONDATE=20220314
#export VERSION=42.0
#export VERSIONDATE=20220318
#export VERSION=42.1
#export VERSIONDATE=20220319
wl-showstatus --package-version
export DEPENDANCIES=atk,cairo,pango,gail,glib2,gtk3,poppler,libxml2,zlib,gettext,libhandy
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=itstool
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/evince/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing ev_application_unregister_uri in shell/ev-application.c (version >= 40.2)
patch -ulbf shell/ev-application.c << EOF
@@ -1180,3 +1180,5 @@
 {
+#ifdef ENABLE_DBUS
        ev_application_unregister_uri (application, application->uri);
+#endif
        g_clear_pointer (&application->uri, g_free);
EOF
# fix missing ldflag in shell/meson.build (version >= 3.36.7 <= 41.4)
patch -ulbf shell/meson.build << EOF
@@ -87,3 +87,3 @@

-  ldflag += custom_target(
+  ldflag = custom_target(
     resource,
EOF
## fix shell/meson.build (version >= 42.0)
#patch -ulbf shell/meson.build << EOF
#@@ -76,3 +76,3 @@
#
#-  evince_ldflag += custom_target(
#+  evince_ldflags += custom_target(
#     resource,
#EOF
# fix error: Function does not take positional arguments (version >= 41.4)
patch -ulbf backend/meson.build << EOF
@@ -55,3 +55,2 @@
   i18n.merge_file(
-    appstream,
     input: appstream_in,
EOF
patch -ulbf data/meson.build << EOF
@@ -17,3 +17,2 @@
   i18n.merge_file(
-    desktop,
     type: 'desktop',
EOF
patch -ulbf meson.build << EOF
@@ -500,3 +500,2 @@
 i18n.merge_file(
-  appdata,
   input: appdata + '.in',
EOF
# fix unknown variable gtk_unix_print_dep
sed -i.bak -e "s/^\(\s*enable_gtk_unix_print\s*=\s*\).*$/\1false/" meson.build
sed -i.bak -e "s/gtk_unix_print_dep,//" libview/meson.build
# fix missing gio-unix
sed -i.bak2 -e "s/gio-unix-/gio-windows-/" meson.build
mkdir -p build_both &&
 wl-showstatus configure &&
 #PKG_CONFIG= PYTHONPATH=$PYTHONPATH:$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dplatform=win32 -Dps=enabled -Dbrowser_plugin=false -Dnautilus=false -Dgtk_unix_print=disabled -Dsystemduserunitdir=no -Dgtk_doc=false . build_both &&
 PKG_CONFIG= PYTHONPATH=$PYTHONPATH:$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dplatform=win32 -Dps=enabled -Dnautilus=false -Dgtk_unix_print=disabled -Dsystemduserunitdir=no -Dgtk_doc=false -Duser_doc=false . build_both &&
 #-Dpreviewer=false
 # fix execution of Python scripts
 sed -i.bak -e "s?\(COMMAND\|POST_BUILD\)\( *= *\| *=.*\&\& *\)\(\"\{0,1\}[^ ]*\)\(\.py\|glib-mkenums\|g-ir-scanner\)\(\"\{0,1\} \)?\1\2$(echo $PYDIR/python.exe|sed -e "s?^/\([a-zA-Z]\)/?\1:\\\\\\\\?; s?/?\\\\\\\\?g") \3\4\5?" build_both/build.ninja &&
 ## fix executing shell scripts
 #sed -i.bak -e "s?^\(\s*COMMAND\s*=\s*\)\(\"[^\"]*\.sh\"\)?\1\"$(cygpath -m $(which sh.exe))\" \2?" build_both/build.ninja &&
 wl-showstatus build-install &&
 PKG_CONFIG= PATH=$PYDIR:$PATH PYTHONPATH=$PYTHONPATH:$MINGWPREFIX/lib GETTEXTDATADIR=$MINGWPREFIX/share/gettext ninja -Cbuild_both install &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



