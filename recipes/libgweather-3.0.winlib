export NAME="LibGWeather 3"
export STATUS=
export URL=http://live.gnome.org/LibGWeather
#export URL=https://gitlab.gnome.org/GNOME/libgweather
export BASENAME=libgweather-3.0
export DESCRIPTION="libgweather is the location/timezone/weather library/database used by the GNOME panel clock and by the gweather applet."
export CATEGORY=communication
export TYPE=library
#export VERSIONDATE=20110404
#export VERSION=3.0.0
#export VERSIONDATE=20110405
#export VERSION=3.0.2
#export VERSIONDATE=20110524
#export VERSION=3.1.3
#export VERSIONDATE=20110711
#export VERSION=3.2.0
#export VERSIONDATE=20110926
#export VERSION=3.2.1
#export VERSIONDATE=20111024
#export VERSION=3.4.0
#export VERSIONDATE=20120308
#export VERSION=3.4.1
#export VERSIONDATE=20120309
#export VERSION=3.5.0
#export VERSIONDATE=20120607
####config.status: error: cannot find input file: `po/Makefile.in.in'
#export VERSION=3.5.1
#export VERSIONDATE=20120624
#export VERSION=3.5.4
#export VERSIONDATE=20120717
#export VERSION=3.5.5
#export VERSIONDATE=20120807
#export VERSION=3.5.91
#export VERSIONDATE=20120904
#export VERSION=3.5.92
#export VERSIONDATE=20120920
#export VERSION=3.6.0
#export VERSIONDATE=20120927
####configure: error: Your intltool is too old.  You need intltool 0.50.0 or later.
#export VERSION=3.6.1
#export VERSIONDATE=20121016
#export VERSION=3.6.2
#export VERSIONDATE=20121113
#export VERSION=3.7.2
#export VERSIONDATE=20121020
#export VERSION=3.7.3
#export VERSIONDATE=20121218
#export VERSION=3.7.4
#export VERSIONDATE=20130115
#export VERSION=3.7.5
#export VERSIONDATE=20130205
#export VERSION=3.8.0
#export VERSIONDATE=20130326
#export VERSION=3.8.1
#export VERSIONDATE=20130416
#export VERSION=3.8.2
#export VERSIONDATE=20130514
#export VERSION=3.8.3
#export VERSIONDATE=20131025
#export VERSION=3.8.4
#export VERSIONDATE=20140203
####libgweather/weather-metar.c:50:5: error: implicit declaration of function 'localtime_r' [-Werror=implicit-function-declaration]
#export VERSION=3.9.1
#export VERSIONDATE=20130501
#export VERSION=3.9.2
#export VERSIONDATE=20130528
#export VERSION=3.9.3
#export VERSIONDATE=20130618
#export VERSION=3.9.5
#export VERSIONDATE=20130730
#export VERSION=3.10.0
#export VERSIONDATE=20130924
#export VERSION=3.10.2
#export VERSIONDATE=20140203
#export VERSION=3.10.1
#export VERSIONDATE=20131016
#export VERSION=3.11.3
#export VERSIONDATE=20131218
####libgweather/weather.c:672:24: error: '_NL_MEASUREMENT_MEASUREMENT' undeclared (first use in this function)
#export VERSION=3.11.4
#export VERSIONDATE=20140114
#export VERSION=3.11.5
#export VERSIONDATE=20140203
#export VERSION=3.12.0
#export VERSIONDATE=20140326
#export VERSION=3.12.1
#export VERSIONDATE=20140418
#export VERSION=3.12.2
#export VERSIONDATE=20140513
#export VERSION=3.12.3
#export VERSIONDATE=20141014
####libgweather/weather.c:31:22: fatal error: langinfo.h: No such file or directory
#export DEPENDENCIES=zoneinfo,glib2,gconf,gtk3,gdk-pixbuf,gettext,pcre,libsoup-2.4,libxml2
#export VERSION=3.13.1
#export VERSIONDATE=20140430
#export VERSION=3.13.2
#export VERSIONDATE=20140529
#export VERSION=3.13.3
#export VERSIONDATE=20140624
#export VERSION=3.13.4
#export VERSIONDATE=20140722
#export VERSION=3.14.0
#export VERSIONDATE=20140923
#export VERSION=3.14.1
#export VERSIONDATE=20141014
#export VERSION=3.14.2
#export VERSIONDATE=20141222
#export VERSION=3.14.3
#export VERSIONDATE=20150120
#export VERSION=3.14.4
#export VERSIONDATE=20150417
#export VERSION=3.15.1
#export VERSIONDATE=20150120
####No package 'geocode-glib-1.0' found
####libgweather/weather-yahoo.c:154:5: error: implicit declaration of function 'strptime' [-Werror=implicit-function-declaration]
#export VERSION=3.16.0
#export VERSIONDATE=20150323
#export VERSION=3.16.1
#export VERSIONDATE=20150414
#export VERSION=3.17.1
#export VERSIONDATE=20150427
#export VERSION=3.17.2
#export VERSIONDATE=20150728
####libgweather/weather-yrno.c:124:5: error: implicit declaration of function 'strptime' [-Werror=implicit-function-declaration]
#export VERSION=3.18.0
#export VERSIONDATE=20150921
#export VERSION=3.18.1
#export VERSIONDATE=20151013
#export VERSION=3.18.2
#export VERSIONDATE=20160829
#export VERSION=3.20.0
#export VERSIONDATE=20160322
#export VERSION=3.20.1
#export VERSIONDATE=20160509
#export VERSION=3.20.2
#export VERSIONDATE=20160816
#export VERSION=3.20.3
#export VERSIONDATE=20160829
#export VERSION=3.20.4
#export VERSIONDATE=20161223
#export VERSION=3.24.0
#export VERSIONDATE=20170320
#export VERSION=3.24.1
#export VERSIONDATE=20170605
#export VERSION=3.26.0
#export VERSIONDATE=20170912
#export VERSION=3.26.1
#export VERSIONDATE=20171127
export VERSION=3.26.2
export VERSIONDATE=20180323
export DEPENDENCIES=zoneinfo,glib2,gconf,gtk3,gdk-pixbuf,gettext,pcre,libsoup-2.4,libxml2,geocode-glib
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
wl-showstatus --package-version
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/libgweather/"
#export DOWNLOADURL="https://gitlab.gnome.org/GNOME/libgweather/-/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/libgweather/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/libgweather-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=https://gitlab.gnome.org/GNOME/libgweather/-/archive/$VERSION/libgweather-$VERSION.tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xj --force-local -f $TARBALLDIR/$BASENAME/libgweather-$VERSION.tar.bz2
tar xJ --force-local -f $TARBALLDIR/$BASENAME/libgweather-$VERSION.tar.xz
cd libgweather-$VERSION
# fix missing gweather-win32.h (version >= 3.8.0)
touch libgweather/gweather-win32.h
# fix missing in localtime_r libgweather/weather-metar.c (version >= 3.8.0)
mv libgweather/weather-metar.c libgweather/weather-metar.c.bak
#echo "#include <pthread.h>" > libgweather/weather-metar.c
echo "#define localtime_r(clock,result) (*(result) = *localtime(clock),result)" > libgweather/weather-metar.c
cat libgweather/weather-metar.c.bak >> libgweather/weather-metar.c
# fix missing in localtime_r libgweather/weather-iwin.c (version >= 3.8.0)
mv libgweather/weather-iwin.c libgweather/weather-iwin.c.bak
#echo "#include <pthread.h>" > libgweather/weather-iwin.c
echo "#define localtime_r(clock,result) (*(result) = *localtime(clock),result)" > libgweather/weather-iwin.c
cat libgweather/weather-iwin.c.bak >> libgweather/weather-iwin.c
## fix missing in strptime libgweather/weather-yahoo.c (version >= 3.8.0)
#mv libgweather/weather-yahoo.c libgweather/weather-yahoo.c.bak
#echo "#include <plibc.h>" > libgweather/weather-yahoo.c
#cat libgweather/weather-yahoo.c.bak >> libgweather/weather-yahoo.c
## fix missing _NL_MEASUREMENT_MEASUREMENT in libgweather/weather.c (version >= 3.9.1)
#patch -ulbf libgweather/weather.c << EOF
#--- libgweather/weather.c  2013-04-18 22:11:50 +0200
#+++ libgweather/weather.c  2013-05-01 10:29:46 +0200
#@@ -670,2 +670,3 @@
# {
#+#ifdef HAVE__NL_MEASUREMENT_MEASUREMENT
#     const char *fmt;
#@@ -676,2 +677,3 @@
#     else
#+#endif
#        return TRUE;
#EOF
# fix missing langinfo.h (version >= 3.16.0)
echo "#include <libintl.h>" > langinfo.h
# fix missing strptime in libgweather/weather-yahoo.c (version >= 3.16.0)
mv libgweather/weather-yahoo.c libgweather/weather-yahoo.c.bak
echo "#define strptime(s,f,t) NULL" > libgweather/weather-yahoo.c
cat libgweather/weather-yahoo.c.bak >> libgweather/weather-yahoo.c
# fix missing strptime in libgweather/weather-yrno.c (version >= 3.16.0)
mv libgweather/weather-yrno.c libgweather/weather-yrno.c.bak
echo "#define strptime(s,f,t) NULL" > libgweather/weather-yrno.c
cat libgweather/weather-yrno.c.bak >> libgweather/weather-yrno.c
# fix missing strptime in libgweather/weather-owm.c (version >= 3.16.0)
mv libgweather/weather-owm.c libgweather/weather-owm.c.bak
echo "#define strptime(s,f,t) NULL" > libgweather/weather-owm.c
cat libgweather/weather-owm.c.bak >> libgweather/weather-owm.c
# fix missing strptime in libgweather/weather-sun.c (version >= 3.16.0)
mv libgweather/weather-sun.c libgweather/weather-sun.c.bak
cat > libgweather/weather-sun.c << EOF
#define strptime(s,f,t) NULL
#define localtime_r(clock,result) (*(result) = *localtime((clock)), (result))
EOF
cat libgweather/weather-sun.c.bak >> libgweather/weather-sun.c
# fix problem detecting GNU gettext tools on 64-bit
if ( echo $RUNPLATFORM | grep -q x86_64 ); then
 mv configure configure.bak
 sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
fi
# fix globbing issue with glib-mkenums (version >= 3.26.0)
sed -i.bak2 -e 's?\("\)\(</\)?\1\\n\2?g' configure
wl-showstatus configure &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-zoneinfo-dir=$MINGWPREFIX/etc/zoneinfo/ --disable-glibtest LDFLAGS="-no-undefined -Wl,-no-undefined" &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-introspection=no --with-zoneinfo-dir=$MINGWPREFIX/etc/zoneinfo/ --disable-glibtest LDFLAGS="-no-undefined -Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-introspection=no --with-zoneinfo-dir=$MINGWPREFIX/etc/zoneinfo/ --disable-glibtest LDFLAGS="-Wl,-no-undefined" &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-introspection=no --with-zoneinfo-dir=$MINGWPREFIX/etc/zoneinfo/ --disable-glibtest LDFLAGS="-Wl,-no-undefined" &&
 INTLTOOL_PERL="$PERLDIR/bin/perl.exe" PATH=$PATH:$PERLDIR/../c/bin ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-introspection=no --with-zoneinfo-dir=$MINGWPREFIX/etc/zoneinfo/ --disable-glibtest LDFLAGS="-Wl,-no-undefined" &&
 wl-showstatus build-install &&
 #make install-strip &&
 #PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} make install-strip INTLTOOL_MERGE="$PERLDIR/bin/perl.exe $(which intltool-merge)" &&
 #PATH=$PYDIR:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} make install-strip INTLTOOL_MERGE="$PERLDIR/bin/perl.exe $(which intltool-merge)" &&
 PATH=$PYDIR:$PATH:$PERLDIR/../c/bin PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} make install-strip INTLTOOL_MERGE="$PERLDIR/bin/perl.exe $(which intltool-merge)" &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf libgweather-$VERSION



