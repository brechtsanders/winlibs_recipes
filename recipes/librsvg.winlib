export NAME="librsvg"
export STATUS=
#export URL=http://librsvg.sourceforge.net/
export URL=http://live.gnome.org/LibRsvg
export BASENAME=librsvg
export DESCRIPTION="librsvg is a component used within software applications to enable support for SVG-format scalable graphics. In contrast to raster formats, scalable vector graphics provide users and artists a way to create, view, and provide imagery that is not limited to the pixel or dot density that an output device is capable of."
export CATEGORY=fileformat
export TYPE=library
#export VERSION=2.26.0
#export VERSIONDATE=20091214
#export VERSION=2.26.3
#export VERSIONDATE=20100503
#export VERSION=2.31.0
#export VERSIONDATE=20100712
#export VERSION=2.32.0
#export VERSIONDATE=20100927
#export VERSION=2.32.1
#export VERSIONDATE=20101114
#export VERSION=2.34.0
#export VERSIONDATE=20110404
#export VERSION=2.34.1
#export VERSIONDATE=20110907
#export VERSION=2.34.2
#export VERSIONDATE=20111115
####/include/gtk-3.0/gdk/gdkdisplay.h:59: error: expected declaration specifiers before 'G_DEPRECATED_FOR'
#export VERSION=2.35.0
#export VERSIONDATE=20111115
#export VERSION=2.35.1
#export VERSIONDATE=20111220
#export VERSION=2.35.2
#export VERSIONDATE=20120207
#export DEPENDENCIES=gtk2,glib2,libxml2,pango,cairo,fontconfig,freetype2
#export VERSION=2.36.0
#export VERSIONDATE=20120326
#export VERSION=2.36.1
#export VERSIONDATE=20120417
#export VERSION=2.36.2
#export VERSIONDATE=20120824
#export VERSION=2.36.3
#export VERSIONDATE=20120902
#export VERSION=2.36.4
#export VERSIONDATE=20121016
#export VERSION=2.37.0
#export VERSIONDATE=20130110
#export VERSION=2.39.0
#export VERSIONDATE=20130816
#export DEPENDENCIES=gtk2,glib2,libxml2,pango,cairo,fontconfig,freetype2,libcroco
#export OPTIONALDEPENDENCIES=
#export VERSION=2.40.0
#export VERSIONDATE=20131014
#export VERSION=2.40.1
#export VERSIONDATE=20131120
#export VERSION=2.40.2
#export VERSIONDATE=20140318
####rsvg-base.c:2194:5: error: implicit declaration of function 'canonicalize_file_name' [-Werror=implicit-function-declaration]
#export VERSION=2.40.3
#export VERSIONDATE=20140819
####depends on gio-unix
#export VERSION=2.40.4
#export VERSIONDATE=20140914
#export VERSION=2.40.5
#export VERSIONDATE=20141014
#export VERSION=2.40.6
#export VERSIONDATE=20141204
#export VERSION=2.40.7
#export VERSIONDATE=20150216
#export VERSION=2.40.8
#export VERSIONDATE=20150228
####rsvg.h:32:21: fatal error: gio/gio.h: No such file or directory
#export VERSION=2.40.9
#export VERSIONDATE=20150327
#export VERSION=2.40.10
#export VERSIONDATE=20150811
#export VERSION=2.40.11
#export VERSIONDATE=20151008
#export VERSION=2.40.12
#export VERSIONDATE=20151202
#export VERSION=2.40.13
#export VERSIONDATE=20160404
#export VERSION=2.40.15
#export VERSIONDATE=20160407
#export VERSION=2.40.16
#export VERSIONDATE=20160609
#export VERSION=2.40.17
#export VERSIONDATE=20170408
#export VERSION=2.40.18
#export VERSIONDATE=20170720
#export VERSION=2.40.19
#export VERSIONDATE=20171005
#export VERSION=2.40.20
#export VERSIONDATE=20171216
export VERSION=2.40.21
export VERSIONDATE=20200227
####No package 'pangoft2' found
export DEPENDENCIES=glib2,libxml2,pango,cairo,fontconfig,freetype2,libcroco,gdk-pixbuf
#export VERSION=2.41.0
#export VERSIONDATE=20170104
#export VERSION=2.41.1
#export VERSIONDATE=20170902
#export VERSION=2.41.2
#export VERSIONDATE=20171206
#export VERSION=2.42.0
#export VERSIONDATE=20180109
#export VERSION=2.42.1
#export VERSIONDATE=20180125
#export VERSION=2.42.2
#export VERSIONDATE=20180202
#export VERSION=2.42.3
#export VERSIONDATE=20180306
#export VERSION=2.42.4
#export VERSIONDATE=20180508
#export VERSION=2.42.5
#export VERSIONDATE=20180602
#export VERSION=2.42.6
#export VERSIONDATE=20180808
#export VERSION=2.42.7
#export VERSIONDATE=20180823
#export VERSION=2.42.8
#export VERSIONDATE=20200226
#export VERSION=2.42.9
#export VERSIONDATE=20210413
#export VERSION=2.43.0
#export VERSIONDATE=20180612
#export VERSION=2.43.1
#export VERSIONDATE=20180623
#export VERSION=2.43.2
#export VERSIONDATE=20180715
#export VERSION=2.43.3
#export VERSIONDATE=20180803
#export VERSION=2.43.4
#export VERSIONDATE=20180808
#export VERSION=2.44.0
#export VERSIONDATE=20180824
#export VERSION=2.44.1
#export VERSIONDATE=20180829
#export VERSION=2.44.2
#export VERSIONDATE=20180831
#export VERSION=2.44.3
#export VERSIONDATE=20180920
#export VERSION=2.44.4
#export VERSIONDATE=20180925
#export VERSION=2.44.6
#export VERSIONDATE=20180928
#export VERSION=2.44.7
#export VERSIONDATE=20181010
#export VERSION=2.44.8
#export VERSIONDATE=20181025
#export VERSION=2.44.9
#export VERSIONDATE=20181114
#export VERSION=2.44.10
#export VERSIONDATE=20181212
#export VERSION=2.44.11
#export VERSIONDATE=20181230
#export VERSION=2.44.12
#export VERSIONDATE=20190122
#export VERSION=2.44.13
#export VERSIONDATE=20190216
#export VERSION=2.44.14
#export VERSIONDATE=20190514
#export VERSION=2.44.15
#export VERSIONDATE=20190903
#export VERSION=2.44.16
#export VERSIONDATE=20200227
#export VERSION=2.44.17
#export VERSIONDATE=20210413
#export VERSION=2.45.0
#export VERSIONDATE=20181117
#export VERSION=2.45.1
#export VERSIONDATE=20181211
#export VERSION=2.45.2
#export VERSIONDATE=20181219
#export VERSION=2.45.3
#export VERSIONDATE=20190109
#export VERSION=2.45.4
#export VERSIONDATE=20190110
#export VERSION=2.45.5
#export VERSIONDATE=20190216
#export VERSION=2.45.6
#export VERSIONDATE=20190515
#export VERSION=2.45.7
#export VERSIONDATE=20190703
#export VERSION=2.45.8
#export VERSIONDATE=20190722
#export VERSION=2.46.0
#export VERSIONDATE=20190910
#export VERSION=2.46.1
#export VERSIONDATE=20191008
#export VERSION=2.46.2
#export VERSIONDATE=20191015
#export VERSION=2.46.3
#export VERSIONDATE=20191024
#export VERSION=2.46.4
#export VERSIONDATE=20191125
#export VERSION=2.46.5
#export VERSIONDATE=20210413
#export VERSION=2.47.0
#export VERSIONDATE=20191029
#export VERSION=2.47.1
#export VERSIONDATE=20191114
#export VERSION=2.47.2
#export VERSIONDATE=20200116
#export VERSION=2.47.3
#export VERSIONDATE=20200202
#export VERSION=2.48.0
#export VERSIONDATE=20200307
#export VERSION=2.48.1
#export VERSIONDATE=20200328
#export VERSION=2.48.2
#export VERSIONDATE=20200401
#export VERSION=2.48.3
#export VERSIONDATE=20200410
#export VERSION=2.48.4
#export VERSIONDATE=20200424
#export VERSION=2.48.5
#export VERSIONDATE=20200530
#export VERSION=2.48.6
#export VERSIONDATE=20200603
#export VERSION=2.48.7
#export VERSIONDATE=20200605
#export VERSION=2.48.8
#export VERSIONDATE=20200704
#export VERSION=2.48.9
#export VERSIONDATE=20201106
#export VERSION=2.48.10
#export VERSIONDATE=20210413
#export VERSION=2.49.0
#export VERSIONDATE=20200530
#export VERSION=2.49.1
#export VERSIONDATE=20200603
#export VERSION=2.49.2
#export VERSIONDATE=20200605
#export VERSION=2.49.3
#export VERSIONDATE=20200704
#export VERSION=2.49.4
#export VERSIONDATE=20200822
#export VERSION=2.49.5
#export VERSIONDATE=20200905
#export VERSION=2.50.0
#export VERSIONDATE=20200911
#export VERSION=2.50.1
#export VERSIONDATE=20201003
#export VERSION=2.50.2
#export VERSIONDATE=20201120
#export VERSION=2.50.3
#export VERSIONDATE=20210129
#export VERSION=2.50.4
#export VERSIONDATE=20210413
#export VERSION=2.50.5
#export VERSIONDATE=20210501
#export VERSION=2.50.6
#export VERSIONDATE=20210526
#export VERSION=2.50.7
#export VERSIONDATE=20210605
#export VERSION=2.51.0
#export VERSIONDATE=20210204
#export VERSION=2.51.1
#export VERSIONDATE=20210413
#export VERSION=2.51.2
#export VERSIONDATE=20210527
#export VERSION=2.51.3
#export VERSIONDATE=20210619
#export VERSION=2.51.4
#export VERSIONDATE=20210710
#export VERSION=2.52.0
#export VERSIONDATE=20210916
#export VERSION=2.52.1
#export VERSIONDATE=20211006
#export VERSION=2.52.2
#export VERSIONDATE=20211016
#export VERSION=2.52.3
#export VERSIONDATE=20211027
#export VERSION=2.52.4
#export VERSIONDATE=20211113
#export VERSION=2.52.5
#export VERSIONDATE=20211218
#export VERSION=2.52.6
#export VERSIONDATE=20220217
#export VERSION=2.52.7
#export VERSIONDATE=20220312
#export VERSION=2.53.0
#export VERSIONDATE=20220108
#export VERSION=2.53.1
#export VERSIONDATE=20220212
#export VERSION=2.53.2
#export VERSIONDATE=20220312
#export VERSION=2.54.0
#export VERSIONDATE=20220317
#export VERSION=2.54.1
#export VERSIONDATE=20220423
#export VERSION=2.54.2
#export VERSIONDATE=20220513
#export VERSION=2.54.3
#export VERSIONDATE=20220514
#export VERSION=2.54.4
#export VERSIONDATE=20220611
#export VERSION=2.54.5
#export VERSIONDATE=20220827
#export VERSION=2.55.0
#export VERSIONDATE=20220803
#export VERSION=2.55.1
#export VERSIONDATE=20220906
#export VERSION=2.55.2
#export VERSIONDATE=20230316
#export VERSION=2.55.3
#export VERSIONDATE=20230721
#export VERSION=2.55.90
#export VERSIONDATE=20221126
#export VERSION=2.55.91
#export VERSIONDATE=20230211
#export VERSION=2.55.92
#export VERSIONDATE=20230309
#export VERSION=2.56.0
#export VERSIONDATE=20230318
#export VERSION=2.56.1
#export VERSIONDATE=20230531
#export VERSION=2.56.2
#export VERSIONDATE=20230701
#export VERSION=2.56.3
#export VERSIONDATE=20230721
#export VERSION=2.56.4
#export VERSIONDATE=20230914
#export VERSION=2.56.93
#export VERSIONDATE=20230826
#export VERSION=2.57.0
#export VERSIONDATE=20230914
#export VERSION=2.57.1
#export VERSIONDATE=20231216
#export VERSION=2.57.2
#export VERSIONDATE=20240309
#export VERSION=2.57.3
#export VERSIONDATE=20240318
#export VERSION=2.57.90
#export VERSIONDATE=20240125
#export VERSION=2.57.91
#export VERSIONDATE=20240210
#export VERSION=2.58.0
#export VERSIONDATE=20240318
#export VERSION=2.58.2
#export VERSIONDATE=20240713
#export VERSION=2.58.3
#export VERSIONDATE=20240817
#export VERSION=2.58.4
#export VERSIONDATE=20240913
#export VERSION=2.58.5
#export VERSIONDATE=20240928
####configure: error: cargo is required.  Please install the Rust toolchain from https://www.rust-lang.org/
#export VERSION=2.58.90
#export VERSIONDATE=20240413
#export VERSION=2.58.91
#export VERSIONDATE=20240427
#export VERSION=2.58.92
#export VERSIONDATE=20240713
#export VERSION=2.58.93
#export VERSIONDATE=20240802
#export VERSION=2.58.94
#export VERSIONDATE=20240830
#export VERSION=2.59.0
#export VERSIONDATE=20240913
#export VERSION=2.59.1
#export VERSIONDATE=20240928
#export VERSION=2.59.2
#export VERSIONDATE=20241030
#export VERSION=2.60.0
#export VERSIONDATE=20250319
####meson.build:27:8: ERROR: Program 'cargo' not found or not executable
wl-showstatus --package-version
#export DEPENDENCIES=glib2,libxml2,pango,cairo,fontconfig,freetype2,libcroco,gdk-pixbuf,rust
export OPTIONALDEPENDENCIES=gtk3
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=gtk-doc
export LICENSEFILE=COPYING.LIB
export LICENSETYPE=LGPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/librsvg/"
export DOWNLOADURL="https://download.gnome.org/sources/librsvg/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/librsvg/`echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/"`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/librsvg/$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://download.gnome.org/sources/librsvg/$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing gdk-pixbuf.loaders (version >= 2.31.0)
mkdir -p $INSTALLPREFIX/etc/gtk-2.0
ln -s $MINGWPREFIX/etc/gtk-2.0/gdk-pixbuf.loaders $INSTALLPREFIX/etc/gtk-2.0/gdk-pixbuf.loaders
# fix missing canonicalize_file_name in rsvg-base.c (version >= 2.40.0)
mv rsvg-base.c rsvg-base.c.bak
cat > rsvg-base.c << EOF
#include <ctype.h>
#include <direct.h>
#include <sys/stat.h>
#include <windows.h>

static char* slashify (char* str)
{
  char *p = str;
  while (*p) {
    if (*p == '\\\\')
      *p = '/';
    p++;
  }
  return str;
}

static char* strlower (char* str)
{
  char *p = str;
  while (*p) {
    *p = (char)tolower(*p);
    p++;
  }
  return str;
}

static char* mingw_realpath (const char* name, char* resolved)
{
  char *rpath = NULL;
  if (name == NULL || name[0] == '\\0')
    return NULL;
  if (resolved == NULL) {
    rpath = (char*)malloc(MAX_PATH + 1);
    if (rpath == NULL)
      return NULL;
  } else
    rpath = resolved;
  GetFullPathName(name, MAX_PATH, rpath, NULL);
  strlower(slashify (rpath));
  struct stat st;
  if (stat (rpath, &st) < 0) {
    if (resolved == NULL)
      free (rpath);
    return NULL;
  }
  return rpath;
}

#define canonicalize_file_name(filename) mingw_realpath(filename, NULL)
#define realpath(filename,resolved) mingw_realpath(filename, resolved)
EOF
cat rsvg-base.c.bak >> rsvg-base.c
# fix invalid include of gio/gunixinputstream.h in rsvg-convert.c (version >= 2.40.3)
mv rsvg-convert.c rsvg-convert.c.bak
sed -e "s?gio/gunixinputstream.h?gio/gwin32inputstream.h?; s/g_unix_input_stream_new/g_win32_input_stream_new/" rsvg-convert.c.bak > rsvg-convert.c
# fix invalid include of gio/gunixinputstream.h in test-display.c (version >= 2.40.3)
mv test-display.c test-display.c.bak
sed -e "s?gio/gunixinputstream.h?gio/gwin32inputstream.h?" test-display.c.bak > test-display.c
## fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# #mv configure.in configure.in.bak
# #grep -v GOBJECT_INTROSPECTION_CHECK configure.in.bak > configure.in
# #mv Makefile.in Makefile.in.bak
# #grep -v "^@HAVE_INTROSPECTION_TRUE" Makefile.in.bak > Makefile.in
# autoreconf -f -i -I $MINGWPREFIX/share/aclocal
#fi
# fix globbing issues with glib-mkenums
sed -i.bak -e "s/\(--fprod \"[^/]*\)\(\/\*\)\(.*\)\(\*\/\)/\1\\\\n\2\3\\\\\4/g" Makefile.in
# fix dependancy on gio-unix (version >= 2.40.3)
sed -i.bak -e "s/gio-unix/gio-windows/g" configure
#make check
#cp `which libtool` .
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-Bsymbolic --disable-vala --disable-introspection LDFLAGS="-Wl,--enable-auto-import" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-Bsymbolic --disable-vala --disable-introspection CFLAGS="$(if ${CC:-gcc} --help -v 2>/dev/null | grep -q "\-Wincompatible-pointer-types" || ${CC:-gcc} --version|grep -q "^clang"; then echo "-Wno-incompatible-pointer-types -Wno-incompatible-function-pointer-types"; fi)" LDFLAGS="-Wl,--enable-auto-import" &&
 # fix detection of shared libraries
 sed -i.bak -e "s/\(deplibs_check_method=\"\)[^\"]*/\1pass_all/" libtool &&
 #--disable-debug 
 ## fix librsvg-enum-types.h (version >= 2.40.18)
 ##make librsvg-enum-types.h &&
 #PATH=$PYDIR:$PATH make librsvg-enum-types.h &&
 #sed -i.bak -e "s?^.*\(/\* enumerations from.*\*/\).*\$?\1?" librsvg-enum-types.h &&
 wl-showstatus build-install &&
 PATH=$PWD/.libs:$PYDIR:$PATH make -j1 all install-strip &&
 #( PATH=$PWD/.libs:$PYDIR:$PATH make -j1 all install-strip || ( sed -i.bak -e "s/\(SUBDIRS = .* \)doc /\1/" Makefile && PATH=$PWD/.libs:$PYDIR:$PATH make -j1 all install-strip )) &&
 rm -rf $INSTALLPREFIX/etc/gtk-2.0 &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####See also: https://bugs.gentoo.org/739820
####See also: https://github.com/oaken-source/librsvg-og



##export BUILDDEPENDENCIES=meson,ninja,pytoml
##-Dc_args=$CFLAGS -Dcpp_args=$CXXFLAGS -Dc_link_args=$LDFLAGS -Dcpp_link_args=$LDFLAGS
### fix location of Perl
##sed -i.bak -e "s?'perl'?'$(cygpath -w $PERLDIR/bin/perl.exe|sed -e 's/\\/&&&&/g')'?" meson.build
### fix detection of Python
##sed -i.bak -e "s?'python3'?'$(cygpath -w $PYDIR/python.exe|sed -e 's/\\/&&&&/g')'?" meson.build
### fix missing gio-unix
###sed -i.bak -e "s/gio-unix-/gio-/" meson.build
##sed -i.bak -e "s/gio-unix-/gio-windows-/" meson.build
#mkdir -p build_both &&
# wl-showstatus configure &&
# PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dtests=false . build_both &&
# ## fix slash/backslash path issue when calling Python from Ninja
# #sed -i.bak -e "s/join_paths/os.path.join/g; /COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
# ## fix Python path issues in meson_exe
# #sed -i.bak -e "s?$PYDIR?$(echo $PYDIR|sed -e "s?^/\([a-zA-Z]\)/?\1:/?")?" build_both/meson-private/meson_exe_python.exe_*.dat &&
# ## fix execution of Python scripts
# #sed -i.bak -e "s?\(COMMAND\|POST_BUILD\)\( *= *\| *=.*\&\& *\)\(\"\{0,1\}[^ ]*\)\(\.py\|glib-mkenums\|g-ir-scanner\|asciidoc\)\(\"\{0,1\} \)?\1\2$(echo $PYDIR/python.exe|sed -e "s?^/\([a-zA-Z]\)/?\1:\\\\\\\\?; s?/?\\\\\\\\?g") \3\4\5?" build_both/build.ninja &&
# ## fix executing shell scripts
# #sed -i.bak -e "s?^\(\s*COMMAND\s*=\s*\)\(\"[^\"]*\.sh\"\)?\1\"$(cygpath -m $(which sh.exe))\" \2?" build_both/build.ninja &&
# wl-showstatus build-install &&
# #PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+:$PYTHONPATH}:$MINGWPREFIX/lib \
# #PATH=$PYDIR:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} \
# ninja -Cbuild_both install/strip &&
# #ninja -Cbuild_both install &&
#    echo OK && find . -name '*.a'
