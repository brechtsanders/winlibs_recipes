export NAME="ICU"
export STATUS=
#export URL=http://www.icu-project.org/
export URL=http://site.icu-project.org/
export BASENAME=icu
export DESCRIPTION="ICU is a mature, widely used set of C/C++ and Java libraries providing Unicode and Globalization support for software applications. ICU is widely portable and gives applications the same results on all platforms and between C/C++ and Java software."
export CATEGORY=internationalization
export TYPE=library
#export VERSION=3.8.1
#export VERSION=4.4.1
#export VERSIONDATE=20100428
#export VERSION=4.4.2
#export VERSIONDATE=20100930
#export VERSION=4.6
#export VERSIONDATE=20101202
####bash: D:/Prog/MinGW-mSys.newer/home/win32/icu-4.6/source/lib/icudt46.dll.lib: No such file or directory
#export VERSION=4.6.1
#export VERSIONDATE=20110312
#export VERSION=4.7.1
#export VERSIONDATE=20110315
#export VERSION=4.8
#export VERSIONDATE=20110524
####source/common/udata.cpp:250: error: '_ReadWriteBarrier' was not declared in this scope
####64-bit: genrb.exe: The procedure entry point icudt48_dat could not be located in the dynamic link library icudt48.dll
#export VERSION=4.8.1
#export VERSIONDATE=20110720
#export VERSION=4.8.1.1
#export VERSIONDATE=20111020
#export VERSION=4.9.1
#export VERSIONDATE=20120322
#export VERSION=4.9.1.1
#export VERSIONDATE=20120407
#export VERSION=49.1.2
#export VERSIONDATE=20120625
####udata.o:udata.cpp:(.text+0xae9): undefined reference to `u_getDataDirectory_49'
#export VERSION=50m2
#export VERSIONDATE=20120910
#export VERSION=50rc
#export VERSIONDATE=20121020
####common/udata.o:udata.cpp:(.text+0x9f6): undefined reference to `u_getDataDirectory_50
#export VERSION=50.1
#export VERSIONDATE=20121106
#export VERSION=50.1.1
#export VERSIONDATE=20121218
#export VERSION=50.1.2
#export VERSIONDATE=20130118
#export VERSION=51.1
#export VERSIONDATE=20130317
#export VERSION=51.2
#export VERSIONDATE=20130524
#export VERSION=52.1
#export VERSIONDATE=20131008
#export VERSION=53.1
#export VERSIONDATE=20140402
#export VERSION=54.1
#export VERSIONDATE=20140930
#export VERSION=55.1
#export VERSIONDATE=20141218
#export VERSION=56.1
#export VERSIONDATE=20150701
#export VERSION=57.1
#export VERSIONDATE=20160319
#export VERSION=58.1
#export VERSIONDATE=20161020
#export VERSION=58.2
#export VERSIONDATE=20161209
####icu/source/i18n/digitlst.cpp:(.text+0xd60): undefined reference to `_free_locale'
####icu/source/i18n/digitlst.cpp:(.text+0xd95): undefined reference to `_create_locale'
####Probaby requires libmsvcr*.a
####configure: error: There is wchar.h but the size of wchar_t is 0
#export VERSION=59.1
#export VERSIONDATE=20170415
####common/putil.cpp:1733:86: error: 'GetUserDefaultLocaleName' was not declared in this scope
#export VERSION=60.1
#export VERSIONDATE=20171101
#export VERSION=60.2
#export VERSIONDATE=20171208
#export VERSION=61.1
#export VERSIONDATE=20180327
####configure: error: There is wchar.h but the size of wchar_t is 0
####digitlst.o:digitlst.cpp:(.text+0xbc9): undefined reference to `_free_locale'
####digitlst.o:digitlst.cpp:(.text+0xbfe): undefined reference to `_create_locale'
####windtfmt.o:windtfmt.cpp:(.text+0x402): undefined reference to `_imp__ResolveLocaleName@12'
####winnmfmt.o:winnmfmt.cpp:(.text+0x543): undefined reference to `_imp__ResolveLocaleName@12'
#export VERSION=62.1
#export VERSIONDATE=20180621
#export VERSION=63.1
#export VERSIONDATE=20181016
#export VERSION=64.1
#export VERSIONDATE=20190328
#export VERSION=64.2
#export VERSIONDATE=20190418
#export VERSION=66.1
#export VERSIONDATE=20200409
#export VERSION=67.1
#export VERSIONDATE=20200423
#export VERSION=68.1
#export VERSIONDATE=20201029
#export VERSION=68.2
#export VERSIONDATE=20210218
#export VERSION=69.1
#export VERSIONDATE=20210408
####windtfmt.o:windtfmt.cpp:(.text+0x3f4): undefined reference to `_imp__ResolveLocaleName@12'
#export VERSION=70.1
#export VERSIONDATE=20211028
#export VERSION=71.1
#export VERSIONDATE=20220407
export VERSION=72.1
export VERSIONDATE=20221019
wl-showstatus --package-version
export DEPENDANCIES=gettext
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=pexports
#export LICENSEFILE=unicode-license.txt
#export LICENSEFILE=license.html
#export LICENSEFILE=LICENSE
#export LICENSETYPE=
export LICENSEFILE=../LICENSE
export LICENSETYPE=
#export DOWNLOADURL="http://download.icu-project.org/files/icu4c/ icu4c- -src.tgz"
#export DOWNLOADURL="http://site.icu-project.org/download icu4c- -src.tgz"
export DOWNLOADURL="https://github.com/unicode-org/icu/releases/ icu4c- -src.tgz"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/; s/[a-z][0-9]*$//'`/icu4c-`echo $VERSION|sed -e "s/\./_/g; s/\([a-z][0-9]*$\)/_\1/"`-src.tgz
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/$VERSION/icu4c-`echo $VERSION|sed -e "s/\./_/g; s/\([a-z][0-9]*$\)/_\1/"`-src.tgz
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/$VERSION/icu4c-`echo $VERSION|sed -e "s/\./_/g"`-src.tgz
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/$(echo $VERSION|sed -e "s/\./m/")/icu4c-$(echo $VERSION|sed -e "s/\./m/")-src.tgz
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/$VERSION/icu4c-$(echo $VERSION|tr . _)-src.tgz
export DOWNLOADSOURCEURL=https://github.com/unicode-org/icu/releases/download/release-$(echo $VERSION|tr . -)/icu4c-$(echo $VERSION|tr . _)-src.tgz
#export DOWNLOADSOURCEURL=https://github.com/unicode-org/icu/archive/refs/tags/release-$(echo $VERSION|tr . -).tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
mkdir -p $BASENAME-$VERSION
#tar $BASENAME-$VERSION xfz $TARBALLDIR/$BASENAME/icu4c-`echo $VERSION|sed -e "s/\./_/g; s/\([a-z][0-9]*$\)/_\1/"`-src.tgz -C$BASENAME-$VERSION
#tar xfz $TARBALLDIR/$BASENAME/icu4c-`echo $VERSION|sed -e "s/\./_/g"`-src.tgz -C$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/$VERSION/icu4c-`echo $VERSION|sed -e "s/\([0-9]*\)\.\([0-9]*.*\)$/\1\2/; s/\./_/g"`-src.tgz
#export DOWNLOADSOURCEURL=http://download.icu-project.org/files/icu4c/`echo $VERSION|sed -e "s/^\([0-9]*\)\./\1/"`/icu4c-`echo $VERSION|sed -e "s/\([0-9]*\)\.\([0-9]*.*\)$/\1\2/; s/\./_/g"`-src.tgz
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#tar xfz $TARBALLDIR/$BASENAME/icu4c-`echo $VERSION|sed -e "s/\([0-9]*\)\.\([0-9]*.*\)$/\1\2/; s/\./_/g"`-src.tgz -C$BASENAME-$VERSION
#tar xfz $TARBALLDIR/$BASENAME/icu4c-$(echo $VERSION|sed -e "s/\./m/")-src.tgz -C$BASENAME-$VERSION
tar xfz $TARBALLDIR/$BASENAME/icu4c-$(echo $VERSION|tr . _)-src.tgz -C$BASENAME-$VERSION
#tar xfz $TARBALLDIR/$BASENAME/release-$(echo $VERSION|tr . -).tar.gz -C$BASENAME-$VERSION
cd $BASENAME-$VERSION/icu/source
#tar xfz $TARBALLDIR/$BASENAME/release-$(echo $VERSION|tr . -).tar.gz
#cd icu-release-$(echo $VERSION|tr . -)/icu4c/source
## remove strict ansi (to avoid missing things from time.h) (version <= 49.1.2)
#mv configure configure.bak
#sed -e "s/\(FLAGS.*\)-ansi/\1/" configure.bak > configure
## fix bad absolute path (version <= 4.8.1.1)
#mv data/Makefile.in data/Makefile.in.bak
##sed -e "s/^\(CURDIR:=\).*/\1./" data/Makefile.in.bak > data/Makefile.in
#sed -e "s/^\(CURDIR:=\).*/\1./; s?^\(top_builddir *= *\)?\1`pwd`/data/?" data/Makefile.in.bak > data/Makefile.in
## fix missing localtime_r (version >= 4.5.1 <= 49.1.2)
#mv common/putil.c common/putil.c.bak
#cat > common/putil.c << EOF
##define localtime_r(clock,result) (*(result) = *localtime(clock),result)
#EOF
#cat common/putil.c.bak >> common/putil.c
## fix missing LC_MESSAGES in common/putil.c (version >= 4.6 <= 49.1.2)
#mv common/putil.c common/putil.c.bak
#echo "#include <libintl.h>" > common/putil.c
#cat common/putil.c.bak >> common/putil.c
## fix install problem in pkgdata (version 4.4.1)
#mv tools/pkgdata/pkgdata.cpp tools/pkgdata/pkgdata.cpp.bak
#echo "#define USING_CYGWIN" > tools/pkgdata/pkgdata.cpp
#cat tools/pkgdata/pkgdata.cpp.bak >> tools/pkgdata/pkgdata.cpp
## fix redefinition of struct timespec in pthread.h on 64-bit (version <= 49.1.2)
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv common/umutex.c common/umutex.c.bak
# echo "#define HAVE_STRUCT_TIMESPEC 1" > common/umutex.c
# echo "#include <pthread.h>" >> common/umutex.c
# cat common/umutex.c.bak >> common/umutex.c
#fi
## fix missing _mkdir in tools/toolutil/toolutil.cpp on 64-bit (version <= 49.1.2)
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv tools/toolutil/toolutil.cpp tools/toolutil/toolutil.cpp.bak
# echo "#define _mkdir mkdir" > tools/toolutil/toolutil.cpp
# cat tools/toolutil/toolutil.cpp.bak >> tools/toolutil/toolutil.cpp
#fi
# fix missing __declspec(dllexport) in common/unicode/platform.h (version >= 50.1)
patch -ulbf common/unicode/platform.h << EOF
--- common/unicode/platform.h  2012-11-05 18:14:34 +0100
+++ common/unicode/platform.h  2012-11-06 07:58:34 +0100
@@ -706,3 +706,3 @@
 #   define U_EXPORT
-#elif defined(__GNUC__)
+#elif defined(__GNUC__) && !defined(__MINGW32__)
 #   define U_EXPORT __attribute__((visibility("default")))
@@ -713,3 +713,3 @@
 #   define U_EXPORT __declspec(dllexport)*/
-#elif defined(_MSC_VER)
+#elif defined(_MSC_VER) || defined(__MINGW32__)
 #   define U_EXPORT __declspec(dllexport)
@@ -722,3 +722,3 @@
     /* Use the predefined value. */
-#elif defined(_MSC_VER)
+#elif defined(_MSC_VER) || defined(__MINGW32__)
 #   define U_EXPORT2 __cdecl
@@ -730,3 +730,3 @@
     /* Use the predefined value. */
-#elif defined(_MSC_VER)
+#elif defined(_MSC_VER) || defined(__MINGW32__)
     /* Windows needs to export/import data. */
EOF
# fix already defined IN in i18n/regexcmp.cpp (version >= 53.1)
patch -ulbf i18n/regexcmp.cpp << EOF
--- i18n/regexcmp.cpp  2014-01-10 03:24:54.000000000 +0100
+++ i18n/regexcmp.cpp  2014-09-09 09:52:54.000000000 +0200
@@ -4153,5 +4153,5 @@
     //
-    static const UChar IN[] = {0x49, 0x6E, 0};  // "In"
+    static const UChar INLIST[] = {0x49, 0x6E, 0};  // "In"
     static const UChar BLOCK[] = {0x42, 0x6C, 0x6f, 0x63, 0x6b, 0x3d, 00};  // "Block="
-    if (mPropName.startsWith(IN, 2) && propName.length()>=3) {
+    if (mPropName.startsWith(INLIST, 2) && propName.length()>=3) {
         setExpr.truncate(4);   // Leaves "[\p{", or "[\P{"
EOF
# fix redefinition of STRICT in tools/genrb/genrb.cpp (version >= 56.1)
mv tools/genrb/genrb.cpp tools/genrb/genrb.cpp.bak
sed -e "s/\(STRICT\)/MY\1/g" tools/genrb/genrb.cpp.bak > tools/genrb/genrb.cpp
## fix missing intrin.h (version >= 4.8 <= 4.8.1.1)
#touch common/intrin.h
#touch data/out/build/icudt[0-9]*/af.res
#touch data/out/build/icudt[0-9]*/af.res
#mv data/out/tmp/icudt38l_dll.mak data/out/tmp/icudt38l_dll.mak.bak
#sed -e "s?[\\]\(af.res\)?/\1?" data/out/tmp/icudt38l_dll.mak.bak > data/out/tmp/icudt38l_dll.mak
## fix missing GetUserDefaultLocaleName in common/putil.cpp (version >= 59.1)
#mv common/putil.cpp common/putil.cpp.bak
#cat > common/putil.cpp << EOF
##if WINVER < 0x0600
##define WINVER 0x0600
##endif
#EOF
#cat common/putil.cpp.bak >> common/putil.cpp
## fix missing ResolveLocaleName in i18n/windtfmt.cpp (version >= 59.1)
#mv i18n/windtfmt.cpp i18n/windtfmt.cpp.bak
#cat > i18n/windtfmt.cpp << EOF
##if WINVER < 0x0601
##define WINVER 0x0601
##endif
##include <winnls.h>
#EOF
#cat i18n/windtfmt.cpp.bak >> i18n/windtfmt.cpp
## fix missing GetLocaleInfoEx in i18n/winnmfmt.cpp (version >= 59.1)
#mv i18n/winnmfmt.cpp i18n/winnmfmt.cpp.bak
#cat > i18n/winnmfmt.cpp << EOF
##if WINVER < 0x0601
##define WINVER 0x0601
##endif
##include <winnls.h>
#EOF
#cat i18n/winnmfmt.cpp.bak >> i18n/winnmfmt.cpp
## fix missing _free_locale/_create_locale in i18n/digitlst.cpp (version >= 59.1)
#mv i18n/digitlst.cpp i18n/digitlst.cpp.bak
#cat > i18n/digitlst.cpp << EOF
##include <locale.h>
##ifndef __MINGW64_VERSION_MAJOR
##define locale_t int
##endif
#EOF
#cat i18n/digitlst.cpp.bak >> i18n/digitlst.cpp
## fix missing ResolveLocaleName in i18n/windtfmt.cpp (version >= 60.1)
#mv i18n/windtfmt.cpp i18n/windtfmt.cpp.bak &&
#echo "#define WINVER 0x0601" > i18n/windtfmt.cpp &&
#echo "#include <winnls.h>" > i18n/windtfmt.cpp &&
#cat i18n/windtfmt.cpp.bak >> i18n/windtfmt.cpp
# fix missing mbstowcs_s in io/ufile.cpp (version >= 64.2)
mv io/ufile.cpp io/ufile.cpp.bak &&
echo "#define MINGW_HAS_SECURE_API 1" > io/ufile.cpp &&
cat io/ufile.cpp.bak >> io/ufile.cpp
# fix missing in int16_t/char16_t in common/unicode/umachine.h (version >= 64.2)
mv common/unicode/umachine.h common/unicode/umachine.h.bak &&
echo "#include <stdint.h>" > common/unicode/umachine.h &&
echo "#include <uchar.h>" >> common/unicode/umachine.h &&
cat common/unicode/umachine.h.bak >> common/unicode/umachine.h
## fix missing std::isnan/std::trunc/std::signbit/std::isfinite/std::round (version >= 64.2)
#sed -i.bak -e "s/std::\(isnan\|trunc\|signbit\|isfinite\|round\)/\1/g" i18n/decimfmt.cpp i18n/reldatefmt.cpp i18n/number_decimalquantity.cpp i18n/number_utils.cpp
#cd ..
#mv data/Makefile data/Makefile.bak
#sed -e "s/^\(CURDIR:=\).*/\1./" data/Makefile.bak > data/Makefile
##sed -e "s/^\(CURDIR:=\).*/\1./; s?^\(top_builddir *= *\)?\1`pwd`/data/?" data/Makefile.bak > data/Makefile
# fix missing numeric_limits when using clang (version >= 70.1)
####include/c++/v1/cmath:642:26: error: no template named 'numeric_limits'
if echo $CXX|grep -q clang++; then
for F in $(find -name '*.cpp'); do
 mv $F $F.bak1 &&
 echo "#include <limits>" > $F &&
 cat $F.bak1 >> $F
done
fi
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-strict LDFLAGS="-static-libstdc++" && mkdir -p lib &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-static-libstdc++" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-static-libstdc++ -Wl,--enable-auto-import -no-undefined -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --disable-static --with-data-packaging=library LDFLAGS="-Wl,--enable-auto-import -no-undefined -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --disable-static --with-data-packaging=library LDFLAGS="-Wl,--enable-auto-import -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --disable-static --with-data-packaging=library CXXFLAGS="-fpermissive" LDFLAGS="-Wl,--enable-auto-import -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=archive CXXFLAGS="-fpermissive" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=library CXXFLAGS="-fpermissive" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=library CC="${CC:-gcc}" CXX="${CXX:-g++}" CXXFLAGS="-fpermissive" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=library --disable-tests CC="${CC:-gcc}" CXX="${CXX:-g++}" CXXFLAGS="-fpermissive" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=library --disable-layoutex --disable-tests CC="${CC:-gcc}" CXX="${CXX:-g++}" CXXFLAGS="-fpermissive" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-shared --enable-static --with-data-packaging=library --disable-layoutex --disable-tests CC="${CC:-gcc}" CXX="${CXX:-g++}" CXXFLAGS="-fpermissive" PYTHON=$PYDIR/python.exe &&
 wl-showstatus build-install &&
 ## fix undefined reference to ___atomic_fetch_sub_4 (version >= 52.1)
 #mv icudefs.mk icudefs.mk.bak &&
 #sed -e "s/\(-DU_HAVE_ATOMIC=\)1/\10/" icudefs.mk.bak > icudefs.mk &&
 #( make -j1 all install || make -j1 all install ICUDATA_SOURCE_IS_NATIVE_TARGET=YES ) &&
 ( make all install || make -j1 all install ) &&
 #( mingw32-make all install || mingw32-make -j1 all install ) &&
 ## move *.dll from lib/ to bin/ (version <= 66.1)
 #mkdir -p $INSTALLPREFIX/bin &&
 #mv $INSTALLPREFIX/lib/*.dll $INSTALLPREFIX/bin/ &&
# # generate .la files
# for F in `ls -1 $INSTALLPREFIX/bin/icu*.dll | grep -v "[0-9]\.dll" | sed -e "s?^.*/??; s/\.dll//"`; do
#  cat > $INSTALLPREFIX/lib/$F.la << EOF
## -lintl - a libtool library file
## Generated by hand - GNU libtool 0.0.0
#dlname='../bin/$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll'
#library_names='lib$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll.a'
##old_library='lib$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.a'
#old_library=''
#dependency_libs=''
#current=0
#age=0
#revision=0
#installed=yes
#shouldnotlink=no
#dlopen=''
#dlpreopen=''
#libdir='$INSTALLPREFIX/lib'
#EOF
# done &&
 # generate .dll.a files and remove duplicate files
 #for F in `ls -1 $INSTALLPREFIX/bin/icu*.dll | grep -v "[0-9]\.dll" | sed -e "s?^.*/??; s/\.dll//"`; do
 # pexports -o $INSTALLPREFIX/bin/$F.dll > lib$F.def &&
 # dlltool --def lib$F.def --dllname $INSTALLPREFIX/bin/$F.dll --output-lib $INSTALLPREFIX/lib/lib$F.dll.a
 #done &&
 for F in $(ls -1 $INSTALLPREFIX/bin/icu*.dll | grep -v "[0-9]\.dll" | sed -e "s?^.*/??; s/\.dll//"); do
  # remove duplicate DLLs without version number
  if [ -f $INSTALLPREFIX/bin/$F.dll ] && [ -f $INSTALLPREFIX/bin/$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll ]; then
   rm $INSTALLPREFIX/bin/$F.dll
  fi &&
  # generate .dll.a files
  pexports -o $INSTALLPREFIX/bin/$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll > lib$F.def &&
  #dlltool --def lib$F.def --dllname $INSTALLPREFIX/bin/$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll --output-lib $INSTALLPREFIX/lib/lib$F.dll.a
  dlltool --def lib$F.def --dllname $INSTALLPREFIX/bin/$F$(echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/").dll --output-lib $INSTALLPREFIX/lib/lib$F`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll.a
 done &&
 # fix needed to build webkitgtk (links to -licui18n instead of -licuin)
 #dlltool --def libicuin.def --dllname $INSTALLPREFIX/bin/icuin.dll --output-lib $INSTALLPREFIX/lib/libicui18n.dll.a &&
 #dlltool --def libicuin.def --dllname $INSTALLPREFIX/bin/icuin`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll --output-lib $INSTALLPREFIX/lib/libicui18n.dll.a &&
 dlltool --dllname $INSTALLPREFIX/bin/icuin$(echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/").dll --output-lib $INSTALLPREFIX/lib/libicui18n.dll.a &&
 # fix needed to build boost with ICU support (links to -licudt instead of -licudata)
 #dlltool --def libicudt.def --dllname $INSTALLPREFIX/bin/icudt`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`.dll --output-lib $INSTALLPREFIX/lib/libicudata.dll.a &&
 dlltool --dllname $INSTALLPREFIX/bin/icudt$(echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/").dll --output-lib $INSTALLPREFIX/lib/libicudata.dll.a &&
 ## fix invalid version suffix in .pc files
 #for F in $INSTALLPREFIX/lib/pkgconfig/*.pc; do
 # mv $F $F.bak &&
 # sed -e "s/\(-licu[^ ]*\)`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`/\1/g" $F.bak > $F &&
 # rm $F.bak
 #done &&
 # fix default_prefix path in icu-config
 #sed -i -e "s/^\(default_prefix=\"\).*\(\"\)/\1\$(dirname \$(dirname \$0))\2/; s/^\(ICUUC_FILE=.*\)libdir/\1bindir/; s/^\# ICULIBSUFFIX_VERSION/ICULIBSUFFIX_VERSION=\"$(sed -n -e "s/^LIB_VERSION_MAJOR=\"\(.*\)\"$/\1/p" $INSTALLPREFIX/bin/icu-config)\" &/" $INSTALLPREFIX/bin/icu-config &&
 sed -i -e "s/^\(default_prefix=\"\).*\(\"\)/\1\$(dirname \$(dirname \$0))\2/; s/^\(ICUUC_FILE=.*\)libdir/\1bindir/; s/\${ICULIBSUFFIX_VERSION}\\(.\${SO}\)/\${LIB_VERSION_MAJOR}\1/" $INSTALLPREFIX/bin/icu-config &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd ../../.. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
 #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd ../../.. && wl-showstatus cleanup && rm -rf icu-release-$(echo $VERSION|tr . -)
####D:\Prog\winlibs32-8.3.0-6.0.0\mingw32\bin\dlltool.exe: Path components stripped from dllname, 'R:/winlibs32-8.3.0-6.0.0/_TMP_/inst_icu-64.2/bin/icutest64.dll'.
####Segmentation fault




#--with-library-suffix=`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`
sed -e "s/\(-licu[^ ]*\)`echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/"`/\1/g"


