export NAME="GZDoom"
export STATUS=
export URL=https://zdoom.org/about
export BASENAME=gzdoom
export DESCRIPTION="ZDoom is a family of enhanced ports of the Doom engine for running on modern operating systems. It runs on Windows, Linux, and OS X, and adds new features not found in the games as originally published by id Software. GZDoom is the latest version targeting current systems with modern graphics hardware."
export CATEGORY=games
export TYPE=application
#export VERSION=4.5.0
#export VERSIONDATE=20201203
#export VERSION=4.6.1
#export VERSIONDATE=20220607
#export VERSION=4.7.1
#export VERSIONDATE=20220607
#export VERSION=4.8.0
#export VERSIONDATE=20220607
#export VERSION=4.8.1
#export VERSIONDATE=20220626
export VERSION=4.8.2
export VERSIONDATE=20220705
wl-showstatus --package-version
export DEPENDANCIES=zlib,libbz2,libjpeg,zmusic
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=cmake,ninja
export LICENSEFILE=LICENSE
export LICENSETYPE=GPL
export DOWNLOADURL="https://github.com/coelckers/gzdoom/releases/ g"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/coelckers/gzdoom/archive/g$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfz $TARBALLDIR/$BASENAME/g$VERSION.tar.gz
cd gzdoom-g$VERSION
# fix redefinition of signbit/isnan in src/common/thirdparty/math/isnan.c (version >= 4.5.0)
patch -ulbf src/common/thirdparty/math/isnan.c << EOF
@@ -101,2 +101,3 @@

+#ifndef __MINGW32__
 int signbit(x)
@@ -207,2 +208,3 @@
 }
+#endif

EOF
# fix invalid -llegacy_stdio_definitions in src/CMakeLists.txt (version >= 4.8.0)
####ld.exe: cannot find -llegacy_stdio_definitions: No such file or directory
sed -i.bak -e "s/legacy_stdio_definitions//" src/CMakeLists.txt
mkdir -p build_win &&
 wl-showstatus configure &&
 #cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX/share/gzdoom -DCMAKE_BUILD_TYPE:STRING=Release -DPKG_CONFIG_EXECUTABLE:FILEPATH=$(which pkg-config.exe) -S. -Bbuild_win &&
 cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX/share/gzdoom -DCMAKE_BUILD_TYPE:STRING=Release -DDYN_OPENAL:BOOL=OFF -DPKG_CONFIG_EXECUTABLE:FILEPATH=$(which pkg-config.exe) -S. -Bbuild_win &&
 sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.*-ladvapi32/& -ldxguid/" build_win/build.ninja &&
 wl-showstatus build-install &&
 ninja -Cbuild_win install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf gzdoom-g$VERSION
####wget -c https://archive.org/download/Heretic.wad/Heretic.wad
####wget -c https://archive.org/download/2020_03_22_DOOM/DOOM%20WADs/Doom%20%28v1.9%29.zip
####unzip -q "Doom (v1.9).zip"
####$MINGWPREFIX/share/gzdoom/gzdoom.exe



