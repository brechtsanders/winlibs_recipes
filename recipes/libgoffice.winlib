export NAME="GOffice"
export STATUS=
#export URL=http://live.gnome.org/GnomeOffice
#export URL=http://live.gnome.org/goffice
export URL=http://freshmeat.net/projects/goffice/
export BASENAME=libgoffice
export DESCRIPTION="GOffice is a library of document-centric objects and utilities building on top of GLib and Gtk+ and used by software such as Gnumeric."
export CATEGORY=
export TYPE=library
#export VERSION=0.8.12
#export VERSIONDATE=20101126
#export VERSION=0.8.13
#export VERSIONDATE=20110205
#export VERSION=0.8.14
#export VERSIONDATE=20110325
#export VERSION=0.8.15
#export VERSIONDATE=20110522
#export VERSION=0.8.16
#export VERSIONDATE=20110617
#export VERSION=0.8.17
#export VERSIONDATE=20110801
#export VERSION=0.9.0
#export VERSIONDATE=20111125
#export VERSION=0.9.1
#export VERSIONDATE=20120118
#export VERSION=0.9.2
#export VERSIONDATE=20120303
#export VERSION=0.9.3
#export VERSIONDATE=20120422
#export VERSION=0.9.4
#export VERSIONDATE=20120626
#export VERSION=0.9.5
#export VERSIONDATE=20120716
#export VERSION=0.9.6
#export VERSIONDATE=20120907
#export VERSION=0.9.90
#export VERSIONDATE=20121117
####make[4]: *** No rule to make target `ms-compat/local.def', needed by `goffice.def'.  Stop.
####make[3]: *** No rule to make target `drawing/local.def', needed by `goffice.def'.  Stop.
#export VERSION=0.10.0
#export VERSIONDATE=20121219
#export VERSION=0.10.1
#export VERSIONDATE=20130310
####<stdin>:366:23: error: missing binary operator before token "("
#export VERSION=0.10.2
#export VERSIONDATE=20130427
#export VERSION=0.10.3
#export VERSIONDATE=20130626
#export VERSION=0.10.4
#export VERSIONDATE=20130715
#export VERSION=0.10.5
#export VERSIONDATE=20130820
#export VERSION=0.10.7
#export VERSIONDATE=20130902
#export VERSION=0.10.8
#export VERSIONDATE=20131008
####Cannot export go_app_get_plugin: symbol not defined
####Cannot export go_app_get_type: symbol not defined
####Cannot export go_app_sys_data_dir: symbol not defined
####Cannot export go_app_sys_glade_dir: symbol not defined
####Cannot export go_app_sys_lib_dir: symbol not defined
####Cannot export go_app_sys_plugin_dir: symbol not defined
####Cannot export go_component_set_window: symbol not defined
####Cannot export go_error_stack_add_child: symbol not defined
####Cannot export go_error_stack_dump: symbol not defined
####Cannot export go_error_stack_free: symbol not defined
####Cannot export go_error_stack_new: symbol not defined
####Cannot export go_font_sel_dialog_new: symbol not defined
####Cannot export go_image_fill: symbol not defined
####Cannot export go_object_new: symbol not defined
####Cannot export go_object_new_valist: symbol not defined
####Cannot export go_plugin_init: symbol not defined
####Cannot export go_plugin_shutdown: symbol not defined
####Cannot export go_service_get_plugin: symbol not defined
####Cannot export go_service_get_type: symbol not defined
####Cannot export go_service_object_get_type: symbol not defined
####Cannot export go_service_object_interfaces: symbol not defined
####Cannot export go_service_object_primary_type: symbol not defined
####Cannot export go_service_simple_get_type: symbol not defined
####Cannot export go_styled_object_is_filled: symbol not defined
#export VERSION=0.10.9
#export VERSIONDATE=20131129
#export VERSION=0.10.10
#export VERSIONDATE=20140212
#export VERSION=0.10.11
#export VERSIONDATE=20140217
#export VERSION=0.10.12
#export VERSIONDATE=20140319
#export VERSION=0.10.14
#export VERSIONDATE=20140414
#export VERSION=0.10.15
#export VERSIONDATE=20140501
#export VERSION=0.10.16
#export VERSIONDATE=20140524
#export VERSION=0.10.17
#export VERSIONDATE=20140610
#export VERSION=0.10.18
#export VERSIONDATE=20140926
#export VERSION=0.10.19
#export VERSIONDATE=20150124
#export VERSION=0.10.20
#export VERSIONDATE=20150205
#export VERSION=0.10.21
#export VERSIONDATE=20150305
#export VERSION=0.10.22
#export VERSIONDATE=20150417
#export VERSION=0.10.23
#export VERSIONDATE=20150729
#export VERSION=0.10.24
#export VERSIONDATE=20151014
#export VERSION=0.10.25
#export VERSIONDATE=20151226
#export VERSION=0.10.26
#export VERSIONDATE=20151229
#export VERSION=0.10.27
#export VERSIONDATE=20160207
#export VERSION=0.10.28
#export VERSIONDATE=20160323
#export VERSION=0.10.29
#export VERSIONDATE=20160507
#export VERSION=0.10.30
#export VERSIONDATE=20160618
#export VERSION=0.10.31
#export VERSIONDATE=20160630
#export VERSION=0.10.32
#export VERSIONDATE=20160821
#export VERSION=0.10.33
#export VERSIONDATE=20170131
#export VERSION=0.10.34
#export VERSIONDATE=20170321
#export VERSION=0.10.35
#export VERSIONDATE=20170707
#export VERSION=0.10.36
#export VERSIONDATE=20171119
#export VERSION=0.10.37
#export VERSIONDATE=20171202
#export VERSION=0.10.38
#export VERSIONDATE=20171229
#export VERSION=0.10.39
#export VERSIONDATE=20180314
#export VERSION=0.10.40
#export VERSIONDATE=20180430
#export VERSION=0.10.41
#export VERSIONDATE=20180508
#export VERSION=0.10.42
#export VERSIONDATE=20180810
#export VERSION=0.10.43
#export VERSIONDATE=20180820
#export VERSION=0.10.44
#export VERSIONDATE=20181125
#export VERSION=0.10.45
#export VERSIONDATE=20190604
#export VERSION=0.10.46
#export VERSIONDATE=20191107
#export VERSION=0.10.47
#export VERSIONDATE=20200510
####Package 'pangowin32', required by 'gdk-3.0', not found
#export VERSION=0.10.48
#export VERSIONDATE=20200813
#export VERSION=0.10.49
#export VERSIONDATE=20210315
####goffice/app/file.c:731:10: error: 'go__BOOLEAN__OBJECT_STRING_POINTER' undeclared (first use in this function)
#export VERSION=0.10.50
#export VERSIONDATE=20210611
#export VERSION=0.10.51
#export VERSIONDATE=20220121
#export VERSION=0.10.52
#export VERSIONDATE=20220419
#export VERSION=0.10.53
#export VERSIONDATE=20220918
#export VERSION=0.10.54
#export VERSIONDATE=20230120
#export VERSION=0.10.55
#export VERSIONDATE=20230203
#export VERSION=0.10.56
#export VERSIONDATE=20231103
#export VERSION=0.10.57
#export VERSIONDATE=20240212
export VERSION=0.10.59
export VERSIONDATE=20250302
wl-showstatus --package-version
export DEPENDENCIES=glib2,libgsf,pango,cairo,atk,gconf,gdk-pixbuf,gettext,libxml2
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/goffice/ goffice-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
wl-wait4deps
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/goffice/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/goffice-$VERSION.tar.bz2
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#tar xj --force-local -f $TARBALLDIR/$BASENAME/goffice-$VERSION.tar.bz2
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/goffice/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/goffice-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
tar xJ --force-local -f $TARBALLDIR/$BASENAME/goffice-$VERSION.tar.xz
cd goffice-$VERSION
# fix missing isnanl in goffice/math/go-math.c (version >= 0.10.1)
mv goffice/math/go-math.c goffice/math/go-math.c.bak
sed -e "s/\(isnanl\)/__\1/g" goffice/math/go-math.c.bak > goffice/math/go-math.c
# fix missing isnanl in goffice/math/go-R.c (version >= 0.10.1)
mv goffice/math/go-R.c goffice/math/go-R.c.bak
sed -e "s/\(isnan\)/__\1/g" goffice/math/go-R.c.bak > goffice/math/go-R.c
# fix missing close in goffice/utils/go-spectre.c (version >= 0.10.1)
mv goffice/utils/go-spectre.c goffice/utils/go-spectre.c.bak
echo "#include <io.h>" > goffice/utils/go-spectre.c
cat goffice/utils/go-spectre.c.bak >> goffice/utils/go-spectre.c
# fix GLIB_CHECK_VERSION issue in goffice/goffice.h (version >= 0.10.2)
mv goffice/goffice.h goffice/goffice.h.bak
sed -e "s/^\(#if \)GLIB_CHECK_VERSION.*$/\11/" goffice/goffice.h.bak > goffice/goffice.h
## remove invalid exports from goffice/goffice.def (version >= 0.10.4 <= 0.10.9)
#patch -ulbf goffice/goffice.def << EOF
#--- goffice/goffice.def  2013-07-16 13:05:02 +0200
#+++ goffice/goffice.def  2013-07-16 13:07:54 +0200
#@@ -274,3 +274,2 @@
# go_component_set_use_font_from_app
#-go_component_set_window
# go_component_stop_editing
#@@ -507,6 +506,2 @@
# go_error_invalid
#-go_error_stack_add_child
#-go_error_stack_dump
#-go_error_stack_free
#-go_error_stack_new
# go_error_system
#@@ -588,3 +583,2 @@
# go_font_sel_dialog_get_type
#-go_font_sel_dialog_new
# go_font_sel_editable_enters
#@@ -747,3 +741,2 @@
# go_image_draw
#-go_image_fill
# go_image_format_info_get_type
#@@ -889,4 +882,2 @@
# go_non_linear_regressionl
#-go_object_new
#-go_object_new_valist
# go_object_properties_apply
#@@ -986,3 +977,2 @@
# go_plugin_get_type_module
#-go_plugin_init
# go_plugin_is_active
#@@ -1021,3 +1011,2 @@
# go_plugin_services_shutdown
#-go_plugin_shutdown
# go_plugin_unload_service
#@@ -1193,8 +1182,2 @@
# go_selector_update_swatch
#-go_service_get_plugin
#-go_service_get_type
#-go_service_object_get_type
#-go_service_object_interfaces
#-go_service_object_primary_type
#-go_service_simple_get_type
# go_set_file_permissions
#@@ -1273,3 +1256,2 @@
# go_styled_object_get_type
#-go_styled_object_is_filled
# go_styled_object_set_cairo_line
#EOF
## remove invalid exports from goffice/app/local.def (version >= 0.10.4 <= 0.10.9)
#patch -ulbf goffice/app/local.def << EOF
#--- goffice/app/local.def  2013-07-16 09:13:38 +0200
#+++ goffice/app/local.def  2013-07-16 13:04:42 +0200
#@@ -4,8 +4,2 @@
# _go_plugin_services_init
#-go_app_get_plugin
#-go_app_get_type
#-go_app_sys_data_dir
#-go_app_sys_glade_dir
#-go_app_sys_lib_dir
#-go_app_sys_plugin_dir
# go_cmd_context_error
#EOF
# fix invalid printf of long double in goffice/math/go-dtoa.c (version >= 0.10.15)
patch -ulbf goffice/math/go-dtoa.c << EOF
--- goffice/math/go-dtoa.c  2014-04-30 02:44:52 +0200
+++ goffice/math/go-dtoa.c  2014-05-01 08:47:44 +0200
@@ -493,3 +493,3 @@

-       if (debug) g_printerr ("%Lg [%s] t=%c  p=%d\n", d, fmt, t, p);
+       if (debug) g_printerr ("%g [%s] t=%c  p=%d\n", (double)d, fmt, t, p);
        fmt_fp (dst, d, w, p, fl, t);
EOF
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
# fix support for PCRE with support for both UTF-8 and UTF-16
sed -i.bak -e "s/\(\^ \*UTF-8 \)\(support\)/\1.*\2/" configure
wl-showstatus configure &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-no-undefined -Wl,-no-undefined" &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-config-backend=win32 --enable-introspection=no LDFLAGS="-Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --with-config-backend=win32 --enable-introspection=no LDFLAGS="-Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-config-backend=win32 --enable-introspection=no --without-long-double LDFLAGS="-Wl,-no-undefined" &&
 #PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-config-backend=win32 --enable-introspection=no --without-long-double --without-lasem LDFLAGS="-Wl,-no-undefined" &&
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-config-backend=win32 --enable-introspection=no --without-long-double --without-lasem LDFLAGS="-Wl,-no-undefined" &&
 PATH=$PATH:$PERLDIR/../c/bin INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-config-backend=win32 --enable-introspection=no --without-long-double --without-lasem CFLAGS="-fcommon" LDFLAGS="-Wl,-no-undefined" &&
 wl-showstatus build-install &&
 # fix missing local.def files (version >= 0.9.0)
 mkdir -p goffice/ms-compat goffice/drawing &&
 #touch goffice/app/local.def goffice/data/local.def goffice/graph/local.def goffice/math/local.def goffice/ms-compat/local.def goffice/utils/local.def goffice/gtk/local.def goffice/drawing/local.def goffice/component/local.def goffice/canvas/local.def &&
 for F in goffice/app goffice/data goffice/graph goffice/math goffice/ms-compat goffice/utils goffice/gtk goffice/drawing goffice/component goffice/canvas; do
  if [ ! -f $F/local.def ]; then
   echo "EXPORTS" > $F/local.def &&
   $PERLDIR/bin/perl.exe tools/dumpdef.pl $F/*.h >> $F/local.def || true
  fi
 done &&
 #( PATH=$PATH:$PERLDIR/../c/bin make install-strip || make install-strip LIBS="-Wl,--as-needed -lepcre" || make install-strip LIBS="-Wl,--as-needed -lpcreposix" ) &&
 ( PATH=$PYDIR:$PATH:$PERLDIR/../c/bin make install-strip || PATH=$PYDIR:$PATH make install-strip LIBS="-Wl,--as-needed -lepcre" || PATH=$PYDIR:$PATH make install-strip LIBS="-Wl,--as-needed -lpcreposix" ) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf goffice-$VERSION
#mkdir -p goffice/ms-compat
#cp -f goffice/local.def goffice/ms-compat/
#cp -f local.def goffice/ms-compat/
####ld.exe:goffice/.libs/libgoffice-0.10-10.dll.def:2: syntax error
#mv goffice/goffice.def goffice/goffice.def.bak
#echo "EXPORTS" > goffice/goffice.def
#grep -v "^EXPORTS$" goffice/goffice.def.bak >> goffice/goffice.def
####*** Warning: linker path does not have real file for library -lpcrepos.



