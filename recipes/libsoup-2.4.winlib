#export NAME="libsoup"
#export STATUS=
#export URL=http://live.gnome.org/LibSoup
#export BASENAME=libsoup
#export DESCRIPTION="libsoup is an HTTP client/server library for GNOME"
#export CATEGORY=communication
#export TYPE=library
##export VERSION=2.25.4
##export VERSION=2.25.91
##export VERSION=2.26.0.9
##export VERSION=2.26.1
##export VERSION=2.27.1
##export VERSION=2.27.2
##export VERSION=2.27.4
##export VERSION=2.27.5
##export VERSION=2.27.90
##export VERSION=2.29.91
##export VERSIONDATE=20100224
##export VERSION=2.30.0
##export VERSIONDATE=20100330
##export VERSION=2.30.1
##export VERSIONDATE=20100427
##export VERSION=2.30.2
##export VERSIONDATE=20100623
##export VERSION=2.32.0
##export VERSIONDATE=20100928
##export VERSION=2.32.1
##export VERSIONDATE=20101116
##export VERSION=2.32.2
##export VERSIONDATE=20101130
##export VERSION=2.33.5
##export VERSIONDATE=20110115
##export VERSION=2.33.6
##export VERSIONDATE=20110202
##export DEPENDENCIES=glib2
##export VERSION=2.34.0
##export VERSIONDATE=20110405
##export VERSION=2.34.1
##export VERSIONDATE=20110426
##export VERSION=2.34.2
##export VERSIONDATE=20110524
##export VERSION=2.34.3
##export VERSIONDATE=20110729
##export VERSION=2.35.3
##export VERSIONDATE=20110711
##export VERSION=2.35.4
##export VERSIONDATE=20110729
##export VERSION=2.35.5
##export VERSIONDATE=20110816
##export VERSION=2.36.0
##export VERSIONDATE=20110927
##export VERSION=2.36.1
##export VERSIONDATE=20111018
##export VERSION=2.37.1
##export VERSIONDATE=20111026
##export VERSION=2.37.2
##export VERSIONDATE=20111122
##export VERSION=2.37.3
##export VERSIONDATE=20120116
##export VERSION=2.37.4
##export VERSIONDATE=20120117
##export VERSION=2.37.5
##export VERSIONDATE=20120207
##export VERSION=2.37.5.1
##export VERSIONDATE=20120210
##export VERSION=2.38.0
##export VERSIONDATE=20120327
##export VERSION=2.38.1
##export VERSIONDATE=20120417
##export VERSION=2.39.1
##export VERSIONDATE=20120501
##export VERSION=2.39.2
##export VERSIONDATE=20120504
##export VERSION=2.39.3
##export VERSIONDATE=20120626
##export VERSION=2.39.4
##export VERSIONDATE=20120717
##export VERSION=2.39.4.1
##export VERSIONDATE=20120717
##export VERSION=2.39.5
##export VERSIONDATE=20120807
##export VERSION=2.39.91
##export VERSIONDATE=20120904
##export VERSION=2.39.92
##export VERSIONDATE=20120918
##export VERSION=2.40.0
##export VERSIONDATE=20120925
#####configure: error: GLIB 2.33.1 or later is required to build libsoup
##export VERSION=2.40.1
##export VERSIONDATE=20121016
##export VERSION=2.40.2
##export VERSIONDATE=20121113
##export VERSION=2.40.3
##export VERSIONDATE=20130115
##export VERSION=2.41.1
##export VERSIONDATE=20121023
##export VERSION=2.41.2
##export VERSIONDATE=20121120
##export VERSION=2.41.4
##export VERSIONDATE=20130115
##export VERSION=2.41.5
##export VERSIONDATE=20130205
#####checking for GLIB - version >= 2.35.0... no
#####configure: error: GLIB 2.35.0 or later is required to build libsoup
##export VERSION=2.42.0
##export VERSIONDATE=20130325
##export VERSION=2.42.1
##export VERSIONDATE=20130416
##export VERSION=2.42.2
##export VERSIONDATE=20130425
##export VERSION=2.42.3
##export VERSIONDATE=20131114
##export VERSION=2.42.3.1
##export VERSIONDATE=20131115
##export VERSION=2.43.1
##export VERSIONDATE=20130501
##export VERSION=2.43.2
##export VERSIONDATE=20130529
##export VERSION=2.43.4
##export VERSIONDATE=20130709
##export VERSION=2.43.5
##export VERSIONDATE=20130730
##export VERSION=2.44.0
##export VERSIONDATE=20130924
##export VERSION=2.44.1
##export VERSIONDATE=20131014
##export VERSION=2.44.2
##export VERSIONDATE=20131112
##export VERSION=2.45.3
##export VERSIONDATE=20131217
##export VERSION=2.46.0
##export VERSIONDATE=20140325
##export VERSION=2.47.3
##export VERSIONDATE=20140624
##export VERSION=2.47.4
##export VERSIONDATE=20140722
##export VERSION=2.48.0
##export VERSIONDATE=20140924
##export VERSION=2.48.1
##export VERSIONDATE=20141207
##export VERSION=2.49.1
##export VERSIONDATE=20141125
##export VERSION=2.50.0
##export VERSIONDATE=20150323
##export VERSION=2.51.3
##export VERSIONDATE=20150623
##export VERSION=2.52.0
##export VERSIONDATE=20150922
#####configure: error: conditional "ENABLE_VAPIGEN" was never defined.
##export VERSION=2.52.1
##export VERSIONDATE=20151013
##export VERSION=2.52.2
##export VERSIONDATE=20151110
##export VERSION=2.53.1
##export VERSIONDATE=20151030
##export VERSION=2.53.2
##export VERSIONDATE=20151127
#####configure: error: Vala bindings require GObject Introspection
#####libsoup/soup-init.c:42:1: error: no previous prototype for 'DllMain' [-Werror=missing-prototypes]
##export VERSION=2.54.0.1
##export VERSIONDATE=20160404
##export VERSION=2.54.1
##export VERSIONDATE=20160426
##export VERSION=2.56.0
##export VERSIONDATE=20160920
##export VERSION=2.56.1
##export VERSIONDATE=20170815
##export VERSION=2.57.1
##export VERSIONDATE=20161213
##export VERSION=2.58.0
##export VERSIONDATE=20170421
##export VERSION=2.58.1
##export VERSIONDATE=20170509
##export VERSION=2.58.2
##export VERSIONDATE=20170815
##export VERSION=2.60.0
##export VERSIONDATE=20170913
##export VERSION=2.60.1
##export VERSIONDATE=20171011
##export VERSION=2.60.2
##export VERSIONDATE=20171027
##export VERSION=2.60.3
##export VERSIONDATE=20180109
#####libsoup/soup-enum-types.h:18:35: error: implicit declaration of function 'soup_address_family_get_type'
##export VERSION=2.61.1
##export VERSIONDATE=20171211
##export VERSION=2.61.2
##export VERSIONDATE=20180109
##export VERSION=2.62.0
##export VERSIONDATE=20180313
##export VERSION=2.62.1
##export VERSIONDATE=20180410
##export VERSION=2.62.2
##export VERSIONDATE=20180507
##export VERSION=2.62.3
##export VERSIONDATE=20180810
##export VERSION=2.63.1
##export VERSIONDATE=20180416
##export VERSION=2.63.2
##export VERSIONDATE=20180522
##export VERSION=2.64.0
##export VERSIONDATE=20180904
##export VERSION=2.64.1
##export VERSIONDATE=20180925
##export VERSION=2.64.2
##export VERSIONDATE=20181023
#export VERSION=2.65.1
#export VERSIONDATE=20181009
#wl-showstatus --package-version
#export DEPENDENCIES=glib2,gnutls,gconf,libproxy,sqlite3,libxml2,libgcrypt,zlib,glib-networking
#export OPTIONALDEPENDENCIES=gnome-keyring
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL2
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/libsoup/ libsoup-"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/libsoup/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/libsoup/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
### fix bug in libsoup/soup-gnutls.c (version 2.27.4)
##patch -ulbf libsoup/soup-gnutls.c << EOF
##--- libsoup/soup-gnutls.c  Mon Jul 13 16:49:00 2009
##+++ libsoup/soup-gnutls.c  Wed Jul 15 20:32:48 2009
##@@ -410,3 +410,3 @@
## #ifdef G_OS_WIN32
##-       chan->eagain = (nread == SOCKET_ERROR && WSAGetLastError () == WSAEWOULDBLOCK);
##+       chan->eagain = (nwrote == SOCKET_ERROR && WSAGetLastError () == WSAEWOULDBLOCK);
## #else
##EOF
## fix use of already defined interface in libsoup/soup-cache.c (version >= 2.42.0)
#mv libsoup/soup-cache.c libsoup/soup-cache.c.bak
#sed -e "s/\(SoupContentProcessorInterface \*\)\(interface\)/\1processor_\2/" libsoup/soup-cache.c.bak > libsoup/soup-cache.c
## fix use of already defined interface in libsoup/soup-content-decoder.c (version >= 2.42.0)
#mv libsoup/soup-content-decoder.c libsoup/soup-content-decoder.c.bak
#sed -e "s/\(SoupContentProcessorInterface \*\)\(interface\)/\1processor_\2/" libsoup/soup-content-decoder.c.bak > libsoup/soup-content-decoder.c
## fix use of already defined interface in libsoup/soup-content-processor.c (version >= 2.42.0)
#mv libsoup/soup-content-processor.c libsoup/soup-content-processor.c.bak
#sed -e "s/\(SoupContentProcessorInterface \*\)\(interface\)/\1processor_\2/; s/\(interface->\)/processor_\1/g" libsoup/soup-content-processor.c.bak > libsoup/soup-content-processor.c
## fix use of already defined interface in libsoup/soup-content-sniffer.c (version >= 2.42.0)
#mv libsoup/soup-content-sniffer.c libsoup/soup-content-sniffer.c.bak
#sed -e "s/\(SoupContentProcessorInterface \*\)\(interface\)/\1processor_\2/" libsoup/soup-content-sniffer.c.bak > libsoup/soup-content-sniffer.c
## fix missing strchr/strlen in libsoup/soup-request-file.c (version >= 2.24.2)
#mv libsoup/soup-request-file.c libsoup/soup-request-file.c.bak
#echo "#include <string.h>" > libsoup/soup-request-file.c
#cat libsoup/soup-request-file.c.bak >> libsoup/soup-request-file.c
### fix missing sso_available in libsoup/soup-auth-ntlm.c (version >= 2.44.0 <= 2.64.1)
##patch -ulbf libsoup/soup-auth-ntlm.c << EOF
##--- libsoup/soup-auth-ntlm.c  2013-09-22 23:24:34 +0200
##+++ libsoup/soup-auth-ntlm.c  2013-09-24 21:49:42 +0200
##@@ -19,2 +19,6 @@
## #include "soup-message-private.h"
##+#ifdef __MINGW32__
##+#include <io.h>
##+#define USE_NTLM_AUTH 1
##+#endif
##
##EOF
## fix missing sscanf format error in libsoup/soup-auth-ntlm.c (version >= 2.65.1)
#patch -ulbf libsoup/soup-auth-ntlm.c << EOF
#@@ -15,2 +15,3 @@
# #include <stdio.h>
#+#include <stdint.h>
#
#@@ -809,2 +810,3 @@
#        size_t count;
#+       char digits[3];
#
#@@ -812,6 +814,9 @@
#        hex_pos = hmac_hex;
#+
#+       digits[2] = 0;
#        for (count = 0; count < HMAC_MD5_LENGTH; count++)
#        {
#-               sscanf(hex_pos, "%2hhx", &hmac[count]);
#-               hex_pos += 2;
#+               digits[0] = *hex_pos++;
#+               digits[1] = *hex_pos++;
#+               *(uint8_t*)&hmac[count] = strtol(digits, (char **) NULL, 16);
#        }
#EOF
## fix invalid export of soup_server_get_gsocket (version >= 2.48.0)
#####Cannot export soup_server_get_gsocket: symbol not defined
#mv libsoup/libsoup-2.4.sym libsoup/libsoup-2.4.sym.bak
#grep -v soup_server_get_gsocket libsoup/libsoup-2.4.sym.bak > libsoup/libsoup-2.4.sym
## fix missing prototype for DllMain in libsoup/soup-init.c (version >= 2.52.1)
#mv libsoup/soup-init.c libsoup/soup-init.c.bak
#cat > libsoup/soup-init.c << EOF
##include <windows.h>
#BOOL WINAPI DllMain (HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpvReserved);
#EOF
#cat libsoup/soup-init.c.bak >> libsoup/soup-init.c
## fix already defined EOF/CLOSED (version >= 2.54.1)
#mv libsoup/soup-cache-client-input-stream.c libsoup/soup-cache-client-input-stream.c.bak &&
#sed -e "s/\(EOF\|CLOSED\|LAST_SIGNAL\)/soup\1/g" libsoup/soup-cache-client-input-stream.c.bak > libsoup/soup-cache-client-input-stream.c
#mv libsoup/soup-client-input-stream.c libsoup/soup-client-input-stream.c.bak &&
#sed -e "s/\(EOF\|CLOSED\|LAST_SIGNAL\)/soup\1/g" libsoup/soup-client-input-stream.c.bak > libsoup/soup-client-input-stream.c
## skip making tests
#mv tests/Makefile.in tests/Makefile.in.bak
#cat > tests/Makefile.in << EOF
#all:
#install:
#install-strip:
#clean:
#EOF
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak &&
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
## remove invalid parameter -Wmissing-include-dirs
#mv configure configure.bak2 &&
#sed -e "s/-Wmissing-include-dirs//" configure.bak2 > configure
## remove invalid parameter -Werror=implicit-function-declaration (version >= 2.58.2)
#mv configure configure.bak3 &&
#sed -e "s/-Werror=implicit-function-declaration\|-Wstrict-prototypes\|-Wall//g" configure.bak3 > configure
## fix globbing issue with glib-mkenums (version >= 2.60.0)
#sed -i.bak -e 's?\("\)\(<*/\*\)?\1\\n\2?g' Makefile.glib
##make check
## fix missing python3 in libsoup/tld-parser.py (version >= 2.61.1)
#sed -i.bak -e "s?\bpython3?python.exe?" libsoup/tld-parser.py
#wl-showstatus configure &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome LDFLAGS="-Wl,--allow-multiple-definition" LIBPROXY_LIBS="-lproxy" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome LDFLAGS="-Wl,--allow-multiple-definition" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition" &&
### --without-gnome is required since version 2.27.91 to avoid dependancy on gnome-keyring
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-gnome LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no --disable-tls-check CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##PATH=$PYDIR:$PATH ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no --disable-tls-check CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##PATH=$PYDIR:$PATH PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no --disable-tls-check CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
##PATH=$PYDIR:$PATH INTLTOOL_PERL="$PERLDIR/bin/perl.exe" PATH=$PATH:$PERLDIR/../c/bin ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no --disable-tls-check CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
#INTLTOOL_PERL="$PERLDIR/bin/perl.exe" PATH=$PYDIR:$PATH:$PERLDIR/../c/bin ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-gnome --enable-introspection=no --disable-tls-check --disable-vala CFLAGS="`pkg-config.exe --cflags gconf-2.0`" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
# wl-showstatus build-install &&
# PATH=$PYDIR:$PATH make install-strip &&
# #( PATH=$PYDIR:$PATH make install-strip || (
# # # fix bad line in generated libsoup/soup-enum-types.h (version >= 2.58.2)
# # mv libsoup/soup-enum-types.h libsoup/soup-enum-types.h.bak &&
# # sed -e "s?^.*\(/\* Generated by glib-mkenums\. Do not edit\)?\1?" libsoup/soup-enum-types.h.bak > libsoup/soup-enum-types.h &&
# # touch -c libsoup/soup-enum-types.h.stamp &&
# # # fix bad line in generated libsoup/soup-enum-types.c (version >= 2.58.2)
# # mv libsoup/soup-enum-types.c libsoup/soup-enum-types.c.bak &&
# # sed -e "s?^.*\(/\* Generated by glib-mkenums\. Do not edit\)?\1?" libsoup/soup-enum-types.c.bak > libsoup/soup-enum-types.c &&
# # touch -c libsoup/soup-enum-types.c.stamp &&
# # PATH=$PYDIR:$PATH make install-strip
# #)) &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
##PKG_CONFIG=$(which pkg-config)



export NAME="libsoup-2.4"
export STATUS=
export URL=http://live.gnome.org/LibSoup
export BASENAME=libsoup-2.4
export DESCRIPTION="libsoup is an HTTP client/server library for GNOME"
export CATEGORY=communication
export TYPE=library
#export VERSION=2.64.3
#export VERSIONDATE=20201214
#export VERSION=2.65.2
#export VERSIONDATE=20190121
#export VERSION=2.66.0
#export VERSIONDATE=20190312
#export VERSION=2.66.1
#export VERSIONDATE=20190412
#export VERSION=2.66.2
#export VERSIONDATE=20190516
#export VERSION=2.66.4
#export VERSIONDATE=20191009
#export VERSION=2.66.5
#export VERSIONDATE=20201214
#export VERSION=2.67.1
#export VERSIONDATE=20190524
#export VERSION=2.67.2
#export VERSIONDATE=20190618
#export VERSION=2.67.3
#export VERSIONDATE=20190718
#export VERSION=2.68.0
#export VERSIONDATE=20190911
#export VERSION=2.68.2
#export VERSIONDATE=20191009
#export VERSION=2.68.3
#export VERSIONDATE=20191204
#export VERSION=2.68.4
#export VERSIONDATE=20200226
####/usr/bin/env: 'python3': No such file or directory
#export VERSION=2.70.0
#export VERSIONDATE=20200307
#export VERSION=2.71.0
#export VERSIONDATE=20200708
#export VERSION=2.71.1
#export VERSIONDATE=20200906
#export VERSION=2.72.0
#export VERSIONDATE=20200914
#export VERSION=2.74.0
#export VERSIONDATE=20210823
export VERSION=2.74.2
export VERSIONDATE=20220314
wl-showstatus --package-version
#export DEPENDENCIES=glib2,gnutls,gconf,libproxy,sqlite3,libxml2,libgcrypt,zlib,glib-networking,libpsl
export DEPENDENCIES=glib2,gnutls,gconf,libproxy,sqlite3,libxml2,libgcrypt,zlib,glib-networking,libpsl,vala,gobject-introspection
#export DEPENDENCIES=glib2,gnutls,gconf,libproxy,sqlite3,libxml2,libgcrypt,zlib,glib-networking,libpsl,vala,gobject-introspection,mman-win32
export OPTIONALDEPENDENCIES=gnome-keyring,libcurl
export BUILDDEPENDENCIES=meson
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL2
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/libsoup/ libsoup-"
#export DOWNLOADURL="https://gitlab.gnome.org/GNOME/libsoup/-/tags libsoup-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/libsoup/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/libsoup-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xJ --force-local -f $TARBALLDIR/$BASENAME/libsoup-$VERSION.tar.xz
cd libsoup-$VERSION
## fix missing files (version >= 2.71.1)
#mkdir -p winfix
#cat > winfix/endian.h << EOF
##define __LITTLE_ENDIAN 1234
##define __BYTE_ORDER __LITTLE_ENDIAN
#EOF
# fix MSVC issue
mkdir -p winfix
cp -rf $PYDIR/lib/distutils winfix/
patch -ulbf winfix/distutils/cygwinccompiler.py << EOF
@@ -85,3 +85,3 @@
         else:
-            raise ValueError("Unknown MS Compiler version %s " % msc_ver)
+            return None

EOF
## fix missing strtoul in libsoup/soup-date-utils.c (version >= 2.99.1)
#mv libsoup/soup-date-utils.c libsoup/soup-date-utils.c.bak &&
#echo "#include <stdlib.h>" > libsoup/soup-date-utils.c &&
#cat libsoup/soup-date-utils.c.bak >> libsoup/soup-date-utils.c
# skip making examples
sed -i.bak -e "s/subdir('examples')/#&/" meson.build
## skip making examples and fix missing ntlm_auth in meson.build (version >= 2.99.1 <= 2.99.8)
#patch -ulbf meson.build << EOF
#@@ -319,3 +319,3 @@
# # NTLM not supported on Windows
#-if host_machine.system() != 'windows'
#+if true
#   ntlm_auth = find_program(get_option('ntlm_auth'), required: get_option('ntlm'))
#@@ -362,3 +362,3 @@
#
#-subdir('examples')
#+#subdir('examples')
# subdir('fuzzing')
#EOF
## fix detection of Python (version >= 2.99.6)
#sed -i.bak -e "s?'python3'?'$(cygpath -w $PYDIR/python.exe|sed -e 's/\\/&&&&/g')'?" meson.build
#sed -i.bak -e "s?'python3'?'$(cygpath -w $PYDIR/python.exe|sed -e 's/\\/&&&&/g')'?" libsoup/meson.build
mkdir -p build_both &&
 wl-showstatus configure &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=false -Dntlm=false -Dtls_check=false -Dgnome=true -Dvapi=false -Dintrospection=false -Ddoc=false -Dtests=false . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=disabled -Dintrospection=disabled -Ddoc=disabled -Dtests=false -Dc_link_args="-Wl,--as-needed -lws2_32" . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=disabled -Dintrospection=disabled -Ddoc=disabled -Dexamples=false -Dtests=false -Dc_link_args="-Wl,--as-needed -lws2_32" . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=enabled -Dintrospection=enabled -Ddoc=disabled -Dexamples=false -Dtests=false -Dc_link_args="-Wl,--as-needed -lws2_32" . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=enabled -Dintrospection=enabled -Ddoc=disabled -Dexamples=false -Dtests=false -Dc_args="-fcommon" -Dc_link_args="-Wl,--as-needed -lws2_32" . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=enabled -Dintrospection=enabled -Dsysprof=disabled -Ddoc=disabled -Dexamples=false -Dtests=false -Dc_args="-fcommon -I$(cygpath -w $(pwd)/winfix) -I$(cygpath -w $MINGWPREFIX/include/mman-win32)" -Dc_link_args="-Wl,--as-needed -lws2_32 -lmman" . build_both &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=enabled -Dintrospection=enabled -Dsysprof=disabled -Dgtk_doc=false -Dtests=false -Dc_args="-fcommon -I$(cygpath -w $(pwd)/winfix) -I$(cygpath -w $MINGWPREFIX/include/mman-win32)" -Dc_link_args="-Wl,--as-needed -lws2_32 -lmman" . build_both &&
 PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgssapi=disabled -Dntlm=disabled -Dtls_check=false -Dgnome=true -Dvapi=enabled -Dintrospection=enabled -Dsysprof=disabled -Dgtk_doc=false -Dtests=false -Dc_args="-fcommon -I$(cygpath -w $(pwd)/winfix) -I$(cygpath -w $MINGWPREFIX/include/mman-win32)" -Dc_link_args="-Wl,--as-needed -lws2_32 -lmman" . build_both &&
 # fix slash/backslash path issue when calling Python from Ninja
 sed -i.bak -e "s/join_paths/os.path.join/g; /COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_both/build.ninja &&
 # fix execution of Python scripts
 sed -i.bak2 -e "s?\(COMMAND\|POST_BUILD\)\( *= *\| *=.*\&\& *\)\(\"\{0,1\}[^ ]*\)\(\.py\|glib-mkenums\|g-ir-scanner\)\(\"\{0,1\} \)?\1\2$(echo $PYDIR/python.exe|sed -e "s?^/\([a-zA-Z]\)/?\1:\\\\\\\\?; s?/?\\\\\\\\?g") \3\4\5?" build_both/build.ninja &&
 # fix invalid -R flag (version >= 2.71.1)
 sed -i.bak3 -e "s/ \"*-R[^ ]*//" build_both/build.ninja &&
 wl-showstatus build-install &&
 #PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -Cbuild_both install &&
 #PKG_CONFIG= PATH=$PATH:$PYDIR PYTHONPATH=$(pwd)/winfix:$MINGWPREFIX/lib${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_both install &&
 PATH=$PATH:$PYDIR PYTHONPATH=$(pwd)/winfix:$MINGWPREFIX/lib${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_both install &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf libsoup-$VERSION



