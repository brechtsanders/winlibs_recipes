export NAME="dmon"
export STATUS=
export URL=https://github.com/septag/dmon
export BASENAME=dmon
export DESCRIPTION="Single header C99 portable library for monitoring filesystem changes. (Windows/Linux/MacOS)"
export CATEGORY=
export TYPE=library
export VERSION=master
export VERSIONDATE=20260126
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=cmake,ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=BSD
export DOWNLOADURL="https://github.com/septag/dmon/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/septag/dmon/archive/refs/heads/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix dmon.h (version >= master)
patch -ulbf dmon.h << EOF
@@ -518,3 +518,4 @@
         DWORD active = 0;
-        for (unsigned i = 0; i < DMON_MAX_WATCHES; i++) {
+        unsigned i;
+        for (i = 0; i < DMON_MAX_WATCHES; i++) {
             dmon__watch_state* watch = _dmon.watches[i];
@@ -594,3 +595,4 @@

-       for (int i = 0; i < DMON_MAX_WATCHES; i++)
+       int i;
+       for (i = 0; i < DMON_MAX_WATCHES; i++)
     {
@@ -613,3 +615,4 @@

-    for (unsigned i = 0; i < DMON_MAX_WATCHES; i++) {
+    unsigned i;
+    for (i = 0; i < DMON_MAX_WATCHES; i++) {
         if (_dmon.watches[i]) {
@@ -1172,3 +1175,4 @@

-    for (int i = 0; i < DMON_MAX_WATCHES; i++)
+    int i;
+    for (i = 0; i < DMON_MAX_WATCHES; i++)
         _dmon.freelist[i] = DMON_MAX_WATCHES - i - 1;
@@ -1563,3 +1567,4 @@

-    for (int i = 0; i < DMON_MAX_WATCHES; i++)
+    int i;
+    for (i = 0; i < DMON_MAX_WATCHES; i++)
         _dmon.freelist[i] = DMON_MAX_WATCHES - i - 1;
EOF
mkdir -p build_win &&
 wl-showstatus configure &&
 cmake.exe -Wno-dev -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_TESTS:BOOL=ON -DBUILD_TESTING:BOOL=ON -DCMAKE_POLICY_VERSION_MINIMUM:STRING=3.5 -S. -Bbuild_win &&
 wl-showstatus build-install &&
 make -Cbuild_win install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



