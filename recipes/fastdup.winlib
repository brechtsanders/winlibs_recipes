export NAME="fastdup"
export STATUS=
export URL=https://github.com/zzhofict/FastDup
export BASENAME=FastDup
export DESCRIPTION="FastDup is a tool designed to locate and tag duplicate reads in a coordinate-sorted SAM or BAM file."
export CATEGORY=system
export TYPE=application
export VERSION=1.0.0
export VERSIONDATE=20250205
wl-showstatus --package-version
export DEPENDENCIES=zlib,libbz2,xz,libdeflate,pcre,openssl
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=cmake,ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=MIT
export DOWNLOADURL="https://github.com/zzhofict/FastDup/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/zzhofict/FastDup/archive/refs/tags/v$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/v$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix undefined int64_t in ext/klib/kthread.c (version >= 1.0.0)
sed -i.bak -e "1i #include <stdint.h>" ext/klib/kthread.c
# fix src/markdup/md_args.h (version >= 1.0.0)
patch -ulbf src/markdup/md_args.h << EOF
@@ -23,2 +23,3 @@
      */
+#undef STRICT
     STRICT,
EOF
# fix src/CMakeLists.txt (version >= 1.0.0)
patch -ulbf src/CMakeLists.txt << EOF
@@ -82,3 +82,3 @@
     target_link_libraries(\${PG_NAME} \${MATH_LIBRARY})
-else()
+elseif(NOT WIN32)
     message(FATAL_ERROR "lm is not found")
EOF
mkdir -p build_win &&
 wl-showstatus configure &&
 cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -S. -Bbuild_win &&
 # fix missing link libraries
 sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.*$/& -Wl,--as-needed -lws2_32 -lregex/" build_win/build.ninja &&
 wl-showstatus build-install &&
 ninja -Cbuild_win install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



