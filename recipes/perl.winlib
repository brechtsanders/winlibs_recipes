export NAME="Perl"
export STATUS=
export URL=http://www.perl.org/
export BASENAME=perl
export DESCRIPTION="Perl is a high-level programming language with an eclectic heritage written by Larry Wall and a cast of thousands. It derives from the ubiquitous C programming language and to a lesser extent from sed, awk, the Unix shell, and at least a dozen other tools and languages. Perl's process, file, and text manipulation facilities make it particularly well-suited for tasks involving quick prototyping, system utilities, software tools, system management tasks, database access, graphical programming, networking, and web programming."
export CATEGORY=development
export TYPE=application
#export VERSION=5.14.1
#export VERSIONDATE=20110825
#export VERSION=5.14.2
#export VERSIONDATE=20110927
#export VERSION=5.16.0
#export VERSIONDATE=20120521
#export VERSION=5.16.1
#export VERSIONDATE=20120814
#export VERSION=5.16.2
#export VERSIONDATE=20121101
#export VERSION=5.16.3
#export VERSIONDATE=20130312
#export VERSION=5.17.7
#export VERSIONDATE=20130116
#export VERSION=5.18.0
#export VERSIONDATE=20130116
#export VERSION=5.18.1
#export VERSIONDATE=20130823
####dmake.exe:  Error code 255, while making 'utils'
#export VERSION=5.18.2
#export VERSIONDATE=20140112
####Couldn't link c2ph to pstruct: Invalid argument
#export VERSION=5.20.0
#export VERSIONDATE=20140528
#export VERSION=5.20.1
#export VERSIONDATE=20140915
#export VERSION=5.20.2
#export VERSIONDATE=20150223
#export VERSION=5.22.0
#export VERSIONDATE=20150602
#export VERSION=5.22.1
#export VERSIONDATE=20151215
#export VERSION=5.22.2
#export VERSIONDATE=20160430
#export VERSION=5.24.0
#export VERSIONDATE=20160517
####dmake.exe:  Error code 255, while making 'utils'
#export VERSION=5.24.1
#export VERSIONDATE=20170121
#export VERSION=5.26.0
#export VERSIONDATE=20170601
#export VERSION=5.26.1
#export VERSIONDATE=20170924
#export VERSION=5.26.2
#export VERSIONDATE=20180420
#export VERSION=5.28.0
#export VERSIONDATE=20180625
#export VERSION=5.28.1
#export VERSIONDATE=20181130
#export VERSION=5.28.2
#export VERSIONDATE=20190420
#export VERSION=5.29.4
#export VERSIONDATE=20181021
#export VERSION=5.29.8
#export VERSIONDATE=20190221
#export VERSION=5.30.0
#export VERSIONDATE=20190530
#export VERSION=5.30.1
#export VERSIONDATE=20191111
####dmake.exe:  makefile.mk:  line 474:  Error: -- Cannot open temp file `/tmp\mk1e9NqM' while processing `Shell escape'
#export VERSION=5.30.2
#export VERSIONDATE=20200315
#export VERSION=5.30.3
#export VERSIONDATE=20200603
#export VERSION=5.32.0
#export VERSIONDATE=20200626
#export VERSION=5.32.1
#export VERSIONDATE=20210124
#export VERSION=5.33.9
#export VERSIONDATE=20210424
export VERSION=5.34.0
export VERSIONDATE=20211221
#export VERSION=5.34.1
#export VERSIONDATE=20220313
#export VERSION=5.35.9
#export VERSIONDATE=20220221
#export VERSION=5.35.10
#export VERSIONDATE=20220321
#export VERSION=5.35.11
#export VERSIONDATE=20220431
#export VERSION=5.36.0
#export VERSIONDATE=20220528
#export VERSION=5.36.1
#export VERSIONDATE=20230424
#export VERSION=5.37.0
#export VERSIONDATE=20220528
#export VERSION=5.37.1
#export VERSIONDATE=20220621
#export VERSION=5.37.2
#export VERSIONDATE=20220721
#export VERSION=5.37.3
#export VERSIONDATE=20220821
#export VERSION=5.37.4
#export VERSIONDATE=20220921
#export VERSION=5.37.5
#export VERSIONDATE=20221021
#export VERSION=5.37.6
#export VERSIONDATE=20221121
#export VERSION=5.37.7
#export VERSIONDATE=20221221
#export VERSION=5.37.8
#export VERSIONDATE=20230121
#export VERSION=5.37.9
#export VERSIONDATE=20230221
#export VERSION=5.37.10
#export VERSIONDATE=20230321
#export VERSION=5.37.11
#export VERSIONDATE=20230421
#export VERSION=5.38.0
#export VERSIONDATE=20230703
#export VERSION=5.39.1
#export VERSIONDATE=20230721
#export VERSION=5.39.2
#export VERSIONDATE=20230821
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=dmake
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=Copying
export LICENSETYPE=GPL
#export DOWNLOADURL="http://www.perl.org/get.html"
export DOWNLOADURL="https://www.cpan.org/src/README.html"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://www.cpan.org/src/5.0/$BASENAME-$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://www.cpan.org/src/$(echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/").0/$BASENAME-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xz --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix missing poll.h in dist/IO/poll.h (version >= 5.33.9)
patch -ulbf dist/IO/poll.h << EOF
@@ -12,3 +12,5 @@
 
-#if (defined(HAS_POLL) && defined(I_POLL)) || defined(POLLWRBAND)
+#ifdef __MINGW32__
+#  include <winsock2.h>
+#elif (defined(HAS_POLL) && defined(I_POLL)) || defined(POLLWRBAND)
 #  include <poll.h>
EOF
# fix redefinition of inet_pton/inet_ntop in cpan/Socket/Socket.xs (version >= 5.33.9)
patch -ulbf cpan/Socket/Socket.xs << EOF
@@ -100,2 +100,3 @@
 
+#ifndef __MINGW32__
 static int inet_pton(int af, const char *src, void *dst)
@@ -147,2 +148,3 @@
 }
+#endif
 
EOF
# don't include lm.h in cpan/Win32/Win32.xs (version >= 5.33.9)
sed -i.bak -e "s/#include <lm\.h>.*$/#include <levmar.h>\n#include <lmaccess.h>\n#include <lmapibuf.h>\n#include <lmwksta.h>/" cpan/Win32/Win32.xs
## fix missing _IOWRT in win32/win32.h (version >= 5.34.1)
#mv win32/win32.h win32/win32.h.bak &&
#echo "#include <stdio.h>" > win32/win32.h &&
#cat win32/win32.h.bak >> win32/win32.h
##sh Configure -des -Dprefix=$INSTALLPREFIX -Dusethreads &&
#cd win32
##make -f GNUmakefile
#wl-showstatus build &&
##dmake &&
## wl-showstatus build-install &&
## dmake install INST_TOP=$INSTALLPREFIX &&
#dmake -f makefile.mk &&
# #wl-showstatus test &&
# #dmake -f makefile.mk test &&
# wl-showstatus build-install &&
# dmake -f makefile.mk install INST_TOP=$INSTALLPREFIX &&
# cd .. &&
#    echo OK
# fix missing CreateEnvironmentBlock/DestroyEnvironmentBlock (version >= 5.33.9)
sed -i.bak -e "s/libs='[^']*/& -Wl,--as-needed -luserenv/" config.sh
#sed -i.bak -e "s/'gmake'/'make.exe'/" win32/config.gc
wl-showstatus build &&
 mingw32-make -Cwin32 ..\\config.sh BUILD_STATIC=define &&
 #mingw32-make -Cwin32 ..\\config.sh BUILD_STATIC=define SKIP_CCHOME_CHECK=1 &&
 sed -i.bak -e "s?c:\\\\perl?$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's/\\/&&/g')?g; s?C:\\\\MinGW\\\\?$(cygpath -w $MINGWPREFIX/|sed -e 's/\\/&&/g')?g" config.sh &&
 mingw32-make -Cwin32 BUILD_STATIC=define &&
 #mingw32-make -Cwin32 BUILD_STATIC=define SKIP_CCHOME_CHECK=1 &&
 wl-showstatus install &&
 ## determine install path using backslashes
 #mkdir -p $INSTALLPREFIX/share/perl &&
 #pushd $INSTALLPREFIX/share/perl > /dev/null &&
 #INSTALLPREFIXFULL="$(pwd -W | tr '/' '\\')" &&
 #popd > /dev/null &&
 #sed -e "s?^\(INST_TOP\s*=\s*\).*?\1$(echo $INSTALLPREFIXFULL|sed -e "s/\\\\/&&/g")?" win32/Makefile > win32/Makefile.mingw &&
 #sed -e "s?^\(INST_TOP\s*=\s*\).*?\1$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's/\\/&&/g')?" win32/Makefile > win32/Makefile.mingw &&
 #mingw32-make -Cwin32 -fMakefile.mingw install &&
 #mingw32-make -Cwin32 install inst_lib BUILD_STATIC=define INST_DRV="$(echo $INSTALLPREFIXFULL | sed -e "s/:.*$/:/")" INST_TOP="$INSTALLPREFIXFULL" &&
 mingw32-make -Cwin32 install inst_lib BUILD_STATIC=define INST_DRV="$(cygpath -m $INSTALLPREFIX| sed -e "s/:.*$/:/")" INST_TOP="$(cygpath -w $INSTALLPREFIX/share/perl)" &&
 #SKIP_CCHOME_CHECK=1 PLMAKE=make 
 #cp -u perl.exe perl*.dll $INSTALLPREFIX/share/perl/bin/ &&
 #mingw32-make -Cwin32 test &&
 # don't use absolute paths in batch files
 sed -i -e "s?$(cygpath -w $INSTALLPREFIX/share/perl/bin|sed -e 's?\\?&&?g; s?\.?\\.?g')?%~dp0?g" $INSTALLPREFIX/share/perl/bin/*.bat &&
 # don't use absolute paths in lib/CORE/config.h
 sed -i -e "s?\"$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&&&?g; s?\.?\\.?g')?__FILE__ \"\\\\\\\\..\\\\\\\\..\\\\\\\\..?g" $INSTALLPREFIX/share/perl/lib/CORE/config.h &&
 # don't use absolute paths in lib/Config.pm
 #sed -i -e "s?^package Config;?use File::Basename;\n&?; s?'$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&?g; s?\.?\\.?g')?dirname(dirname(__FILE__)) . '?" $INSTALLPREFIX/share/perl/lib/Config.pm &&
 #sed -i -e "s?^package Config;?use File::Basename;\n&?; s?'$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&?g; s?\.?\\.?g')?dirname(dirname(__FILE__)) . '?" $INSTALLPREFIX/share/perl/lib/Config.pm &&
 sed -i -e "s?^package Config;?use File::Basename;\n&?; s?^tie?my \$DerivedPERLBasePath = dirname(dirname(__FILE__));\n&?; s?'$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?\\\\\\{1,2\\}?g; s?\.?\\.?g')?\$DerivedPERLBasePath . '?" $INSTALLPREFIX/share/perl/lib/Config.pm &&
 ## don't use absolute paths in lib/Config_heavy.pl
 #sed -i -e "s?^package Config;?use File::Basename;\n&?; s?'$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&?g; s?\.?\\.?g')?dirname(dirname(__FILE__)) . '?" $INSTALLPREFIX/share/perl/lib/Config_heavy.pl &&
 #sed -i -e "s?^package Config;?use File::Basename;\n&?; s?'$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&?g; s?\.?\\.?g')?dirname(dirname(__FILE__)) . '?; s?\(-L\"\)$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&?g; s?\.?\\.?g')?\1' . dirname(dirname(__FILE__)) . '?g" $INSTALLPREFIX/share/perl/lib/Config_heavy.pl &&
 sed -i -e "s?^package Config;?use File::Basename;\n&?; s?^EOVIRTUAL?&\nmy \$DerivedPERLBasePath = dirname(dirname(__FILE__));\n\$DerivedPERLBasePath =~ s\?\\\\\\\\\?/\?g;\n\$Config_SH_expanded =~ s\?$(cygpath -w $INSTALLPREFIX/share/perl|sed -e 's?\\?&&&&?g; s?\.?\\\\.?g')\?\$DerivedPERLBasePath\?g;?" $INSTALLPREFIX/share/perl/lib/Config_heavy.pl &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
####See also: http://www.adp-gmbh.ch/blog/2004/october/9.html



mkdir -p localbin
cp -f $(which mingw32-make.exe) localbin/gmake.exe
PATH=$PWD/localbin:$PATH gmake -Cwin32 install inst_lib CCHOME="$(cygpath -m $(dirname $(dirname $(which gcc.exe))))" CCTYPE=GCC BUILD_STATIC=define INST_DRV="$(cygpath -m $INSTALLPREFIX| sed -e "s/:.*$/:/")" INST_TOP="$(cygpath -w $INSTALLPREFIX/share/perl)" OPTIMIZE=-Os USE_MINGW_ANSI_STDIO=define &&
    echo OK



wl-showstatus configure &&
 ./Configure -des -Dprefix=$INSTALLPREFIX -DCC=gcc &&
 #./Configure -Dprefix=$INSTALLPREFIX -DCC=gcc &&
    echo OK
