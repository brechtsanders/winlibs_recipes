export NAME="GIMP"
export STATUS=
export URL=http://www.gimp.org/
export BASENAME=gimp
export DESCRIPTION="GIMP is the GNU Image Manipulation Program. It is a freely distributed piece of software for such tasks as photo retouching, image composition and image authoring."
export CATEGORY=graphics
export TYPE=application
#export VERSION=2.8.4
#export VERSIONDATE=20130331
#export VERSION=2.8.6
#export VERSIONDATE=20130622
####failed to load "modifier_background": Failed to open file 'modifier_background': No such file or directory
#export VERSION=2.8.8
#export VERSIONDATE=20131104
####failed to load "cursor_bad_bw": Failed to open file 'cursor_bad_bw': No such file or directory
####app/widgets/gimpcursor.c:81:5: error: 'cursor_none' undeclared here (not in a function)
#export VERSION=2.8.10
#export VERSIONDATE=20131129
#export VERSION=2.8.16
#export VERSIONDATE=20160109
#export VERSION=2.8.18
#export VERSIONDATE=20160714
#export VERSION=2.8.20
#export VERSIONDATE=20170201
#export VERSION=2.8.22
#export VERSIONDATE=20170509
####plug-ins/color-rotate/color-rotate-stock.c:84:41: error: 'color_rotate_cw' undeclared (first use in this function)
#export OPTIONALDEPENDENCIES=webkitgtk,libxcursor,pygtk
#export VERSION=2.9.2
#export VERSIONDATE=20160109
#export DEPENDENCIES=glib2,gtk2,zlib,libbz2,gdk-pixbuf,libtiff,libjpeg,librsvg,gnu-ghostscript,libpng,libmng,libexif,aalib,libxpm,poppler,pango,cairo,libcurl,libwmf,jasper,lcms1,babl,gegl,atk,fontconfig,freetype2,gettext
#export VERSION=2.9.4
#export VERSIONDATE=20160713
#export VERSION=2.9.6
#export VERSIONDATE=20170825
#export VERSION=2.9.8
#export VERSIONDATE=20171213
####/bin/install: cannot stat './128/gimp-wilber.png': No such file or directory
####Error: missing dependency gegl-0.4 >= 0.4.0
####Error: missing dependency mypaint-brushes-1.0
#export VERSION=2.10.0
#export VERSIONDATE=20180427
#export VERSION=2.10.2
#export VERSIONDATE=20180521
#export VERSION=2.10.4
#export VERSIONDATE=20180705
####Error: missing dependency glib >= 2.54.2 except glib 2.56.0 and 2.56.1 (broken on Win32 - bug 795855)
#export VERSION=2.10.6
#export VERSIONDATE=20180820
#export VERSION=2.10.8
#export VERSIONDATE=20181109
#export VERSION=2.10.10
#export VERSIONDATE=20190408
#export VERSION=2.10.12
#export VERSIONDATE=20190613
####Error: missing dependency gegl-0.4 >= 0.4.16
#export VERSION=2.10.14
#export VERSIONDATE=20191028
#export VERSION=2.10.16
#export VERSIONDATE=20200219
#export VERSION=2.10.18
#export VERSIONDATE=20200224
#export VERSION=2.10.20
#export VERSIONDATE=20200608
####Error: missing dependency gegl-0.4 >= 0.4.18
#export VERSION=2.10.22
#export VERSIONDATE=20201005
#export VERSION=2.10.24
#export VERSIONDATE=20210329
#export VERSION=2.10.26
#export VERSIONDATE=20210906
####cursors/gimp-tool-cursors.gresource.xml: Error on line 4 char 1: Element <gresources> not allowed inside <gresources>.
#export VERSION=2.10.28
#export VERSIONDATE=20210915
#export VERSION=2.10.30
#export VERSIONDATE=20211220
#export VERSION=2.10.32
#export VERSIONDATE=20220613
export VERSION=2.10.34
export VERSIONDATE=20230222
#export VERSION=2.99.2
#export VERSIONDATE=20201026
#export VERSION=2.99.4
#export VERSIONDATE=20201224
#export VERSION=2.99.6
#export VERSIONDATE=20210426
#export VERSION=2.99.8
#export VERSIONDATE=20211020
#export VERSION=2.99.10
#export VERSIONDATE=20220224
#export VERSION=2.99.12
#export VERSIONDATE=20220823
#export VERSION=2.99.14
#export VERSIONDATE=2022114
####Error: missing dependency appstream-glib >= 0.7.7
wl-showstatus --package-version
export DEPENDENCIES=glib2,gtk2,zlib,libbz2,gdk-pixbuf,libtiff,libjpeg,librsvg,gnu-ghostscript,libpng,libmng,libexif,aalib,libxpm,poppler,poppler-data,pango,cairo,libcurl,libwmf,jasper,lcms1,babl,gegl,atk,fontconfig,freetype2,gettext,libmypaint,appstream-glib,mypaint-brushes
export OPTIONALDEPENDENCIES=webkitgtk,libxcursor,pygtk,gegl
export BUILDDEPENDENCIES=gtk-doc
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gimp/ gimp-"
#export DOWNLOADURL="ftp://ftp.gimp.org/pub/gimp/"
export DOWNLOADURL="http://ftp.gimp.org/pub/gimp/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=ftp://ftp.gimp.org/pub/gimp/v`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=http://ftp.gimp.org/pub/gimp/v$(echo $VERSION|sed "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/gimp-$VERSION.tar.bz2
export DOWNLOADSOURCEURL=https://download.gimp.org/pub/gimp/v$(echo $VERSION|sed "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/gimp-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=https://download.gimp.org/pub/gimp/v$(echo $VERSION|sed "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/gimp-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xfz $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing GetUserDefaultUILanguage in app/language.c
mv app/language.c app/language.c.bak
echo "#define WINVER 0x0500" > app/language.c
cat app/language.c.bak >> app/language.c
# fix missing freetype/tttables.h in app/text/gimpfont.c
sed -i.bak -e "s?freetype/?freetype2/?" app/text/gimpfont.c
# fix already defined environ in plug-ins/file-raw/file-darktable.c (version >= 2.10.30)
sed -i.bak -e "s/\benviron\b/myenv/g" plug-ins/file-raw/file-darktable.c
# fix GdkPixbuf issue
GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders gdk-pixbuf-query-loaders > $MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache
## fix missing GEGL_IS_PARAM_SPEC_MULTILINE in app/core/gimpparamspecs-duplicate.c (version >= 2.8.20 <= 2.9.8)
#patch -ulbf app/core/gimpparamspecs-duplicate.c << EOF
#--- app/core/gimpparamspecs-duplicate.c  2017-01-28 20:08:44.000000000 +0100
#+++ app/core/gimpparamspecs-duplicate.c  2017-02-01 21:06:33.720681400 +0100
#@@ -69,2 +69,3 @@
#
#+#ifdef GEGL_IS_PARAM_SPEC_MULTILINE
#           if (GEGL_IS_PARAM_SPEC_MULTILINE (pspec))
#@@ -74,2 +75,3 @@
#             }
#+#endif
#
#EOF
# avoid error exporting symbol gimp_color_picker_cursors_get_resource (version >= 2.10.34)
####ld.exe: cannot export gimp_color_picker_cursors_get_resource: symbol not defined
sed -i.bak -e "s/^\s*gimp_color_picker_cursors_get_resource$//" libgimpwidgets/gimpwidgets.def
# fix globbing issues with glib-mkenums
sed -i.bak -e "s/\(--fprod \"\)\(\/\*\)/\1\\\\n\2/g" gdk/Makefile.in
# fix detection of newer GEGL
mv configure configure.bak &&
sed -e "s/gegl-0.2/gegl-0.3/g" configure.bak > configure
wl-showstatus configure &&
 #PYTHON=$PYDIR/python.exe PKG_CONFIG="$(which pkg-config)" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM &&
 #PKG_CONFIG="$(which pkg-config)" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-python &&
 PATH=$PATH:$PERLDIR/../c/bin INTLTOOL_PERL="$PERLDIR/bin/perl.exe" PKG_CONFIG="$(which pkg-config)" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-openexr --disable-python &&
 ## fix invalid number of parameters to g_param_spec_string (version >= 2.9.8)
 #echo "#define GEGL_IS_PARAM_SPEC_MULTILINE 1" >> config.h &&
 #wl-showstatus build &&
 #PATH=$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache make &&
 make -j1 -Ccursors &&
 wl-showstatus build-install &&
 #PATH=$PATH:$PERLDIR/../c/bin make all install-strip &&
 #PATH=$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache make all install-strip &&
 #PATH=$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders make all install-strip &&
 #( PATH=$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders make all install-strip || PATH=$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders make -j1 all install-strip || ( cp -u icons/Symbolic/64/* icons/Symbolic-Inverted/64/ && make install-strip )) &&
 ( PATH=$PYDIR:$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders make all install-strip || PATH=$PYDIR:$PATH:$PERLDIR/../c/bin GDK_PIXBUF_MODULE_FILE=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders make -j1 all install-strip || ( cp -u icons/Symbolic/64/* icons/Symbolic-Inverted/64/ && make install-strip )) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



