export NAME="Subversion"
export STATUS=
export URL=http://subversion.apache.org/
export BASENAME=subversion
export DESCRIPTION="Apache Subversion is a full-featured version control system"
export CATEGORY=
export TYPE=library
#export VERSION=1.6.17
#export VERSIONDATE=20110722
#export VERSION=1.6.18
#export VERSIONDATE=20120412
#export VERSION=1.6.19
#export VERSIONDATE=20120921
#export VERSION=1.6.20
#export VERSIONDATE=20130109
#export VERSION=1.6.21
#export VERSIONDATE=20130405
#export VERSION=1.6.23
#export VERSIONDATE=20130601
#export VERSION=1.7.0
#export VERSIONDATE=20111012
#export VERSION=1.7.1
#export VERSIONDATE=20111023
####subversion/libsvn_subr/cmdline.c:35:20: error: crtdbg.h: No such file or directory
#export VERSION=1.7.2
#export VERSIONDATE=20111206
####subversion/libsvn_subr/win32_xlate.c:126: undefined reference to `IID_IMultiLanguage'
#export VERSION=1.7.3
#export VERSIONDATE=20120213
#export VERSION=1.7.4
#export VERSIONDATE=20120309
#export VERSION=1.7.5
#export VERSIONDATE=20120517
#export VERSION=1.7.6
#export VERSIONDATE=20120815
#export VERSION=1.7.7
#export VERSIONDATE=20121010
#export VERSION=1.7.8
#export VERSIONDATE=20121221
#export VERSION=1.7.9
#export VERSIONDATE=20130405
#export VERSION=1.7.10
#export VERSIONDATE=20130601
#export VERSION=1.7.11
#export VERSIONDATE=20130725
#export VERSION=1.7.13
#export VERSIONDATE=20130831
#export VERSION=1.7.14
#export VERSIONDATE=20131126
#export VERSION=1.7.16
#export VERSIONDATE=20140226
#export VERSION=1.7.17
#export VERSIONDATE=20140520
#export VERSION=1.7.18
#export VERSIONDATE=20140812
#export VERSION=1.7.19
#export VERSIONDATE=20141216
#export VERSION=1.7.20
#export VERSIONDATE=20150331
#export DEPENDENCIES=apr,apr-util,dbus,zlib,sqlite3,expat,libiconv,gettext,file
#export VERSION=1.8.0
#export VERSIONDATE=20130618
#export VERSION=1.8.1
#export VERSIONDATE=20130725
#export VERSION=1.8.3
#export VERSIONDATE=20130831
#export VERSION=1.8.4
#export VERSIONDATE=20131029
#export VERSION=1.8.5
#export VERSIONDATE=20131126
####/include/apr-1/arch/win32/apr_arch_file_io.h:174:32: error: expected specifier-qualifier-list before '/' token
#export VERSION=1.8.8
#export VERSIONDATE=20140220
#export VERSION=1.8.9
#export VERSIONDATE=20140514
#export VERSION=1.8.10
#export VERSIONDATE=20140812
#export VERSION=1.8.11
#export VERSIONDATE=20141216
#export VERSION=1.8.13
#export VERSIONDATE=20150331
#export VERSION=1.8.15
#export VERSIONDATE=20151215
#export VERSION=1.8.17
#export VERSIONDATE=20161130
#export VERSION=1.8.18
#export VERSIONDATE=20170707
#export VERSION=1.8.19
#export VERSIONDATE=20170816
####subversion/libsvn_subr/auth.c:512: undefined reference to `svn_auth_get_gpg_agent_simple_provider'
#export VERSION=1.9.0
#export VERSIONDATE=20150811
#export VERSION=1.9.1
#export VERSIONDATE=20150903
#export VERSION=1.9.2
#export VERSIONDATE=20150923
#export VERSION=1.9.3
#export VERSIONDATE=20151215
#export VERSION=1.9.4
#export VERSIONDATE=20160429
#export VERSION=1.9.5
#export VERSIONDATE=20161130
#export VERSION=1.9.6
#export VERSIONDATE=20170706
#export VERSION=1.9.7
#export VERSIONDATE=20170816
#export VERSION=1.9.9
#export VERSIONDATE=20180721
#export VERSION=1.9.10
#export VERSIONDATE=20190111
#export VERSION=1.9.12
#export VERSIONDATE=20190724
####subversion/libsvn_subr/config_win.c:72: undefined reference to `RegOpenCurrentUser'
#export DEPENDENCIES=apr,apr-util,dbus,zlib,sqlite3,expat,libiconv,gettext,file,libgnome-keyring
#export OPTIONALDEPENDENCIES=neon,serf
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export VERSION=1.10.0
#export VERSIONDATE=20180413
#export VERSION=1.10.2
#export VERSIONDATE=20180721
####configure: error: Subversion requires UTF8PROC
#export VERSION=1.10.3
#export VERSIONDATE=20181010
#export VERSION=1.10.6
#export VERSIONDATE=20190724
#export VERSION=1.10.7
#export VERSIONDATE=20210211
#export VERSION=1.11.0
#export VERSIONDATE=20181031
#export VERSION=1.11.1
#export VERSIONDATE=20190111
#export VERSION=1.12.0
#export VERSIONDATE=20190425
#export VERSION=1.12.2
#export VERSIONDATE=20190724
#export VERSION=1.13.0
#export VERSIONDATE=20191030
#export VERSION=1.14.0
#export VERSIONDATE=20200528
#export VERSION=1.14.1
#export VERSIONDATE=20210211
#export VERSION=1.14.2
#export VERSIONDATE=20220411
#export VERSION=1.14.3
#export VERSIONDATE=20231228
#export DEPENDENCIES=apr,apr-util,boost,dbus,zlib,liblz4,sqlite3,expat,libiconv,gettext,file,libgnome-keyring,libutf8proc,cyrus-sasl,serf
#export OPTIONALDEPENDENCIES=neon,swig
#export BUILDDEPENDENCIES=ruby
##export BUILDDEPENDENCIES=doxygen
##export OPTIONALBUILDDEPENDENCIES=
export VERSION=1.14.4
export VERSIONDATE=20241008
wl-showstatus --package-version
export DEPENDENCIES=apr,apr-util,boost,dbus,zlib,liblz4,sqlite3,expat,libiconv,gettext,file,libgnome-keyring,libutf8proc,cyrus-sasl,serf,opencflite
export OPTIONALDEPENDENCIES=neon,swig
export BUILDDEPENDENCIES=ruby
export OPTIONALBUILDDEPENDENCIES=doxygen
#export LICENSEFILE=COPYING
#export LICENSETYPE=
export LICENSEFILE=LICENSE
export LICENSETYPE=Apache
#export DOWNLOADURL="http://subversion.apache.org/download/"
export DOWNLOADURL="https://archive.apache.org/dist/subversion/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://subversion.tigris.org/downloads/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://apache.cu.be/subversion/$BASENAME-$VERSION.tar.bz2
export DOWNLOADSOURCEURL=https://archive.apache.org/dist/subversion/$BASENAME-$VERSION.tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
cd $BASENAME-$VERSION
# fix missing SHGFP_TYPE_CURRENT in subversion/libsvn_subr/config_win.c
mv subversion/libsvn_subr/config_win.c subversion/libsvn_subr/config_win.c.bak
echo "#define _WIN32_IE 0x0500" > subversion/libsvn_subr/config_win.c
cat subversion/libsvn_subr/config_win.c.bak >> subversion/libsvn_subr/config_win.c
# fix missing definition of SVN_LOCALE_RELATIVE_PATH
mv subversion/libsvn_subr/nls.c subversion/libsvn_subr/nls.c.bak
grep SVN_LOCALE_RELATIVE_PATH subversion/svn_private_config.hw > subversion/libsvn_subr/nls.c
cat subversion/libsvn_subr/nls.c.bak >> subversion/libsvn_subr/nls.c
# fix redefinition of win32_xlate_t and missing definition of alloca and work around missing _IID_IMultiLanguage/_CLSID_CMultiLanguage in subversion/libsvn_subr/win32_xlate.c
patch -ulbf subversion/libsvn_subr/win32_xlate.c << EOF
--- subversion/libsvn_subr/win32_xlate.c  2008-08-31 00:32:02 +0200
+++ subversion/libsvn_subr/win32_xlate.c  2013-01-10 15:21:54 +0100
@@ -32,2 +32,3 @@
 #include <mlang.h>
+#include <malloc.h>

@@ -43,3 +44,3 @@

-typedef struct win32_xlate_t
+struct win32_xlate_t
 {
@@ -47,3 +48,3 @@
   UINT to_page_id;
-} win32_xlate_t;
+};

@@ -97,2 +98,5 @@

+#ifdef __MINGW32__
+  return APR_EGENERAL;
+#else
   hr = CoCreateInstance(&CLSID_CMultiLanguage, NULL, CLSCTX_INPROC_SERVER,
@@ -122,2 +126,3 @@
   return APR_SUCCESS;
+#endif
 }
EOF
# fix missing file (version >= 1.7.0)
touch apr_private_common.h
# fix subversion/libsvn_subr/cmdline.c (version >= 1.7.0)
patch -ulbf subversion/libsvn_subr/cmdline.c << EOF
--- subversion/libsvn_subr/cmdline.c  2011-06-07 16:46:00 +0200
+++ subversion/libsvn_subr/cmdline.c  2011-10-13 09:07:46 +0200
@@ -34,3 +34,5 @@
 #else
+#ifndef __MINGW32__
 #include <crtdbg.h>
+#endif
 #include <io.h>
EOF
# avoid use of getdcwd in subversion/tests/libsvn_subr/dirent_uri-test.c
patch -ulbf subversion/tests/libsvn_subr/dirent_uri-test.c << EOF
--- subversion/tests/libsvn_subr/dirent_uri-test.c  2009-05-04 17:19:30 +0200
+++ subversion/tests/libsvn_subr/dirent_uri-test.c  2013-01-10 15:29:20 +0100
@@ -1439,3 +1439,3 @@

-#if defined(WIN32) || defined(__CYGWIN__)
+#if (defined(WIN32) || defined(__CYGWIN__)) && !defined(__MINGW32__)
   if (! getdcwd(3, buf, sizeof(buf))) /* 3 stands for drive C: */
EOF
# fix missing LPMSG in subversion/libsvn_subr/io.c
mv subversion/libsvn_subr/io.c subversion/libsvn_subr/io.c.bak
echo "#include <winsock2.h>" > subversion/libsvn_subr/io.c
echo "#include <wtypes.h>" >> subversion/libsvn_subr/io.c
cat subversion/libsvn_subr/io.c.bak >> subversion/libsvn_subr/io.c
# fix pointer issue and missing FILE_NAME_NORMALIZED/VOLUME_NAME_DOS in subversion/libsvn_subr/io.c (version >= 1.9.0)
patch -ulbf subversion/libsvn_subr/io.c << EOF
--- subversion/libsvn_subr/io.c  2015-08-11 21:48:16 +0200
+++ subversion/libsvn_subr/io.c  2015-08-11 22:48:59 +0200
@@ -1770,3 +1770,3 @@

-    SVN_ERR(svn_utf__win32_utf8_to_utf16(&(const WCHAR*)buffer, source,
+    SVN_ERR(svn_utf__win32_utf8_to_utf16((const WCHAR**)&buffer, source,
                                          prefix, result_pool));
@@ -1901,3 +1901,10 @@
                filehand, wdest, wdest_len,
-               FILE_NAME_NORMALIZED | VOLUME_NAME_DOS);
+              0
+#ifdef FILE_NAME_NORMALIZED
+               | FILE_NAME_NORMALIZED
+#endif
+#ifdef VOLUME_NAME_DOS
+              | VOLUME_NAME_DOS
+#endif
+              );

EOF
# fix redefinition of DATE in subversion/libsvn_ra_serf/log.c and subversion/libsvn_ra_serf/merge.c (version >= 1.14.3)
sed -i.bak -e "s/\bDATE\b/SVN_&/g" subversion/libsvn_ra_serf/log.c subversion/libsvn_ra_serf/merge.c
# fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# autoreconf -f -i -I $MINGWPREFIX/share/aclocal
#fi
# fon't force strict ANSI C 90 (version >= 1.14.3)
sed -i.bak -e "s/-std=c90/-std=gnu90/" configure
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared LDFLAGS="-Wl,--as-needed -lole32 -lapr-1 -laprutil-1 -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LIBS="-Wl,--as-needed -lapr-1 -laprutil-1 -lole32 -lintl -lz" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared LDFLAGS="-Wl,--as-needed -lole32 -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,--as-needed -lole32 -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,--as-needed -lole32 -lversion" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-svnxx --with-serf --disable-javahl --without-apxs --with-ruby-sitedir=$INSTALLPREFIX/lib/ruby/site_ruby CFLAGS="-I$MINGWPREFIX/include/sasl" LDFLAGS="-Wl,--as-needed -lole32 -lversion" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-svnxx --with-serf --disable-keychain --disable-javahl --without-apxs --with-ruby-sitedir=$INSTALLPREFIX/lib/ruby/site_ruby CFLAGS="-I$MINGWPREFIX/include/sasl" LDFLAGS="-Wl,--as-needed -lole32 -lversion" &&
 #--without-serf 
 #PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} 
 wl-showstatus build-install &&
 sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 # fix missing svn_auth_get_gpg_agent_simple_provider (version >= 1.8.8)
 echo "#undef SVN_HAVE_GPG_AGENT" >> subversion/svn_private_config.h &&
 #( make install || make install SVN_ZLIB_LIBS="-Wl,--as-needed -lz" || make install SVN_ZLIB_LIBS="-Wl,--as-needed -lz -lws2_32 -lsecur32 -lcrypto -lssl -lapr-1 -laprutil-1" ) &&
 #make install SVN_ZLIB_LIBS="-Wl,--as-needed -lz -lws2_32 -lsecur32 -lcrypto -lssl -lapr-1 -laprutil-1" &&
 make install SVN_ZLIB_LIBS="-Wl,--as-needed -lz -lws2_32 -lsecur32 -lcrypto -lssl -lapr-1 -laprutil-1 -lCoreFoundation" &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####To do: build DLL
####To do: fix detection of Python



