#export NAME="libmng"
#export STATUS=
#export URL=http://www.libmng.com/
##export URL=http://gjuyn.xs4all.nl/libmng/
#export BASENAME=libmng
#export DESCRIPTION="MNG (pronounced \"ming\"), is short for Multiple-image Network Graphics, as one might gather from the title of this page. Designed with the same modular philosophy as PNG and by many of the same people, MNG is intended to provide a home for all of the multi-image capabilities that have no place in PNG."
#export CATEGORY=graphics
#export TYPE=library
#export VERSION=1.0.10
#export VERSIONDATE=
#wl-showstatus --package-version
#export DEPENDENCIES=zlib,libjpeg,lcms2
#export OPTIONALDEPENDENCIES=
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=LICENSE
#export LICENSETYPE=
##export DOWNLOADURL="http://www.libmng.com/download.html?cat=25 libmng-"
##export DOWNLOADURL="http://sourceforge.net/projects/libmng/files/ libmng-"
#export DOWNLOADURL="http://sourceforge.net/projects/libmng/files/libmng-devel/ libmng-"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://prdownloads.sourceforge.net/libmng/libmng-$VERSION.tar.bz2
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#cd $BASENAME-$VERSION
##grep "LIBRARY\|EXPORTS\|mng" contrib/msvc/libmng-msvc.lib/libmng.def | sed -e "s/^\(LIBRARY \).*/\1libmng.1.dll/" > libmng.def
#make -f makefiles/makefile.mingw install INSTALL_PREFIX=$INSTALLPREFIX/ LCMSLIB="-Wl,--as-needed -llcms2" &&
# rm -f *.o &&
# make -f makefiles/makefile.mingwdll install LIBMNG_A=libmng.dll.a INSTALL_PREFIX=$INSTALLPREFIX/ LCMSLIB=-llcms2 LDFLAGS="-s -Wl,--as-needed -lz -ljpeg -llcms2 -lm -Wl,--enable-auto-import" &&
# mkdir -p $INSTALLPREFIX/bin && 
# cp -f libmng*.dll $INSTALLPREFIX/bin && 
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION


 
export NAME="libmng"
export STATUS=
export URL=http://www.libmng.com/
#export URL=http://gjuyn.xs4all.nl/libmng/
export BASENAME=libmng
export DESCRIPTION="MNG (pronounced \"ming\"), is short for Multiple-image Network Graphics, as one might gather from the title of this page. Designed with the same modular philosophy as PNG and by many of the same people, MNG is intended to provide a home for all of the multi-image capabilities that have no place in PNG."
export CATEGORY=graphics
export TYPE=library
#export VERSION=2.0.2
#export VERSIONDATE=20130816
export VERSION=2.0.3
export VERSIONDATE=20150421
wl-showstatus --package-version
export DEPENDENCIES=zlib,libjpeg,lcms2
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=cmake,pexports
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=
export DOWNLOADURL="http://sourceforge.net/projects/libmng/files/libmng-devel/ libmng-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/libmng/libmng-devel/$VERSION/libmng-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# create libmng.la manually
cat > libmng.la << EOF
# -lmng - a libtool library file
# Generated by hand - GNU libtool 0.0.0
dlname='../bin/libmng.dll'
library_names='libmng.dll.a'
old_library='libmng.a'
dependency_libs=''
current=0
age=0
revision=1
installed=yes
shouldnotlink=no
dlopen=''
dlpreopen=''
libdir='$INSTALLPREFIX/lib'
EOF
#wl-showstatus configure &&
# cmake.exe -G"MSYS Makefiles" -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DBUILD_STATIC_LIBS:BOOL=ON -DWITH_JPEG:BOOL=ON -DWITH_LCMS2:BOOL=ON . &&
# wl-showstatus build-install &&
# make install/strip &&
# cp -f libmng.la $INSTALLPREFIX/lib/ &&
# # regenerate .dll.a file
# pexports bin/libmng.dll | sed -e "s/@.*$//" > libmng.def &&
# dlltool -D bin/libmng.dll -d libmng.def -l $INSTALLPREFIX/lib/libmng.dll.a &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
# fix installing libmng.pc in CMakeLists.txt (version >= 2.0.3)
patch -ulbf CMakeLists.txt << EOF
@@ -434,5 +434,6 @@
 #
+  TARGET_LINK_OPTIONS(\${MNG_LIBRARY_NAME}-shared PUBLIC "LINKER:--add-stdcall-alias")
 ENDIF(BUILD_SHARED_LIBS)
 #------------ libmng.pc ---------------
-IF(UNIX)
+IF(UNIX OR MINGW)
  SET(MNG_LIBS_PRIVATE "")
@@ -458,3 +459,3 @@

-ENDIF(UNIX)
+ENDIF(UNIX OR MINGW)
 #
EOF
mkdir -p build_win &&
 wl-showstatus configure &&
 cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DBUILD_STATIC_LIBS:BOOL=ON -DWITH_JPEG:BOOL=ON -DWITH_LCMS2:BOOL=ON -S. -Bbuild_win &&
 wl-showstatus build-install &&
 ninja -Cbuild_win install/strip &&
 # manually copy .la file
 cp -f libmng.la $INSTALLPREFIX/lib/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



