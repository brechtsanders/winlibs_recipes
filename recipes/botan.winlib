export NAME="Botan"
export STATUS=
export URL=http://botan.randombit.net/
export BASENAME=botan
export DESCRIPTION="Botan is a crypto library for C++ released under the BSD license. It provides most any cryptographic algorithm you might be looking for, along with Transport Layer Security (TLS), X.509 certificates and CRLs, a pipeline-style message processing system, and a wide variety of other features."
export CATEGORY=security
export TYPE=library
#export VERSION=1.10.5
#export VERSIONDATE=20130312
#export VERSION=1.10.8
#export VERSIONDATE=20141110
#export VERSION=1.10.9
#export VERSIONDATE=20141214
#export VERSION=1.10.10
#export VERSIONDATE=20150811
#export VERSION=1.10.11
#export VERSIONDATE=20160202
#export VERSION=1.10.12
#export VERSIONDATE=20160203
#export VERSION=1.10.13
#export VERSIONDATE=20160619
#export VERSION=1.10.14
#export VERSIONDATE=20161128
#export VERSION=1.10.15
#export VERSIONDATE=20170113
#export VERSION=1.10.16
#export VERSIONDATE=20170405
#export VERSION=1.10.17
#export VERSIONDATE=20171003
#export VERSION=1.11.10
#export VERSIONDATE=20141210
#export VERSION=1.11.11
#export VERSIONDATE=20141222
#export VERSION=1.11.12
#export VERSIONDATE=20150103
#export VERSION=1.11.13
#export VERSIONDATE=20150112
#export VERSION=1.11.14
#export VERSIONDATE=20150228
#export VERSION=1.11.15
#export VERSIONDATE=20150310
####ERROR: Unknown makefile style "unix"
#export VERSION=1.11.16
#export VERSIONDATE=20150330
#export VERSION=1.11.17
#export VERSIONDATE=20150619
#export VERSION=1.11.18
#export VERSIONDATE=20150706
#export VERSION=1.11.19
#export VERSIONDATE=20150811
#export VERSION=1.11.20
#export VERSIONDATE=20150908
#export VERSION=1.11.21
#export VERSIONDATE=20151011
#export VERSION=1.11.23
#export VERSIONDATE=20151031
#export VERSION=1.11.24
#export VERSIONDATE=20151105
#export VERSION=1.11.25
#export VERSIONDATE=20151208
#export VERSION=1.11.26
#export VERSIONDATE=20160105
#export VERSION=1.11.28
#export VERSIONDATE=20160202
#export VERSION=1.11.29
#export VERSIONDATE=20160321
#export VERSION=1.11.30
#export VERSIONDATE=20160619
#export VERSION=1.11.31
#export VERSIONDATE=20160831
#export VERSION=1.11.32
#export VERSIONDATE=20160928
#export VERSION=1.11.33
#export VERSIONDATE=20161027
#export VERSION=1.11.34
#export VERSIONDATE=20161128
#export VERSION=2.0.0
#export VERSIONDATE=20170107
#export VERSION=2.0.1
#export VERSIONDATE=20170110
#export VERSION=2.1.0
#export VERSIONDATE=20170405
#export VERSION=2.2.0
#export VERSIONDATE=20170814
#export VERSION=2.3.0
#export VERSIONDATE=20171003
#export VERSION=2.6.0
#export VERSIONDATE=20180501
#export VERSION=2.7.0
#export VERSIONDATE=20180703
####build/include/botan/rng.h:161:15: error: 'mutex' in namespace 'std' does not name a type
#export VERSION=2.8.0
#export VERSIONDATE=20181002
#export VERSION=2.9.0
#export VERSIONDATE=20190105
#export LICENSEFILE=doc/license.txt
#export LICENSETYPE=BSD
#export VERSION=2.10.0
#export VERSIONDATE=20190330
#export VERSION=2.11.0
#export VERSIONDATE=20190702
#export VERSION=2.12.0
#export VERSIONDATE=20191008
#export VERSION=2.12.1
#export VERSIONDATE=20191014
#export VERSION=2.13.0
#export VERSIONDATE=20200107
#export VERSION=2.14.0
#export VERSIONDATE=20200407
#export VERSION=2.15.0
#export VERSIONDATE=20200708
#export VERSION=2.16.0
#export VERSIONDATE=20201007
#export VERSION=2.17.0
#export VERSIONDATE=20201106
#export VERSION=2.17.1
#export VERSIONDATE=20201108
#export VERSION=2.17.2
#export VERSIONDATE=20201114
#export VERSION=2.17.3
#export VERSIONDATE=20201222
#export VERSION=2.18.0
#export VERSIONDATE=20210415
#export VERSION=2.18.1
#export VERSIONDATE=20210510
#export VERSION=2.18.2
#export VERSIONDATE=20211026
#export VERSION=2.19.0
#export VERSIONDATE=20220120
#export VERSION=2.19.1
#export VERSIONDATE=20220122
#export VERSION=2.19.2
#export VERSIONDATE=20220604
#export VERSION=2.19.3
#export VERSIONDATE=20221117
#export VERSION=2.19.4
#export VERSIONDATE=20240221
#export VERSION=2.19.5
#export VERSIONDATE=20240709
#export VERSION=3.0.0
#export VERSIONDATE=20230411
#export VERSION=3.1.0
#export VERSIONDATE=20230711
#export VERSION=3.1.1
#export VERSIONDATE=20230713
#export VERSION=3.2.0
#export VERSIONDATE=20231009
#export VERSION=3.3.0
#export VERSIONDATE=20240221
#export VERSION=3.4.0
#export VERSIONDATE=20240409
#export VERSION=3.5.0
#export VERSIONDATE=20240709
#export VERSION=3.6.0
#export VERSIONDATE=20241022
#export VERSION=3.6.1
#export VERSIONDATE=20241026
#export VERSION=3.7.0
#export VERSIONDATE=20250205
#export VERSION=3.7.1
#export VERSIONDATE=20250205
#export VERSION=3.8.0
#export VERSIONDATE=20250507
#export VERSION=3.8.1
#export VERSIONDATE=20250508
export VERSION=3.9.0
export VERSIONDATE=20250805
#export VERSION=3.10.0
#export VERSIONDATE=20251107
####build/include/public/botan/p11.h:112:19: error: 'CKA_SUBPRIME_BITS' was not declared in this scope
wl-showstatus --package-version
export DEPENDENCIES=pthreads,zlib,libbz2,xz,boost,sqlite3
#export DEPENDENCIES=pthreads,zlib,libbz2,xz,boost,sqlite3,nss,nspr
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=doc/license.txt
export LICENSEFILE=license.txt
export LICENSETYPE=BSD
#export DOWNLOADURL="http://botan.randombit.net/download.html Botan-"
export DOWNLOADURL="https://botan.randombit.net/releases/ Botan-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://botan.randombit.net/files/Botan-$VERSION.tbz
#export DOWNLOADSOURCEURL=http://botan.randombit.net/releases/Botan-$VERSION.tgz
export DOWNLOADSOURCEURL=https://botan.randombit.net/releases/Botan-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xj --force-local -f $TARBALLDIR/$BASENAME/Botan-$VERSION.tbz
#tar xz --force-local -f $TARBALLDIR/$BASENAME/Botan-$VERSION.tgz
tar xJ --force-local -f $TARBALLDIR/$BASENAME/Botan-$VERSION.tar.xz
cd Botan-$VERSION
## fix configure.py (version <= 1.10.5)
#patch -ulbf configure.py << EOF
#--- configure.py  2013-03-02 22:19:36 +0100
#+++ configure.py  2013-03-12 18:12:50 +0100
#@@ -1853,6 +1853,2 @@
#
#-    if not osinfo[options.os].build_shared:
#-        if options.build_shared_lib:
#-            logging.info('Disabling shared lib on %s' % (options.os))
#-            options.build_shared_lib = False
#
#EOF
## fix build/include/botan/dl_group.h (version >= 1.10.16)
#patch -ulbf build/include/botan/dl_group.h << EOF
#--- build/include/botan/dl_group.h  2017-04-11 09:14:52.453047000 +0200
#+++ build/include/botan/dl_group.h  2017-04-11 09:45:37.841567400 +0200
#@@ -50,2 +50,3 @@
#          DH_PARAMETERS = ANSI_X9_42,
#+#undef X942_DH_PARAMETERS
#          X942_DH_PARAMETERS = ANSI_X9_42,
#EOF
## fix configure.py (version >= 1.10.8)
#patch -ulbf configure.py << EOF
#--- configure.py  2014-04-10 16:11:44.000000000 +0200
#+++ configure.py  2014-11-10 21:28:38.000000000 +0100
#@@ -1391,6 +1391,2 @@
#         def useable_methods():
#-            if 'symlink' in os.__dict__:
#-                yield 'symlink'
#-            if 'link' in os.__dict__:
#-                yield 'hardlink'
#             yield 'copy'
#@@ -1860,6 +1856,2 @@
#
#-    if not osinfo[options.os].build_shared:
#-        if options.build_shared_lib:
#-            logging.info('Disabling shared lib on %s' % (options.os))
#-            options.build_shared_lib = False
#
#EOF
# fix configure.py (version >= 2.19.1)
patch -ulbf configure.py << EOF
@@ -1525,7 +1525,8 @@
                 # Could not calculate soname_pattern_*
                 # This happens for OSs without shared library support (e.g. nacl, mingw, includeos, cygwin)
-                self.soname_pattern_base = None
-                self.soname_pattern_abi = None
-                self.soname_pattern_patch = None
+                lex.soname_suffix = "dll"
+                self.soname_pattern_base = "botan.DELETEME.%s" % (lex.soname_suffix)
+                self.soname_pattern_abi = "botan-{version_major}.%s" % (lex.soname_suffix)
+                self.soname_pattern_patch = "botan.{version_minor}.{version_patch}.DELETEME.%s" % (lex.soname_suffix)

         self._aliases = lex.aliases
EOF
## fix src/scripts/install.py (version >= 2.19.1 <= 3.2.0)
#patch -ulbf src/scripts/install.py << EOF
#@@ -188,3 +188,3 @@
#     if build_shared_lib:
#-        if target_os == "windows":
#+        if target_os == "windows" or target_os == "mingw":
#             libname = cfg['libname']
#EOF
# fix src/scripts/install.py (version >= 3.3.0)
patch -ulbf src/scripts/install.py << EOF
@@ -171,6 +171,6 @@
     if build_shared_lib:
-        if target_os == "windows":
+        if target_os == "windows" or target_os == "mingw":
             libname = cfg['libname']
             soname_base = libname + '.dll'
-            implib = cfg['implib_name']
+            implib = soname_base + '.a'
             copy_executable(os.path.join(out_dir, soname_base),
EOF
wl-showstatus configure &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --makefile-style=gmake --link-method=cp --enable-shared --with-gnump --with-bzip2 --with-zlib --with-sqlite3 &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --makefile-style=gmake --link-method=cp --enable-shared --with-bzip2 --with-zlib --with-sqlite3 &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --makefile-style=gmake --link-method=copy --disable-shared --with-bzip2 --with-zlib --with-sqlite3 &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --link-method=copy --enable-shared-library --with-bzip2 --with-zlib --with-sqlite3 &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --makefile-style=unix --enable-shared --without-openssl --with-gnump --with-bzip2 --with-zlib &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --enable-shared-library --enable-static-library --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --enable-shared --without-openssl --with-zlib --with-bzip2 --with-sqlite3 &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --enable-shared-library --enable-static-library --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --enable-shared --without-openssl --with-zlib --with-bzip2 --with-lzma --with-sqlite3 --with-boost --link-method=copy --ldflags="-Wl,--as-needed -lmswsock" &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --enable-shared-library --enable-static-library --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --enable-shared --with-zlib --with-bzip2 --with-lzma --with-sqlite3 --with-boost --link-method=copy --ldflags="-Wl,--as-needed -lmswsock" &&
 $PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --enable-shared-library --enable-static-library --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --enable-shared --with-zlib --with-bzip2 --with-lzma --with-sqlite3 --with-boost --link-method=copy --ldflags="-Wl,--as-needed -lmswsock" &&
 #$PYDIR/python.exe configure.py --prefix=$INSTALLPREFIX --enable-shared-library --enable-static-library --os=mingw --cpu=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo x86_32; else echo x86_64; fi) --enable-shared --with-zlib --with-bzip2 --with-lzma --with-sqlite3 --with-boost --link-method=copy --with-external-includedir=$MINGWPREFIX/include/nspr --ldflags="-Wl,--as-needed -lmswsock" &&
 #--cxxflags="-DBOTAN_DLL=__declspec\\\\(dllexport\\\\)" 
 wl-showstatus build-install &&
 sed -i.bak -e "s?\([^ ]\)\\\\?\1/?g; s/\(-shared\)/\1 -s -Wl,-no-undefined -Wl,--out-implib,\$@.a/" Makefile &&
 #sed -i.bak2 -e "s/^CXXFLAGS\s*=.*$/& -DBOTAN_DLL=__declspec\\\\(dllexport\\\\)/" Makefile &&
 sed -i.bak3 -e "s/ln -fs /echo &/" Makefile &&
 # fix DLL name in build/build_config.json (version >= 3.0.0)
 sed -i.bak -e "s/\(\"libname\": \"\)\(botan-3\"\)/\1lib\2/" build/build_config.json &&
 #( make install LN="cp -f" || make install CXX="${CXX:-g++} -std=c++11" LN="cp -f" ) &&
 #PATH=$PYDIR:$PATH ( make install LN="cp -f" || make install CXX="${CXX:-g++} -std=c++11" LN="cp -f" ) &&
 # make sure to use local pkcs11.h (version >= 3.3.0)
 sed -i.bak -e "s?\(\"\)\(pkcs11\.h\"\)?\1../../external/\2?" build/include/public/botan/p11.h &&
 PATH=$PYDIR:$PATH make install &&
 #PATH=$PYDIR:$PATH make CXXFLAGS="-O3 -momit-leaf-frame-pointer -DBOTAN_DLL=__declspec\(dllexport\)" &&
 #g++ -shared -s -mwindows -Wl,--export-all-symbols -o libbotan-2.dll libbotan-2.a -Wl,--out-implib,libbotan-2.dll.a &&
 #mkdir -p $INSTALLPREFIX/bin &&
 #mv $INSTALLPREFIX/lib/*.dll $INSTALLPREFIX/bin/ &&
 #cp -f libbotan*.dll $INSTALLPREFIX/bin/ &&
 cp -f *.dll.a $INSTALLPREFIX/lib/ &&
 # replace backslash(es) with forward slash(es) in .pc file
 sed -i -e 's?\\?/?g' $INSTALLPREFIX/lib/pkgconfig/*.pc &&
 # fix Python package location
 mkdir -p $INSTALLPREFIX/python/Lib &&
 mv $INSTALLPREFIX/lib/python*/site-packages/ $INSTALLPREFIX/python/Lib/ &&
 ( rmdir $INSTALLPREFIX/lib/python* || true ) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf Botan-$VERSION



