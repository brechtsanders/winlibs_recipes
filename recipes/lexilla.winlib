export NAME="Lexilla"
export STATUS=
export URL=https://www.scintilla.org/Lexilla.html
export BASENAME=lexilla
export DESCRIPTION="Lexilla is a free library of language lexers that can be used with the Scintilla editing component."
export CATEGORY=gui
export TYPE=library
#export VERSION=5.1.3
#export VERSIONDATE=20211108
#export VERSION=5.1.4
#export VERSIONDATE=20211207
#export VERSION=5.1.5
#export VERSIONDATE=20220209
#export VERSION=5.1.6
#export VERSIONDATE=20220331
#export VERSION=5.1.7
#export VERSIONDATE=20220522
#export VERSION=5.1.8
#export VERSIONDATE=20220709
export VERSION=5.1.9
export VERSIONDATE=20220827
wl-showstatus --package-version
export DEPENDANCIES=scintilla
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=License.txt
export LICENSETYPE=
#export DOWNLOADURL="https://www.scintilla.org/LexillaDownload.html"
export DOWNLOADURL="https://sourceforge.net/projects/scintilla/files/lexilla/"
#export DOWNLOADURL="https://github.com/ScintillaOrg/lexilla/tags rel-"
#export DOWNLOADURL="https://github.com/ScintillaOrg/lexilla/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://downloads.sourceforge.net/project/scintilla/lexilla/$VERSION/lexilla$(echo $VERSION|sed -e "s/\.//g").tgz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
mkdir -p $BASENAME-$VERSION
tar xfz $TARBALLDIR/$BASENAME/lexilla$(echo $VERSION|sed -e "s/\.//g").tgz -C$BASENAME-$VERSION
cd $BASENAME-$VERSION/lexilla
#wl-showstatus build &&
# for F in lexlib/*.cxx src/*.cxx lexers/*.cxx access/*.cxx; do
#  if [ ! -f $F.o ]; then
#   echo CXX $F &&
#   g++ -c -o $F.o $F -O3 -Iinclude -Ilexlib || break
#  fi
# done &&
#    echo OK
# fix building standalone   
sed -i.bak -e "s?../../scintilla/include[^ ]*??g" src/makefile src/deps.mak
# fix building .dll.a and .def files
sed -i.bak2 "s/^\s*\$(CXX).*\$(LDFLAGS).*-o \$@/& -Wl,--out-implib,liblexilla.dll.a -Wl,--output-def,liblexilla.def -s/" src/makefile
wl-showstatus build &&
 make -Csrc -fmakefile windir=1 PYTHON=$PYDIR/python.exe &&
 wl-showstatus build-install &&
 mkdir -p $INSTALLPREFIX/include $INSTALLPREFIX/lib $INSTALLPREFIX/bin &&
 cp -f bin/*.a src/*.dll.a $INSTALLPREFIX/lib/ &&
 cp -f src/*.def $INSTALLPREFIX/lib/ &&
 cp -f bin/*.dll $INSTALLPREFIX/bin/ &&
 cp -f include/* $INSTALLPREFIX/include/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd ../.. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



