export NAME="cracklib"
export STATUS=
#export URL=http://sourceforge.net/projects/cracklib/
export URL=https://github.com/cracklib/cracklib
export BASENAME=cracklib
export DESCRIPTION="Next generation version of libCrack password checking library."
export CATEGORY=security
export TYPE=library
#export VERSION=2.8.19
#export VERSIONDATE=20121015
#export VERSION=2.8.20
#export VERSIONDATE=20121208
#export VERSION=2.8.21
#export VERSIONDATE=20121214
#export VERSION=2.8.22
#export VERSIONDATE=20121215
#export VERSION=2.9.0
#export VERSIONDATE=20130602
#export VERSION=2.9.1
#export VERSIONDATE=20131206
#export VERSION=2.9.2
#export VERSIONDATE=20141006
#export VERSION=2.9.3
#export VERSIONDATE=20150412
#export VERSION=2.9.4
#export VERSIONDATE=20150415
#export VERSION=2.9.5
#export VERSIONDATE=20150714
export VERSION=2.10.3
export VERSIONDATE=20251123
wl-showstatus --package-version
export DEPENDENCIES=gettext,libiconv
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING.LIB
export LICENSETYPE=LGPL
#export DOWNLOADURL="http://sourceforge.net/projects/cracklib/files/cracklib/"
export DOWNLOADURL="https://github.com/cracklib/cracklib/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/cracklib/cracklib/$VERSION/$BASENAME-$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://github.com/cracklib/cracklib/releases/download/v$VERSION/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xz --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing file
mkdir -p winfix
cat > winfix/pwd.h << EOF
#define getuid() 0
#define getpwuid(uid) NULL
#define getpwuid(uid) NULL
struct passwd {
 char *pw_name;
 char *pw_gecos;
};
EOF
# fix util/check.c (version >= 2.10.3)
patch -ulbf util/check.c << EOF
@@ -10,3 +10,5 @@
 #include <locale.h>
+#ifndef _WIN32
 #include <termios.h>
+#endif
 #include <unistd.h>
@@ -27,5 +29,7 @@
        int i;
-       int result = -1;
        int echo_on = 1;
+#ifndef _WIN32
+       int result = -1;
        struct termios tios;
+#endif

@@ -60,2 +64,6 @@
        if (!echo_on) {
+#ifdef _WIN32
+               fprintf(stderr, "Option --no-echo is not supported on Windows.\\n");
+               return -2;
+#else
                result = tcgetattr(STDIN_FILENO, &tios);
@@ -65,2 +73,3 @@
                }
+#endif
        }
EOF
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-python &&
 #PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-python CFLAGS="-I$PWD/winfix $(if ${CC:-gcc} --help -v 2>/dev/null|grep -q "\-Wint-conversion" || ${CC:-gcc} --version|grep -q "^clang"; then echo "-Wno-error=int-conversion"; fi)" LDFLAGS="-Wl,--as-needed -lws2_32" &&
 # fix building DLLs
 sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 wl-showstatus build-install &&
 make install-strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



