#export NAME="at-spi2-atk"
#export STATUS=
##export URL=http://www.gnome.org/projects/at-spi2-atk
#export URL=https://github.com/GNOME/at-spi2-atk
#export BASENAME=at-spi2-atk
#export DESCRIPTION="A GTK+ module that bridges ATK to D-Bus at-spi"
#export CATEGORY=accessibility
#export TYPE=library
##export VERSION=0.4.1
##export VERSIONDATE=20101116
##export VERSION=2.0.0
##export VERSIONDATE=20110405
##export VERSION=2.0.1
##export VERSIONDATE=20110426
##export VERSION=2.0.2
##export VERSIONDATE=20110524
##export VERSION=2.1.3
##export VERSIONDATE=20110711
##export VERSION=2.1.4
##export VERSIONDATE=20110726
#####No package 'atspi-2' found
##export VERSION=2.1.5
##export VERSIONDATE=20110816
##export VERSION=2.2.0
##export VERSIONDATE=20110927
##export VERSION=2.2.1
##export VERSIONDATE=20111018
#####atk-adaptor/adaptors/accessible-adaptor.c:555: error: 'ATSPI_DBUS_INTERFACE_ACCESSIBLE' undeclared (first use in this function)
##export VERSION=2.2.2
##export VERSIONDATE=20111115
##export VERSION=2.3.1
##export VERSIONDATE=20111026
##export VERSION=2.3.2
##export VERSIONDATE=20111122
##export VERSION=2.3.4
##export VERSIONDATE=20120116
##export VERSION=2.3.5
##export VERSIONDATE=20120207
##export VERSION=2.4.0
##export VERSIONDATE=20120327
##export VERSION=2.5.1
##export VERSIONDATE=20120501
##export VERSION=2.5.2
##export VERSIONDATE=20120606
#####atk-adaptor/gtk-2.0/../../atk-adaptor/bridge.c:516: undefined reference to `atk_plug_get_type'
##export VERSION=2.5.3
##export VERSIONDATE=20120626
##export VERSION=2.5.4
##export VERSIONDATE=20120717
##export VERSION=2.5.5
##export VERSIONDATE=20120807
##export VERSION=2.5.91
##export VERSIONDATE=20120904
##export VERSION=2.5.92
##export VERSIONDATE=20120918
#####atk-adaptor/bridge.c:515:1: error: invalid storage class for function 'user_check'
##export VERSION=2.6.0
##export VERSIONDATE=20120925
##export VERSION=2.6.1
##export VERSIONDATE=20121017
##export VERSION=2.6.2
##export VERSIONDATE=20121113
#####atk-adaptor/bridge.c:513:1: error: expected 'while' before 'static'
##export VERSION=2.7.1
##export VERSIONDATE=20121023
##export VERSION=2.7.2
##export VERSIONDATE=20121120
##export VERSION=2.7.3
##export VERSIONDATE=20121218
##export VERSION=2.7.5
##export VERSIONDATE=20130205
##export VERSION=2.8.0
##export VERSIONDATE=20130226
##export VERSION=2.8.1
##export VERSIONDATE=20130417
##export VERSION=2.9.2
##export VERSIONDATE=20130529
##export VERSION=2.9.3
##export VERSIONDATE=20130618
##export VERSION=2.9.4
##export VERSIONDATE=20130709
##export VERSION=2.9.5
##export VERSIONDATE=20130730
##export VERSION=2.10.0
##export VERSIONDATE=20130924
##export VERSION=2.10.2
##export VERSIONDATE=20131112
##export VERSION=2.11.1
##export VERSIONDATE=20131101
##export VERSION=2.11.2
##export VERSIONDATE=20131119
#####Requested 'atspi-2 >= 2.9.4' but version of atspi is 2.8.0
##export VERSION=2.11.3
##export VERSIONDATE=20131217
##export VERSION=2.11.5
##export VERSIONDATE=20140204
##export VERSION=2.12.0
##export VERSIONDATE=20140325
##export VERSION=2.12.1
##export VERSIONDATE=20140418
##export VERSION=2.13.1
##export VERSIONDATE=20140429
##export VERSION=2.13.4
##export VERSIONDATE=20140721
##export VERSION=2.14.0
##export VERSIONDATE=20140923
#####atk-adaptor/adaptors/document-adaptor.c:37: undefined reference to `atk_document_get_current_page_number'
##export VERSION=2.14.1
##export VERSIONDATE=20141014
##export VERSION=2.15.3
##export VERSIONDATE=20141216
#####Requested 'atk >= 2.15.2' but version of Atk is 2.14.0
##export VERSION=2.15.4
##export VERSIONDATE=20150120
#####Requested 'atk >= 2.15.3' but version of Atk is 2.14.0
##export VERSION=2.16.0
##export VERSIONDATE=20150325
##export VERSION=2.17.1
##export VERSIONDATE=20150721
##export VERSION=2.18.0
##export VERSIONDATE=20150922
##export VERSION=2.18.1
##export VERSIONDATE=20151013
##export VERSION=2.19.2
##export VERSIONDATE=20151127
##export VERSION=2.20.0
##export VERSIONDATE=20160322
##export VERSION=2.20.1
##export VERSIONDATE=20160412
##export VERSION=2.21.4
##export VERSIONDATE=20160719
##export VERSION=2.22.0
##export VERSIONDATE=20160926
##export VERSION=2.24.0
##export VERSIONDATE=20170321
##export VERSION=2.24.1
##export VERSIONDATE=20170509
##export VERSION=2.24.2
##export VERSIONDATE=20200301
##export VERSION=2.25.1
##export VERSIONDATE=20170425
##export VERSION=2.25.2
##export VERSIONDATE=20170523
##export VERSION=2.25.3
##export VERSIONDATE=20170620
##export VERSION=2.26.0
##export VERSIONDATE=20170912
##export VERSION=2.26.1
##export VERSIONDATE=20171031
##export VERSION=2.26.2
##export VERSIONDATE=20180313
#export VERSION=2.26.3
#export VERSIONDATE=20190305
#export DEPENDANCIES=at-spi2-core,atk,glib2,dbus
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
##export VERSION=2.29.1
##export VERSIONDATE=20180619
##export VERSION=2.30.0
##export VERSIONDATE=20180904
##export VERSION=2.30.1
##export VERSIONDATE=20190305
##export VERSION=2.31.2
##export VERSIONDATE=20190219
##export VERSION=2.32.0
##export VERSIONDATE=20190312
##export VERSION=2.33.1
##export VERSIONDATE=20190521
##export VERSION=2.33.2
##export VERSIONDATE=20190619
##export VERSION=2.34.0
##export VERSIONDATE=20190910
##export VERSION=2.34.1
##export VERSIONDATE=20191008
##export VERSION=2.38.0
##export VERSIONDATE=20200913
######meson.build:49:0: ERROR:  Invalid version of dependency, need 'atk' ['>= 2.31.1'] found '2.28.1'.
#wl-showstatus --package-version
##export DEPENDANCIES=at-spi2-core,atk,glib2,dbus
##export OPTIONALDEPENDANCIES=
##export BUILDDEPENDANCIES=meson
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/at-spi2-atk/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
### fix missing ATSPI_DBUS_INTERFACE_ACCESSIBLE in atk-adaptor/adaptors/accessible-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/accessible-adaptor.c atk-adaptor/adaptors/accessible-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_ACCESSIBLE 0" > atk-adaptor/adaptors/accessible-adaptor.c
##cat atk-adaptor/adaptors/accessible-adaptor.c.bak >> atk-adaptor/adaptors/accessible-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_ACTION in atk-adaptor/adaptors/action-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/action-adaptor.c atk-adaptor/adaptors/action-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_ACTION 0" > atk-adaptor/adaptors/action-adaptor.c
##cat atk-adaptor/adaptors/action-adaptor.c.bak >> atk-adaptor/adaptors/action-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_APPLICATION in atk-adaptor/adaptors/application-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/application-adaptor.c atk-adaptor/adaptors/application-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_APPLICATION 0" > atk-adaptor/adaptors/application-adaptor.c
##cat atk-adaptor/adaptors/application-adaptor.c.bak >> atk-adaptor/adaptors/application-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_CACHE in atk-adaptor/adaptors/cache-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/cache-adaptor.c atk-adaptor/adaptors/cache-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_CACHE 0" > atk-adaptor/adaptors/cache-adaptor.c
##cat atk-adaptor/adaptors/cache-adaptor.c.bak >> atk-adaptor/adaptors/cache-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_COLLECTION in atk-adaptor/adaptors/collection-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/collection-adaptor.c atk-adaptor/adaptors/collection-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_COLLECTION 0" > atk-adaptor/adaptors/collection-adaptor.c
##cat atk-adaptor/adaptors/collection-adaptor.c.bak >> atk-adaptor/adaptors/collection-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_COMPONENT in atk-adaptor/adaptors/component-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/component-adaptor.c atk-adaptor/adaptors/component-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_COMPONENT 0" > atk-adaptor/adaptors/component-adaptor.c
##cat atk-adaptor/adaptors/component-adaptor.c.bak >> atk-adaptor/adaptors/component-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_DOCUMENT in atk-adaptor/adaptors/document-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/document-adaptor.c atk-adaptor/adaptors/document-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_DOCUMENT 0" > atk-adaptor/adaptors/document-adaptor.c
##cat atk-adaptor/adaptors/document-adaptor.c.bak >> atk-adaptor/adaptors/document-adaptor.c
### fix missing ATSPI_DBUS_INTERFACE_EDITABLE_TEXT in atk-adaptor/adaptors/editabletext-adaptor.c (version >= 2.1.5 <= 2.7.5)
##mv atk-adaptor/adaptors/editabletext-adaptor.c atk-adaptor/adaptors/editabletext-adaptor.c.bak
##echo "#define ATSPI_DBUS_INTERFACE_EDITABLE_TEXT 0" > atk-adaptor/adaptors/editabletext-adaptor.c
##cat atk-adaptor/adaptors/editabletext-adaptor.c.bak >> atk-adaptor/adaptors/editabletext-adaptor.c
### fix atk-adaptor/bridge.c (version <= 2.2.2)
##patch -ulbf atk-adaptor/bridge.c << EOF
##--- atk-adaptor/bridge.c  2011-08-15 21:11:50 +0200
##+++ atk-adaptor/bridge.c  2011-11-15 13:27:50 +0100
##@@ -263,8 +263,8 @@
##   /* could this be better, we accept some amount of race in getting the temp name*/
##   /* make sure the directory exists */
##+#ifndef DISABLE_P2P
##   mkdir ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   chmod ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   app->app_bus_addr = g_malloc(max_addr_length * sizeof(char));
##-#ifndef DISABLE_P2P
##   sprintf (app->app_bus_addr, "unix:path=/tmp/at-spi2/socket-%d-%d", getpid(),
##            rand());
##@@ -427,4 +427,5 @@
## }
##
##+#ifndef __MINGW32__
## static uint
## get_ancestral_uid (uint pid)
##@@ -458,12 +459,15 @@
##   return get_ancestral_uid (ppid);
## }
##+#endif
##
## static dbus_bool_t
## user_check (DBusConnection *bus, unsigned long uid)
## {
##+#ifndef __MINGW32__
##   if (uid == getuid () || uid == geteuid ())
##     return TRUE;
##   if (getuid () == 0)
##     return get_ancestral_uid (getpid ()) == uid;
##+#endif
##   return FALSE;
## }
##EOF
### fix atk-adaptor/bridge.c (version = 2.3.4)
##patch -ulbf atk-adaptor/bridge.c << EOF
##--- atk-adaptor/bridge.c  2012-01-04 23:57:20 +0100
##+++ atk-adaptor/bridge.c  2012-01-16 23:30:22 +0100
##@@ -358,8 +358,8 @@
##   /* could this be better, we accept some amount of race in getting the temp name*/
##   /* make sure the directory exists */
##+#ifndef DISABLE_P2P
##   mkdir ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   chmod ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   app->app_bus_addr = g_malloc(max_addr_length * sizeof(char));
##-#ifndef DISABLE_P2P
##   sprintf (app->app_bus_addr, "unix:path=/tmp/at-spi2/socket-%d-%d", getpid(),
##            rand());
##@@ -522,4 +522,5 @@
## }
##
##+#ifndef __MINGW32__
## static uint
## get_ancestral_uid (uint pid)
##@@ -553,12 +554,15 @@
##   return get_ancestral_uid (ppid);
## }
##+#endif
##
## static dbus_bool_t
## user_check (DBusConnection *bus, unsigned long uid, void *data)
## {
##+#ifndef __MINGW32__
##   if (uid == getuid () || uid == geteuid ())
##     return TRUE;
##   if (getuid () == 0)
##     return get_ancestral_uid (getpid ()) == uid;
##+#endif
##   return FALSE;
## }
##EOF
### fix atk-adaptor/bridge.c (version >= 2.3.5 <= 2.7.5)
##patch -ulbf atk-adaptor/bridge.c << EOF
##--- atk-adaptor/bridge.c  2012-02-07 20:11:52 +0100
##+++ atk-adaptor/bridge.c  2012-02-07 22:59:18 +0100
##@@ -554,12 +554,15 @@
##   return get_ancestral_uid (ppid);
## }
##+#endif
##
## static dbus_bool_t
## user_check (DBusConnection *bus, unsigned long uid, void *data)
## {
##+#ifndef __MINGW32__
##   if (uid == getuid () || uid == geteuid ())
##     return TRUE;
##   if (getuid () == 0)
##     return get_ancestral_uid (getpid ()) == uid;
##+#endif
##   return FALSE;
## }
##EOF
## fix atk-adaptor/bridge.c (version >= 2.8.1)
#patch -ulbf atk-adaptor/bridge.c << EOF
#--- atk-adaptor/bridge.c  2013-04-17 03:16:18 +0200
#+++ atk-adaptor/bridge.c  2013-04-17 08:24:40 +0200
#@@ -521,8 +521,10 @@
# user_check (DBusConnection *bus, unsigned long uid, void *data)
# {
#+#ifndef __MINGW32__
#   if (uid == getuid () || uid == geteuid ())
#     return TRUE;
#   if (getuid () == 0)
#     return get_ancestral_uid (getpid ()) == uid;
#+#endif
#   return FALSE;
# }
#EOF
### fix atk-adaptor/bridge.c (version >= 2.4.0 <= 2.7.5)
##patch -ulbf atk-adaptor/bridge.c << EOF
##--- atk-adaptor/bridge.c  2012-03-14 22:53:36 +0100
##+++ atk-adaptor/bridge.c  2012-03-27 22:18:42 +0200
##@@ -357,10 +357,10 @@
##
##   /* could this be better, we accept some amount of race in getting the temp name*/
##   /* make sure the directory exists */
##+#ifndef DISABLE_P2P
##   mkdir ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   chmod ("/tmp/at-spi2/", S_IRWXU|S_IRWXG|S_IRWXO|S_ISVTX);
##   app->app_bus_addr = g_malloc(max_addr_length * sizeof(char));
##-#ifndef DISABLE_P2P
##   sprintf (app->app_bus_addr, "unix:path=/tmp/at-spi2/socket-%d-%d", getpid(),
##            rand());
## #else
##@@ -521,6 +521,7 @@
##   socket_class->embed = socket_embed_hook;
## }
##
##+#ifndef __MINGW32__
## static uint
## get_ancestral_uid (uint pid)
## {
##@@ -552,14 +553,17 @@
##     return 0;
##   return get_ancestral_uid (ppid);
## }
##+#endif
##
## static dbus_bool_t
## user_check (DBusConnection *bus, unsigned long uid, void *data)
## {
##+#ifndef __MINGW32__
##   if (uid == getuid () || uid == geteuid ())
##     return TRUE;
##   if (getuid () == 0)
##     return get_ancestral_uid (getpid ()) == uid;
##+#endif
##   return FALSE;
## }
##
##@@ -714,14 +718,14 @@
## static DBusHandlerResult
## signal_filter (DBusConnection *bus, DBusMessage *message, void *user_data)
## {
##-  const char *interface = dbus_message_get_interface (message);
##+  const char *iface = dbus_message_get_interface (message);
##   const char *member = dbus_message_get_member (message);
##   DBusHandlerResult result = DBUS_HANDLER_RESULT_NOT_YET_HANDLED;
##
##   if (dbus_message_get_type (message) != DBUS_MESSAGE_TYPE_SIGNAL)
##     return DBUS_HANDLER_RESULT_NOT_YET_HANDLED;
##
##-  if (!strcmp (interface, ATSPI_DBUS_INTERFACE_REGISTRY))
##+  if (!strcmp (iface, ATSPI_DBUS_INTERFACE_REGISTRY))
##     {
##       result = DBUS_HANDLER_RESULT_HANDLED;
##       if (!strcmp (member, "EventListenerRegistered"))
##@@ -731,7 +735,7 @@
##       else
##         result = DBUS_HANDLER_RESULT_NOT_YET_HANDLED;
##     }
##-  else if (!strcmp (interface, ATSPI_DBUS_INTERFACE_DEVICE_EVENT_LISTENER))
##+  else if (!strcmp (iface, ATSPI_DBUS_INTERFACE_DEVICE_EVENT_LISTENER))
##     {
##       result = DBUS_HANDLER_RESULT_HANDLED;
##       if (!strcmp (member, "KeystrokeListenerRegistered"))
##@@ -742,7 +746,7 @@
##         result = DBUS_HANDLER_RESULT_NOT_YET_HANDLED;
##     }
##
##-  if (!g_strcmp0(interface, DBUS_INTERFACE_DBUS) &&
##+  if (!g_strcmp0(iface, DBUS_INTERFACE_DBUS) &&
##       !g_strcmp0(member, "NameOwnerChanged"))
##     {
##       char *name, *old, *new;
##EOF
## avoid using already defined interface in atk-adaptor/spi-dbus.h (version >= 2.4.0)
#mv atk-adaptor/spi-dbus.h atk-adaptor/spi-dbus.h.bak
#sed -e "s/\b\(interface\)\b/iface/g" atk-adaptor/spi-dbus.h.bak > atk-adaptor/spi-dbus.h
## fix missing getuid/geteuid in atk-adaptor/bridge.c (version >= 2.20.0)
#mv atk-adaptor/bridge.c atk-adaptor/bridge.c.bak
#cat > atk-adaptor/bridge.c << EOF
##define getuid() 0
##define geteuid() 0
#EOF
#cat atk-adaptor/bridge.c.bak >> atk-adaptor/bridge.c
## fix missing strcasecmp in atk-adaptor/adaptors/collection-adaptor.c (version >= 2.24.0)
#mv atk-adaptor/adaptors/collection-adaptor.c atk-adaptor/adaptors/collection-adaptor.c.bak2 &&
#sed -e "s/\bstrcasecmp\b/stricmp/g" atk-adaptor/adaptors/collection-adaptor.c.bak2 > atk-adaptor/adaptors/collection-adaptor.c
## fix missing strcasecmp/strncasecmp in atk-adaptor/bridge.c (version >= 2.24.0)
#mv atk-adaptor/bridge.c atk-adaptor/bridge.c.bak2 &&
#sed -e "s/\bstrcasecmp\b/stricmp/g; s/\bstrncasecmp\b/strnicmp/g" atk-adaptor/bridge.c.bak2 > atk-adaptor/bridge.c
## fix missing ATK_ROLE_FOOTNOTE atk-adaptor/object.c (version >= 2.25.2)
#patch -ulbf atk-adaptor/object.c << EOF
#--- atk-adaptor/object.c  2017-05-23 03:34:10.000000000 +0200
#+++ atk-adaptor/object.c  2017-05-23 11:57:03.864395000 +0200
#@@ -484,3 +484,5 @@
#   role_table[ATK_ROLE_DESCRIPTION_VALUE] = ATSPI_ROLE_DESCRIPTION_VALUE;
#+#ifdef ATK_ROLE_FOOTNOTE
#   role_table[ATK_ROLE_FOOTNOTE] = ATSPI_ROLE_FOOTNOTE;
#+#endif
#
#EOF
#wl-showstatus configure &&
## fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# autoreconf -f -i -I $MINGWPREFIX/share/aclocal
#fi
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
##INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-x --disable-p2p LDFLAGS="-Wl,-no-undefined" &&
#INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --with-x --disable-p2p LDFLAGS="-Wl,--as-needed -latk-1.0 -Wl,-no-undefined" &&
# ## fix missing strcasecmp on non-MinGW-W64 (version >= 2.22.0)
# #echo "#define strcasecmp(s,t) _stricmp((s), (t))" >> config.h
# wl-showstatus build-install &&
# make install-strip &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



export NAME="at-spi2-atk"
export STATUS=
export URL=https://github.com/GNOME/at-spi2-atk
export BASENAME=at-spi2-atk
export DESCRIPTION="A GTK+ module that bridges ATK to D-Bus at-spi"
export CATEGORY=accessibility
export TYPE=library
export VERSION=2.38.0
export VERSIONDATE=20200913
wl-showstatus --package-version
export DEPENDANCIES=at-spi2-core,atk,glib2,dbus
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=meson
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/at-spi2-atk/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# don't include sys/wait.h in subprojects/at-spi2-core/bus/at-spi-bus-launcher.c (version >= 2.38.0)
sed -i.bak -e "s?^#include <sys/wait.h>?//&?" subprojects/at-spi2-core/bus/at-spi-bus-launcher.c
# avoid already defined word interface (version >= 2.38.0)
sed -i.bak -e "s/\binterface\b/iface/g" subprojects/at-spi2-core/atspi/atspi-misc.c
# fix missing getuid/geteuid in atk-adaptor/bridge.c (version >= 2.38.0)
patch -ulbf atk-adaptor/bridge.c << EOF
@@ -683,2 +683,3 @@
 {
+#ifndef _WIN32
   if (uid == getuid () || uid == geteuid ())
@@ -690,2 +691,3 @@
   }
+#endif
   return FALSE;
@@ -898,3 +900,5 @@

+#ifndef _WIN32
   if (getuid () != 0)
+#endif
   {
EOF
mkdir -p build_both &&
 wl-showstatus configure &&
 #PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both . build_both &&
 PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Ddisable_p2p=false -Dtests=false . build_both &&
 wl-showstatus build-install &&
 PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -Cbuild_both install &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####TO DO: check if at-spi2-atk is now included in at-spi2-core



