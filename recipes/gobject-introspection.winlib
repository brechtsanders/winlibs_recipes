#export NAME="GObject Introspection"
#export STATUS=
#export URL=http://live.gnome.org/GObjectIntrospection
#export BASENAME=gobject-introspection
#export DESCRIPTION="The goal of the project is to describe the APIs and collect them in a uniform, machine readable format."
#export CATEGORY=development
#export TYPE=library
##export VERSION=0.6.14
##export VERSIONDATE=20100609
##export VERSION=0.9.0
##export VERSIONDATE=20100630
##export VERSION=0.9.2
##export VERSIONDATE=20100712
##export VERSION=0.9.3
##export VERSIONDATE=20100804
##export VERSION=0.9.5
##export VERSIONDATE=20100912
##export VERSION=0.9.6
##export VERSIONDATE=20100917
#####giscanner/.libs/libgiscanner.a(libgiscanner_la-scannerlexer.o):scannerlexer.c:(.text+0x88): undefined reference to `realpath'
##export VERSION=0.9.8
##export VERSIONDATE=20100929
##export VERSION=0.9.10
##export VERSIONDATE=20101001
##export VERSION=0.9.12
##export VERSIONDATE=20101007
##export VERSION=0.10.0
##export VERSIONDATE=20101223
##export VERSION=0.10.1
##export VERSIONDATE=20110115
##export VERSION=0.10.2
##export VERSIONDATE=20110209
##export VERSION=0.10.3
##export VERSIONDATE=20110223
##export VERSION=0.10.4
##export VERSIONDATE=20110316
##export VERSION=0.10.6
##export VERSIONDATE=20110326
##export VERSION=0.10.7
##export VERSIONDATE=20110405
#export VERSION=0.10.8
#export VERSIONDATE=20110421
##export VERSION=1.29.0
##export VERSIONDATE=20110614
##export VERSION=1.29.15
##export VERSIONDATE=20110727
##export VERSION=1.29.16
##export VERSIONDATE=20110728
##export VERSION=1.29.17
##export VERSIONDATE=20110730
#####Requested 'glib-2.0 >= 2.29.7' but version of GLib is 2.28.8
##export VERSION=1.30.0
##export VERSIONDATE=20110921
##export VERSION=1.31.0
##export VERSIONDATE=20111027
##export VERSION=1.31.6
##export VERSIONDATE=20120116
##export VERSION=1.31.10
##export VERSIONDATE=20120120
##export VERSION=1.31.20
##export VERSIONDATE=20120305
##export VERSION=1.31.22
##export VERSIONDATE=20120321
##export VERSION=1.32.0
##export VERSIONDATE=20120327
##export VERSION=1.32.1
##export VERSIONDATE=20120418
##export VERSION=1.33.2
##export VERSIONDATE=20120606
##export VERSION=1.33.3
##export VERSIONDATE=20120626
##export VERSION=1.33.4
##export VERSIONDATE=20120717
#####configure: error: Python libs not found. Windows requires Python modules to be explicitly linked to libpython.
#wl-showstatus --package-version
#export DEPENDANCIES=glib2,libffi
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=LGPLv2+/GPLv2+
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gobject-introspection/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix missing files
#mkdir sys
#touch sys/mman.h
### fix redefinition of GetFullPathNameA
##patch -ulbf giscanner/grealpath.h << EOF
##--- giscanner/grealpath.h  2009-09-17 10:53:46 +0200
##+++ giscanner/grealpath.h  2010-06-09 11:03:22 +0200
##@@ -14,3 +14,3 @@
## {
##-#ifndef _WIN32
##+#if !defined _WIN32 || defined __MINGW32__
## #ifndef PATH_MAX
##EOF
##patch -ulbf giscanner/grealpath.h << EOF
##--- giscanner/grealpath.h  2009-09-17 10:53:46 +0200
##+++ giscanner/grealpath.h  2010-09-17 17:15:10 +0200
##@@ -28,3 +28,3 @@
##         */
##-       extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
##+       //extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
##        char *buffer;
##EOF
##patch -ulbf giscanner/grealpath.h << EOF
##--- giscanner/grealpath.h  2009-09-17 10:53:46 +0200
##+++ giscanner/grealpath.h       2011-02-09 23:01:46 +0100
##@@ -14,3 +14,3 @@
## {
##-#if !defined _WIN32 || defined __MINGW32__
##+#if !defined _WIN32
## #ifndef PATH_MAX
##@@ -28,3 +28,3 @@
##         */
##-       extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
##+       //extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
##        char *buffer;
##EOF
## fix missing realpath in giscanner/grealpath.h (version >= 0.10.3)
#patch -ulbf giscanner/grealpath.h << EOF
#--- giscanner/grealpath.h  2010-09-02 15:41:12 +0200
#+++ giscanner/grealpath.h  2011-02-23 23:15:04 +0100
#@@ -28,3 +28,5 @@
#         */
#+#ifndef __MINGW32__
#        extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
#+#endif
#        char *buffer;
#EOF
## fix missing realpath in giscanner/giscannermodule.c (version >= 0.10.8)
#patch -ulbf giscanner/giscannermodule.c << EOF
#--- giscanner/giscannermodule.c  2011-09-07 21:39:30 +0200
#+++ giscanner/giscannermodule.c  2011-09-07 21:39:36 +0200
#@@ -26,2 +26,5 @@
# #include "sourcescanner.h"
#+#ifdef G_OS_WIN32
#+#define USE_WINDOWS
#+#endif
# #include "grealpath.h"
#EOF
## fix missing realpath in giscanner/grealpath.h (version >= 0.10.8)
#patch -ulbf giscanner/grealpath.h << EOF
#--- giscanner/grealpath.h  2010-09-02 15:41:12 +0200
#+++ giscanner/grealpath.h  2011-09-07 21:40:06 +0200
#@@ -4,2 +4,5 @@
# #include <stdlib.h>
#+#ifdef USE_WINDOWS
#+#include <windows.h>
#+#endif
#
#@@ -28,3 +31,5 @@
#         */
#-       extern __stdcall GetFullPathNameA(const char*, int, char*, char**);
#+#ifndef USE_WINDOWS
#+       extern __stdcall int GetFullPathNameA(const char*, int, char*, char**);
#+#endif
#        char *buffer;
#EOF
#patch -ulbf giscanner/giscannermodule.c << EOF
#--- giscanner/giscannermodule.c  2010-05-26 18:15:20 +0200
#+++ giscanner/giscannermodule.c  2010-09-17 17:15:54 +0200
#@@ -26,3 +26,2 @@
# #include "sourcescanner.h"
#-#include "grealpath.h"
#
#@@ -35,2 +34,3 @@
# #endif
#+#include "grealpath.h"
#EOF
### fix missing g-ir-scanner.exe
##patch -ulbf gir/Makefile.in << EOF
##--- gir/Makefile.in  2010-06-29 16:17:36 +0200
##+++ gir/Makefile.in  2010-10-12 13:24:44 +0200
##@@ -360,3 +360,3 @@
##        UNINSTALLED_INTROSPECTION_BUILDDIR=\$(top_builddir) \\
##-    \$(top_builddir)/tools/g-ir-scanner\$(EXEEXT)
##+    \$(top_builddir)/tools/g-ir-scanner
##EOF
## fix missing timeval in girepository/cmph/cmph_time.h (version >= 0.10.0)
#patch -ulbf girepository/cmph/cmph_time.h << EOF
#--- girepository/cmph/cmph_time.h  2010-12-05 23:42:36 +0100
#+++ girepository/cmph/cmph_time.h  2010-12-23 08:43:42 +0100
#@@ -9,2 +9,5 @@
# #ifdef WIN32
#+       #ifdef __MINGW32__
#+               #include <sys/time.h>
#+       #endif
# // include headers to use gettimeofday
#EOF
### fix girepository/cmph/cmph_time.h (version >= 0.10.3)
##patch -ulbf girepository/cmph/cmph_time.h << EOF
##--- girepository/cmph/cmph_time.h  2010-12-06 15:20:52 +0100
##+++ girepository/cmph/cmph_time.h  2011-02-23 22:20:40 +0100
##@@ -9,3 +9,3 @@
## #ifdef WIN32
##-// include headers to use gettimeofday
##+  #include <sys/time.h>
## #else
##EOF
### fix misssing include/krb5/krb5.h (version >= 0.10.0 <= 0.10.7)
##mv include/krb5/krb5.hin include/krb5/krb5.h.in
## fix giscanner/utils.py
#patch -ulbf giscanner/utils.py << EOF
#--- giscanner/utils.py  2011-06-10 17:36:50 +0200
#+++ giscanner/utils.py  2012-03-05 21:24:30 +0100
#@@ -101,2 +101,3 @@
#     libname = libname.replace('.libs/.libs', '.libs')
#+    libname = libname.replace('.libs\\\\.libs', '.libs')
#     return libname
#EOF
### fix building DLLs on 64-bit
##if ( echo $RUNPLATFORM | grep -q x86_64 ); then
## #aclocal --force -I $MINGWPREFIX/share/aclocal &&
## libtoolize --force -i -c &&
## autoconf --force
##fi
## fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
#fi
## fix for use of g-ir-scanner.exe instead of g-ir-scanner
#mv common.mk common.mk.bak
#sed -e "s/g-ir-scanner\\\$(EXEEXT)/g-ir-scanner/" common.mk.bak > common.mk
#sed -i.orig "s/\(g-ir-scanner\)\\\$(EXEEXT)/\1/g; s/\(\$(_gir_silent_scanner_prefix)\)/\1/" $(grep -l "g-ir-scanner\\\$(EXEEXT)" `find . -iname Makefile.in`)
### fix glib2 Makefile issues
##mv Makefile.in Makefile.in.bak
##sed -e "s?\$(GLIB_LIBDIR)/glib-2.0/include/glibconfig.h??; s?\$(GLIB_INCLUDEDIR)/glib/\*\.h??" Makefile.in.bak > Makefile.in
## fix missing libpython25.a
##mkdir -p $INSTALLPREFIX/libs
##cp $PYDIR/libs/*.a $INSTALLPREFIX/libs/libpython25.a
##mkdir -p $INSTALLPREFIX/lib/libs
##cp $PYDIR/libs/*.a $INSTALLPREFIX/lib/libs/libpython25.a
#mv Makefile.in Makefile.in.bak
##sed -e "s/libpython25.a/`ls -1 $PYDIR/libs/libpython*.a|sed -e 's?^.*/??g'`/" Makefile.in.bak > Makefile.in
#sed -e "s?[^, ]*libpython25\.a?`ls -1 $PYDIR/libs/libpython*.a`?" Makefile.in.bak > Makefile.in
##PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html --disable-tests CFLAGS="-I$MINGWPREFIX/lib -I$PYDIR/include" LDFLAGS="-L$PYDIR/libs -Wl,--enable-auto-import -Wl,--enable-stdcall-fixup" LIBS="-Wl,--as-needed -lkernel32" &&
#PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html --disable-tests PYTHON_LIBS="-L$PYDIR/libs -lpython26" CFLAGS="-I$MINGWPREFIX/lib -I$PYDIR/include" LDFLAGS="-L$PYDIR/libs -Wl,--enable-auto-import -Wl,--enable-stdcall-fixup" LIBS="-Wl,--as-needed -lkernel32" &&
##PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html --disable-tests GLIB_CFLAGS="`$PKG_CONFIG --cflags glib-2.0`" GLIB_LIBS="`$PKG_CONFIG --libs glib-2.0`" CFLAGS="-I$MINGWPREFIX/lib -I$PYDIR/include" LDFLAGS="-L$PYDIR/libs -Wl,--enable-auto-import -Wl,--enable-stdcall-fixup" LIBS="-Wl,--as-needed -lkernel32" &&
# # fix building DLLs
# mv libtool libtool.bak &&
# sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
# ( make -j1 g-ir-compiler.exe all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0 || (
#  mkdir -p giscanner/.libs/ &&
#  cp .libs/_giscanner.dll giscanner/.libs/ &&
#  mkdir -p giscanner/.libs/.libs &&
#  cp giscanner/.libs/_giscanner.dll giscanner/.libs/.libs/ &&
#  mkdir -p .libs/.libs &&
#  cp giscanner/.libs/_giscanner.dll .libs/.libs/ &&
#  ( make -j1 -Cgir all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0 EXEEXT= ||
#   make -j1 all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0 )
# ) ) &&
# rm -rf $INSTALLPREFIX/libs $INSTALLPREFIX/lib/libs &&
# # fix absolute path to python
# for F in $(grep -l "^#\!$PYDIR/python.exe" $INSTALLPREFIX/bin/*); do
#  mv $F $F.bak &&
#  sed -e "s?^#\!$PYDIR/python.exe?#\!/bin/env PATH=\$PYDIR:\$PATH python.exe?; s?$PYDIR?\$PYDIR?" $F.bak > $F &&
#  rm -f $F.bak
# done &&
#    echo OK
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
#####/glib-2.0/include/glibconfig.h', needed by `GLib-2.0.gir'.  Stop.32/lib
#####IOError: [Errno 2] No such file or directory: 'D:\\Prog\\MinGW-mSys.newer\\home\\win32\\gobject-introspection-0.9.0\\giscanner\\.libs\\.libs\\_giscanner.dll'
#####make: Entering directory `/home/win32/gobject-introspection-0.9.0/gir'
#####  GISCAN GLib-2.0.gir
#####Traceback (most recent call last):
#####  File "../tools/g-ir-scanner", line 39, in <module>
#####    sys.exit(scanner_main(sys.argv))
#####  File "D:\Prog\MinGW-mSys.newer\home\win32\gobject-introspection-0.9.0\giscanner\scannermain.py", line 304, in scanner_main
#####    ss.parse_files(filenames)
#####  File "D:\Prog\MinGW-mSys.newer\home\win32\gobject-introspection-0.9.0\giscanner\sourcescanner.py", line 229, in parse_files
#####    self._parse(headers)
#####  File "D:\Prog\MinGW-mSys.newer\home\win32\gobject-introspection-0.9.0\giscanner\sourcescanner.py", line 262, in _parse
#####    stdout=subprocess.PIPE)
#####  File "d:\Prog\Python26\lib\subprocess.py", line 595, in __init__
#####    errread, errwrite)
#####  File "d:\Prog\Python26\lib\subprocess.py", line 804, in _execute_child
#####    startupinfo)
#####WindowsError: [Error 2] The system cannot find the file specified
##env LPATH=.libs PYTHONPATH=.:. UNINSTALLED_INTROSPECTION_SRCDIR=. UNINSTALLED_INTROSPECTION_BUILDDIR=. $PYDIR/python.exe -d -v ./g-ir-scanner  --verbose -I. --add-include-path=. --add-include-path=./gir --add-include-path=. --add-include-path=. --namespace=GLib --nsversion=2.0 --libtool="/bin/sh ./libtool" --pkg=glib-2.0    --library=libglib-2.0-0 --external-library --reparse-validate --identifier-prefix=G --symbol-prefix=g --symbol-prefix=glib --c-include="glib.h"  -I/mingw32/include/glib-2.0 -I/mingw32/lib/glib-2.0/include -DGETTEXT_PACKAGE=Dummy -DGLIB_COMPILATION -D__G_I18N_LIB_H__  /mingw32/lib/glib-2.0/include/glibconfig.h /mingw32/include/glib-2.0/glib/galloca.h /mingw32/include/glib-2.0/glib/garray.h /mingw32/include/glib-2.0/glib/gasyncqueue.h /mingw32/include/glib-2.0/glib/gatomic.h /mingw32/include/glib-2.0/glib/gbacktrace.h /mingw32/include/glib-2.0/glib/gbase64.h /mingw32/include/glib-2.0/glib/gbitlock.h /mingw32/include/glib-2.0/glib/gbookmarkfile.h /mingw32/include/glib-2.0/glib/gcache.h /mingw32/include/glib-2.0/glib/gchecksum.h /mingw32/include/glib-2.0/glib/gcompletion.h /mingw32/include/glib-2.0/glib/gconvert.h /mingw32/include/glib-2.0/glib/gdataset.h /mingw32/include/glib-2.0/glib/gdate.h /mingw32/include/glib-2.0/glib/gdatetime.h /mingw32/include/glib-2.0/glib/gdir.h /mingw32/include/glib-2.0/glib/gerror.h /mingw32/include/glib-2.0/glib/gfileutils.h /mingw32/include/glib-2.0/glib/ghash.h /mingw32/include/glib-2.0/glib/ghook.h /mingw32/include/glib-2.0/glib/ghostutils.h /mingw32/include/glib-2.0/glib/gi18n-lib.h /mingw32/include/glib-2.0/glib/gi18n.h /mingw32/include/glib-2.0/glib/giochannel.h /mingw32/include/glib-2.0/glib/gkeyfile.h /mingw32/include/glib-2.0/glib/glist.h /mingw32/include/glib-2.0/glib/gmacros.h /mingw32/include/glib-2.0/glib/gmain.h /mingw32/include/glib-2.0/glib/gmappedfile.h /mingw32/include/glib-2.0/glib/gmarkup.h /mingw32/include/glib-2.0/glib/gmem.h /mingw32/include/glib-2.0/glib/gmessages.h /mingw32/include/glib-2.0/glib/gnode.h /mingw32/include/glib-2.0/glib/goption.h /mingw32/include/glib-2.0/glib/gpattern.h /mingw32/include/glib-2.0/glib/gpoll.h /mingw32/include/glib-2.0/glib/gprimes.h /mingw32/include/glib-2.0/glib/gprintf.h /mingw32/include/glib-2.0/glib/gqsort.h /mingw32/include/glib-2.0/glib/gquark.h /mingw32/include/glib-2.0/glib/gqueue.h /mingw32/include/glib-2.0/glib/grand.h /mingw32/include/glib-2.0/glib/gregex.h /mingw32/include/glib-2.0/glib/grel.h /mingw32/include/glib-2.0/glib/gscanner.h /mingw32/include/glib-2.0/glib/gsequence.h /mingw32/include/glib-2.0/glib/gshell.h /mingw32/include/glib-2.0/glib/gslice.h /mingw32/include/glib-2.0/glib/gslist.h /mingw32/include/glib-2.0/glib/gspawn.h /mingw32/include/glib-2.0/glib/gstdio.h /mingw32/include/glib-2.0/glib/gstrfuncs.h /mingw32/include/glib-2.0/glib/gstring.h /mingw32/include/glib-2.0/glib/gtestutils.h /mingw32/include/glib-2.0/glib/gthread.h /mingw32/include/glib-2.0/glib/gthreadpool.h /mingw32/include/glib-2.0/glib/gtimer.h /mingw32/include/glib-2.0/glib/gtimezone.h /mingw32/include/glib-2.0/glib/gtree.h /mingw32/include/glib-2.0/glib/gtypes.h /mingw32/include/glib-2.0/glib/gunicode.h /mingw32/include/glib-2.0/glib/gurifuncs.h /mingw32/include/glib-2.0/glib/gutils.h /mingw32/include/glib-2.0/glib/gvariant.h /mingw32/include/glib-2.0/glib/gvarianttype.h /mingw32/include/glib-2.0/glib/gwin32.h gir/glib-2.0.c g-ir-scanner g-ir-compiler --output GLib-2.0.gir &> _
##PYTHONPATH="`pwd`;`pwd`/.libs;.;$PYDIR/Lib" PYTHONCASEOK=1 LPATH=`pwd`/.libs UNINSTALLED_INTROSPECTION_SRCDIR=`pwd` make -j1 g-ir-compiler.exe all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0
#cat > g-ir-compiler << EOF
##!/bin/sh
#\$0.exe \$@
#EOF
## See also: https://bugzilla.gnome.org/show_bug.cgi?id=620566
##make -j1 GLIB_LIBDIR=/mingw32/lib GLIB_INCLUDEDIR=/mingw32/include/glib-2.0 CC=${CC:-gcc}
#####No msvcr71.dll loaded.
##mv giscanner/giscannermodule.c giscanner/giscannermodule.c.bak
##sed -e "s/msvcr71\.dll/msvcrt.dll/" giscanner/giscannermodule.c.bak > giscanner/giscannermodule.c
##make -i g-ir-compiler.exe all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0
##make -j1 g-ir-compiler.exe all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0
## See also: http://tml.pp.fi/g-i.windows.diff



#export NAME="GObject Introspection"
#export STATUS=
##export URL=http://live.gnome.org/GObjectIntrospection
#export URL=https://gi.readthedocs.io/en/latest/
#export BASENAME=gobject-introspection
#export DESCRIPTION="The goal of the project is to describe the APIs and collect them in a uniform, machine readable format."
#export CATEGORY=development
#export TYPE=library
#export VERSION=1.31.22
#export VERSIONDATE=20120807
##export VERSION=1.32.1
##export VERSIONDATE=20120807
##export VERSION=1.33.4
##export VERSIONDATE=20120807
##export VERSION=1.33.9
##export VERSIONDATE=20120825
##export VERSION=1.33.10
##export VERSIONDATE=20120905
##export VERSION=1.33.14
##export VERSIONDATE=20120920
##export VERSION=1.34.0
##export VERSIONDATE=20120925
##export VERSION=1.34.1.1
##export VERSIONDATE=20121018
##export VERSION=1.34.2
##export VERSIONDATE=20121113
##export VERSION=1.35.2
##export VERSIONDATE=20121120
##export VERSION=1.35.3
##export VERSIONDATE=20121219
##export VERSION=1.35.4
##export VERSIONDATE=20130115
##export VERSION=1.35.8
##export VERSIONDATE=20130220
##export VERSION=1.35.9
##export VERSIONDATE=20130322
##export VERSION=1.36.0
##export VERSIONDATE=20130326
##export VERSION=1.37.1
##export VERSIONDATE=20130529
##export VERSION=1.37.4
##export VERSIONDATE=20130711
##export VERSION=1.37.6
##export VERSIONDATE=20130821
#####Requested 'glib-2.0 >= 2.35.0' but version of GLib is 2.34.2
##export VERSION=1.38.0
##export VERSIONDATE=20130924
##export VERSION=1.39.0
##export VERSIONDATE=20131121
##export VERSION=1.39.3
##export VERSIONDATE=20140126
##export VERSION=1.40.0
##export VERSIONDATE=20140326
##export VERSION=1.41.3
##export VERSIONDATE=20140626
##export VERSION=1.41.4
##export VERSIONDATE=20140722
##export VERSION=1.42.0
##export VERSIONDATE=20140924
##export VERSION=1.43.3
##export VERSIONDATE=20150121
##export VERSION=1.44.0
##export VERSIONDATE=20150324
##export VERSION=1.45.2
##export VERSIONDATE=20150526
#####Requested 'glib-2.0 >= 2.45.2' but version of GLib is 2.44.1
##export VERSION=1.45.3
##export VERSIONDATE=20150704
##export VERSION=1.45.4
##export VERSIONDATE=20150821
#####Requested 'glib-2.0 >= 2.45.3' but version of GLib is 2.44.1
##export VERSION=1.46.0
##export VERSIONDATE=20150922
##export VERSION=1.47.1
##export VERSIONDATE=20151102
##export VERSION=1.47.92
##export VERSIONDATE=20160314
##export VERSION=1.48.0
##export VERSIONDATE=20160323
##export VERSION=1.49.1
##export VERSIONDATE=20160804
##export VERSION=1.49.2
##export VERSIONDATE=20160913
##export VERSION=1.50.0
##export VERSIONDATE=20160920
##export VERSION=1.51.1
##export VERSIONDATE=20161101
##export VERSION=1.51.2
##export VERSIONDATE=20170117
##export VERSION=1.51.3
##export VERSIONDATE=20170214
##export VERSION=1.51.5
##export VERSIONDATE=20170315
##export VERSION=1.52.0
##export VERSIONDATE=20170321
##export VERSION=1.52.1
##export VERSIONDATE=20170410
#####Requested 'glib-2.0 >= 2.51.1' but version of GLib is 2.50.2
##export VERSION=1.53.1
##export VERSIONDATE=20170426
##export VERSION=1.53.2
##export VERSIONDATE=20170523
##export VERSION=1.53.3
##export VERSIONDATE=20170621
##export VERSION=1.53.4
##export VERSIONDATE=20170724
##export VERSION=1.53.5
##export VERSIONDATE=20170815
##export VERSION=1.53.7
##export VERSIONDATE=20170905
##export VERSION=1.54.0
##export VERSIONDATE=20170911
##export VERSION=1.54.1
##export VERSIONDATE=20171003
#####TypeError: cannot create 'scanner.SourceScanner' instances
##export VERSION=1.55.0
##export VERSIONDATE=20171119
##export VERSION=1.55.1
##export VERSIONDATE=20180109
##export VERSION=1.55.2
##export VERSIONDATE=20180223
##export VERSION=1.56.0
##export VERSIONDATE=20180313
##export VERSION=1.56.1
##export VERSIONDATE=20180409
#####Requested 'glib-2.0 >= 2.55.0' but version of GLib is 2.54.2
#####TypeError: cannot create 'scanner.SourceScanner' instances
##export VERSION=1.57.2
##export VERSIONDATE=20180807
##export VERSION=1.57.3
##export VERSIONDATE=20180818
##export VERSION=1.58.0
##export VERSIONDATE=20180901
##export VERSION=1.58.1
##export VERSIONDATE=20181118
##export VERSION=1.58.2
##export VERSIONDATE=20181209
##export VERSION=1.58.3
##export VERSIONDATE=20181231
##export VERSION=1.59.2
##export VERSIONDATE=20190105
##export VERSION=1.59.3
##export VERSIONDATE=20190109
##export VERSION=1.59.4
##export VERSIONDATE=20190205
##export VERSION=1.60.0
##export VERSIONDATE=20190311
##export VERSION=1.60.1
##export VERSIONDATE=20190408
##export VERSION=1.60.2
##export VERSIONDATE=20190616
##export VERSION=1.61.1
##export VERSIONDATE=20190808
##export VERSION=1.61.2
##export VERSIONDATE=20190818
##export VERSION=1.64.0
##export VERSIONDATE=20200308
#####configure: error: 'autoconf-archive' missing
#wl-showstatus --package-version
#export DEPENDANCIES=glib2,libffi
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=LGPLv2+/GPLv2+
##export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gobject-introspection/"
#export DOWNLOADURL="https://download.gnome.org/sources/gobject-introspection/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=https://download.gnome.org/sources/gobject-introspection/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix giscanner/utils.py
#patch -ulbf giscanner/utils.py << EOF
#--- giscanner/utils.py  2011-06-10 17:36:50 +0200
#+++ giscanner/utils.py  2012-03-05 21:24:30 +0100
#@@ -101,2 +101,3 @@
#     libname = libname.replace('.libs/.libs', '.libs')
#+    libname = libname.replace('.libs\\\\.libs', '.libs')
#     return libname
#EOF
## fix error: No msvcr71.dll loaded (must replace with the msvcr DLL version used by Python version, test with: objdump.exe -p $PYDIR/python.exe|grep -i msvcr)
#mv giscanner/giscannermodule.c giscanner/giscannermodule.c.bak
#cat > giscanner/giscannermodule.c << EOF
##ifdef __MINGW64__
##define Py_InitModule4 Py_InitModule4_64
##endif
#EOF
#sed -e "s/msvcr71/msvcr90/g" giscanner/giscannermodule.c.bak >> giscanner/giscannermodule.c
## patches see https://mail.gnome.org/archives/windows-devel-list/2012-July/msg00000.html
#patch -ulbf Makefile-gir.am << EOF
#--- Makefile-gir.am
#+++ Makefile-gir.am
#@@ -26,17 +26,17 @@ CLEANFILES += gir/cairo-1.0.gir
# EXTRA_DIST += gir/cairo-1.0.gir.in
# 
# # Doesn't seem to work to do gir/%.typelib =(
#-gir/cairo-1.0.typelib: g-ir-compiler
#-gir/DBus-1.0.typelib: g-ir-compiler
#-gir/DBusGLib-1.0.typelib: g-ir-compiler
#-gir/fontconfig-2.0.typelib: g-ir-compiler
#-gir/freetype2-2.0.typelib: g-ir-compiler
#-gir/GL-1.0.typelib: g-ir-compiler
#-gir/libxml2-2.0.typelib: g-ir-compiler
#-gir/xft-2.0.typelib: g-ir-compiler
#-gir/xlib-2.0.typelib: g-ir-compiler
#-gir/xfixes-4.0.typelib: g-ir-compiler
#-gir/xrandr-1.3.typelib: g-ir-compiler
#+gir/cairo-1.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/DBus-1.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/DBusGLib-1.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/fontconfig-2.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/freetype2-2.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/GL-1.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/libxml2-2.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/xft-2.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/xlib-2.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/xfixes-4.0.typelib: g-ir-compiler\$(EXEEXT)
#+gir/xrandr-1.3.typelib: g-ir-compiler\$(EXEEXT)
# 
# # glib with source (to enable documentation)
# if WITH_GLIBSRC
#EOF
#patch -ulbf giscanner/sourcescanner.py << EOF
#--- giscanner/sourcescanner.py
#+++ giscanner/sourcescanner.py
#@@ -275,6 +275,8 @@ class SourceScanner(object):
#         defines = ['__GI_SCANNER__']
#         undefs = []
#         cpp_args = os.environ.get('CC', 'cc').split()
#+        # On MINGW32 with a custom prefix, headers like libintl.h are not found
#+        cpp_args += os.environ.get('GI_SCANNER_INCLUDES', '').split()
#         cpp_args += ['-E', '-C', '-I.', '-']
# 
#         cpp_args += self._cpp_options
#EOF
### fix giscanner/sourcescanner.py (version >= 1.36.0)
##patch -ulbf giscanner/sourcescanner.py << EOF
##--- giscanner/sourcescanner.py  2013-03-06 23:53:20 +0100
##+++ giscanner/sourcescanner.py  2013-07-17 11:35:02 +0200
##@@ -287,2 +287,4 @@
##             cpp_args = cpp_exec
##+        # On MINGW32 with a custom prefix, headers like libintl.h are not found
##+        cpp_args += os.environ.get('GI_SCANNER_INCLUDES', '').split()
##         cpp_args += ['-E', '-C', '-I.', '-']
##EOF
#patch -ulbf giscanner/gdumpparser.py << EOF
#--- giscanner/gdumpparser.py
#+++ giscanner/gdumpparser.py
#@@ -23,6 +23,7 @@ import sys
# import tempfile
# import shutil
# import subprocess
#+import time
# from xml.etree.cElementTree import parse
# 
# from . import ast
#@@ -171,7 +172,14 @@ blob containing data gleaned from GObject's primitive introspection."""
#             return parse(out_path)
#         finally:
#             if not utils.have_debug_flag('save-temps'):
#-                shutil.rmtree(self._binary.tmpdir)
#+                # FIXME: MinGW/MSYS do not always remove the directory the first time,
#+                #        causing lockups due to what seems to be interaction between
#+                #        MSYS and python when an exception is caught ...
#+                try:
#+                    shutil.rmtree(self._binary.tmpdir)
#+                except Exception, e:
#+                    time.sleep(0.5)
#+                    shutil.rmtree(self._binary.tmpdir, True)
#
#     # Parser
#
#EOF
## fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
#fi
## skip Windows specific checks in Python detection in configure (version >= 1.36.0)
#patch -ulbf configure << EOF
#--- configure  2013-07-17 11:34:26 +0200
#+++ configure  2013-07-17 11:43:30 +0200
#@@ -14440,5 +14440,5 @@
# CPPFLAGS="\$save_CPPFLAGS"
#
#-if test "x\$os_win32" = "xyes"; then
#+if test "x\$os_win32" = "xyes___"; then
#
# { \$as_echo "\$as_me:\${as_lineno-\$LINENO}: checking for libraries required to link against libpython" >&5
#EOF
#wl-showstatus configure &&
#PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html --disable-tests PYTHON_INCLUDES="-I$PYDIR/include" PYTHON_LIBS="-L$PYDIR/libs -l`ls -1 $PYDIR/libs/libpython[0-9][0-9].a|sed -e "s/^.*\(python[0-9]*\).*$/\1/"`" &&
##PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html CFLAGS="-I$PYDIR/include" LIBS="-Wl,--as-needed -L$PYDIR/libs -l`ls -1 $PYDIR/libs/libpython[0-9][0-9].a|sed -e "s/^.*\(python[0-9]*\).*$/\1/"`" &&
##PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG=$MINGWPREFIX/bin/pkg-config.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-gtk-doc-html --with-python=$PYDIR/python.exe CFLAGS="-I$PYDIR/include" LIBS="-Wl,--as-needed -L$PYDIR/libs -l`ls -1 $PYDIR/libs/libpython[0-9][0-9].a|sed -e "s/^.*\(python[0-9]*\).*$/\1/"`" &&
# wl-showstatus build-install &&
# # workaround for error: No rule to make target `g-ir-compiler'
# make g-ir-compiler.exe &&
# ( C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} make all install-strip || make all install-strip GLIB_LIBDIR=$MINGWPREFIX/lib GLIB_INCLUDEDIR=$MINGWPREFIX/include/glib-2.0 ) &&
# #make PKG_CONFIG=$(which pkg-config) &&
# mv $INSTALLPREFIX/bin/g-ir-scanner $INSTALLPREFIX/bin/g-ir-scanner.bak &&
# sed -e "s?$PYDIR/python.exe?/bin/env PATH=\$PYDIR:\$PATH python.exe?; s?$INSTALLPREFIX?$MINGWPREFIX?g" $INSTALLPREFIX/bin/g-ir-scanner.bak > $INSTALLPREFIX/bin/g-ir-scanner &&
# rm -f $INSTALLPREFIX/bin/g-ir-scanner.bak &&
#    echo OK
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
##PATH=$PYDIR:$PATH PYTHON=$PYDIR/python.exe 
##C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PYTHONPATH=$(pwd):$(pwd)/.libs${PYTHONPATH:+:$PYTHONPATH} make -j1 INTROSPECTION_SCANNER="$PYDIR/python.exe $(pwd)/g-ir-scanner"
##C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PYTHONPATH=$(pwd):$(pwd)/.libs${PYTHONPATH:+:$PYTHONPATH} LPATH=.libs PYTHONPATH=.:. UNINSTALLED_INTROSPECTION_SRCDIR=. UNINSTALLED_INTROSPECTION_BUILDDIR=. make -j1 INTROSPECTION_SCANNER="$PYDIR/python.exe $(pwd)/g-ir-scanner"
##cp -f .libs/_giscanner.pyd giscanner/
##mkdir -p .libs/scanner
#
#
#
##C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-cairo --disable-gtk-doc-html --with-python=$PYDIR/python.exe PYTHON_INCLUDES="-I$PYDIR/include" PYTHON_LIBS="-L$PYDIR/libs -l$(ls -1 $PYDIR/libs/libpython[0-9][0-9].a|sed -e "s/^.*\(python[0-9]*\).*$/\1/")" &&
##C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} make PKG_CONFIG="$(which pkg-config.exe)" _giscanner.la &&
##cp -f .libs/_giscanner.pyd giscanner/ &&
##PATH=$PYDIR:$PATH make PKG_CONFIG="$(which pkg-config.exe)" INTROSPECTION_SCANNER="$PYDIR/python.exe $(pwd)/g-ir-scanner" -j1 &&
##  echo OK
#
#
#
#####See also: https://github.com/camgunz/mingw-w64-builds/blob/master/build-gobject-introspection-1.44.0.sh



#export NAME="GObject Introspection"
#export STATUS=
#export URL=https://wiki.gnome.org/Projects/GObjectIntrospection
##export URL=https://developer.gnome.org/gi/stable/
##export URL=https://github.com/GNOME/gobject-introspection
#export BASENAME=gobject-introspection
#export DESCRIPTION="The goal of the project is to describe the APIs and collect them in a uniform, machine readable format."
#export CATEGORY=development
#export TYPE=library
##export VERSION=1.56.1
##export VERSIONDATE=20180827
##export VERSION=1.58.0
##export VERSIONDATE=20180901
##export VERSION=1.58.1
##export VERSIONDATE=20181118
##export VERSION=1.58.2
##export VERSIONDATE=20181209
##export VERSION=1.58.3
##export VERSIONDATE=20181231
##export VERSION=1.59.1
##export VERSIONDATE=20181217
##export VERSION=1.59.2
##export VERSIONDATE=20190105
##export VERSION=1.59.3
##export VERSIONDATE=20190109
##export VERSION=1.59.4
##export VERSIONDATE=20190205
##export VERSION=1.60.0
##export VERSIONDATE=20190311
##export VERSION=1.60.1
##export VERSIONDATE=20190408
##export VERSION=1.60.2
##export VERSIONDATE=20190616
#export VERSION=1.64.0
#export VERSIONDATE=20200308
#wl-showstatus --package-version
#export DEPENDANCIES=glib2,libffi,cairo
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE="LGPLv2+/GPLv2+"
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gobject-introspection/"
##export DOWNLOADURL="https://github.com/GNOME/gobject-introspection/releases"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#wl-showstatus extract
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix missing Py_InitModule4 in giscanner/giscannermodule.c
#mv giscanner/giscannermodule.c giscanner/giscannermodule.c.bak
#cat > giscanner/giscannermodule.c << EOF
##ifdef __MINGW64__
##define Py_InitModule4 Py_InitModule4_64
##endif
#EOF
#cat giscanner/giscannermodule.c.bak >> giscanner/giscannermodule.c
#wl-showstatus configure &&
#C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} PKG_CONFIG=$(which pkg-config.exe) ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-cairo --with-python=$PYDIR/python.exe PYTHON_INCLUDES="-I$PYDIR/include" PYTHON_LIBS="-L$PYDIR/libs -l$(ls -1 $PYDIR/libs/libpython[0-9][0-9].a|sed -e "s/^.*\(python[0-9]*\).*$/\1/")" &&
# ## fix building DLLs
# #mv libtool libtool.bak &&
# #sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
# #wl-showstatus build &&
# #make &&
# wl-showstatus build-install &&
# C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} make install-strip &&
# 
# C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} make PKG_CONFIG="$(which pkg-config.exe)" _giscanner.la &&
# cp -f .libs/_giscanner.pyd giscanner/ &&
# C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} make -j1 &&
#    echo OK && find . -name '*.a'
#
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
#####PATH=$PYDIR:$PATH $PYDIR/python.exe g-ir-scanner



export NAME="GObject Introspection"
export STATUS=
#export URL=https://wiki.gnome.org/Projects/GObjectIntrospection
export URL=https://gi.readthedocs.io/
#export URL=https://developer.gnome.org/gi/stable/
#export URL=https://github.com/GNOME/gobject-introspection
export BASENAME=gobject-introspection
export DESCRIPTION="The goal of the project is to describe the APIs and collect them in a uniform, machine readable format."
export CATEGORY=development
export TYPE=library
#export VERSION=1.61.1
#export VERSIONDATE=20190808
#export VERSION=1.61.2
#export VERSIONDATE=20190818
#export VERSION=1.62.0
#export VERSIONDATE=20190910
#export VERSION=1.63.1
#export VERSIONDATE=20191125
#export VERSION=1.63.2
#export VERSIONDATE=20200118
#export VERSION=1.64.1
#export VERSIONDATE=20200406
#export VERSION=1.66.0
#export VERSIONDATE=20200913
#export VERSION=1.66.1
#export VERSIONDATE=20201003
#export VERSION=1.67.1
#export VERSIONDATE=20210313
#export VERSION=1.68.0
#export VERSIONDATE=20210320
#export VERSION=1.69.0
#export VERSIONDATE=20210825
#export VERSION=1.70.0
#export VERSIONDATE=20210918
#export VERSION=1.71.0
#export VERSIONDATE=20220214
#export VERSION=1.72.0
#export VERSIONDATE=20220318
#export VERSION=1.73.0
#export VERSIONDATE=20220714
export VERSION=1.73.1
export VERSIONDATE=20220903
wl-showstatus --package-version
export DEPENDANCIES=glib2,libffi
export OPTIONALDEPENDANCIES=cairo
export BUILDDEPENDANCIES=meson,ninja
export LICENSEFILE=COPYING
export LICENSETYPE="LGPLv2+/GPLv2+"
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gobject-introspection/"
#export DOWNLOADURL="https://github.com/GNOME/gobject-introspection/releases"
export DOWNLOADURL="https://download.gnome.org/sources/gobject-introspection/"
#export DOWNLOADURL="https://gitlab.gnome.org/GNOME/gobject-introspection/-/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://download.gnome.org/sources/gobject-introspection/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=https://gitlab.gnome.org/GNOME/gobject-introspection/-/archive/$VERSION/$BASENAME-$VERSION.tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# apply patch (version >= 1.70.0)
####error: giscanner\meson.build:58:0: ERROR: File doctemplates does not exist.
wl-download -v -d $TARBALLDIR/$BASENAME https://gitlab.gnome.org/GNOME/gobject-introspection/-/commit/effb1e09dee263cdac4ec593e8caf316e6f01fe2.diff
patch -ulbf -p1 < $TARBALLDIR/$BASENAME/effb1e09dee263cdac4ec593e8caf316e6f01fe2.diff
# fix MSVC issue
mkdir -p winfix
cp -rf $PYDIR/lib/distutils winfix/
patch -ulbf winfix/distutils/cygwinccompiler.py << EOF
@@ -85,3 +85,3 @@
         else:
-            raise ValueError("Unknown MS Compiler version %s " % msc_ver)
+            return None

EOF
mkdir -p build_both &&
 wl-showstatus configure &&
 PKG_CONFIG= PYTHONPATH=$MINGWPREFIX/lib${PYTHONPATH:+:$PYTHONPATH} $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -D cairo=disabled -D doctool=disabled -D gtk_doc=false -D python=$PYDIR/python.exe . build_both &&
 # fix slash/backslash path issue when calling Python from Ninja
 #sed -i.bak -e "s/join_paths/os.path.join/g; /COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
 #sed -i.bak -e "s/join_paths/os.path.join/g; /COMMAND =.*python\.exe/ s?\(\"\|| *\)/\([a-zA-Z]\)/?\1\2:/?g; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
 #sed -i.bak -e "s/join_paths/os.path.join/g; /CUSTOM_COMMAND.*python\.exe/ s? \([a-zA-Z]\)\$:/? /\1/?g; /COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
 wl-showstatus build-install &&
 PKG_CONFIG= PATH=$PYDIR:$PATH PYTHONPATH=$(pwd)/winfix:$MINGWPREFIX/lib${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_both install &&
 # change python3 to python
 sed -i -e "s/python3/python.exe/" $INSTALLPREFIX/bin/g-ir-annotation-tool $INSTALLPREFIX/bin/g-ir-scanner &&
 # remove unneeded include path from gobject-introspection-1.0.pc
 sed -i -e "s?-I$(cygpath -m $MINGWPREFIX)/include\b??" $INSTALLPREFIX/lib/pkgconfig/gobject-introspection-1.0.pc &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
####See also: https://github.com/msys2/MINGW-packages/tree/master/mingw-w64-gobject-introspection



