export NAME="ZABBIX"
export STATUS=
export URL=http://www.zabbix.com/
export BASENAME=zabbix
export DESCRIPTION="ZABBIX is an enterprise-class open source distributed monitoring solution."
export CATEGORY=sysadmin
export TYPE=library
#export VERSION=1.4.5
#export VERSION=1.5.2
#export VERSION=1.5.4
#export VERSION=1.6.2
#export VERSION=1.6.4
#export VERSION=1.6.5
#export VERSION=1.6.6
#export VERSION=1.8.1
#export VERSION=1.8.2
#export VERSION=1.8.3
#export VERSION=1.8.4
#export VERSION=1.8.5
#export VERSIONDATE=20110416
#export VERSION=1.8.6
#export VERSIONDATE=20110804
#export VERSION=1.8.7
#export VERSIONDATE=20110901
#export VERSION=1.8.8
#export VERSIONDATE=20110928
#export VERSION=1.8.9
#export VERSIONDATE=20130517
#export VERSION=1.8.17
#export VERSIONDATE=20130726
#export VERSION=1.8.18
#export VERSIONDATE=20131008
#export VERSION=1.8.19
#export VERSIONDATE=20131209
#export VERSION=1.8.20
#export VERSIONDATE=20140212
#export VERSION=1.8.21
#export VERSIONDATE=20140910
####configure: error: Unable to DNS lookup functions "no"
#export VERSION=2.0.6
#export VERSIONDATE=20130517
####configure: error: Unable to do DNS lookups (libresolv check failed)
#export VERSION=2.0.8
#export VERSIONDATE=20130821
#export VERSION=2.0.9
#export VERSIONDATE=20131008
#export VERSION=2.0.10
#export VERSIONDATE=20131209
#export VERSION=2.0.11
#export VERSIONDATE=20140212
#export VERSION=2.0.12
#export VERSIONDATE=20140513
#export VERSION=2.0.13
#export VERSIONDATE=20140910
#export VERSION=2.0.16
#export VERSIONDATE=20151112
#export VERSION=2.0.18
#export VERSIONDATE=20160518
#export VERSION=2.0.19
#export VERSIONDATE=20160930
#export VERSION=2.0.20
#export VERSIONDATE=20161207
#export VERSION=2.0.21
#export VERSIONDATE=20170420
#####checking for integer field name in union sigval of struct siginfo_t... configure: error: Unable to find integer field name in union sigval of struct siginfo_t
#export VERSION=2.2.0
#export VERSIONDATE=20131112
#export VERSION=2.2.1
#export VERSIONDATE=20131209
#export VERSION=2.2.2
#export VERSIONDATE=20140212
#export VERSION=2.2.4
#export VERSIONDATE=20140623
#export VERSION=2.2.5
#export VERSIONDATE=20140717
####checking for integer field name in union sigval of struct siginfo_t... configure: error: Unable to find integer field name in union sigval of struct siginfo_t
#export VERSION=2.2.6
#export VERSIONDATE=20140827
#export VERSION=2.2.11
#export VERSIONDATE=20151112
#export VERSION=2.2.13
#export VERSIONDATE=20160518
#export VERSION=2.2.14
#export VERSIONDATE=20160725
#export VERSION=2.2.15
#export VERSIONDATE=20160930
#export VERSION=2.2.16
#export VERSIONDATE=20161207
#export VERSION=2.2.17
#export VERSIONDATE=20170227
#export VERSION=2.2.18
#export VERSIONDATE=20170420
#export VERSION=2.2.19
#export VERSIONDATE=20170714
#export VERSION=2.2.20
#export VERSIONDATE=20170926
#export VERSION=2.2.21
#export VERSIONDATE=20171228
#export VERSION=2.2.22
#export VERSIONDATE=20180604
#export VERSION=2.2.23
#export VERSIONDATE=20180730
####configure: error: Unable to do DNS lookups (libresolv check failed)
#export VERSION=2.4.0
#export VERSIONDATE=20140911
#export VERSION=2.4.1
#export VERSIONDATE=20141008
#export VERSION=2.4.2
#export VERSIONDATE=20141105
#export VERSION=2.4.3
#export VERSIONDATE=20181113
#export VERSION=2.4.6
#export VERSIONDATE=20151019
#export VERSION=2.4.7
#export VERSIONDATE=20151112
#export VERSION=2.4.8
#export VERSIONDATE=20160420
#export VERSION=3.0.1
#export VERSIONDATE=20160406
#export VERSION=3.0.2
#export VERSIONDATE=20160420
#export VERSION=3.0.3
#export VERSIONDATE=20160518
#export VERSION=3.0.4
#export VERSIONDATE=20160725
#export VERSION=3.0.5
#export VERSIONDATE=20160930
#export VERSION=3.0.6
#export VERSIONDATE=20161207
#export VERSION=3.0.7
#export VERSIONDATE=20161221
#export VERSION=3.0.8
#export VERSIONDATE=20170227
#export VERSION=3.0.9
#export VERSIONDATE=20170420
#export VERSION=3.0.10
#export VERSIONDATE=20170714
#export VERSION=3.0.11
#export VERSIONDATE=20170926
#export VERSION=3.0.12
#export VERSIONDATE=20171017
#export VERSION=3.0.13
#export VERSIONDATE=20171109
#export VERSION=3.0.14
#export VERSIONDATE=20171228
#export VERSION=3.0.15
#export VERSIONDATE=20180226
#export VERSION=3.0.16
#export VERSIONDATE=20180407
#export VERSION=3.0.17
#export VERSIONDATE=20180510
#export VERSION=3.0.18
#export VERSIONDATE=20180606
#export VERSION=3.0.19
#export VERSIONDATE=20180625
#export VERSION=3.0.20
#export VERSIONDATE=20180731
#export VERSION=3.0.21
#export VERSIONDATE=20180828
#export VERSION=3.0.22
#export VERSIONDATE=20180914
#export VERSION=3.0.23
#export VERSIONDATE=20181029
#export VERSION=3.0.24
#export VERSIONDATE=20181126
#export VERSION=3.0.25
#export VERSIONDATE=20190128
#export VERSION=3.0.26
#export VERSIONDATE=20190325
#export VERSION=3.0.27
#export VERSIONDATE=20190418
#export VERSION=3.0.28
#export VERSIONDATE=20190528
#export VERSION=3.0.29
#export VERSIONDATE=20191221
#export VERSION=3.0.30
#export VERSIONDATE=20200226
#export VERSION=3.2.0
#export VERSIONDATE=20160914
#export VERSION=3.2.1
#export VERSIONDATE=20160930
#export VERSION=3.2.2
#export VERSIONDATE=20161207
#export VERSION=3.2.3
#export VERSIONDATE=20161221
#export VERSION=3.2.4
#export VERSIONDATE=20170227
#export VERSION=3.2.5
#export VERSIONDATE=20170420
#export VERSION=3.2.6
#export VERSIONDATE=20170506
#export VERSION=3.2.7
#export VERSIONDATE=20170718
#export VERSION=3.2.8
#export VERSIONDATE=20170926
#export VERSION=3.2.9
#export VERSIONDATE=20171017
#export VERSION=3.2.10
#export VERSIONDATE=20171109
#export VERSION=3.2.11
#export VERSIONDATE=20171128
####checking for integer field name in union sigval of struct siginfo_t... configure: error: Unable to find integer field name in union sigval of struct siginfo_t
#export VERSION=3.4.0
#export VERSIONDATE=20170821
#export VERSION=3.4.1
#export VERSIONDATE=20170828
#export VERSION=3.4.2
#export VERSIONDATE=20170926
#export VERSION=3.4.3
#export VERSIONDATE=20171017
#export VERSION=3.4.4
#export VERSIONDATE=20171109
#export VERSION=3.4.5
#export VERSIONDATE=20171228
#export VERSION=3.4.6
#export VERSIONDATE=20180115
#export VERSION=3.4.7
#export VERSIONDATE=20180216
#export VERSION=3.4.8
#export VERSIONDATE=20180405
#export VERSION=3.4.9
#export VERSIONDATE=20180510
#export VERSION=3.4.10
#export VERSIONDATE=20180606
#export VERSION=3.4.11
#export VERSIONDATE=20180627
#export VERSION=3.4.12
#export VERSIONDATE=20180731
#export VERSION=3.4.13
#export VERSIONDATE=20180828
#export VERSION=3.4.14
#export VERSIONDATE=20180917
#export VERSION=3.4.15
#export VERSIONDATE=20181113
#export VERSION=4.0.0
#export VERSIONDATE=20181002
#export VERSION=4.0.1
#export VERSIONDATE=20181030
#export VERSION=4.0.2
#export VERSIONDATE=20181128
#export VERSION=4.0.3
#export VERSIONDATE=20181220
export VERSION=4.0.4
export VERSIONDATE=20190204
#export VERSION=4.0.5
#export VERSIONDATE=20190225
#export VERSION=4.0.6
#export VERSIONDATE=20190329
#export VERSION=4.0.7
#export VERSIONDATE=20190418
#export VERSION=4.0.8
#export VERSIONDATE=20190520
#export VERSION=4.0.9
#export VERSIONDATE=20190608
#export VERSION=4.0.10
#export VERSIONDATE=20190627
#export VERSION=4.0.11
#export VERSIONDATE=20190729
#export VERSION=4.0.12
#export VERSIONDATE=20190827
#export VERSION=4.0.13
#export VERSIONDATE=20191003
#export VERSION=4.0.14
#export VERSIONDATE=20191029
#export VERSION=4.0.15
#export VERSIONDATE=20191125
#export VERSION=4.0.16
#export VERSIONDATE=20191220
#export VERSION=4.0.17
#export VERSIONDATE=20200129
#export VERSION=4.0.18
#export VERSIONDATE=20200224
#export VERSION=4.0.19
#export VERSIONDATE=20200323
#export VERSION=4.2.1
#export VERSIONDATE=20190419
#export VERSION=4.2.2
#export VERSIONDATE=20190529
#export VERSION=4.2.3
#export VERSIONDATE=20190608
#export VERSION=4.2.4
#export VERSIONDATE=20190627
#export VERSION=4.2.5
#export VERSIONDATE=20190730
#export VERSION=4.2.6
#export VERSIONDATE=20190827
#export VERSION=4.2.8
#export VERSIONDATE=20191029
#export VERSION=4.4.0
#export VERSIONDATE=20191008
#export VERSION=4.4.1
#export VERSIONDATE=20191030
#export VERSION=4.4.2
#export VERSIONDATE=20191126
#export VERSION=4.4.3
#export VERSIONDATE=20191127
#export VERSION=4.4.4
#export VERSIONDATE=20191219
#export VERSION=4.4.5
#export VERSIONDATE=20200128
#export VERSION=4.4.6
#export VERSIONDATE=20200221
#export VERSION=4.4.7
#export VERSIONDATE=20200323
####configure: error: Unable to use libpcre (libpcre check failed)
wl-showstatus --package-version
export DEPENDANCIES=pcre,sqlite3,netsnmp,libssh2,openipmi,openldap,libcurl,libiconv
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL2
#export DOWNLOADURL="http://sourceforge.net/project/showfiles.php?group_id=23494&package_id=16271"
export DOWNLOADURL="http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/zabbix/zabbix-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/$VERSION/zabbix-$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://downloads.sourceforge.net/project/zabbix/ZABBIX%20Latest%20Stable/$VERSION/zabbix-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfz $TARBALLDIR/$BASENAME/zabbix-$VERSION.tar.gz
cd zabbix-$VERSION
# fix missing libresolv in configure
patch -ulbf configure << EOF
--- configure  2016-05-18 15:08:43.000000000 +0200
+++ configure  2016-05-18 18:08:32.634070000 +0200
@@ -5766,3 +5766,3 @@
 if test "x\$found_resolv" != "xyes"; then
-       as_fn_error \$? "Unable to do DNS lookups (libresolv check failed)" "\$LINENO" 5
+       as_fn_warning \$? "Unable to do DNS lookups (libresolv check failed)" "\$LINENO" 5
 fi
@@ -6097,3 +6097,3 @@

-\$as_echo "#define socklen_t int" >>confdefs.h
+#\$as_echo "#define socklen_t int" >>confdefs.h

@@ -6191,4 +6191,2 @@

-else
-  as_fn_error \$? "Unable to find integer field name in union sigval of struct siginfo_t" "\$LINENO" 5
 fi
EOF
# fix missing libpcre in configure
mv configure configure.bak &&
sed -e "s?/usr/local/?$MINGWPREFIX/?g" configure.bak > configure
#make -j1 -Cbuild/win32/project -f Makefile_agent CC=gcc LINKER=ld LIBS="-lws2 _32 -lpsapi.lib -lpdh -lwldap32 -ladvapi32.lib -luuid -liphlpapi" && echo OK
#--enable-static --enable-server --enable-agent --enable-ipv6
wl-showstatus configure &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-server --with-iconv=$MINGWPREFIX &&
./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-server --disable-proxy --disable-agent --disable-java --enable-ipv6 --with-sqlite3=$MINGWPREFIX --with-jabber=$MINGWPREFIX --with-libxml2=$MINGWPREFIX --with-net-snmp=$MINGWPREFIX --with-ssh2=$MINGWPREFIX --with-openipmi=$MINGWPREFIX --with-ldap=$MINGWPREFIX --with-libcurl=$(which curl-config) --with-iconv=$MINGWPREFIX &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-server --enable-proxy --enable-agent --disable-java --enable-ipv6 --with-sqlite3=$MINGWPREFIX --with-jabber=$MINGWPREFIX --with-libxml2=$MINGWPREFIX --with-net-snmp=$MINGWPREFIX --with-ssh2=$MINGWPREFIX --with-openipmi=$MINGWPREFIX --with-ldap=$MINGWPREFIX --with-libcurl=$(which curl-config) --with-iconv=$MINGWPREFIX &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-server --enable-proxy --enable-agent --disable-java --enable-ipv6 --with-sqlite3=$MINGWPREFIX --with-jabber=$MINGWPREFIX --with-libxml2=$MINGWPREFIX --with-net-snmp=$MINGWPREFIX --with-gnutls=$MINGWPREFIX --with-ssh2=$MINGWPREFIX --with-openipmi=$MINGWPREFIX --with-ldap=$MINGWPREFIX --with-libcurl=$(which curl-config) --with-iconv=$MINGWPREFIX &&
#--with-gnutls=$MINGWPREFIX --with-mbedtls=$MINGWPREFIX
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-server --with-iconv=$MINGWPREFIX --with-sqlite3=$MINGWPREFIX CFLAGS="-D_WINDOWS -I$(pwd)/build/win32/project" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-server --enable-proxy --enable-agent --disable-java --enable-ipv6 --with-mysql=$MINGWPREFIX --without-postgresql --without-sqlite3 --with-jabber=$MINGWPREFIX --with-libxml2=$MINGWPREFIX --with-net-snmp=$MINGWPREFIX --with-ssh2=$MINGWPREFIX --with-openipmi=$MINGWPREFIX --with-ldap=$MINGWPREFIX --with-libcurl=$(which curl-config) --with-iconv=$MINGWPREFIX &&
 #mv include/config.h include/config.h.bak &&
 #grep -v "^#define socklen_t int" include/config.h.bak > include/config.h &&
 wl-showstatus build &&
 make &&
 #wl-showstatus build-install &&
 #make install-strip &&
 wl-showstatus install &&
 mkdir -p $INSTALLPREFIX/include $INSTALLPREFIX/lib $INSTALLPREFIX/bin $INSTALLPREFIX/etc/zabbix &&
 cp -f bin/win$(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo 64; else echo 32; fi)/dev/*.h $INSTALLPREFIX/include/ &&
 cp -f bin/win$(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo 64; else echo 32; fi)/dev/zabbix_sender.lib $INSTALLPREFIX/lib/libzabbix_sender.dll.a &&
 cp -f bin/win$(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo 64; else echo 32; fi)/dev/*.dll $INSTALLPREFIX/bin/ &&
 cp -f bin/win$(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo 64; else echo 32; fi)/*.exe $INSTALLPREFIX/bin/ &&
 cp -rf conf/* $INSTALLPREFIX/etc/zabbix/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf zabbix-$VERSION



