export NAME="git"
export STATUS=
export URL=http://git.or.cz/
export BASENAME=git
export DESCRIPTION="Git is a free & open source, distributed version control system designed to handle everything from small to very large projects with speed and efficiency."
export CATEGORY=development
export TYPE=application
#export VERSION=1.6.2.2
#export VERSION=1.6.2.4
#export VERSION=1.6.3.2
#export VERSION=1.6.3.3
#export VERSION=1.6.3.4
#export VERSION=1.6.5
####LINK git-fast-import.exe: cannot find -lgen
#export VERSION=1.6.5.4
#export VERSIONDATE=20091203
#export VERSION=1.6.5.5
#export VERSIONDATE=20091206
#export VERSION=1.6.5.6
#export VERSIONDATE=20091211
#export VERSION=1.6.5.7
#export VERSIONDATE=20091217
#export VERSION=1.6.6
#export VERSIONDATE=20091227
#export VERSION=1.6.6.1
#export VERSIONDATE=20100122
#export VERSION=1.6.6.3
#export VERSIONDATE=20101216
#export VERSION=1.7.0.3
#export VERSIONDATE=20100322
#export VERSION=1.7.0.4
#export VERSIONDATE=20100331
#export VERSION=1.7.0.5
#export VERSIONDATE=20100413
#export VERSION=1.7.0.6
#export VERSIONDATE=20100423
#export VERSION=1.7.1
#export VERSIONDATE=20100426
#export VERSION=1.7.1.1
#export VERSIONDATE=20100630
#export VERSION=1.7.2
#export VERSIONDATE=20100722
#export VERSION=1.7.2.1
#export VERSIONDATE=20100729
#export VERSION=1.7.2.2
#export VERSIONDATE=20100823
#export VERSION=1.7.3
#export VERSIONDATE=20100920
#export VERSION=1.7.2.4
#export VERSIONDATE=20101203
#export VERSION=1.7.2.5
#export VERSIONDATE=20101217
####/bin/sh: line 3: tclsh: command not found
#export VERSION=1.7.3.3
#export VERSIONDATE=20101205
####checking for socklen_t equivalent... configure: error: Cannot find a type to use in place of socklen_t
#export VERSION=1.7.3.4
#export VERSIONDATE=20101216
#export VERSION=1.7.3.5
#export VERSIONDATE=20110106
#export VERSION=1.7.4
#export VERSIONDATE=20110202
####MSGFMT    po/de.msg make[1]: *** [po/de.msg] Error 127
#export VERSION=1.7.4.1
#export VERSIONDATE=20110222
####checking for socklen_t equivalent... configure: error: Cannot find a type to use in place of socklen_t
#export VERSION=1.7.4.2
#export VERSIONDATE=20110328
#export VERSION=1.7.4.3
#export VERSIONDATE=20110403
#export VERSION=1.7.4.4
#export VERSIONDATE=20110407
#export VERSION=1.7.4.5
#export VERSIONDATE=20110420
#export VERSION=1.7.5
#export VERSIONDATE=20110425
#export VERSION=1.7.5.1
#export VERSIONDATE=20110505
#export VERSION=1.7.5.2
#export VERSIONDATE=20110520
#export VERSION=1.7.5.3
#export VERSIONDATE=20110527
#export VERSION=1.7.5.4
#export VERSIONDATE=20110602
####./libgit.a(xdiff-interface.o):xdiff-interface.c:(.text+0x6a0): undefined reference to `xdl_get_hunk'
####./libgit.a(ll-merge.o):ll-merge.c:(.text+0x1e8): undefined reference to `xdl_merge'
#export VERSION=1.7.8.5
#export VERSIONDATE=20120227
#export VERSION=1.7.8.6
#export VERSIONDATE=20120427
#export VERSION=1.7.6.1
#export VERSIONDATE=20110825
#export VERSION=1.7.9.1
#export VERSIONDATE=20120219
#export VERSION=1.7.9.2
#export VERSIONDATE=20120223
#export VERSION=1.7.9.3
#export VERSIONDATE=20120306
#export VERSION=1.7.9.4
#export VERSIONDATE=20120313
#export VERSION=1.7.9.5
#export VERSIONDATE=20120327
#export VERSION=1.7.9.6
#export VERSIONDATE=20120403
#export VERSION=1.7.9.7
#export VERSIONDATE=20120427
#export VERSION=1.7.10
#export VERSIONDATE=20120407
#export VERSION=1.7.10.1
#export VERSIONDATE=20120502
#export VERSION=1.7.10.2
#export VERSIONDATE=20120512
#export VERSION=1.7.10.3
#export VERSIONDATE=20120526
#export VERSION=1.7.10.4
#export VERSIONDATE=20120604
#export VERSION=1.7.10.5
#export VERSIONDATE=20120618
#export VERSION=1.7.11
#export VERSIONDATE=20120618
#export VERSION=1.7.11.1
#export VERSIONDATE=20120622
#export VERSION=1.7.11.2
#export VERSIONDATE=20120712
#export VERSION=1.7.11.4
#export VERSIONDATE=20120731
#export VERSION=1.7.11.5
#export VERSIONDATE=20120816
#export VERSION=1.7.11.6
#export VERSIONDATE=20120912
#export VERSION=1.7.11.7
#export VERSIONDATE=20120915
#export VERSION=1.7.12
#export VERSIONDATE=20120824
#export VERSION=1.7.12.1
#export VERSIONDATE=20120920
#export VERSION=1.7.12.2
#export VERSIONDATE=20120930
#export VERSION=1.7.12.3
#export VERSIONDATE=20121009
#export VERSION=1.7.12.4
#export VERSIONDATE=20121018
#export VERSION=1.8.0
#export VERSIONDATE=20121022
#export VERSION=1.8.0.1
#export VERSIONDATE=20121126
#export VERSION=1.8.0.2
#export VERSIONDATE=20121211
#export VERSION=1.8.0.3
#export VERSIONDATE=20121228
#export VERSION=1.8.1
#export VERSIONDATE=20130101
#export VERSION=1.8.1.1
#export VERSIONDATE=20130115
#export VERSION=1.8.1.2
#export VERSIONDATE=20130129
#export VERSION=1.8.1.3
#export VERSIONDATE=20130208
#export VERSION=1.8.1.4
#export VERSIONDATE=20130220
#export VERSION=1.8.1.5
#export VERSIONDATE=20130302
#export VERSION=1.8.1.6
#export VERSIONDATE=20130408
#export VERSION=1.8.2
#export VERSIONDATE=20130314
#export VERSION=1.8.2.1
#export VERSIONDATE=20130408
#export VERSION=1.8.2.2
#export VERSIONDATE=20130427
#export VERSION=1.8.2.3
#export VERSIONDATE=20130510
#export VERSION=1.8.3
#export VERSIONDATE=20130525
#export VERSION=1.8.3.1
#export VERSIONDATE=20130611
#export VERSION=1.8.3.2
#export VERSIONDATE=20130629
#export VERSION=1.8.3.3
#export VERSIONDATE=20130716
#export VERSION=1.8.3.4
#export VERSIONDATE=20130723
#export VERSION=1.8.4
#export VERSIONDATE=20130824
#export VERSION=1.8.4.1
#export VERSIONDATE=20131003
#export VERSION=1.8.4.2
#export VERSIONDATE=20131029
#export VERSION=1.8.4.3
#export VERSIONDATE=20131109
#export VERSION=1.8.4.4
#export VERSIONDATE=20131121
#export VERSION=1.8.4.5
#export VERSIONDATE=20131203
#export VERSION=1.8.5
#export VERSIONDATE=20131128
#export VERSION=1.8.5.1
#export VERSIONDATE=20131204
#export VERSION=1.8.5.2
#export VERSIONDATE=20131218
####libgit.a(poll.o):poll.c:(.text+0x85c): undefined reference to `MsgWaitForMultipleObjects'
#export VERSION=1.8.5.3
#export VERSIONDATE=20140115
#export VERSION=1.8.5.4
#export VERSIONDATE=20140206
#export VERSION=1.8.5.5
#export VERSIONDATE=20140214
#export VERSION=1.9.0
#export VERSIONDATE=20140215
export VERSION=2.24.1
export VERSIONDATE=20191211
#export VERSION=2.24.2
#export VERSIONDATE=20200415
#export VERSION=2.24.3
#export VERSIONDATE=20200421
#export VERSION=2.25.0
#export VERSIONDATE=20200114
#export VERSION=2.25.1
#export VERSIONDATE=20200217
#export VERSION=2.25.2
#export VERSIONDATE=20200318
#export VERSION=2.25.4
#export VERSIONDATE=20200421
#export VERSION=2.26.0
#export VERSIONDATE=20200323
#export VERSION=2.26.1
#export VERSIONDATE=20200415
#export VERSION=2.26.2
#export VERSIONDATE=20200421
####include/_mingw.h:452:2: error: #error You cannot use 32-bit time_t (_USE_32BIT_TIME_T) with _WIN64
wl-showstatus --package-version
export DEPENDANCIES=libiconv,openssl,pcre,libcurl,expat,zlib
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=tcl
export LICENSEFILE=
export LICENSETYPE=
#export DOWNLOADURL="http://code.google.com/p/git-core/downloads/list"
#export DOWNLOADURL="https://mirrors.edge.kernel.org/pub/software/scm/git/"
export DOWNLOADURL="http://www.kernel.org/pub/software/scm/git/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://www.kernel.org/pub/software/scm/git/git-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://git-core.googlecode.com/files/git-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/git-core/git-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://mirrors.edge.kernel.org/pub/software/scm/git/git-$VERSION.tar.gz
export DOWNLOADSOURCEURL=http://www.kernel.org/pub/software/scm/git/git-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xfj $TARBALLDIR/$BASENAME/git-$VERSION.tar.bz2
tar xfz $TARBALLDIR/$BASENAME/git-$VERSION.tar.gz
cd git-$VERSION
# fix missing files
mkdir -p win32fix
echo "#include <winsock2.h>" > win32fix/netdb.h
mkdir -p win32fix/sys
cat > win32fix/sys/socket.h << EOF
#include <winsock2.h>
#include <ws2tcpip.h>
EOF
touch win32fix/poll.h
## fix missing getpass() (version <= 1.6.3.3)
#cat >> compat/mingw.c << EOF
#char* getpass (const char* prompt) {
# struct strbuf buf = STRBUF_INIT;
# fputs(prompt, stderr);
# for (;;) {
#  char c = _getch();
#  if (c == '\r' || c == '\n')
#   break;
#  strbuf_addch(&buf, c);
# }
# fputs("\n", stderr);
# return strbuf_detach(&buf, NULL);
#}
#EOF
#cat >> compat/mingw.h << EOF
#extern char* getpass (const char* prompt);
#EOF
# fix cache.h for 64-bit
mv cache.h cache.h.bak
cat > cache.h << EOF
#include <stdint.h>
#include <libintl.h>
EOF
cat cache.h.bak >> cache.h
## fix compat/mingw.h for 64-bit
#patch -ulbf compat/mingw.h << EOF
#--- compat/mingw.h  2012-03-05 23:42:16 +0100
#+++ compat/mingw.h  2012-03-06 11:57:02 +0100
#@@ -7,6 +7,10 @@
#
#+#ifndef __MINGW64__
# typedef int pid_t;
#+#endif
# typedef int uid_t;
# typedef int socklen_t;
#+#ifndef __MINGW32__
# #define hstrerror strerror
#+#endif
#
#@@ -259,3 +263,5 @@
# #define off_t off64_t
#+#ifndef __MINGW64__
# #define lseek _lseeki64
#+#endif
# #ifndef ALREADY_DECLARED_STAT_FUNCS
#@@ -267,4 +273,6 @@
# #define lstat mingw_lstat
#+#ifndef __MINGW64__
# #define _stati64(x,y) mingw_stat(x,y)
# #endif
#+#endif
#
#EOF
patch -ulbf compat/mingw.h << EOF
--- compat/mingw.h  2013-12-03 20:35:24 +0100
+++ compat/mingw.h  2013-12-04 08:56:18 +0100
@@ -7,6 +7,10 @@

+#ifndef __MINGW64__
 typedef int pid_t;
+#endif
 typedef int uid_t;
 typedef int socklen_t;
+#ifndef __MINGW32__
 #define hstrerror strerror
+#endif

@@ -270,3 +274,5 @@
 #define off_t off64_t
+#ifndef __MINGW64__
 #define lseek _lseeki64
+#endif

@@ -322,2 +328,3 @@

+#ifndef __MINGW32__
 int winansi_fputs(const char *str, FILE *stream);
@@ -328,2 +335,3 @@
 #define fprintf(...) winansi_fprintf(__VA_ARGS__)
+#endif

EOF
## fix redefinition of lseek/stat in compat/mingw.h (version >= 1.8.4.5)
#patch -ulbf compat/mingw.h << EOF
#--- compat/mingw.h  2013-12-03 08:55:16 +0100
#+++ compat/mingw.h  2013-12-03 22:18:46 +0100
#@@ -264,5 +264,5 @@
# #define off_t off64_t
#-#define lseek _lseeki64
#+//#define lseek _lseeki64
# #ifndef ALREADY_DECLARED_STAT_FUNCS
#-#define stat _stati64
#+//#define stat _stati64
# int mingw_lstat(const char *file_name, struct stat *buf);
#EOF
## fix redefinition of fork in compat/mingw.h
#mv compat/mingw.h compat/mingw.h.bak
#sed -e "s/fork/MY_fork/" compat/mingw.h.bak > compat/mingw.h
## fix missing fork in run-command.c (version >= 1.8.5.3)
#mv run-command.c run-command.c.bak
#echo "#define fork() -1" > run-command.c
#cat run-command.c.bak >> run-command.c
## fix missing fork in transport-helper.c (version >= 1.8.5.3)
#mv transport-helper.c transport-helper.c.bak
#echo "#define fork() -1" > transport-helper.c
#cat transport-helper.c.bak >> transport-helper.c
# fix compat/bswap.h for 64-bit
mv compat/bswap.h compat/bswap.h.bak
echo "#include <stdint.h>" > compat/bswap.h
cat compat/bswap.h.bak >> compat/bswap.h
# fix missing QS_ALLINPUT in compat/win32/poll.c for 64-bit or MinGW-W64
if ( echo $RUNPLATFORM | grep -q x86_64 || gcc --version|grep "MinGW-W64" > /dev/null ); then
 if [ -f compat/win32/poll.c ]; then
  mv compat/win32/poll.c compat/win32/poll.c.bak
  echo "#define QS_ALLINPUT 0x04FF" > compat/win32/poll.c
  cat compat/win32/poll.c.bak >> compat/win32/poll.c
 fi
 if [ -f compat/poll/poll.c ]; then
  mv compat/poll/poll.c compat/poll/poll.c.bak
  echo "#define QS_ALLINPUT 0x04FF" > compat/poll/poll.c
  if ! ( echo $RUNPLATFORM | grep -q x86_64 ); then
cat >> compat/poll/poll.c << EOF
#include <winsock2.h>
#include <windows.h>
WINUSERAPI DWORD WINAPI MsgWaitForMultipleObjects(DWORD nCount,CONST HANDLE *pHandles,WINBOOL fWaitAll,DWORD dwMilliseconds,DWORD dwWakeMask);
EOF
  fi
  cat compat/poll/poll.c.bak >> compat/poll/poll.c
 fi
fi
# fix compat/nedmalloc/malloc.c.h for 64-bit
mv compat/nedmalloc/malloc.c.h compat/nedmalloc/malloc.c.h.bak
sed -e "s/\(static\) FORCEINLINE/\1/" compat/nedmalloc/malloc.c.h.bak > compat/nedmalloc/malloc.c.h
# fix compat/nedmalloc/nedmalloc.c for 64-bit
mv compat/nedmalloc/nedmalloc.c compat/nedmalloc/nedmalloc.c.bak
sed -e "s/\(static\) FORCEINLINE/\1/" compat/nedmalloc/nedmalloc.c.bak > compat/nedmalloc/nedmalloc.c
# fix invalid linker option --large-address-aware on 64-bit (version >= 1.8.4)
if ( echo $RUNPLATFORM | grep -q x86_64 ); then
 #mv GIT-LDFLAGS GIT-LDFLAGS.bak
 #sed -e "s/-Wl,--large-address-aware//" GIT-LDFLAGS.bak > GIT-LDFLAGS
 mv config.mak.uname config.mak.uname.bak
 #sed -e "s/-Wl,--large-address-aware//" config.mak.uname.bak > config.mak.uname
 sed -e "s/-Wl,--large-address-aware//; s/-D_USE_32BIT_TIME_T//" config.mak.uname.bak > config.mak.uname
fi
## fix missing syslog.h and poll.h in git-compat-util.h (version >= 1.9.0)
#patch -ulbf git-compat-util.h << EOF
#--- git-compat-util.h  2014-02-14 22:57:09.000000000 +0100
#+++ git-compat-util.h  2015-01-20 09:42:16.182834800 +0100
#@@ -124,2 +124,3 @@
# #include <utime.h>
#+#if !defined(__MINGW32__)
# #include <syslog.h>
#@@ -130,2 +131,3 @@
# #endif
#+#endif
#
#EOF
## remove -lgen from configure
#mv configure configure.bak
#sed -e "s/-lgen//" configure.bak > configure
# remove -lgen and -lsocket from configure
mv configure configure.bak
sed -e "s/-lgen//; s/-lsocket//" configure.bak > configure
wl-showstatus configure &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-tcltk --without-iconv LDFLAGS="-Wl,--allow-multiple-definition" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--allow-multiple-definition" &&
####checking for socklen_t equivalent... configure: error: Cannot find a type to use in place of socklen_t
./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-tcltk --with-openssl --with-libpcre --with-curl --with-expat CFLAGS="-I`pwd`/win32fix" LIBS="-Wl,--as-needed -lregex" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-tcltk --with-openssl --with-libpcre --with-curl --with-expat CFLAGS="-I`pwd`/win32fix -I$MINGWPREFIX/include/mman-win32" LIBS="-Wl,--as-needed -lregex" LDFLAGS="-Wl,--allow-multiple-definition -Wl,--enable-auto-import -Wl,--as-needed -lmman" &&
 # fix problems with redefinition of sockaddr_storage (version >= 1.6.2.2)
 sed -i.bak -e "s/-Dsockaddr_storage=[^ ]*//; s/-lsocket//; s/-pthread/-lpthread/; s/{ /( /; s/} /) /" Makefile &&
 ## don't define NO_UNSETENV (version >= 2.24.2)
 #sed -i.bak2 -e "s/-DNO_UNSETENV//" Makefile &&
 # fix linking with pthreads
 sed -i.bak -e "s/-pthread/-lpthread/" config.mak.autogen &&
 # avoid linking with -lgen and -lresolv (version >= 1.6.5)
 sed -i.bak2 -e "s/-lgen//g; s/-lresolv//g" Makefile &&
 # avoid linking with -lgen and -lresolv (version >= 1.7.8.5)
 sed -i.bak3 -e "s?vcs-svn/lib.a?vcs-svn/libvcssvn.a?g" Makefile &&
 wl-showstatus build-install &&
 # make sure the INSTALL documentation file is not confused with the install command
 ( mv INSTALL INSTALL.txt; mv gitweb/INSTALL gitweb/INSTALL.txt; true ) &&
 #make install prefix=$INSTALLPREFIX &&
 #make install prefix=$INSTALLPREFIX XDIFF_LIB=xdiff/libxdiff.a VCSSVN_LIB=vcs-svn/libvcssvn.a &&
 #make -j1 all install prefix=$INSTALLPREFIX XDIFF_LIB=xdiff/libxdiff.a VCSSVN_LIB=vcs-svn/libvcssvn.a LIBS="-Wl,--enable-auto-import -Wl,--as-needed -L. -lgit -lregex -lpcre -lintl -liconv -lws2_32 -lz -Lxdiff -lxdiff" &&
 make -j1 all install prefix=$INSTALLPREFIX USE_WIN32_MMAP=1 XDIFF_LIB=xdiff/libxdiff.a VCSSVN_LIB=vcs-svn/libvcssvn.a LIBS="-Wl,--enable-auto-import -Wl,--as-needed -L. -lgit -lregex -lpcre -lintl -liconv -lws2_32 -lz -Lxdiff -lxdiff" &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf git-$VERSION



#export NAME="git"
#export STATUS=
#export URL=https://git-scm.com/
#export BASENAME=git
#export DESCRIPTION="Git is a free & open source, distributed version control system designed to handle everything from small to very large projects with speed and efficiency."
#export CATEGORY=development
#export TYPE=application
##export VERSION=2.24.0
##export VERSIONDATE=20191117
##export VERSION=2.24.1
##export VERSIONDATE=20191211
##export VERSION=2.24.2
##export VERSIONDATE=20200415
##export VERSION=2.24.3
##export VERSIONDATE=20200421
##export VERSION=2.25.0
##export VERSIONDATE=20200114
##export VERSION=2.25.1
##export VERSIONDATE=20200217
##export VERSION=2.25.2
##export VERSIONDATE=20200318
##export VERSION=2.25.4
##export VERSIONDATE=20200421
##export VERSION=2.26.0
##export VERSIONDATE=20200323
##export VERSION=2.26.1
##export VERSIONDATE=20200415
##export VERSION=2.26.2
##export VERSIONDATE=20200421
##export VERSION=2.27.0
##export VERSIONDATE=20200602
##export VERSION=2.28.0
##export VERSIONDATE=20200728
##export VERSION=2.29.0
##export VERSIONDATE=20201020
##export VERSION=2.29.1
##export VERSIONDATE=20201024
##export VERSION=2.29.2
##export VERSIONDATE=20201030
##export VERSION=2.30.0
##export VERSIONDATE=20201229
##export VERSION=2.30.1
##export VERSIONDATE=20210209
##export VERSION=2.30.2
##export VERSIONDATE=20210310
##export VERSION=2.31.0
##export VERSIONDATE=20210316
##export VERSION=2.31.1
##export VERSIONDATE=20210327
##export VERSION=2.32.0
##export VERSIONDATE=20210606
##export VERSION=2.33.0
##export VERSIONDATE=20210817
##export VERSION=2.33.1
##export VERSIONDATE=20211013
##export VERSION=2.34.1
##export VERSIONDATE=20211215
#export VERSION=2.35.1
#export VERSIONDATE=20220129
#wl-showstatus --package-version
#export DEPENDANCIES=libiconv,openssl,pcre2,libcurl,expat,zlib,syslog-win32
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=tcl
#export LICENSEFILE=
#export LICENSETYPE=
##export DOWNLOADURL="https://github.com/git/git/releases"
##export DOWNLOADURL="https://mirrors.edge.kernel.org/pub/software/scm/git/"
#export DOWNLOADURL="http://www.kernel.org/pub/software/scm/git/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=https://github.com/git/git/archive/v$VERSION.tar.gz
##export DOWNLOADSOURCEURL=https://mirrors.edge.kernel.org/pub/software/scm/git/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=http://www.kernel.org/pub/software/scm/git/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xfz $TARBALLDIR/$BASENAME/v$VERSION.tar.gz
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd git-$VERSION
## fix redefinition of inet_pton/inet_ntop in git-compat-util.h
#patch -ulbf git-compat-util.h << EOF
#@@ -808,2 +808,3 @@
#
#+#ifndef __MINGW32__
# #ifdef NO_INET_PTON
#@@ -815,2 +816,3 @@
# #endif
#+#endif
#
#EOF
## fix missing files
#mkdir -p win32fix/sys
#echo "#include <winsock2.h>" > win32fix/netdb.h
#cat > win32fix/sys/socket.h << EOF
##include <winsock2.h>
##include <ws2tcpip.h>
#EOF
#touch win32fix/poll.h
#sed -i.bak -e "s/as_fn_error\(.*Cannot find a type to use in place of socklen_t\)/echo\1/" configure
## fix redefinition of  in  fetch-pack.c (version >= 2.24.1)
#patch -ulbf fetch-pack.c << EOF
#@@ -44,2 +44,3 @@
# #define COMPLETE       (1U << 0)
#+#undef ALTERNATE
# #define ALTERNATE      (1U << 1)
#EOF
## fix compat/mingw.h (version >= 2.25.0)
#patch -ulbf compat/mingw.h << EOF
#
#+#ifndef __MINGW64_VERSION_MAJOR
# struct mingw_stat {
#@@ -395,2 +396,3 @@
# #define lstat mingw_lstat
#+#endif
#
#EOF
## fix compat/mingw.h (version >= 2.25.2)
#patch -ulbf compat/mingw.h << EOF
#@@ -351,2 +351,3 @@
#  */
#+#ifdef _MSC_VER
# #ifndef __MINGW64_VERSION_MAJOR
#EOF
## fix compat/mingw.h (version >= 2.26.1)
#patch -ulbf compat/mingw.h << EOF
#@@ -102,2 +102,3 @@
# };
#+#undef NO_STRUCT_ITIMERVAL
# #define ITIMER_REAL 0
#@@ -362,2 +363,3 @@
#
#+#ifndef __MINGW64_VERSION_MAJOR
# struct mingw_stat {
#@@ -395,2 +397,7 @@
# #define lstat mingw_lstat
#+#else
#+#define st_atim st_atime
#+#define st_mtim st_mtime
#+#define st_ctim st_ctime
#+#endif
#
#EOF
## fix compat/mingw.c (version >= 2.25.2)
#patch -ulbf compat/mingw.c << EOF
#@@ -749,2 +749,3 @@
#  */
#+#ifdef _MSC_VER
# static int do_lstat(int follow, const char *file_name, struct stat *buf)
#@@ -909,2 +910,3 @@
# }
#+#endif
#
#EOF
## fix redefinition of setitimer in git-compat-util.h (version >= 2.29.0)
#sed -i.bak -e "s/#ifdef NO_SETITIMER/#if 0/" git-compat-util.h
## fix compat/stat.c (version >= 2.29.0)
#patch -ulbf compat/stat.c << EOF
#@@ -11,4 +11,6 @@
#                return 0040000 | perm_bits;
#+#ifdef S_ISLNK
#        if (S_ISLNK(native_mode))
#                return 0120000 | perm_bits;
#+#endif
#        if (S_ISBLK(native_mode))
#@@ -19,4 +21,6 @@
#                return 0010000 | perm_bits;
#+#ifdef S_ISSOCK
#        if (S_ISSOCK(native_mode))
#                return 0140000 | perm_bits;
#+#endif
#        /* Non-standard type bits were given. */
#@@ -43,3 +47,7 @@
# {
#+#ifdef _WIN32
#+       int rc = stat(path, buf);
#+#else
#        int rc = lstat(path, buf);
#+#endif
#        if (rc == 0)
#EOF
## fix git-compat-util.h (version >= 2.35.2-1)
#patch -ulbf git-compat-util.h << EOF
#@@ -308,2 +308,3 @@
#
#+#ifndef __MINGW32__
# #ifdef NO_STRUCT_ITIMERVAL
#@@ -320,2 +321,3 @@
# #endif
#+#endif
#
#EOF
### fix Makefile
##patch -ulbf Makefile << EOF
##@@ -1452,3 +1451,0 @@
##-ifdef NEEDS_LIBGEN
##-       EXTLIBS += -lgen
##-endif
##@@ -1460,3 +1456,0 @@
##-ifdef NEEDS_SOCKET
##-       EXTLIBS += -lsocket
##-endif
##@@ -1541,4 +1534,0 @@
##-ifdef NO_UNSETENV
##-       COMPAT_CFLAGS += -DNO_UNSETENV
##-       COMPAT_OBJS += compat/unsetenv.o
##-endif
##@@ -1578,4 +1567,0 @@
##-ifdef NO_STRUCT_ITIMERVAL
##-       COMPAT_CFLAGS += -DNO_STRUCT_ITIMERVAL
##-       NO_SETITIMER = YesPlease
##-endif
##@@ -1608,16 +1593,0 @@
##-ifdef NO_SOCKADDR_STORAGE
##-ifdef NO_IPV6
##-       BASIC_CFLAGS += -Dsockaddr_storage=sockaddr_in
##-else
##-       BASIC_CFLAGS += -Dsockaddr_storage=sockaddr_in6
##-endif
##-endif
##-ifdef NO_INET_NTOP
##-       LIB_OBJS += compat/inet_ntop.o
##-       BASIC_CFLAGS += -DNO_INET_NTOP
##-endif
##-ifdef NO_INET_PTON
##-       LIB_OBJS += compat/inet_pton.o
##-       BASIC_CFLAGS += -DNO_INET_PTON
##-endif
##-ifdef NO_UNIX_SOCKETS
##@@ -1626,5 +1595,0 @@
##-else
##-       LIB_OBJS += unix-socket.o
##-       PROGRAM_OBJS += credential-cache.o
##-       PROGRAM_OBJS += credential-cache--daemon.o
##-endif
##EOF
##sed -i.bak -e "s/-lgen//g; s/-lsocket//g" configure
##sed -i.bak -e "s/-lsocket/-lws2_32/g" configure
#wl-showstatus configure &&
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-openssl --with-libpcre2 --with-curl --with-expat --with-zlib=$MINGWPREFIX --with-python=$PYDIR/python.exe --with-perl=$PERLDIR/bin/perl.exe --with-tcltk CFLAGS="-DGIT_WINDOWS_NATIVE=1 -I$(pwd)/win32fix -I$MINGWPREFIX/include/mman-win32" LDFLAGS="-Wl,--as-needed -lmman -lpcre -lws2_32" &&
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-openssl --with-libpcre2 --with-curl --with-expat --with-zlib=$MINGWPREFIX --with-python=$PYDIR/python.exe --with-perl=$PERLDIR/bin/perl.exe --with-tcltk CFLAGS="-I$(pwd)/win32fix -I$MINGWPREFIX/include/mman-win32" LDFLAGS="-Wl,--as-needed -lmman -lpcre -lws2_32" &&
# #echo "#define GIT_WINDOWS_NATIVE 1" >> config.h &&
# ## fix redefinition of inet_ntop/inet_pton (version >= 2.26.1)
# #echo "#if _WIN32_WINNT < 0x0600" >> config.h &&
# #echo "#undef _WIN32_WINNT" >> config.h &&
# #echo "#define _WIN32_WINNT 0x0600" >> config.h &&
# #echo "#endif" >> config.h &&
# #echo "#undef NO_INET_PTON" >> config.h &&
# #echo "#undef NO_INET_NTOP" >> config.h &&
# # don't define NO_UNSETENV (version >= 2.24.2)
# sed -i.bak -e "s/-DNO_UNSETENV//" Makefile &&
# sed -i.bak2 -e "s/-lgen//; s/-lsocket/-lws2_32/" Makefile &&
# wl-showstatus build &&
# make libgit.a &&
# ( echo "EXPORTS" && nm -f posix --defined-only -p libgit.a | sed -n -e "s/^_*\(git[^ ]*\) T .*$/\1/p" ) > git.def &&
# gcc -shared -s -mwindows -def git.def -o git.dll libgit.a -Wl,--out-implib,libgit.dll.a -Wl,--as-needed -lssp -lws2_32 -lntdll -lintl -liconv -lz -lregex -lpcre2-8 && # -lgit2
# #make -j1 EXTLIBS="-Wl,--as-needed -lmman -lz -lws2_32 -lregex -lpcre2-8 -liconv -lintl" &&
# make -j1 USE_LIBPCRE=1 USE_WIN32_MMAP=1 MMAP_PREVENTS_DELETE=1 NO_POLL=1 NO_UNIX_SOCKETS=1 NO_PYTHON=1 NATIVE_CRLF=1 COMPAT_OBJS="compat/mingw.o" EXTLIBS="-Wl,--as-needed -lmman -lws2_32 -lntdll -lz -lregex -lpcreposix -lpcre2-8 -liconv -lintl -lmingw32" &&
#     echo OK
####-lwin32fork



## fix configure (version >= 2.29.0)
#patch -ulbf configure << EOF
#@@ -5720,3 +5720,3 @@
# config_appended_defs="\$config_appended_defs\${newline}NEEDS_SOCKET=\${NEEDS_SOCKET}"
#-test -n "\$NEEDS_SOCKET" && LIBS="\$LIBS -lsocket"
#+test -n "\$NEEDS_SOCKET" && LIBS="\$LIBS -lws2_32"
#
#@@ -6186,4 +6186,4 @@
#
#-   ac_fn_c_check_type "\$LINENO" "socklen_t" "ac_cv_type_socklen_t" "#include <sys/types.h>
#-#include <sys/socket.h>
#+   ac_fn_c_check_type "\$LINENO" "socklen_t" "ac_cv_type_socklen_t" "#include <winsock2.h>
#+#include <wspiapi.h>
# "
#EOF



####See also: https://github.com/git-for-windows/git/releases
####See also: https://github.com/microsoft/git



#export NAME="Git"
#export STATUS=
#export URL=https://github.com/git-for-windows/git
#export BASENAME=git
#export DESCRIPTION="A fork of Git containing Windows-specific patches."
#export CATEGORY=development
#export TYPE=application
##export VERSION=2.33.0-2
##export VERSIONDATE=20211013
##export VERSION=2.34.0-1
##export VERSIONDATE=20211116
##export VERSION=2.34.0-1
##export VERSIONDATE=20211125
##export VERSION=2.34.1-1
##export VERSIONDATE=20211215
##export VERSION=2.35.0-1
##export VERSIONDATE=20220125
##export VERSION=2.35.1-1
##export VERSIONDATE=20220129
##export VERSION=2.35.2-1
##export VERSIONDATE=20220413
##export VERSION=2.35.3
##export VERSIONDATE=20220414
##export VERSION=2.36.0
##export VERSIONDATE=20220419
##export VERSION=2.36.1
##export VERSIONDATE=20220507
#export VERSION=2.37.0
#export VERSIONDATE=20220628
#wl-showstatus --package-version
#export DEPENDANCIES=pcre2,libiconv,expat,openssl,libcurl,tcl,tk
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
#export DOWNLOADURL="https://github.com/git-for-windows/git/releases"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=https://github.com/git-for-windows/git/archive/refs/tags/v$(echo $VERSION|sed -e "s/^\(.*\)\(-\([0-9]*\)\)$/\1.windows.\3/").tar.gz
#export DOWNLOADSOURCEURL=https://mirrors.edge.kernel.org/pub/software/scm/git/$BASENAME-$VERSION.tar.gz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#wl-showstatus extract
##tar xfz $TARBALLDIR/$BASENAME/v$(echo $VERSION|sed -e "s/^\(.*\)\(-\([0-9]*\)\)$/\1.windows.\3/").tar.gz
##cd $BASENAME-$(echo $VERSION|sed -e "s/^\(.*\)\(-\([0-9]*\)\)$/\1.windows.\3/")
#tar xfz $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
#cd $BASENAME-$VERSION
## remove detection of socklen_t from configure.ac (version >= 2.33.0-2)
#patch -ulbf configure.ac << EOF
#@@ -869,8 +869,2 @@
# #
#-TYPE_SOCKLEN_T
#-case \$ac_cv_type_socklen_t in
#-  yes) SOCKLEN_T='';;
#-  *)   SOCKLEN_T=\$git_cv_socklen_t_equiv;;
#-esac
#-GIT_CONF_SUBST([SOCKLEN_T])
#
#EOF
#wl-showstatus configure &&
# mkdir -p m4 &&
# autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-libpcre2 --with-python=$PYDIR/python.exe &&
# sed -i.bak -e "s/-Dsockaddr_storage=[^ ]*//" Makefile &&
# wl-showstatus build &&
# make &&
# wl-showstatus build-install &&
# make install-strip &&
#    echo OK
## #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$(echo $VERSION|sed -e "s/^\(.*\)\(-\([0-9]*\)\)$/\1.windows.\3/")
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



