export NAME="Liblinphone"
export STATUS=
export URL=http://linphone.org/
export BASENAME=liblinphone
export DESCRIPTION="Liblinphone is a high-level SIP library integrating all calling and instant messaging features into an unified easy-to-use API. It is the cross-platform VoIP library on which the Linphone application is based on, and that anyone can use to add audio and video calls or instant messaging capabilities to an application."
export CATEGORY=communication
export TYPE=library
#export VERSION=5.2.25
#export VERSIONDATE=20230222
#export VERSION=5.2.27
#export VERSIONDATE=20230227
#export VERSION=5.2.28
#export VERSIONDATE=20230227
#export VERSION=5.2.29
#export VERSIONDATE=20230303
#export VERSION=5.2.30
#export VERSIONDATE=20230308
#export VERSION=5.2.32
#export VERSIONDATE=20230311
#export VERSION=5.2.37
#export VERSIONDATE=20230318
#export VERSION=5.2.39
#export VERSIONDATE=20230323
#export VERSION=5.2.40
#export VERSIONDATE=20230324
#export VERSION=5.2.41
#export VERSIONDATE=20230327
#export VERSION=5.2.42
#export VERSIONDATE=20230328
#export VERSION=5.2.45
#export VERSIONDATE=20230330
#export VERSION=5.2.46
#export VERSIONDATE=20230331
#export VERSION=5.2.47
#export VERSIONDATE=20230404
#export VERSION=5.2.49
#export VERSIONDATE=20230406
#export VERSION=5.2.50
#export VERSIONDATE=20230407
#export VERSION=5.2.51
#export VERSIONDATE=20230414
#export VERSION=5.2.52
#export VERSIONDATE=20230426
#export VERSION=5.2.53
#export VERSIONDATE=20230428
#export VERSION=5.2.54
#export VERSIONDATE=20230503
#export VERSION=5.2.57
#export VERSIONDATE=20230506
#export VERSION=5.2.58
#export VERSIONDATE=20230510
#export VERSION=5.2.59
#export VERSIONDATE=20230511
#export VERSION=5.2.61
#export VERSIONDATE=20230517
#export VERSION=5.2.62
#export VERSIONDATE=20230523
#export VERSION=5.2.64
#export VERSIONDATE=20230525
#export VERSION=5.2.65
#export VERSIONDATE=20230530
#export VERSION=5.2.66
#export VERSIONDATE=20230531
#export VERSION=5.2.67
#export VERSIONDATE=20230531
#export VERSION=5.2.68
#export VERSIONDATE=20230606
#export VERSION=5.2.69
#export VERSIONDATE=20230607
#export VERSION=5.2.70
#export VERSIONDATE=20230610
#export VERSION=5.2.71
#export VERSIONDATE=20230613
#export VERSION=5.2.73
#export VERSIONDATE=20230614
#export VERSION=5.2.75
#export VERSIONDATE=20230615
#export VERSION=5.2.77
#export VERSIONDATE=20230620
#export VERSION=5.2.78
#export VERSIONDATE=20230627
#export VERSION=5.2.79
#export VERSIONDATE=20230627
#export VERSION=5.2.81
#export VERSIONDATE=20230628
#export VERSION=5.2.83
#export VERSIONDATE=20230630
#export VERSION=5.2.84
#export VERSIONDATE=20230704
#export VERSION=5.2.86
#export VERSIONDATE=20230704
#export VERSION=5.2.87
#export VERSIONDATE=20230710
#export VERSION=5.2.88
#export VERSIONDATE=20230710
#export VERSION=5.2.89
#export VERSIONDATE=20230714
#export VERSION=5.2.90
#export VERSIONDATE=20230717
#export VERSION=5.2.91
#export VERSIONDATE=20230718
#export VERSION=5.2.92
#export VERSIONDATE=20230720
#export VERSION=5.2.93
#export VERSIONDATE=20230725
#export VERSION=5.2.94
#export VERSIONDATE=20230729
#export VERSION=5.2.95
#export VERSIONDATE=20230809
#export VERSION=5.2.96
#export VERSIONDATE=20230821
#export VERSION=5.2.97
#export VERSIONDATE=20230822
#export VERSION=5.2.98
#export VERSIONDATE=20230824
#export VERSION=5.2.99
#export VERSIONDATE=20230902
#export VERSION=5.2.100
#export VERSIONDATE=20230905
#export VERSION=5.2.102
#export VERSIONDATE=20230908
#export VERSION=5.2.103
#export VERSIONDATE=20230912
#export VERSION=5.2.104
#export VERSIONDATE=20230918
#export VERSION=5.2.105
#export VERSIONDATE=20230919
#export VERSION=5.2.106
#export VERSIONDATE=20230920
#export VERSION=5.2.107
#export VERSIONDATE=20230922
#export VERSION=5.2.108
#export VERSIONDATE=20230926
#export VERSION=5.2.109
#export VERSIONDATE=20230929
#export VERSION=5.2.110
#export VERSIONDATE=20231021
#export VERSION=5.2.111
#export VERSIONDATE=20231030
#export VERSION=5.2.112
#export VERSIONDATE=20231208
#export VERSION=5.2.113
#export VERSIONDATE=20240214
#export VERSION=5.2.114
#export VERSIONDATE=20240307
#export VERSION=5.3.0
#export VERSIONDATE=20231221
#export VERSION=5.3.1
#export VERSIONDATE=20231222
####'pystache' python module not found
#export VERSION=5.3.2
#export VERSIONDATE=20231223
#export VERSION=5.3.4
#export VERSIONDATE=20231226
#export VERSION=5.3.5
#export VERSIONDATE=20231229
#export VERSION=5.3.6
#export VERSIONDATE=20240103
#export VERSION=5.3.7
#export VERSIONDATE=20240105
#export VERSION=5.3.8
#export VERSIONDATE=20240111
#export VERSION=5.3.9
#export VERSIONDATE=20240113
#export VERSION=5.3.10
#export VERSIONDATE=20240116
#export VERSION=5.3.11
#export VERSIONDATE=20240123
#export VERSION=5.3.13
#export VERSIONDATE=20240125
#export VERSION=5.3.14
#export VERSIONDATE=20240131
#export VERSION=5.3.16
#export VERSIONDATE=20240202
#export VERSION=5.3.17
#export VERSIONDATE=20240203
#export VERSION=5.3.18
#export VERSIONDATE=20240205
#export VERSION=5.3.21
#export VERSIONDATE=20240216
#export VERSION=5.3.22
#export VERSIONDATE=20240221
#export VERSION=5.3.23
#export VERSIONDATE=20240222
#export VERSION=5.3.24
#export VERSIONDATE=20240227
#export VERSION=5.3.25
#export VERSIONDATE=20240228
#export VERSION=5.3.26
#export VERSIONDATE=20240301
#export VERSION=5.3.27
#export VERSIONDATE=20240307
#export VERSION=5.3.29
#export VERSIONDATE=20240307
#export VERSION=5.3.30
#export VERSIONDATE=20240309
#export VERSION=5.3.32
#export VERSIONDATE=20240309
#export VERSION=5.3.34
#export VERSIONDATE=20240311
#export VERSION=5.3.35
#export VERSIONDATE=20240320
#export VERSION=5.3.36
#export VERSIONDATE=20240321
#export VERSION=5.3.37
#export VERSIONDATE=20240326
#export VERSION=5.3.38
#export VERSIONDATE=20240329
#export VERSION=5.3.39
#export VERSIONDATE=20240330
#export VERSION=5.3.40
#export VERSIONDATE=20240404
#export VERSION=5.3.41
#export VERSIONDATE=20240409
#export VERSION=5.3.42
#export VERSIONDATE=20240416
#export VERSION=5.3.44
#export VERSIONDATE=20240419
#export VERSION=5.3.45
#export VERSIONDATE=20240426
#export VERSION=5.3.46
#export VERSIONDATE=20240430
#export VERSION=5.3.48
#export VERSIONDATE=20240508
#export VERSION=5.3.49
#export VERSIONDATE=20240515
#export VERSION=5.3.50
#export VERSIONDATE=20240516
#export VERSION=5.3.51
#export VERSIONDATE=20240522
#export VERSION=5.3.52
#export VERSIONDATE=20240523
#export VERSION=5.3.53
#export VERSIONDATE=20240528
#export VERSION=5.3.54
#export VERSIONDATE=20240530
#export VERSION=5.3.55
#export VERSIONDATE=20240603
#export VERSION=5.3.56
#export VERSIONDATE=20240604
#export VERSION=5.3.57
#export VERSIONDATE=20240608
#export VERSION=5.3.58
#export VERSIONDATE=20240618
#export VERSION=5.3.60
#export VERSIONDATE=20240620
#export VERSION=5.3.61
#export VERSIONDATE=20240626
#export VERSION=5.3.62
#export VERSIONDATE=20240629
#export VERSION=5.3.63
#export VERSIONDATE=20240708
#export VERSION=5.3.66
#export VERSIONDATE=20240709
####src/sal/sal.h:367:17: error: 'belle_sip_stack_set_ip_version_preference' was not declared in this scope
#export VERSION=5.3.68
#export VERSIONDATE=20240710
#export VERSION=5.3.69
#export VERSIONDATE=20240712
#export VERSION=5.3.70
#export VERSIONDATE=20240716
#export VERSION=5.3.71
#export VERSIONDATE=20240717
#export VERSION=5.3.72
#export VERSIONDATE=20240725
#export VERSION=5.3.73
#export VERSIONDATE=20240725
#export VERSION=5.3.74
#export VERSIONDATE=20240726
#export VERSION=5.3.75
#export VERSIONDATE=20240808
#export VERSION=5.3.76
#export VERSIONDATE=20240813
#export VERSION=5.3.77
#export VERSIONDATE=20240821
#export VERSION=5.3.78
#export VERSIONDATE=20240823
#export VERSION=5.3.79
#export VERSIONDATE=20240903
#export VERSION=5.3.81
#export VERSIONDATE=20240907
#export VERSION=5.3.83
#export VERSIONDATE=20240913
export VERSION=5.3.84
export VERSIONDATE=20240918
wl-showstatus --package-version
export DEPENDENCIES=bctoolbox,libortp,libbzrtp,belr,belcard,mediastreamer2,lime,zlib,libjpeg-turbo,libxml2,xerces,sqlite3,soci,pystache,pysix,ffmpeg4,libdl
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=cmake,ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE.txt
export LICENSETYPE=AGPL
export DOWNLOADURL="https://github.com/BelledonneCommunications/liblinphone/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/BelledonneCommunications/liblinphone/archive/refs/tags/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix undefined DOMDocument in libxsd/xsd/cxx/xml/dom/serialization-source.txx (version >= 5.2.84)
patch -ulbf libxsd/xsd/cxx/xml/dom/serialization-source.txx << EOF
@@ -274,3 +274,3 @@

-          XSD_DOM_AUTO_PTR<DOMDocument> doc (
+          XSD_DOM_AUTO_PTR<xercesc::DOMDocument> doc (
             impl->createDocument (
EOF
# fix missing ppltasks.h in src/core/paths/paths-windows.cpp (version >= 5.2.84)
patch -ulbf src/core/paths/paths-windows.cpp << EOF
@@ -29,3 +29,5 @@
 #include "linphone/api/c-factory.h"
+#ifndef __MINGW32__
 #include <ppltasks.h>
+#endif

EOF
# fix unsresolved _com_util::ConvertBSTRToString in src/core/paths/paths-windows.cpp (version >= 5.3.1)
patch -ulbf src/core/paths/paths-windows.cpp << EOF
@@ -68,3 +68,4 @@
        if (SHGetKnownFolderPath(id, KF_FLAG_DONT_VERIFY, 0, &path) == S_OK) {
-               strPath = _bstr_t(path);
+               wstring wstrPath = path;
+               strPath = string(wstrPath.begin(), wstrPath.end());
                replace(strPath.begin(), strPath.end(), '\\\\', '/');
EOF
# fix coreapi/lpc2xml.c (version >= 5.3.58)
####coreapi/lpc2xml.c:299:9: error: 'xmlSetGenericErrorFunc' was not declared in this scope
#### Bug reported here: https://github.com/BelledonneCommunications/liblinphone/pull/243
patch -ulbf coreapi/lpc2xml.c << EOF
@@ -23,2 +23,3 @@
 #include <libxml/xmlversion.h>
+#include <libxml/xmlerror.h>
 #include <string.h>
EOF
# avoid undefined belle_sip_stack_set_ip_version_preference() in src/sal/sal.h (version >= 5.3.68)
patch -ulbf src/sal/sal.h << EOF
@@ -366,3 +366,3 @@
        void setIpv6Preference(bool value) {
-               belle_sip_stack_set_ip_version_preference(mStack, value ? AF_INET6 : AF_INET);
+               //belle_sip_stack_set_ip_version_preference(mStack, value ? AF_INET6 : AF_INET);
        }
EOF
# build with C++17
sed -i.bak -e "s/\(set(CMAKE_CXX_STANDARD \)14\()\)/\117\2/" CMakeLists.txt
# fix error: IMPORTED_LOCATION not set for imported target
sed -i.bak -e "s/WIN32/MSVC/" $(grep -l WIN32 cmake/*.cmake)
# avoid using libdl in CMakeLists.txt (version >= 5.3.4)
patch -ulbf CMakeLists.txt << EOF
@@ -103,3 +103,5 @@

+if(NOT WIN32)
 check_library_exists("dl" "dlopen" "" HAVE_DLOPEN)
+endif()

EOF
mkdir -p build_static build_shared &&
 wl-showstatus configure &&
 #PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_static &&
 #PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-fdiagnostics-color=always" -S. -Bbuild_static &&
 C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/share/libjpeg-turbo/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DENABLE_QRCODE:BOOL=OFF -DENABLE_CXX_WRAPPER:BOOL=OFF -DENABLE_CSHARP_WRAPPER:BOOL=OFF -DENABLE_JAVA_WRAPPER:BOOL=OFF -DENABLE_SWIFT_WRAPPER:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-fdiagnostics-color=always -fpermissive" -S. -Bbuild_static &&
 #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/share/libjpeg-turbo/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=OFF -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DENABLE_QRCODE:BOOL=OFF -DENABLE_CXX_WRAPPER:BOOL=OFF -DENABLE_CSHARP_WRAPPER:BOOL=OFF -DENABLE_JAVA_WRAPPER:BOOL=OFF -DENABLE_SWIFT_WRAPPER:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-I$MINGWPREFIX/include/libdl-win32 -fdiagnostics-color=always -fpermissive" -S. -Bbuild_static &&
 # -I$(cygpath -m $MINGWPREFIX/include/libdl-win32)
 #-DPKG_CONFIG_EXECUTABLE:FILEPATH=$(which pkg-config.exe) 
 # fix missing link libraries
 sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.*$/& -Wl,--as-needed -lopengl32 -lmfcore -lmfuuid -lmfplat -lmfreadwrite/" build_static/build.ninja &&
 ## avoid using libdl (version <= 5.3.2)
 #echo "#undef HAVE_DLOPEN" >> build_static/config.h &&
 wl-showstatus configure &&
 #PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -S. -Bbuild_shared &&
 #PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-fdiagnostics-color=always" -S. -Bbuild_shared &&
 C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/share/libjpeg-turbo/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DENABLE_QRCODE:BOOL=OFF -DENABLE_CXX_WRAPPER:BOOL=OFF -DENABLE_CSHARP_WRAPPER:BOOL=OFF -DENABLE_JAVA_WRAPPER:BOOL=OFF -DENABLE_SWIFT_WRAPPER:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-fdiagnostics-color=always -fpermissive" -S. -Bbuild_shared &&
 #C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include:$MINGWPREFIX/share/libjpeg-turbo/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$PATH PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DBUILD_SHARED_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=OFF -DENABLE_UPDATE_CHECK:BOOL=OFF -DENABLE_STRICT:BOOL=OFF -DENABLE_DAEMON:BOOL=OFF -DENABLE_FLEXIAPI:BOOL=OFF -DENABLE_LDAP:BOOL=OFF -DENABLE_QRCODE:BOOL=OFF -DENABLE_CXX_WRAPPER:BOOL=OFF -DENABLE_CSHARP_WRAPPER:BOOL=OFF -DENABLE_JAVA_WRAPPER:BOOL=OFF -DENABLE_SWIFT_WRAPPER:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DTURBOJPEG_INCLUDE_DIRS:PATH=$MINGWPREFIX/share/libjpeg-turbo/include -DTURBOJPEG_LIBRARIES:PATH="-L$MINGWPREFIX/share/libjpeg-turbo/lib -lturbojpeg" -DFFMpeg_TARGETS:STRING="avcodec -lavutil -lswscale -L$(cygpath -m $MINGWPREFIX/ffmpeg4/lib) -lbcg729" -DFFMpeg_avcodec_TARGET:STRING=avcodec -DFFMpeg_avutil_TARGET:STRING=avutil -DFFMpeg_swscale_TARGET:STRING=swscale -DENABLE_TUTORIALS:BOOL=OFF -DENABLE_DOC:BOOL=OFF -DENABLE_UNIT_TESTS:BOOL=OFF -DPYTHON_EXECUTABLE:FILEPATH=$PYDIR/python.exe -DCMAKE_CXX_FLAGS="-I$MINGWPREFIX/include/libdl-win32 -fdiagnostics-color=always -fpermissive" -S. -Bbuild_shared &&
 ## fix execution of Python scripts
 #sed -i.bak -e "s?\(COMMAND\|POST_BUILD\)\( *=.*\&\& *\)\([^ ]*\)\(\.py\|glib-mkenums\|glib-genmarshal\|g-ir-scanner\)\( \)?\1\2$(echo $PYDIR/python.exe|sed -e "s?^/\([a-zA-Z]\)/?\1:\\\\\\\\?; s?/?\\\\\\\\?g") \3\4\5?" build_*/build.ninja &&
 # fix missing link libraries
 sed -i.bak -e "s/^\s*LINK_LIBRARIES\s*=.*$/& -Wl,--as-needed -lopengl32 -lmfcore -lmfuuid -lmfplat -lmfreadwrite/" build_shared/build.ninja &&
 ## avoid using libdl (version <= 5.3.2)
 #echo "#undef HAVE_DLOPEN" >> build_shared/config.h &&
 wl-showstatus build-install &&
 PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_static install/strip &&
 wl-showstatus build-install &&
 PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_shared install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



