export NAME="pngcrush"
export STATUS=
export URL=http://pmt.sourceforge.net/pngcrush/index.html
export BASENAME=pngcrush
export DESCRIPTION="pngcrush and other tools for manipulating PNG (Portable Network Graphics) and MNG (Multiple-image Network Graphics) files."
export CATEGORY=graphics
export TYPE=application
#export VERSION=1.6.20
#export VERSIONDATE=20110924
#export VERSION=1.7.17
#export VERSIONDATE=20110924
#export VERSION=1.7.18
#export VERSIONDATE=20111014
#export VERSION=1.7.20
#export VERSIONDATE=20111014
#export VERSION=1.7.21
#export VERSIONDATE=20111108
#export VERSION=1.7.22
#export VERSIONDATE=20111208
#export VERSION=1.7.23
#export VERSIONDATE=20120107
#export VERSION=1.7.24
#export VERSIONDATE=20120110
#export VERSION=1.7.25
#export VERSIONDATE=20120219
#export VERSION=1.7.26
#export VERSIONDATE=20120329
#export VERSION=1.7.27
#export VERSIONDATE=20120414
#export VERSION=1.7.28
#export VERSIONDATE=20120524
#export VERSION=1.7.29
#export VERSIONDATE=20120604
#export VERSION=1.7.30
#export VERSIONDATE=20120615
#export VERSION=1.7.31
#export VERSIONDATE=20120703
#export VERSION=1.7.32
#export VERSIONDATE=20120724
#export VERSION=1.7.33
#export VERSIONDATE=20120724
#export VERSION=1.7.34
#export VERSIONDATE=20120728
#export VERSION=1.7.35
#export VERSIONDATE=20120731
#export VERSION=1.7.37
#export VERSIONDATE=20120901
#export VERSION=1.7.38
#export VERSIONDATE=20120929
#export VERSION=1.7.39
#export VERSIONDATE=20121015
#export VERSION=1.7.40
#export VERSIONDATE=20121016
#export VERSION=1.7.41
#export VERSIONDATE=20121024
#export VERSION=1.7.43
#export VERSIONDATE=20130112
#export VERSION=1.7.44
#export VERSIONDATE=20130124
#export VERSION=1.7.46
#export VERSIONDATE=20130131
#export VERSION=1.7.47
#export VERSIONDATE=20130203
#export VERSION=1.7.48
#export VERSIONDATE=20130210
#export VERSION=1.7.49
#export VERSIONDATE=20130213
#export VERSION=1.7.50
#export VERSIONDATE=20130214
#export VERSION=1.7.51
#export VERSIONDATE=20130217
#export VERSION=1.7.52
#export VERSIONDATE=20130305
#export VERSION=1.7.53
#export VERSIONDATE=20130310
#export VERSION=1.7.54
#export VERSIONDATE=20130325
#export VERSION=1.7.55
#export VERSIONDATE=20130401
#export VERSION=1.7.56
#export VERSIONDATE=20130403
#export VERSION=1.7.57
#export VERSIONDATE=20130407
#export VERSION=1.7.58
#export VERSIONDATE=20130411
#export VERSION=1.7.59
#export VERSIONDATE=20130525
#export VERSION=1.7.60
#export VERSIONDATE=20130608
#export VERSION=1.7.61
#export VERSIONDATE=20130612
#export VERSION=1.7.62
#export VERSIONDATE=20130613
#export VERSION=1.7.63
#export VERSIONDATE=20130615
#export VERSION=1.7.64
#export VERSIONDATE=20130627
#export VERSION=1.7.65
#export VERSIONDATE=20130630
#export VERSION=1.7.66
#export VERSIONDATE=20130717
#export VERSION=1.7.67
#export VERSIONDATE=20130803
#export VERSION=1.7.69
#export VERSIONDATE=20131107
#export VERSION=1.7.70
#export VERSIONDATE=20131223
#export VERSION=1.7.71
#export VERSIONDATE=20140208
#export VERSION=1.7.72
#export VERSIONDATE=20140307
#export VERSION=1.7.73
#export VERSIONDATE=20140316
#export VERSION=1.7.74
#export VERSIONDATE=20140606
#export VERSION=1.7.75
#export VERSIONDATE=20140607
#export VERSION=1.7.76
#export VERSIONDATE=20140613
#export VERSION=1.7.77
#export VERSIONDATE=20140823
#export VERSION=1.7.78
#export VERSIONDATE=20141023
#export VERSION=1.7.79
#export VERSIONDATE=20141103
#export VERSION=1.7.78
#export VERSIONDATE=20141104
#export VERSION=1.7.81
#export VERSIONDATE=20141122
#export VERSION=1.7.82
#export VERSIONDATE=20141223
#export VERSION=1.7.83
#export VERSIONDATE=20150129
#export VERSION=1.7.84
#export VERSIONDATE=20150301
#export VERSION=1.7.85
#export VERSIONDATE=20150310
#export VERSION=1.7.86
#export VERSIONDATE=20150811
#export VERSION=1.7.87
#export VERSIONDATE=20151011
#export VERSION=1.7.88
#export VERSIONDATE=20151113
#export VERSION=1.7.91
#export VERSIONDATE=20160101
#export VERSION=1.8.0
#export VERSIONDATE=20160119
#export VERSION=1.8.1
#export VERSIONDATE=20160411
#export VERSION=1.8.2
#export VERSIONDATE=20160712
#export VERSION=1.8.4
#export VERSIONDATE=20160810
#export VERSION=1.8.5
#export VERSIONDATE=20160823
#export VERSION=1.8.6
#export VERSIONDATE=20160905
#export VERSION=1.8.7
#export VERSIONDATE=20160926
#export VERSION=1.8.8
#export VERSIONDATE=20161008
#export VERSION=1.8.9
#export VERSIONDATE=20161024
#export VERSION=1.8.10
#export VERSIONDATE=20161029
#export VERSION=1.8.11
#export VERSIONDATE=20170116
#export VERSION=1.8.12
#export VERSIONDATE=20170816
export VERSION=1.8.13
export VERSIONDATE=20170830
wl-showstatus --package-version
export DEPENDANCIES=zlib
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=
export LICENSETYPE=
export DOWNLOADURL="http://sourceforge.net/projects/pmt/files/pngcrush/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/pmt/pngcrush/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$VERSION/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/pmt/pngcrush/$VERSION/$BASENAME-$VERSION.tar.bz2
export DOWNLOADSOURCEURL=http://downloads.sourceforge.net/project/pmt/pngcrush/$VERSION/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
## fix missing __int64 in adler32.c (version >= 1.7.26 <= 1.7.91)
#mv adler32.c adler32.c.bak
#echo "#include <sys/types.h>" > adler32.c
#cat adler32.c.bak >> adler32.c
# fix redefinition of ptrdiff_t in zutil.h (version >= 1.7.26 <= 1.7.91 >= 1.8.10)
patch -ulbf zutil.h << EOF
--- zutil.h  2012-02-23 15:25:26 +0100
+++ zutil.h  2012-03-29 19:07:12 +0200
@@ -32 +32 @@
-#ifdef Z_SOLO
+#if defined(Z_SOLO) && !defined(__MINGW32__)
EOF
# fix undefined clock_gettime in pngcrush.c (version >= 1.8.5)
patch -ulbf pngcrush.c << EOF
--- pngcrush.c  2016-08-23 20:01:49.495608400 +0200
+++ pngcrush.c  2016-08-23 20:02:04.730207400 +0200
@@ -1411,3 +1411,3 @@
 #    define PNGCRUSH_USE_CLOCK_GETTIME 1
-#  elif defined(CLOCK_MONOTONIC) /* Linux & FreeBSD */
+#  elif defined(CLOCK_MONOTONIC) && !defined(__MINGW32__) /* Linux & FreeBSD */
 #    define
EOF
# fix linking with -lrt (version >= 1.8.4)
sed -i.bak -e "s/-lrt//; s/-DPNGCRUSH_TIMERS=3//" Makefile
wl-showstatus build &&
 #make -f Makefile-nolib LIBS="-lpng -lz" &&
 ( make E=.exe || ( mv zutil.h.orig zutil.h && make E=.exe ) ) &&
 wl-showstatus build-install &&
 mkdir -p $INSTALLPREFIX/bin &&
 cp -f *.exe $INSTALLPREFIX/bin/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



