export NAME="mono"
export STATUS=
export URL=http://mono-project.com/
export BASENAME=mono
export DESCRIPTION="An open source, cross-platform, implementation of C# and the CLR that is binary compatible with Microsoft.NET"
export CATEGORY=
export TYPE=library
#export VERSION=2.8
#export VERSIONDATE=20101014
#export VERSION=2.10.9
#export VERSIONDATE=20130120
#export VERSION=3.0.4
#export VERSIONDATE=20130223
#export VERSION=3.0.5
#export VERSIONDATE=20130227
####configure: error: C compiler cannot create executables
#export VERSION=3.0.6
#export VERSIONDATE=20130228
#export VERSION=3.0.7
#export VERSIONDATE=20130316
#export VERSION=3.0.10
#export VERSIONDATE=20130427
#export VERSION=3.0.11
#export VERSIONDATE=20130618
#export VERSION=3.0.12
#export VERSIONDATE=20130619
#export VERSION=3.1.2
#export VERSIONDATE=20130719
#export VERSION=3.2.0
#export VERSIONDATE=20130725
#export VERSION=3.2.1
#export VERSIONDATE=20130803
#export VERSION=3.2.3
#export VERSIONDATE=20130918
#export VERSION=3.2.5
#export VERSIONDATE=20131125
####checking host platform characteristics... configure: error: Don't set CC. mono can only be compiled with gcc-3 from the 'gcc-core' package
#export VERSION=3.2.6
#export VERSIONDATE=20140119
#export VERSION=3.2.8
#export VERSIONDATE=20140221
#export VERSION=3.4.0
#export VERSIONDATE=20140402
#export VERSION=3.6.0
#export VERSIONDATE=20140813
#export VERSION=3.8.0
#export VERSIONDATE=20140906
#export VERSION=3.10.0
#export VERSIONDATE=20141005
#export VERSION=3.12.0
#export VERSIONDATE=20150113
#export VERSION=3.12.1
#export VERSIONDATE=20150307
#export VERSION=4.0.1
#export VERSIONDATE=20150427
#export VERSION=4.0.1.28
#export VERSIONDATE=20150509
#export VERSION=4.0.1.34
#export VERSIONDATE=20150515
#export VERSION=4.0.1.43
#export VERSIONDATE=20150521
#export VERSION=4.0.1.44
#export VERSIONDATE=20150529
#export VERSION=4.0.2.4
#export VERSIONDATE=20150611
#export VERSION=4.0.2.5
#export VERSIONDATE=20150624
#export VERSION=4.0.3.13
#export VERSIONDATE=20150720
#export VERSION=4.0.3.19
#export VERSIONDATE=20150725
#export VERSION=4.0.3.20
#export VERSIONDATE=20150811
####configure: creating ./config.status
####config.status: error: cannot find input file: `po/mcs/Makefile.in.in'
#export VERSION=4.0.4.1
#export VERSIONDATE=20150826
#export VERSION=4.0.5.1
#export VERSIONDATE=20151111
#export VERSION=4.2.0.179
#export VERSIONDATE=20150826
####make[3]: *** No rule to make target '../../mono/metadata/libmonoruntime-static.a
#export VERSION=4.2.0.207
#export VERSIONDATE=20150903
#export VERSION=4.2.1.36
#export VERSIONDATE=20150925
####mono/metadata/threadpool-ms-io-poll.c:16:1: error: unknown type name 'WSAPOLLFD'
####mono/metadata/sgen-os-win32.c:64:23: error: 'MonoContext' has no member named 'rip'
#export VERSION=4.2.1.60
#export VERSIONDATE=20151006
####mono/metadata/sgen-os-win32.c:64:23: error: 'MonoContext' has no member named 'rip'
#export VERSION=4.2.1.91
#export VERSIONDATE=20151101
#export VERSION=4.2.1.102
##export VERSIONDATE=20151113
#export VERSION=4.2.1.124
#export VERSIONDATE=20151209
#export VERSION=4.2.2.10
#export VERSIONDATE=20151220
#export VERSION=4.2.2.30
#export VERSIONDATE=20160405
#export VERSION=4.2.2.44
#export VERSIONDATE=20160610
#export VERSION=4.4.0.40
#export VERSIONDATE=20160405
#export VERSION=4.4.0.122
#export VERSIONDATE=20160413
#export VERSION=4.4.0.148
#export VERSIONDATE=20160429
#export VERSION=4.4.0.182
#export VERSIONDATE=20160610
#export VERSION=4.4.1.0
#export VERSIONDATE=20160623
#export VERSION=4.4.1.7
#export VERSIONDATE=20180122
#export VERSION=4.4.2.4
#export VERSIONDATE=20160721
#export VERSION=4.4.2.8
#export VERSIONDATE=20160726
#export VERSION=4.4.2.11
#export VERSIONDATE=20160729
#export VERSION=4.6.0.125
#export VERSIONDATE=20160803
#export VERSION=4.6.0.150
#export VERSIONDATE=20160823
#export VERSION=4.6.0.165
#export VERSIONDATE=20160825
#export VERSION=4.6.0.182
#export VERSIONDATE=20160901
#export VERSION=4.6.0.243
#export VERSIONDATE=20160909
#export VERSION=4.6.0.245
#export VERSIONDATE=20160915
#export VERSION=4.6.1.3
#export VERSIONDATE=20160928
#export VERSION=4.6.1.5
#export VERSIONDATE=20161012
#export VERSION=4.6.2.6
#export VERSIONDATE=20161103
#export VERSION=4.6.2.7
#export VERSIONDATE=20161115
#export VERSION=4.6.2.16
#export VERSIONDATE=20170104
####libgc/win32_threads.c:212: undefined reference to `GC_get_max_thread_index'
#export VERSION=4.8.0.309
#export VERSIONDATE=20161111
#export VERSION=4.8.0.344
#export VERSIONDATE=20161116
####make[2]: *** No rule to make target 'mono-package-runtime', needed by 'all-am'.
#export VERSION=4.8.0.371
#export VERSIONDATE=20161129
#export VERSION=4.8.0.374
#export VERSIONDATE=20161206
#export VERSION=4.8.0.382
#export VERSIONDATE=20161216
#export VERSION=4.8.0.395
#export VERSIONDATE=20170104
#export VERSION=4.8.0.425
#export VERSIONDATE=20170109
#export VERSION=4.8.0.429
#export VERSIONDATE=20170114
#export VERSION=4.8.0.459
#export VERSIONDATE=20170120
#export VERSION=4.8.0.472
#export VERSIONDATE=20170124
#export VERSION=4.8.0.478
#export VERSIONDATE=20170131
#export VERSION=4.8.0.483
#export VERSIONDATE=20170208
#export VERSION=4.8.0.489
#export VERSIONDATE=20170216
#export VERSION=4.8.0.495
#export VERSIONDATE=20170224
#export VERSION=4.8.0.520
#export VERSIONDATE=20170323
#export VERSION=4.8.0.524
#export VERSIONDATE=20170329
####last version to compile with classic MinGW
#export VERSION=4.8.1.0
#export VERSIONDATE=20170414
#export VERSION=5.0.0.48
#export VERSIONDATE=20170414
#export VERSION=5.0.0.61
#export VERSIONDATE=20170421
#export VERSION=5.0.0.78
#export VERSIONDATE=20170430
#export VERSION=5.0.0.94
#export VERSIONDATE=20170507
#export VERSION=5.0.0.100
#export VERSIONDATE=20170514
####eglib/src/gmodule-win32.c:35:37: fatal error: gmodule-win32-internals.h: No such file or directory
#export VERSION=5.0.1.1
#export VERSIONDATE=20170528
#export VERSION=5.2.0.104
#export VERSIONDATE=20170616
#export VERSION=5.2.0.175
#export VERSIONDATE=20170608
#export VERSION=5.2.0.179
#export VERSIONDATE=20170624
#export VERSION=5.2.0.196
#export VERSIONDATE=20170701
#export VERSION=5.2.0.209
#export VERSIONDATE=20170724
#export VERSION=5.2.0.215
#export VERSIONDATE=20170816
#export VERSION=5.2.0.224
#export VERSIONDATE=20170922
#export VERSION=5.4.0.56
#export VERSIONDATE=20170624
#export VERSION=5.4.0.135
#export VERSIONDATE=20170816
#export VERSION=5.4.0.167
#export VERSIONDATE=20170822
#export VERSION=5.4.0.199
#export VERSIONDATE=20170929
#export VERSION=5.4.0.201
#export VERSIONDATE=20171006
#export VERSION=5.4.1.6
#export VERSIONDATE=20171111
#export VERSION=5.8.0.22
#export VERSIONDATE=20171020
#export VERSION=5.8.0.88
#export VERSIONDATE=20171203
#export VERSION=5.8.0.108
#export VERSIONDATE=20180122
#export VERSION=5.8.0.127
#export VERSIONDATE=20180220
#export VERSION=5.8.0.129
#export VERSIONDATE=20180306
#export VERSION=5.9.0.398
#export VERSIONDATE=20171118
#export VERSION=5.9.0.453
#export VERSIONDATE=20171126
#export VERSION=5.9.0.569
#export VERSIONDATE=20171202
#export VERSION=5.10.0.53
#export VERSIONDATE=20180129
#export VERSION=5.10.0.79
#export VERSIONDATE=20180205
#export VERSION=5.10.0.103
#export VERSIONDATE=20180213
#export VERSION=5.10.0.129
#export VERSIONDATE=20180220
#export VERSION=5.10.0.140
#export VERSIONDATE=20180227
#export VERSION=5.10.0.157
#export VERSIONDATE=20180306
#export VERSION=5.10.0.172
#export VERSIONDATE=20180314
#export VERSION=5.10.0.179
#export VERSIONDATE=20180321
#export VERSION=5.10.1.2
#export VERSIONDATE=20180321
#export VERSION=5.10.1.16
#export VERSIONDATE=20180328
#export VERSION=5.10.1.32
#export VERSIONDATE=20180405
#export VERSION=5.10.1.47
#export VERSIONDATE=20180422
#export VERSION=5.11.0.15
#export VERSIONDATE=20171210
#export VERSION=5.11.0.49
#export VERSIONDATE=20171217
####mono/utils/os-event-win32.c:83:18: error: expected ')' before numeric constant
#export VERSION=5.11.0.119
#export VERSIONDATE=20171224
#export VERSION=5.11.0.124
#export VERSIONDATE=20171224
#export VERSION=5.12.0.226
#export VERSIONDATE=20180521
#export VERSION=5.12.0.301
#export VERSIONDATE=20180721
#export VERSION=5.12.0.309
#export VERSIONDATE=20181026
#export VERSION=5.14.0.177
#export VERSIONDATE=20180812
#export VERSION=5.10.1.57
#export VERSIONDATE=20180827
#export VERSION=5.16.0.179
#export VERSIONDATE=20181010
#export VERSION=5.16.0.220
#export VERSIONDATE=20181130
#export VERSION=5.16.1.0
#export VERSIONDATE=20190318
####configure.ac:4734: error: required file 'mono/utils/jemalloc/Makefile.in' not found
#export VERSION=5.18.0.225
#export VERSIONDATE=20181222
#export VERSION=5.18.0.240
#export VERSIONDATE=20190124
#export VERSION=5.18.0.268
#export VERSIONDATE=20190303
#export VERSION=5.18.1.0
#export VERSIONDATE=20190318
#export VERSION=5.18.1.3
#export VERSIONDATE=20190412
#export VERSION=5.18.1.28
#export VERSIONDATE=20190717
#export VERSION=5.20.1.19
#export VERSIONDATE=20190414
#export VERSION=5.20.1.27
#export VERSIONDATE=20190428
#export VERSION=5.20.1.34
#export VERSIONDATE=20190717
#export VERSION=6.0.0.313
#export VERSIONDATE=20190734
#export VERSION=6.0.0.319
#export VERSIONDATE=20190808
#export VERSION=6.0.0.327
#export VERSIONDATE=20190903
#export VERSION=6.0.0.334
#export VERSIONDATE=20190918
####mono/utils/mono-rand-windows.c:71: undefined reference to `BCryptGenRandom'
#export VERSION=6.4.0.198
#export VERSIONDATE=20190925
#export VERSION=6.6.0.161
#export VERSIONDATE=20191213
#export VERSION=6.6.0.166
#export VERSIONDATE=20200303
####mono/utils/mono-error.c:91: undefined reference to `mono_gchandle_get_target_internal'
#export VERSION=6.8.0.96
#export VERSIONDATE=20200118
#export VERSION=6.8.0.105
#export VERSIONDATE=20200209
#export VERSION=6.8.0.123
#export VERSIONDATE=20200515
####mono/mini/intrinsics.c:733: undefined reference to `mono_gc_is_moving'
#export VERSION=6.10.0.104
#export VERSIONDATE=20200627
#export VERSION=6.12.0.90
#export VERSIONDATE=20200910
#export VERSION=6.12.0.107
#export VERSIONDATE=20201215
#export VERSION=6.12.0.122
#export VERSIONDATE=20210223
export VERSION=6.12.0.182
export VERSIONDATE=20220615
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING.LIB
export LICENSETYPE=GPL
#export DOWNLOADURL="http://www.mono-project.com/OldReleases"
#export DOWNLOADURL="http://download.mono-project.com/sources/mono-1.1/"
#export DOWNLOADURL="http://download.mono-project.com/sources/"
export DOWNLOADURL="http://download.mono-project.com/sources/mono/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.novell.com/pub/mono/sources/mono/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://download.mono-project.com/sources/mono-1.1/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://download.mono-project.com/sources/mono-1.1/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=http://download.mono-project.com/sources/mono/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
#cd $BASENAME-$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\.[0-9]*\)\..*$/\1/")
# fix missing __BEGIN_DECLS in mono/utils/sha1.h
patch -ulbf mono/utils/sha1.h << EOF
--- mono/utils/sha1.h  2014-10-04 11:27:44 +0200
+++ mono/utils/sha1.h  2014-10-05 22:17:00 +0200
@@ -23,3 +23,5 @@

+#ifdef __BEGIN_DECLS
 __BEGIN_DECLS
+#endif
 void SHA1Init(SHA1_CTX *);
@@ -33,3 +35,5 @@
 char *SHA1Data(const guint8 *, size_t, char *);
+#ifdef __BEGIN_DECLS
 __END_DECLS
+#endif

EOF
# fix libgc/include/private/gcconfig.h for 64-bit
if ( echo $RUNPLATFORM | grep -q x86_64 ); then
patch -ulbf libgc/include/private/gcconfig.h << EOF
--- libgc/include/private/gcconfig.h  2014-09-22 15:23:06.000000000 +0200
+++ libgc/include/private/gcconfig.h  2014-10-09 21:18:08.000000000 +0200
@@ -1 +1,4 @@
+#ifdef X86_64
+#undef I386
+#endif
 /*
@@ -457,3 +460,7 @@
 # if defined(__MINGW32__)
-#   define I386
+#   if defined(__MINGW64__)
+#     define X86_64
+#   else
+#     define I386
+#   endif
 #   define MSWIN32
EOF
fi
# fix libgc/mark.c for 64-bit
if ( echo $RUNPLATFORM | grep -q x86_64 ); then
patch -ulbf libgc/mark.c << EOF
--- libgc/mark.c  2014-09-22 15:23:06.000000000 +0200
+++ libgc/mark.c  2014-10-09 21:25:08.000000000 +0200
@@ -403,5 +403,5 @@


-#ifdef MSWIN32
+#if defined(MSWIN32) && !defined(__MINGW64__)

 # ifdef __GNUC__
EOF
fi
## fix libgc/mark.c for 64-bit (version <= 3.12.0)
#patch -ulbf libgc/mark.c << EOF
#--- libgc/mark.c  2014-10-30 23:11:01.000000000 +0100
#+++ libgc/mark.c  2015-02-12 14:05:49.825073500 +0100
#@@ -268,5 +268,5 @@
# /* We hold the allocation lock.  In the case of        */
# /* incremental collection, the world may not be stopped.*/
#-#ifdef MSWIN32
#+#if defined(MSWIN32) && !defined(__MINGW64__)
#   /* For win32, this is called after we establish a structured */
#   /* exception handler, in case Windows unmaps one of our root */
#@@ -403,5 +403,5 @@
#
#
#-#ifdef MSWIN32
#+#if defined(MSWIN32) && !defined(__MINGW64__)
#
# # ifdef __GNUC__
#@@ -1232,5 +1232,5 @@
#     register struct hblk * h;
#
#-    bottom = (ptr_t)(((long) bottom + ALIGNMENT-1) & ~(ALIGNMENT-1));
#+    bottom = (ptr_t)(((intptr_t) bottom + ALIGNMENT-1) & ~(ALIGNMENT-1));
#     top = (ptr_t)(((long) top) & ~(ALIGNMENT-1));
#
#EOF
## fix libgc/mark.c for 64-bit (version >= 3.12.1 <= 3.12.1)
#patch -ulbf libgc/mark.c << EOF
#--- libgc/mark.c  2014-10-30 23:11:02 +0100
#+++ libgc/mark.c  2015-03-07 18:01:00 +0100
#@@ -19,2 +19,3 @@
# # include <stdio.h>
#+# include <stdint.h>
# # include "private/gc_pmark.h"
#@@ -269,3 +270,3 @@
# /* incremental collection, the world may not be stopped.*/
#-#ifdef MSWIN32
#+#if defined(MSWIN32) && !defined(__MINGW64__)
#   /* For win32, this is called after we establish a structured */
#@@ -404,3 +405,3 @@
#
#-#ifdef MSWIN32
#+#if defined(MSWIN32) && !defined(__MINGW64__)
#
#@@ -1233,3 +1234,3 @@
#
#-    bottom = (ptr_t)(((long) bottom + ALIGNMENT-1) & ~(ALIGNMENT-1));
#+    bottom = (ptr_t)(((intptr_t) bottom + ALIGNMENT-1) & ~(ALIGNMENT-1));
#     top = (ptr_t)(((long) top) & ~(ALIGNMENT-1));
#
#EOF
# fix missing GC_mark_some in libgc/mark.c (version >= 4.0.1)
patch -ulbf libgc/mark.c << EOF
--- libgc/mark.c  2015-04-28 09:36:07.131377500 +0200
+++ libgc/mark.c  2015-04-28 10:12:23.344176800 +0200
@@ -265,11 +265,11 @@
 /* remains valid until all marking is complete.                */
 /* A zero value indicates that it's OK to miss some    */
 /* register values.                                    */
 /* We hold the allocation lock.  In the case of        */
 /* incremental collection, the world may not be stopped.*/
-#ifdef MSWIN32
+#if defined(MSWIN32) && !defined(__MINGW64__)
   /* For win32, this is called after we establish a structured */
   /* exception handler, in case Windows unmaps one of our root */
   /* segments.  See below.  In either case, we acquire the     */
   /* allocator lock long before we get here.                   */
   GC_bool GC_mark_some_inner(cold_gc_frame)
EOF
# fix libgc/include/private/gc_hdrs.h for 64-bit
if ( echo $RUNPLATFORM | grep -q x86_64 ); then
patch -ulbf libgc/include/private/gc_hdrs.h << EOF
--- libgc/include/private/gc_hdrs.h  2014-09-22 15:23:05.000000000 +0200
+++ libgc/include/private/gc_hdrs.h  2015-02-12 13:34:07.118233200 +0100
@@ -227,3 +227,3 @@
 /* beginning of the block or NIL?                                      */
-# define IS_FORWARDING_ADDR_OR_NIL(hhdr) ((unsigned long) (hhdr) <= MAX_JUMP)
+# define IS_FORWARDING_ADDR_OR_NIL(hhdr) ((uintptr_t) (hhdr) <= MAX_JUMP)

EOF
fi
## fix mono/metadata/sgen-os-win32.c for 64-bit (version >= 4.2.0)
#patch -ulbf mono/metadata/sgen-os-win32.c << EOF
#--- mono/metadata/sgen-os-win32.c  2015-11-12 10:00:29.000000000 +0100
#+++ mono/metadata/sgen-os-win32.c  2015-12-09 18:40:16.119255600 +0100
#@@ -58,5 +58,5 @@
#        CloseHandle (handle);
#
#-#if !defined(MONO_CROSS_COMPILE)
#+#if !defined(MONO_CROSS_COMPILE) && !defined(__MINGW64__)
# #ifdef USE_MONO_CTX
#        memset (&info->client_info.ctx, 0, sizeof (MonoContext));
#EOF
# fix undefined reference to GC_get_max_thread_index in libgc/win32_threads.c (version >= 4.2.2)
patch -ulbf libgc/win32_threads.c << EOF
--- libgc/win32_threads.c  2015-09-24 11:36:09.000000000 +0200
+++ libgc/win32_threads.c  2016-01-05 11:39:41.409553600 +0100
@@ -167,5 +167,2 @@
  */
-#ifdef __GNUC__
-__inline__
-#endif
 LONG GC_get_max_thread_index()
EOF
## fix missing po/mcs/Makefile
#mv po/mcs po/mcs.bak
#mkdir -p po/mcs
#cat > po/mcs/Makefile << EOF
#clean:
#all:
#install:
#install-strip:
#EOF
# fix missing strcasecmp in eglib/src/glib.h (version >= 4.6.1)
patch -ulbf eglib/src/glib.h << EOF
--- eglib/src/glib.h  2016-09-28 13:17:04 +0200
+++ eglib/src/glib.h  2016-09-28 20:55:14 +0200
@@ -248,3 +248,3 @@
 /* FIXME: g_strcasecmp supports utf8 unicode stuff */
-#ifdef _MSC_VER
+#if defined(_MSC_VER) || defined(__MINGW32__)
 #define g_strcasecmp stricmp
EOF
# fix missing eglib/src/gmodule-win32-internals.h (version >= 5.0.0.48)
ls -1 eglib/src/gmodule-win32-internals.h &> /dev/null || cat > eglib/src/gmodule-win32-internals.h << EOF
#include <glib.h>
#include <gmodule.h>
EOF

# workaround for missing po/mcs/Makefile.in.in
cp -f po/mcs/Makefile.in po/mcs/Makefile.in.in

# fix missing man/Makefile.in (version >= 4.0.1)
mkdir -p man
touch man/Makefile.in
## fix missing libgc
#mkdir -p libgc
#cat > libgc/Makefile << EOF
#clean:
#all:
#install:
#install-strip:
#EOF

## fix missing mono/utils/jemalloc/Makefile.in (version >= 5.11.0.119)
#mkdir -p mono/utils/jemalloc
#cat > mono/utils/jemalloc/Makefile.in << EOF
#clean:
#all:
#install:
#install-strip:
#EOF

# fix missing cmake (version >= 6.0.0.313)
sed -i.bak -e "s/which cmake\b/&.exe/" llvm/build.mk llvm/Makefile.in
#wl-showstatus build-install &&
#./build-mingw32.sh -d / -m $RUNPLATFORM &&
#    echo OK
#./build-mingw32.sh
wl-showstatus configure &&
 autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-x &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --without-x CC=${CC:-gcc} &&
 ####checking host platform characteristics... configure: error: Don't set CC. mono can only be compiled with gcc-3 from the 'gcc-core' package
 #./autogen.sh --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-parallel-mark --program-transform-name="" --with-tls=none --disable-mcs-build --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x CC=${CC:-gcc} &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-parallel-mark --program-transform-name="" --with-tls=none --disable-mcs-build --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x CC=${CC:-gcc} &&
 ####added --without-sgen to be able to compile 64-bit (version >= 4.2.0)
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-parallel-mark --program-transform-name="" --with-tls=none --disable-mcs-build --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x $(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo "--without-sgen"; fi) CC=${CC:-gcc} &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-parallel-mark --program-transform-name="" --with-tls=none --disable-mcs-build --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x $(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo "--without-sgen"; fi) CC=${CC:-gcc} LIBS="-Wl,--as-needed -lssp" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-parallel-mark --program-transform-name="" --with-tls=none --disable-mcs-build --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x $(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo "--without-sgen"; fi) PYTHON=$PYDIR/python.exe CC=${CC:-gcc} LIBS="-Wl,--as-needed -lssp" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-ninja --disable-llvm --disable-msvc --enable-cxx --disable-dev-random --enable-parallel-mark --program-transform-name="" -with-runtime-preset=winaot --enable-system-aot --with-winaot=yes --with-tls=pthread --disable-embed-check --enable-win32-dllmain=yes --with-libgc-threads=win32 --with-profile4=yes --without-x PYTHON=$PYDIR/python.exe CC=${CC:-gcc} LIBS="-Wl,--as-needed -lssp" &&
 wl-showstatus build-install &&
 #make install-strip &&
 #( PATH=$PATH:$PYDIR make install-strip || ( cp mono/metadata/.libs/libmonoruntime-static.a mono/metadata/; PATH=$PATH:$PYDIR make install-strip )) &&
 ( PATH=$PATH:$PYDIR make install-strip || ( cp mono/metadata/.libs/libmonoruntime-static.a mono/metadata/; PATH=$PATH:$PYDIR make install-strip ) || ( make -Cmono/metadata libmonoruntimesgen.la && make -Cmono/sgen libmonosgen.la && PATH=$PATH:$PYDIR make install-strip )) &&
 # fix missing extension
 if [ -f $INSTALLPREFIX/bin/mono ] && ! [ -f $INSTALLPREFIX/bin/mono.exe ]; then
  mv -f $INSTALLPREFIX/bin/mono $INSTALLPREFIX/bin/mono.exe
 fi  &&
 for F in $(grep -l "exec $INSTALLPREFIX" $INSTALLPREFIX/bin/*); do
  mv $F $F.bak &&
  sed -e "s?$INSTALLPREFIX?\$MINGWPREFIX?g; s?$(echo $INSTALLPREFIX|sed -e 's?^/\([A-Z]\)/?\1:/?')?\$MINGWPREFIX?g; s?/bin/mono\b?&.exe?" $F.bak > $F &&
  rm -rf $F.bak
 done &&
 # fix missing files (version >= 4.8.0.374)
 MONOVER=$(sed -n -e "s?^.*runtime/etc/mono/\([^ ]*\)/machine\.config.*?\1?p" configure*.ac|tail -n 1) &&
 mkdir -p $INSTALLPREFIX/lib/mono/$MONOVER &&
 #cp -rf mcs/class/lib/monolite/* $INSTALLPREFIX/lib/mono/$MONOVER/ &&
 cp -rf mcs/class/lib/monolite-win32/[0-9a-f]*/* $INSTALLPREFIX/lib/mono/$MONOVER/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
 #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\.[0-9]*\)\..*$/\1/")
#cp mono/metadata/.libs/libmonoruntime-static.a mono/metadata/
####mono/utils/atomic.h:62: undefined reference to `__sync_sub_and_fetch_8'
#make clean; make CFLAGS="-march=i686" CXXFLAGS="-march=i686" && echo OK
####TO DO: build 64-bit
####TO DO: build mono.exe
####Warning: filenames can get too long if the extraction path has a path name that is long causing extraction to fail
####MONO_GAC_PREFIX=$INSTALLPREFIX MONO_PATH=$INSTALLPREFIX/lib/mono/4.5 MONO_CFG_DIR=$INSTALLPREFIX/etc MONO_CONFIG=$INSTALLPREFIX/etc/mono/config make -Cmcs/tools/xbuild -j1 BUILD_PLATFORM=win32 HOST_PLATFORM=win32 RUNTIME=$INSTALLPREFIX/lib/mono/4.5/mcs.exe PROFILE=net_4_x



## fix mono/metadata/object-internals.h (version >= 6.12.0.107)
#patch -ulbf mono/metadata/object-internals.h << EOF
#@@ -2358,3 +2358,3 @@
#
#-void mono_gchandle_free_internal (uint32_t gchandle);
#+APIENTRY void mono_gchandle_free_internal (uint32_t gchandle);
#
#@@ -2381,3 +2381,3 @@
# /* GC write barriers support */
#-void
#+APIENTRY void
# mono_gc_wbarrier_set_field_internal (MonoObject *obj, void* field_ptr, MonoObject* value);
#EOF
## fix mono/metadata/object-internals.h (version >= 6.12.0.107)
#patch -ulbf mono/metadata/object-internals.h << EOF
#@@ -2358,2 +2358,3 @@
#
#+ICALL_EXTERN_C
# void mono_gchandle_free_internal (uint32_t gchandle);
#@@ -2381,2 +2382,3 @@
# /* GC write barriers support */
#+ICALL_EXTERN_C
# void
#EOF
#wl-showstatus configure &&
# NOCONFIGURE=1 ./autogen.sh &&
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-ninja --enable-parallel-mark --program-transform-name="" --with-tls=none --enable-win32-dllmain=yes --with-libgc-threads=win32 --disable-boehm --without-x $(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo "--without-sgen"; fi) PYTHON=$PYDIR/python.exe CC=${CC:-gcc} LIBS="-Wl,--as-needed -lssp" &&
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-ninja --enable-parallel-mark --program-transform-name="" --with-tls=none --enable-win32-dllmain=yes --with-libgc-threads=win32 --disable-boehm --enable-system-aot --with-winaot --with-testing_winaot_interp --without-x $(if ( echo $RUNPLATFORM | grep -q x86_64 ); then echo "--without-sgen"; fi) PYTHON=$PYDIR/python.exe CC=${CC:-gcc} LIBS="-Wl,--as-needed -lssp" &&
# #--enable-btls
# wl-showstatus build &&
# #make get-monolite-latest &&
# mingw32-make -Cmono/zlib &&
# mingw32-make -Cmono/metadata libmonoruntimesgen.la &&
# mingw32-make -Cmono/sgen libmonosgen.la &&
# #sed -i.bak -e "s?\(\$(FRIENDLY_TIME) \)mono ?\1../../mono/mini/mono.exe ?" mcs/mcs/Makefile &&
#    echo OK



