#export NAME="GLib"
#export STATUS=
##export URL=http://library.gnome.org/devel/glib/stable/glib.html
##export URL=http://developer.gnome.org/glib/stable/
#export URL=https://wiki.gnome.org/Projects/GLib
#export BASENAME=glib2
#export DESCRIPTION="GLib is the low-level core library that forms the basis for projects such as GTK+ and GNOME. It provides data structure handling for C, portability wrappers, and interfaces for such runtime functionality as an event loop, threads, dynamic loading, and an object system."
#export CATEGORY=framework
#export TYPE=library
##export VERSION=2.14.3
##export VERSION=2.14.6
##export VERSION=2.15.6
##export VERSION=2.16.1
##export VERSION=2.16.2
##export VERSION=2.16.3
##export VERSION=2.18.1
##export VERSION=2.19.4
##export VERSION=2.20.0
##export VERSION=2.20.1
##export VERSION=2.20.4
##export VERSION=2.20.5
##export VERSION=2.21.0
##export VERSION=2.21.1
##export VERSION=2.21.2
##export VERSION=2.21.3
##export VERSION=2.21.4
##export VERSION=2.21.5
##export VERSION=2.21.6
##export VERSION=2.22.0
##export VERSION=2.22.1
##export VERSION=2.22.2
##export VERSION=2.22.3
##export VERSIONDATE=20091130
##export VERSION=2.22.4
##export VERSIONDATE=20100107
##export VERSION=2.22.5
##export VERSIONDATE=20100316
##export VERSION=2.23.3
##export VERSIONDATE=20091202
##export VERSION=2.23.4
##export VERSIONDATE=20100222
##export VERSION=2.23.5
##export VERSIONDATE=20100309
##export VERSION=2.23.6
##export VERSIONDATE=20100324
##export VERSION=2.24.0
##export VERSIONDATE=20100328
##export VERSION=2.24.1
##export VERSIONDATE=20100503
##export VERSION=2.24.2
##export VERSIONDATE=20100809
##export VERSION=2.25.0
##export VERSIONDATE=20100420
##export VERSION=2.25.3
##export VERSIONDATE=20100426
##export VERSION=2.25.6
##export VERSIONDATE=20100520
##export VERSION=2.25.7
##export VERSIONDATE=20100525
##export VERSION=2.25.8
##export VERSIONDATE=20100608
##export VERSION=2.25.10
##export VERSIONDATE=20100625
##export VERSION=2.25.11
##export VERSIONDATE=20100712
##export VERSION=2.25.12
##export VERSIONDATE=20100730
##export VERSION=2.25.13
##export VERSIONDATE=20100809
#####gio/win32/gwin32directorymonitor.h:32:36: error: glocaldirectorymonitor.h: No such file or directory
##export VERSION=2.25.14
##export VERSIONDATE=20100818
##export VERSION=2.25.15
##export VERSIONDATE=20100831
##export VERSION=2.25.16
##export VERSIONDATE=20100920
##export VERSION=2.25.17
##export VERSIONDATE=20100920
##export VERSION=2.26.0
##export VERSIONDATE=20100928
##export VERSION=2.26.1
##export VERSIONDATE=20101115
##export VERSION=2.27.0
##export VERSIONDATE=20100920
##export VERSION=2.27.1
##export VERSIONDATE=20101026
##export VERSION=2.27.2
##export VERSIONDATE=20101101
##export VERSION=2.27.3
##export VERSIONDATE=20101109
##export VERSION=2.27.4
##export VERSIONDATE=20101130
##export VERSION=2.27.5
##export VERSIONDATE=20101221
##export VERSION=2.27.92
##export VERSIONDATE=20101224
##export VERSION=2.27.93
##export VERSIONDATE=20110202
##export VERSION=2.28.0
##export VERSIONDATE=20110209
##export VERSION=2.28.1
##export VERSIONDATE=20110218
##export VERSION=2.28.3
##export VERSIONDATE=20110315
##export VERSION=2.28.4
##export VERSIONDATE=20110322
##export VERSION=2.28.5
##export VERSIONDATE=20110402
##export VERSION=2.28.6
##export VERSIONDATE=20110414
##export VERSION=2.28.7
##export VERSIONDATE=20110521
##export VERSION=2.28.8
##export VERSIONDATE=20110606
##export VERSION=2.29.2
##export VERSIONDATE=20110413
##export VERSION=2.29.4
##export VERSIONDATE=20110505
##export VERSION=2.29.6
##export VERSIONDATE=20110605
##export VERSION=2.29.8
##export VERSIONDATE=20110614
##export VERSION=2.29.10
##export VERSIONDATE=20110713
##export VERSION=2.29.12
##export VERSIONDATE=20110720
##export VERSION=2.29.14
##export VERSIONDATE=20110723
##export VERSION=2.29.16
##export VERSIONDATE=20110816
##export VERSION=2.29.18
##export VERSIONDATE=20110831
##export VERSION=2.30.0
##export VERSIONDATE=20110927
##export VERSION=2.30.1
##export VERSIONDATE=20111015
##export VERSION=2.30.2
##export VERSIONDATE=20111112
##export VERSION=2.30.3
##export VERSIONDATE=20120312
##export VERSION=2.31.0
##export VERSIONDATE=20111020
##export VERSION=2.31.2
##export VERSIONDATE=20111122
##export VERSION=2.31.8
##export VERSIONDATE=20120116
##export VERSION=2.31.10
##export VERSIONDATE=20120117
#####gio/gsocket.h:126: error: expected ';', ',' or ')' before 'struct'
##export VERSION=2.31.12
##export VERSIONDATE=20120121
##export VERSION=2.31.14
##export VERSIONDATE=20120131
##export VERSION=2.31.16
##export VERSIONDATE=20120205
##export VERSION=2.31.18
##export VERSIONDATE=20120221
##export VERSION=2.31.20
##export VERSIONDATE=20120305
##export VERSION=2.31.22
##export VERSIONDATE=20120320
##export VERSION=2.32.0
##export VERSIONDATE=20120325
##export VERSION=2.32.1
##export VERSIONDATE=20120414
##export VERSION=2.32.2
##export VERSIONDATE=20120501
##export VERSION=2.32.3
##export VERSIONDATE=20120515
##export VERSION=2.32.4
##export VERSIONDATE=20120715
##export VERSION=2.33.1
##export VERSIONDATE=20120502
##export VERSION=2.33.2
##export VERSIONDATE=20120504
##export VERSION=2.33.3
##export VERSIONDATE=20120626
##export VERSION=2.33.4
##export VERSIONDATE=20120716
##export VERSION=2.33.6
##export VERSIONDATE=20120718
##export VERSION=2.33.8
##export VERSIONDATE=20120807
##export VERSION=2.33.10
##export VERSIONDATE=20120824
##export VERSION=2.33.12
##export VERSIONDATE=20120904
##export VERSION=2.33.14
##export VERSIONDATE=20120918
##export VERSION=2.34.0
##export VERSIONDATE=20120924
##export VERSION=2.34.1
##export VERSIONDATE=20121016
##export VERSION=2.34.2
##export VERSIONDATE=20121110
##export VERSION=2.34.3
##export VERSIONDATE=20121127
##export VERSION=2.35.1
##export VERSIONDATE=20121023
##export VERSION=2.35.2
##export VERSIONDATE=20121120
##export VERSION=2.35.3
##export VERSIONDATE=20121218
##export VERSION=2.35.4
##export VERSIONDATE=20130115
##export VERSION=2.35.7
##export VERSIONDATE=20130206
##export VERSION=2.35.8
##export VERSIONDATE=20130219
##export VERSION=2.35.9
##export VERSIONDATE=20130319
##export VERSION=2.36.0
##export VERSIONDATE=20130325
##export VERSION=2.36.1
##export VERSIONDATE=20130416
##export VERSION=2.36.2
##export VERSIONDATE=20130513
#####missing: line 81: automake-1.13: command not found
##export VERSION=2.36.3
##export VERSIONDATE=20130610
##export VERSION=2.36.4
##export VERSIONDATE=20130808
#####/bin/sh: -c: line 1: syntax error near unexpected token `;'
##export VERSION=2.37.0
##export VERSIONDATE=20130501
#####missing: line 81: automake-1.13: command not found
#####WARNING: 'automake-1.13' is missing on your system.
##export VERSION=2.37.1
##export VERSIONDATE=20130528
##export VERSION=2.37.2
##export VERSIONDATE=20130618
##export VERSION=2.37.3
##export VERSIONDATE=20130625
##export VERSION=2.37.4
##export VERSIONDATE=20130710
##export VERSION=2.37.5
##export VERSIONDATE=20130730
##export VERSION=2.37.6
##export VERSIONDATE=20130820
##export VERSION=2.37.7
##export VERSIONDATE=20130903
##export VERSION=2.38.0
##export VERSIONDATE=20130924
##export VERSION=2.38.1
##export VERSIONDATE=20131016
##export VERSION=2.38.2
##export VERSIONDATE=20131113
##export VERSION=2.39.0
##export VERSIONDATE=20131025
##export VERSION=2.39.1
##export VERSIONDATE=20131112
##export VERSION=2.39.2
##export VERSIONDATE=20131217
##export VERSION=2.39.3
##export VERSIONDATE=20140114
##export VERSION=2.39.4
##export VERSIONDATE=20140204
##export VERSION=2.40.0
##export VERSIONDATE=20140325
##export VERSION=2.40.1
##export VERSIONDATE=20140921
##export VERSION=2.40.2
##export VERSIONDATE=20140923
##export VERSION=2.41.0
##export VERSIONDATE=20140527
##export VERSION=2.41.1
##export VERSIONDATE=20140624
##export VERSION=2.41.2
##export VERSIONDATE=20140715
##export VERSION=2.41.3
##export VERSIONDATE=20140816
##export VERSION=2.41.4
##export VERSIONDATE=20140903
##export VERSION=2.41.5
##export VERSIONDATE=20140916
##export VERSION=2.42.0
##export VERSIONDATE=20140923
##export VERSION=2.42.1
##export VERSIONDATE=20141110
##export VERSION=2.42.2
##export VERSIONDATE=20150226
##export VERSION=2.43.0
##export VERSIONDATE=20141028
##export VERSION=2.43.1
##export VERSIONDATE=20141125
##export VERSION=2.43.2
##export VERSIONDATE=20141216
##export VERSION=2.43.3
##export VERSIONDATE=20150120
##export VERSION=2.43.4
##export VERSIONDATE=20150211
##export VERSION=2.44.0
##export VERSIONDATE=20150323
##export VERSION=2.44.1
##export VERSIONDATE=20150513
#####gio/gsocket.c:2023:9: error: implicit declaration of function 'if_nametoindex' [-Werror=implicit-function-declaration]
##export VERSION=2.45.1
##export VERSIONDATE=20150501
#####gio/glocalfile.c:(.text+0x26ae): undefined reference to `_wstat32i64'
##export VERSION=2.45.2
##export VERSIONDATE=20150526
##export VERSION=2.45.3
##export VERSIONDATE=20150623
##export VERSION=2.45.4
##export VERSIONDATE=20150721
##export VERSION=2.45.6
##export VERSIONDATE=20150820
##export VERSION=2.45.7
##export VERSIONDATE=20150902
##export VERSION=2.45.8
##export VERSIONDATE=20150915
##export VERSION=2.46.0
##export VERSIONDATE=20150921
##export VERSION=2.46.1
##export VERSIONDATE=20151014
##export VERSION=2.46.2
##export VERSIONDATE=20151107
##export VERSION=2.47.1
##export VERSIONDATE=20151031
##export VERSION=2.47.2
##export VERSIONDATE=20151127
##export VERSION=2.47.3
##export VERSIONDATE=20151128
##export VERSION=2.47.4
##export VERSIONDATE=20151218
##export VERSION=2.47.5
##export VERSIONDATE=20160121
##export VERSION=2.47.6
##export VERSIONDATE=20160216
##export VERSION=2.48.0
##export VERSIONDATE=20160323
##export VERSION=2.48.1
##export VERSIONDATE=20160510
##export VERSION=2.48.2
##export VERSIONDATE=20160818
##export VERSION=2.49.1
##export VERSIONDATE=20160528
##export VERSION=2.49.2
##export VERSIONDATE=20160621
##export VERSION=2.49.3
##export VERSIONDATE=20160718
##export VERSION=2.49.4
##export VERSIONDATE=20160721
##export VERSION=2.49.5
##export VERSIONDATE=20160818
##export VERSION=2.49.6
##export VERSIONDATE=20160828
##export VERSION=2.49.7
##export VERSIONDATE=20160913
##export VERSION=2.50.0
##export VERSIONDATE=20160920
##export VERSION=2.50.1
##export VERSIONDATE=20161011
##export VERSION=2.50.2
##export VERSIONDATE=20161108
##export VERSION=2.50.3
##export VERSIONDATE=20170214
##export VERSION=2.51.0
##export VERSIONDATE=20161025
##export VERSION=2.51.1
##export VERSIONDATE=20170117
##export VERSION=2.51.2
##export VERSIONDATE=20170214
##export VERSION=2.51.3
##export VERSIONDATE=20170228
##export VERSION=2.51.4
##export VERSIONDATE=20170302
#####config.status: error: cannot find input file: `win32/vs15/Makefile.in'
##export VERSION=2.51.5
##export VERSIONDATE=20170314
##export VERSION=2.52.0
##export VERSIONDATE=20170319
##export VERSION=2.52.1
##export VERSIONDATE=20170408
##export VERSION=2.52.2
##export VERSIONDATE=20170509
##export VERSION=2.52.3
##export VERSIONDATE=20170623
##export VERSION=2.53.1
##export VERSIONDATE=20170425
##export VERSION=2.53.2
##export VERSIONDATE=20170523
##export VERSION=2.53.3
##export VERSIONDATE=20170620
##export VERSION=2.53.4
##export VERSIONDATE=20170718
##export VERSION=2.53.5
##export VERSIONDATE=20170815
##export VERSION=2.53.6
##export VERSIONDATE=20170820
##export VERSION=2.53.7
##export VERSIONDATE=20170905
##export VERSION=2.54.0
##export VERSIONDATE=20170911
##export VERSION=2.54.1
##export VERSIONDATE=20171003
##export VERSION=2.54.2
##export VERSIONDATE=20171028
##export VERSION=2.54.3
##export VERSIONDATE=20180109
##export VERSION=2.55.0
##export VERSIONDATE=20171122
##export VERSION=2.55.1
##export VERSIONDATE=20180109
##export VERSION=2.55.2
##export VERSIONDATE=20180207
##export VERSION=2.56.0
##export VERSIONDATE=20180313
##export VERSION=2.56.1
##export VERSIONDATE=20180407
##export VERSION=2.56.2
##export VERSIONDATE=20180817
##export VERSION=2.56.3
##export VERSIONDATE=20180921
##export VERSION=2.56.4
##export VERSIONDATE=20181219
##export VERSION=2.57.1
##export VERSIONDATE=20180523
#####gio/gsocket.c:2407:34: error: incompatible types when assigning to type 'struct in_addr' from type 'unsigned int'
##export VERSION=2.57.2
##export VERSIONDATE=20180801
##export VERSION=2.57.3
##export VERSIONDATE=20180824
#####Checking if "OpenBSD strlcpy/strlcat" runs: DID NOT COMPILE
##export VERSION=2.58.0
##export VERSIONDATE=20180831
##export VERSION=2.58.1
##export VERSIONDATE=20180922
##export VERSION=2.58.2
##export VERSIONDATE=20181219
#export VERSION=2.58.3
#export VERSIONDATE=20190122
#####configure.ac:66: require Automake 1.13.3, but have 1.11.1
#export DEPENDENCIES=pcre,gettext,zlib,libffi
#export OPTIONALDEPENDENCIES=
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
##export VERSION=2.59.0
##export VERSIONDATE=20181224
#####checking whether /D/Prog/Python/WinPython-32bit-2.7.12.4Zero/python-2.7.12/python.exe version is >= 3.4... no
##export VERSION=2.59.1
##export VERSIONDATE=20190126
##export VERSION=2.59.2
##export VERSIONDATE=20190205
##export VERSION=2.59.3
##export VERSIONDATE=20190218
#####Checking if "OpenBSD strlcpy/strlcat" runs: DID NOT COMPILE
##export VERSION=2.60.0
##export VERSIONDATE=20190305
##export VERSION=2.60.1
##export VERSIONDATE=20190415
##export VERSION=2.60.2
##export VERSIONDATE=20190504
##export VERSION=2.60.3
##export VERSIONDATE=20190522
##export VERSION=2.60.4
##export VERSIONDATE=20190611
##export VERSION=2.60.5
##export VERSIONDATE=20190709
##export VERSION=2.60.6
##export VERSIONDATE=20190724
##export VERSION=2.60.7
##export VERSIONDATE=20190903
#####meson.build:1889:0: ERROR: python not found
##export VERSION=2.61.0
##export VERSIONDATE=20190416
##export VERSION=2.61.1
##export VERSIONDATE=20190525
##export VERSION=2.61.2
##export VERSIONDATE=20190805
##export VERSION=2.61.3
##export VERSIONDATE=20190903
##export VERSION=2.62.0
##export VERSIONDATE=20190906
##export VERSION=2.62.1
##export VERSIONDATE=20191005
##export VERSION=2.62.2
##export VERSIONDATE=20191022
##export VERSION=2.63.0
##export VERSIONDATE=20191005
##export VERSION=2.63.1
##export VERSIONDATE=20191101
##export VERSION=2.63.2
##export VERSIONDATE=20191125
##export VERSION=2.63.3
##export VERSIONDATE=20191217
#wl-showstatus --package-version
##export DEPENDENCIES=pcre,gettext,zlib,libffi
##export OPTIONALDEPENDENCIES=
##export BUILDDEPENDENCIES=meson
##export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/glib/ glib-"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/glib/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/glib-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/glib/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/glib-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xj --force-local -f $TARBALLDIR/$BASENAME/glib-$VERSION.tar.bz2
#tar xJ --force-local -f $TARBALLDIR/$BASENAME/glib-$VERSION.tar.xz
#cd glib-$VERSION
### create dummy sys/uio.h (version >= 2.21.2 <= 2.22.2)
##mkdir -p sys
##touch sys/uio.h 
### create dummy sys/mman.h (version >= 2.31.14)
##mkdir -p sys
##touch sys/mman.h
##cp -rfp $INSTALLPREFIX/include/glib-2.0/* $INSTALLPREFIX/include/
##cp -rfp $INSTALLPREFIX/lib/glib-2.0/include/* $INSTALLPREFIX/include/
## create dummy sys/wait.h (version >= 2.25.11)
#mkdir -p sys
#touch sys/wait.h
## skip making tests
#cat > glib/tests/Makefile.in << EOF
#all:
#install:
#install-strip:
#clean:
#EOF
#cat > gio/tests/Makefile.in << EOF
#all:
#install:
#install-strip:
#clean:
#EOF
### fix stderr problem in gio/tests/gschema-compile.c (version >= 2.25.2 <= 2.25.5)
##patch -ulbf gio/tests/gschema-compile.c << EOF
##--- gio/tests/gschema-compile.c  2010-04-23 22:58:16 +0200
##+++ gio/tests/gschema-compile.c  2010-04-26 17:16:02 +0200
##@@ -10,3 +10,3 @@
##   const gchar *opt;
##-  const gchar *stderr;
##+  const gchar *stderror;
## } SchemaTest;
##@@ -34,6 +34,6 @@
##     }
##-  if (test->stderr)
##+  if (test->stderror)
##     {
##       g_test_trap_assert_failed ();
##-      g_test_trap_assert_stderr (test->stderr);
##+      g_test_trap_assert_stderr (test->stderror);
##     }
##EOF
### avoid already defined interface (version >= 2.25.5)
##mv gio/gdbusmessage.h gio/gdbusmessage.h.bak
##sed -e "s/\(\*interf\)ace/\1/" gio/gdbusmessage.h.bak > gio/gdbusmessage.h
##make -C glib gtester CFLAGS="-I.. -I."
### fix missing MemoryBarrier in glib/gatomic.c (version >= 2.29.8)
##mv glib/gatomic.c glib/gatomic.c.bak
##echo '#define MemoryBarrier() asm("mfence;")' > glib/gatomic.c
##cat glib/gatomic.c.bak >> glib/gatomic.c
### fix glib/gatomic.c (needed for 64-bit Windows)
##patch -ulbf glib/gatomic.c << EOF
##--- glib/gatomic.c  2011-06-06 01:18:50 +0200
##+++ glib/gatomic.c  2011-06-16 21:07:56 +0200
##@@ -71,3 +71,3 @@
##
##-#if defined (__GNUC__)
##+#if defined (__GNUC__) && !defined (G_PLATFORM_WIN32)
## # if defined (G_ATOMIC_I486)
##EOF
### fix missing MemoryBarrier in glib/gatomic.c (version >= 2.29.2 <= 2.32.4)
##patch -ulbf glib/gatomic.c << EOF
##--- glib/gatomic.c  2011-08-16 02:51:30 +0200
##+++ glib/gatomic.c  2011-09-26 20:40:16 +0200
##@@ -455,7 +455,7 @@
##   return g_atomic_pointer_xor ((volatile gpointer *) atomic, val);
## }
##
##-#elif defined (G_PLATFORM_WIN32) && defined(HAVE_WIN32_BUILTINS_FOR_ATOMIC_OPERATIONS)
##+#elif defined (G_PLATFORM_WIN32) && defined (_MSC_VER) && defined(HAVE_WIN32_BUILTINS_FOR_ATOMIC_OPERATIONS)
##
## #include <windows.h>
## #if !defined(_M_AMD64) && !defined (_M_IA64) && !defined(_M_X64)
##EOF
## fix duplicate case in glib/giochannel.c
#patch -ulbf glib/giochannel.c << EOF
#--- glib/giochannel.c  2011-06-06 01:18:50 +0200
#+++ glib/giochannel.c  2011-10-17 08:16:24 +0200
#@@ -783,3 +783,3 @@
#
#-#ifdef EFBIG
#+#if defined(EFBIG) && (!defined(EOVERFLOW) || EFBIG != EOVERFLOW)
#     case EFBIG:
#EOF
## fix missing g_object_notify_queue_freeze/g_object_notify_queue_thaw/g_object_notify_queue_add in gobject/gobject.c (version >= 2.31.0)
#patch -ulbf gobject/gobject.c << EOF
#--- gobject/gobject.c  2011-11-18 10:51:54 +0100
#+++ gobject/gobject.c  2011-11-22 10:31:48 +0100
#@@ -340,2 +340,6 @@
# }
#+#else  /* G_ENABLE_DEBUG */
#+#define g_object_notify_queue_freeze(object,conditional) NULL
#+#define g_object_notify_queue_thaw(object,nqueue)
#+#define g_object_notify_queue_add(object,nqueue,pspec)
# #endif /* G_ENABLE_DEBUG */
#EOF
### fix missing parameter when using WSAIoctl in gio/gsocket.c (version >= 2.34.2 <= 2.34.3)
######error: too few arguments to function 'WSAIoctl'
##patch -ulbf gio/gsocket.c << EOF
##--- gio/gsocket.c  2012-11-10 04:27:30 +0100
##+++ gio/gsocket.c  2012-11-10 13:18:44 +0100
##@@ -2388,2 +2388,3 @@
##   gsize avail_len = sizeof (avail);
##+  DWORD n;
## #endif
##@@ -2393,3 +2394,3 @@
## #if defined(G_OS_WIN32)
##-  if (WSAIoctl (socket->priv->fd, FIONREAD, NULL, 0, &avail, sizeof (avail), 0, 0) == SOCKET_ERROR)
##+  if (WSAIoctl (socket->priv->fd, FIONREAD, NULL, 0, &avail, sizeof (avail), &n, NULL, NULL) == SOCKET_ERROR)
##     return -1;
##EOF
### fix missing rand_s in glib/grand.c (version >= 2.39.1)
##mv glib/grand.c glib/grand.c.bak
##cat > glib/grand.c << EOF
###include <time.h>
###include <stdlib.h>
##int rand_s (unsigned int* r);
##int rand_s (unsigned int* r)
##{
##  static int srand_called = 0;
##  if (!srand_called) {
##    srand(time(0));
##    srand_called++;
##  }
##  if (r)
##    *r = rand();
##  return 0;
##}
##EOF
##cat glib/grand.c.bak >> glib/grand.c
## fix missing export of g_win32_get_package_installation_subdirectory (needed for building pkg-config)
#mv glib/glib.symbols glib/glib.symbols.bak
#sed -e "s/\(g_win32_get_package_installation_subdirectory\) *PRIVATE/\1/" glib/glib.symbols.bak > glib/glib.symbols
## fix missing PCTSTR in gio/gwin32networking.h (version >= 2.44.0)
#patch -ulbf gio/gwin32networking.h << EOF
#--- glib-2.44.0/gio/gwin32networking.h  2015-03-20 18:33:38.000000000 +0100
#+++ glib-2.44.0/gio/gwin32networking.h  2015-03-23 21:03:15.924279829 +0100
#@@ -24,8 +24,9 @@
# /* Check if more ANSI-compliant Winsock2 functions are provided */
# /* For run-time compatibility with Windows XP, remove when XP support dropped */
#
#-typedef INT (WSAAPI *PFN_InetPton) (INT, PCTSTR, PVOID);
#-typedef PCTSTR (WSAAPI *PFN_InetNtop) (INT, PVOID, PTSTR, size_t);
#+typedef ULONG NET_IFINDEX;
#+typedef INT (WSAAPI *PFN_InetPton) (INT, LPCTSTR, PVOID);
#+typedef LPCTSTR (WSAAPI *PFN_InetNtop) (INT, PVOID, PTSTR, size_t);
# typedef NET_IFINDEX (WINAPI *PFN_IfNameToIndex) (PCSTR);
#
# typedef struct _GWin32WinsockFuncs
#EOF
## avoid using langinfo.h from plibc
#if [ -e $MINGWPREFIX/include/langinfo.h ]; then
# #echo "#error langinfo.h should not be used" > langinfo.h
# #rm langinfo.h
# mv configure configure.bak
# sed -e "s/#include <langinfo.h>/#include <langinfo_BAD.h>/" configure.bak > configure
#fi
## platform fix for 32-bit
#if ( echo $RUNPLATFORM | grep -qv x86_64 ); then
# PLATFORMCFLAGS=-march=pentium
#else
# PLATFORMCFLAGS=
#fi
### fix missing gdesktopappinfo.h (version >= 2.32.1)
##patch -ulbf gio/Makefile.in << EOF
##--- gio/Makefile.in  2012-04-14 00:17:00 +0200
##+++ gio/Makefile.in  2012-04-14 10:09:00 +0200
##@@ -66,2 +66,3 @@
## @OS_UNIX_TRUE@am__append_15 = gdesktopappinfo.c
##+@OS_WIN32_TRUE@am__append_15 = gdesktopappinfo.c
## @OS_UNIX_TRUE@am__append_16 = xdgmime/libxdgmime.la \$(RESOLVER_LIBADD)
##@@ -468,4 +469,4 @@
##        gunixsocketaddress.h
##-am__giowin32include_HEADERS_DIST = gwin32inputstream.h \\
##-       gwin32outputstream.h
##+am__giowin32include_HEADERS_DIST = gdesktopappinfo.h gwin32inputstream.h \\
##+       gwin32outputstream.h
## HEADERS = \$(gioinclude_HEADERS) \$(giounixinclude_HEADERS) \\
##EOF
### fix missing gdesktopappinfo.h (version >= 2.36.0 < 2.46.0)
##patch -ulbf gio/Makefile.in << EOF
##--- gio/Makefile.in  2012-04-14 00:17:00 +0200
##+++ gio/Makefile.in  2012-04-14 10:09:00 +0200
##@@ -66,2 +66,3 @@
## @OS_UNIX_TRUE@am__append_15 = gdesktopappinfo.c \\
##+@OS_WIN32_TRUE@am__append_15 = gdesktopappinfo.c \\
## @OS_UNIX_TRUE@am__append_16 = xdgmime/libxdgmime.la \$(RESOLVER_LIBADD)
##@@ -468,4 +469,4 @@
##        gunixsocketaddress.h
##-am__giowin32include_HEADERS_DIST = gwin32inputstream.h \\
##-       gwin32outputstream.h
##+am__giowin32include_HEADERS_DIST = gdesktopappinfo.h gwin32inputstream.h \\
##+       gwin32outputstream.h
## HEADERS = \$(gioinclude_HEADERS) \$(giounixinclude_HEADERS) \\
##EOF
## fix missing gdesktopappinfo.h (version >= 2.46.0)
#patch -ulbf gio/Makefile.in << EOF
#--- gio/Makefile.in  2015-09-21 14:39:06 +0200
#+++ gio/Makefile.in  2015-09-22 18:51:44 +0200
#@@ -66,2 +66,3 @@
#   fi; \\
#+@OS_WIN32_TRUE@am__append_15 = gdesktopappinfo.c \\
# }
#@@ -674,4 +675,4 @@
#        gunixsocketaddress.h
#-am__giowin32include_HEADERS_DIST = gwin32inputstream.h \\
#-       gwin32outputstream.h
#+am__giowin32include_HEADERS_DIST = gdesktopappinfo.h gwin32inputstream.h \\
#+       gwin32outputstream.h
# HEADERS = \$(gioinclude_HEADERS) \$(giounixinclude_HEADERS) \\
#@@ -4099,7 +4100,3 @@
#        @fail=; \\
#-       if \$(am__make_keepgoing); then \\
#-         failcom='fail=yes'; \\
#-       else \\
#-         failcom='exit 1'; \\
#-       fi; \\
#+       failcom='exit 1'; \\
#        dot_seen=no; \\
#EOF
### fix missing gdesktopappinfo.h (version >= 2.54.2)
##mv gio/Makefile.in gio/Makefile.in.bak &&
##sed -e "s/@OS_COCOA_FALSE@@OS_UNIX_TRUE@\(.*=.*gdesktopappinfo\.\)/\1/" gio/Makefile.in.bak > gio/Makefile.in
### fix missing gdesktopappinfo.h and avoid already defined interface (version >= 3.18.2)
##mv gio/gdesktopappinfo.h gio/gdesktopappinfo.h.bak &&
##sed -e "s/\(\*interf\)ace/\1/" gio/gdesktopappinfo.h.bak > gio/gdesktopappinfo.h
### fix missing _wstat32i64 in gio/glocalfile.c (version >= 2.45.1 < 2.46.0)
##mv gio/glocalfile.c gio/glocalfile.c.bak
##echo "#define __MSVCRT_VERSION__ 0x0800" > gio/glocalfile.c
##cat gio/glocalfile.c.bak >> gio/glocalfile.c
### fix missing _wstat32i64 in gio/glocalfile.c (version >= 2.46.0)
##mv gio/glocalfile.c gio/glocalfile.c.bak2
##echo "#define HAVE_LSTAT" > gio/glocalfile.c
##cat gio/glocalfile.c.bak2 >> gio/glocalfile.c
### fix missing  in gio/glocalfile.c (version >= 2.49.3)
##mv gio/glocalfile.c gio/glocalfile.c.bak
##cat > gio/glocalfile.c << EOF
###include <errno.h>
###ifndef ECANCELED
###define ECANCELED 105
###endif
##EOF
##cat gio/glocalfile.c.bak >> gio/glocalfile.c
### fix gio/Makefile (version >= 2.46.0)
##patch -ulbf gio/Makefile << EOF
##--- gio/Makefile  2015-09-21 17:01:14 +0200
##+++ gio/Makefile  2015-09-21 20:16:59 +0200
##@@ -4100,7 +4100,3 @@
##        @fail=; \\
##-       if \$(am__make_keepgoing); then \\
##-         failcom='fail=yes'; \\
##-       else \\
##-         failcom='exit 1'; \\
##-       fi; \\
##+       failcom='exit 1'; \\
##        dot_seen=no; \\
##EOF
## fix missing iswalpha/LOAD_LIBRARY_AS_IMAGE_RESOURCE in gio/gwin32appinfo.c (version >= 2.46.0)
#mv gio/gwin32appinfo.c gio/gwin32appinfo.c.bak
#cat > gio/gwin32appinfo.c << EOF
##include <wctype.h>
##include <windows.h>
##ifndef LOAD_LIBRARY_AS_IMAGE_RESOURCE
##define LOAD_LIBRARY_AS_IMAGE_RESOURCE 0x00000020
##endif
#EOF
#cat gio/gwin32appinfo.c.bak >> gio/gwin32appinfo.c
### fix missing strerror_s in glib/gstrfuncs.c (version >= 2.46.0)
##if ! gcc --version|grep "MinGW-W64" &> /dev/null; then
## mv glib/gstrfuncs.c glib/gstrfuncs.c.bak &&
## echo "#define strerror_s(buf,buflen,errnum) { strncpy(buf,strerror(errnum),buflen-1);buf[buflen-1]=0; }" > glib/gstrfuncs.c &&
## cat glib/gstrfuncs.c.bak >> glib/gstrfuncs.c
##fi
## fix missing ntstatus.h/winternl.h in gio/gwin32registrykey.c (version >= 2.46.0)
#if ! gcc --version|grep "MinGW-W64" &> /dev/null; then
# mv gio/gwin32registrykey.c gio/gwin32registrykey.c.bak
# cat > gio/gwin32registrykey.c << EOF
##include <windows.h>
##include <ddk/ntstatus.h>
##include <ddk/ndis.h>
##define _WDMDDK_
##ifndef HKEY_PERFORMANCE_NLSTEXT
##define HKEY_PERFORMANCE_NLSTEXT ((HKEY)(ULONG_PTR)((LONG)0x80000060))
##endif
##ifndef HKEY_PERFORMANCE_TEXT
##define HKEY_PERFORMANCE_TEXT ((HKEY)(ULONG_PTR)((LONG)0x80000050))
##endif
#EOF
#sed -e "s?^\(#include <\)\(ntstatus.h\|winternl.h\)?//\1\2?" gio/gwin32registrykey.c.bak >> gio/gwin32registrykey.c
#fi
### fix missing NTSTATUS in glib/gwin32.c (version >= 2.46.1 < 2.48.0)
##mv glib/gwin32.c glib/gwin32.c.bak
##cat > glib/gwin32.c << EOF
###include <windows.h>
###include <ddk/ntstatus.h>
###include <ddk/ndis.h>
##EOF
###cat glib/gwin32.c.bak >> glib/gwin32.c
##grep -v "winternl\.h" glib/gwin32.c.bak >> glib/gwin32.c
## fix missing sys/socket.h in glib/gmessages.c (version >= 2.49.4)
#patch -ulbf glib/gmessages.c << EOF
#--- glib/gmessages.c  2016-07-21 02:42:09.000000000 +0200
#+++ glib/gmessages.c  2016-07-21 10:42:38.876418900 +0200
#@@ -98,4 +98,6 @@
# #include <sys/types.h>
#+#ifndef _WIN32
# #include <sys/socket.h>
# #include <sys/un.h>
#+#endif
#
#EOF
## fix glib/gfileutils.c (version >= 2.52.1)
#####error: ISO C90 forbids mixed declarations and code
#patch -ulbf glib/gfileutils.c << EOF
#--- glib/gfileutils.c  2017-04-08 07:47:34.000000000 +0200
#+++ glib/gfileutils.c  2017-04-08 16:41:40.479319900 +0200
#@@ -319,2 +319,4 @@
# {
#+  int attributes;
#+  wchar_t *wfilename;
#   g_return_val_if_fail (filename != NULL, FALSE);
#@@ -329,4 +331,3 @@
# #  endif
#-  int attributes;
#-  wchar_t *wfilename = g_utf8_to_utf16 (filename, -1, NULL, NULL, NULL);
#+  wfilename = g_utf8_to_utf16 (filename, -1, NULL, NULL, NULL);
#
#EOF
## fix missing definitions in gio/gdbusprivate.c (version >= 2.53.2)
#mv gio/gdbusprivate.c gio/gdbusprivate.c.bak
#cat > gio/gdbusprivate.c << EOF
##include "gioenumtypes.h"
##include "gdbusauthobserver.h"
##include "gsocketaddress.h"
#EOF
#cat gio/gdbusprivate.c.bak >> gio/gdbusprivate.c
### fix redefinition of REPARSE_DATA_BUFFER and missing FSCTL_GET_REPARSE_POINT in glib/gstdio.c (version >= 2.55.0)
##patch -ulbf glib/gstdio.c << EOF
##@@ -33,2 +33,3 @@
## #include <windows.h>
##+#include <winioctl.h>
## #include <errno.h>
##@@ -61,3 +62,2 @@
##  * https://msdn.microsoft.com/en-us/library/ff552012(v=vs.85).aspx
##- */
## typedef struct _REPARSE_DATA_BUFFER
##@@ -92,2 +92,3 @@
## } REPARSE_DATA_BUFFER, *PREPARSE_DATA_BUFFER;
##+ */
##
##EOF
### fix missing SetThreadErrorMode in gmodule/gmodule-win32.c (version >= 2.55.0)
##mv gmodule/gmodule-win32.c gmodule/gmodule-win32.c.bak &&
##echo "#define SetThreadErrorMode(newmode,oldmode) FALSE" > gmodule/gmodule-win32.c &&
##cat gmodule/gmodule-win32.c.bak >> gmodule/gmodule-win32.c
#
## fix undefined WEEKDAY_FULL_IS_LOCALE in glib/gdatetime.c (version >= 2.56.0)
#patch -ulbf glib/gdatetime.c << EOF
#@@ -2950,2 +2950,5 @@
#             return FALSE;
#+#ifndef WEEKDAY_FULL_IS_LOCALE
#+#define WEEKDAY_FULL_IS_LOCALE FALSE
#+#endif
#          if (!locale_is_utf8 && !WEEKDAY_FULL_IS_LOCALE)
#EOF
## fix += issue in Makefile.am (version >= 2.58.0 <= 2.59.0)
#echo "EXTRA_DIST+=" > _dummy_.am &&
#for F in $(grep -l "EXTRA_DIST\s*+=" $(find -name '*.am')); do
# mv $F $F.bak &&
# echo "EXTRA_DIST=" > $F &&
# echo "CLEANFILES=" >> $F &&
# cat $F.bak >> $F
#done &&
#rm -f _dummy_.am
## skip making docs/reference/glib (version >= 2.36.2)
#####missing: line 81: automake-1.13: command not found
#cat > docs/reference/glib/Makefile.in << EOF
#clean:
#all:
#install:
#install-strip:
#EOF
#cp -f docs/reference/glib/Makefile.in docs/reference/gobject/Makefile.in
#cp -f docs/reference/glib/Makefile.in docs/reference/gio/Makefile.in
## avoid printf type mismatch errors on 64-bit (version >= 2.49.4)
#mv configure configure.bak &&
#sed -e "s/-Werror=format=2//" configure.bak > configure
#wl-showstatus configure &&
#mkdir -p m4 &&
#touch gtk-doc.make &&
#autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
##make check
##PKG_CONFIG=`which pkg-config` ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-threads=win32 --with-pcre=external --with-libiconv=gnu --disable-static --enable-shared CFLAGS="-I$MINGWPREFIX/include" LDFLAGS="-L$MINGWPREFIX/lib" && make install
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-threads=win32 --with-pcre=external --with-libiconv=gnu --disable-static --enable-shared CFLAGS="-I$MINGWPREFIX/include" LDFLAGS="-L$MINGWPREFIX/lib" && make install
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-threads=win32 --with-pcre=external --with-libiconv=gnu &&
##PKG_CONFIG="`which pkg-config` --dont-define-prefix" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-threads=win32 --with-pcre=external --with-libiconv=gnu &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-debug=no --with-threads=win32 --with-pcre=external --with-libiconv=gnu &&
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-debug=no --with-threads=win32 --with-pcre=external --with-libiconv=gnu &&
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=yes --with-threads=none --with-pcre=internal --with-libiconv=no &&
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu &&
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu CFLAGS="$PLATFORMCFLAGS" &&
#####configure: error: Can not build both shared and static at the same time on Windows.
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu CFLAGS="$PLATFORMCFLAGS" &&
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu CFLAGS="$PLATFORMCFLAGS" LIBFFI_CFLAGS="-I$MINGWPREFIX/lib$(grep "^includedir=" $MINGWPREFIX/lib/pkgconfig/libffi.pc|sed -e "s?[^/]*??")" LIBFFI_LIBS="-L$MINGWPREFIX/lib -lffi" PCRE_CFLAGS="-I$MINGWPREFIX/include" PCRE_LIBS="-L$MINGWPREFIX/lib -lpcre" &&
#####fix programs failing to start with exit status code 57 (caused by missing ieshims.dll) by linking with shell32
##PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu CFLAGS="$PLATFORMCFLAGS" LIBFFI_CFLAGS="-I$MINGWPREFIX/lib$(grep "^includedir=" $MINGWPREFIX/lib/pkgconfig/libffi.pc|sed -e "s?[^/]*??")" LIBFFI_LIBS="-L$MINGWPREFIX/lib -lffi" PCRE_CFLAGS="-I$MINGWPREFIX/include" PCRE_LIBS="-L$MINGWPREFIX/lib -lpcre" LDFLAGS="-lshell32" &&
#PYTHON=$PYDIR/python.exe ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-debug=no --with-threads=win32 --with-pcre=system --with-libiconv=gnu --disable-libelf CFLAGS="$PLATFORMCFLAGS" LIBFFI_CFLAGS="-I$MINGWPREFIX/lib$(grep "^includedir=" $MINGWPREFIX/lib/pkgconfig/libffi.pc|sed -e "s?[^/]*??")" LIBFFI_LIBS="-L$MINGWPREFIX/lib -lffi" PCRE_CFLAGS="-I$MINGWPREFIX/include" PCRE_LIBS="-L$MINGWPREFIX/lib -lpcre" LDFLAGS="-lshell32" &&
##LDFLAGS="-Wl,--allow-multiple-definition"
# #echo "#define HAVE_WIN32_BUILTINS_FOR_ATOMIC_OPERATIONS 1" >> config.h &&
# ## fix redefinition of if_nametoindex (version >= 2.42.1)
# #if grep -q if_nametoindex $MINGWDIR/*mingw32/include/netioapi.h; then
# # echo "#define HAVE_IF_NAMETOINDEX 1" >> config.h
# #fi &> /dev/null &&
# # fix s_addr issue (version >= 2.56.2)
# echo "#undef BROKEN_IP_MREQ_SOURCE_STRUCT" >> config.h &&
# # fix missing strcasecmp/strncasecmp when not using MinGW-W64 (version >= 2.50.0)
# if ( ! gcc --version | grep -q "MinGW-W64" ); then
#  echo "#define strcasecmp _stricmp" >> config.h
#  echo "#define strncasecmp _strnicmp" >> config.h
# fi &&
# ## fix issues with G_GINT64_FORMAT/G_GUINT64_FORMAT in glib/glibconfig.h (version >= 2.58.2)
# ##rm -f glib/glibconfig-stamp glib/glibconfig.h &&
# #make -Cglib glibconfig-stamp &&
# #mv glib/glibconfig.h glib/glibconfig.h.bak &&
# #echo "#include <inttypes.h>" > glib/glibconfig.h &&
# #sed -e "s/\(G_GU*INT64_FORMAT\s*\)\"ll\([iu]\)\"/\1PRI\264/; s/\(G_GU*INTPTR_FORMAT\s*\)\"ll\([iu]\)\"/\1PRI\2PTR/" glib/glibconfig.h.bak >> glib/glibconfig.h &&
# wl-showstatus build-install &&
# #( make install-strip || make -j1 all install-strip ) &&
# # build gio/gioenumtypes.h manually (version >= 2.58.0)
# make -Cgio gioenumtypes.h &&
# # build gio/win32 manually (version >= 2.38.0)
# make -Cgio/win32 &&
# ## fix missing destination folder (version >= 2.42.2)
# #mkdir -p $INSTALLPREFIX/include/glib-2.0/gio/ &&
# ####/bin/sh: -c: line 1: syntax error near unexpected token `;'
# ( make install-strip am__make_keepgoing=false || make -j1 all install-strip am__make_keepgoing=false GLIB_WARN_CFLAGS= ) &&
# # fix missing gdbus-codegen (version >= 2.39.1)
# make -j1 -C gio/gdbus-2.0/codegen/ install-strip &&
# ## fix missing gdesktopappinfo.h (version >= 2.32.1)
# #cp -f gio/gdesktopappinfo.h $INSTALLPREFIX/include/glib-2.0/gio/ &&
# # fix missing gdesktopappinfo.h and avoid already defined interface (version >= 3.18.2)
# sed -e "s/\(\*interf\)ace/\1/" gio/gdesktopappinfo.h > $INSTALLPREFIX/include/glib-2.0/gio/gdesktopappinfo.h &&
# # fix missing gwin32appinfo.h (version >= 2.32.1)
# cp -f gio/gwin32appinfo.h $INSTALLPREFIX/include/glib-2.0/gio/ &&
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf glib-$VERSION
#####Note: gtester not yet possible on Windows: make -C glib -j1 gtester.o
#
##grep HAVE_WIN32_BUILTINS_FOR_ATOMIC_OPERATIONS config.h
##PATH=glib/.libs:$PATH gdb gobject/.libs/testgobject.exe
##start
##continue
#####Program received signal SIGSEGV, Segmentation fault.
#####0x685c3009 in g_atomic_pointer_get (atomic=0x686b4040) at gatomic.c:732
#####732       g_static_mutex_lock (&g_atomic_lock);
# 
## To do: fix missing gdesktopappinfo.h
#patch -ulbf gio/Makefile.in << EOF
#--- gio/Makefile.in  2010-11-14 07:01:54 +0100
#+++ gio/Makefile.in  2010-11-18 15:25:32 +0100
#@@ -186,3 +186,3 @@
#        gsocks5proxy.h gio-marshal.h gio-marshal.c
#-@OS_UNIX_TRUE@am__objects_1 = gdesktopappinfo.lo
#+am__objects_1 = gdesktopappinfo.lo
# @OS_WIN32_TRUE@am__objects_2 = gwin32appinfo.lo
#@@ -324,3 +324,3 @@
# am__giowin32include_HEADERS_DIST = gwin32inputstream.h \\
#-       gwin32outputstream.h
#+       gwin32outputstream.h gdesktopappinfo.h
# HEADERS = \$(gioinclude_HEADERS) \$(giounixinclude_HEADERS) \\
#EOF
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x828): undefined reference to`_g_unix_content_type_unalias'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0xae9): undefined reference to`_g_unix_content_type_unalias'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0xcdf): undefined reference to`_g_unix_content_type_unalias'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0xd7e): undefined reference to`_g_unix_content_type_unalias'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0xe9d): undefined reference to`_g_unix_content_type_get_parents'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0xef6): undefined reference to`_g_unix_content_type_get_parents'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x23de): undefined reference to `WIFEXITED'
#####.libs/gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x23f9): undefined reference to `WEXITSTATUS'
#
#
## To do: fix missing gdesktopappinfo.h
#patch -ulbf gio/Makefile.in << EOF
#--- gio/Makefile.in  2012-09-24 03:26:30 +0200
#+++ gio/Makefile.in  2012-09-26 13:20:02 +0200
#@@ -82,3 +82,3 @@
# @HAVE_FAM_TRUE@am__append_14 = fam
#-@OS_UNIX_TRUE@am__append_15 = gdesktopappinfo.c
#+am__append_15 = gdesktopappinfo.c
# @OS_UNIX_TRUE@am__append_16 = xdgmime/libxdgmime.la $(RESOLVER_LIBADD)
#@@ -247,3 +247,3 @@
#        gsocks5proxy.h
#-@OS_UNIX_TRUE@am__objects_1 = libgio_2_0_la-gdesktopappinfo.lo
#+am__objects_1 = libgio_2_0_la-gdesktopappinfo.lo
# @OS_WIN32_TRUE@am__objects_2 = libgio_2_0_la-gwin32appinfo.lo
#@@ -510,3 +510,3 @@
#        gunixsocketaddress.h
#-am__giowin32include_HEADERS_DIST = gwin32inputstream.h \
#+am__giowin32include_HEADERS_DIST = gdesktopappinfo.h gwin32inputstream.h \
#        gwin32outputstream.h
#EOF
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x3f3a): undefined reference to `_g_unix_content_type_unalias'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x4190): undefined reference to `_g_unix_content_type_unalias'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x4455): undefined reference to `_g_unix_content_type_unalias'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x451f): undefined reference to `_g_unix_content_type_unalias'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x45e1): undefined reference to `_g_unix_content_type_unalias'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x4ada): undefined reference to `_g_unix_content_type_get_parents'
#####.libs/libgio_2_0_la-gdesktopappinfo.o:gdesktopappinfo.c:(.text+0x4b48): undefined reference to `_g_unix_content_type_get_parents'
#
#PYTHONPATH=$MINGWPREFIX/share:$MINGWPREFIX/share/glib-2.0${PYTHONPATH:+:$PYTHONPATH} $PYDIR/python.exe $MINGWPREFIX/bin/gdbus-codegen --help



export NAME="GLib"
export STATUS=
#export URL=http://library.gnome.org/devel/glib/stable/glib.html
#export URL=http://developer.gnome.org/glib/stable/
#export URL=https://wiki.gnome.org/Projects/GLib
export URL=https://docs.gtk.org/glib/
export BASENAME=glib2
export DESCRIPTION="GLib is the low-level core library that forms the basis for projects such as GTK+ and GNOME. It provides data structure handling for C, portability wrappers, and interfaces for such runtime functionality as an event loop, threads, dynamic loading, and an object system."
export CATEGORY=framework
export TYPE=library
#export VERSION=2.59.0
#export VERSIONDATE=20181224
####checking whether /D/Prog/Python/WinPython-32bit-2.7.12.4Zero/python-2.7.12/python.exe version is >= 3.4... no
#export VERSION=2.59.1
#export VERSIONDATE=20190126
#export VERSION=2.59.2
#export VERSIONDATE=20190205
#export VERSION=2.59.3
#export VERSIONDATE=20190218
####Checking if "OpenBSD strlcpy/strlcat" runs: DID NOT COMPILE
#export VERSION=2.60.0
#export VERSIONDATE=20190305
#export VERSION=2.60.1
#export VERSIONDATE=20190415
#export VERSION=2.60.2
#export VERSIONDATE=20190504
#export VERSION=2.60.3
#export VERSIONDATE=20190522
#export VERSION=2.60.4
#export VERSIONDATE=20190611
#export VERSION=2.60.5
#export VERSIONDATE=20190709
#export VERSION=2.60.6
#export VERSIONDATE=20190724
####meson.build:1889:0: ERROR: python not found
#export VERSION=2.61.0
#export VERSIONDATE=20190416
#export VERSION=2.61.1
#export VERSIONDATE=20190525
#export VERSION=2.61.2
#export VERSIONDATE=20190805
#export VERSION=2.61.3
#export VERSIONDATE=20190903
#export VERSION=2.62.0
#export VERSIONDATE=20190906
#export VERSION=2.62.1
#export VERSIONDATE=20191005
#export VERSION=2.62.3
#export VERSIONDATE=20191120
#export VERSION=2.62.4
#export VERSIONDATE=20191220
#export VERSION=2.62.5
#export VERSIONDATE=20200218
#export VERSION=2.62.6
#export VERSIONDATE=20200319
#export VERSION=2.63.0
#export VERSIONDATE=20191005
#export VERSION=2.63.1
#export VERSIONDATE=20191101
#export VERSION=2.63.2
#export VERSIONDATE=20191125
#export VERSION=2.63.3
#export VERSIONDATE=20191217
#export VERSION=2.63.4
#export VERSIONDATE=20200122
#export VERSION=2.63.5
#export VERSIONDATE=20200204
#export VERSION=2.63.6
#export VERSIONDATE=20200225
#export VERSION=2.64.0
#export VERSIONDATE=20200228
#export VERSION=2.64.1
#export VERSIONDATE=20200312
#export VERSION=2.64.2
#export VERSIONDATE=20200410
#export VERSION=2.64.3
#export VERSIONDATE=20200520
#export VERSION=2.64.4
#export VERSIONDATE=20200703
#export VERSION=2.64.5
#export VERSIONDATE=20200819
#export VERSION=2.64.6
#export VERSIONDATE=20201002
#export VERSION=2.65.1
#export VERSIONDATE=20200808
#export VERSION=2.65.2
#export VERSIONDATE=20200819
#export VERSION=2.65.3
#export VERSIONDATE=20200903
#export VERSION=2.66.0
#export VERSIONDATE=20200910
#export VERSION=2.66.1
#export VERSIONDATE=20201002
#export VERSION=2.66.2
#export VERSIONDATE=20201020
#export VERSION=2.66.3
#export VERSIONDATE=20201116
#export VERSION=2.66.4
#export VERSIONDATE=20201217
#export VERSION=2.66.5
#export VERSIONDATE=20210204
#export VERSION=2.66.6
#export VERSIONDATE=20210205
#export VERSION=2.66.7
#export VERSIONDATE=20210211
#export VERSION=2.66.8
#export VERSIONDATE=20210319
#export VERSION=2.67.0
#export VERSIONDATE=20201024
#export VERSION=2.67.1
#export VERSIONDATE=20201217
#export VERSION=2.67.2
#export VERSIONDATE=20210108
#export VERSION=2.67.3
#export VERSIONDATE=20210204
#export VERSION=2.67.4
#export VERSIONDATE=20210217
#export VERSION=2.67.5
#export VERSIONDATE=20210301
#export VERSION=2.67.6
#export VERSIONDATE=20210312
####gio/gfile.c:(.text+0x39f): undefined reference to `g_memdup2'
####bug report: https://gitlab.gnome.org/GNOME/glib/-/issues/2355
#export VERSION=2.68.0
#export VERSIONDATE=20210318
#export VERSION=2.68.1
#export VERSIONDATE=20210409
#export VERSION=2.68.2
#export VERSIONDATE=20210511
#export VERSION=2.68.3
#export VERSIONDATE=20210611
#export VERSION=2.68.4
#export VERSIONDATE=20210820
#export VERSION=2.69.0
#export VERSIONDATE=20210707
#export VERSION=2.69.1
#export VERSIONDATE=20210805
#export VERSION=2.69.2
#export VERSIONDATE=20210820
#export VERSION=2.69.3
#export VERSIONDATE=20210907
#export VERSION=2.70.0
#export VERSIONDATE=20210917
#export VERSION=2.70.1
#export VERSIONDATE=20211028
#export VERSION=2.70.2
#export VERSIONDATE=20211203
#export VERSION=2.70.3
#export VERSIONDATE=20220127
#export VERSION=2.70.4
#export VERSIONDATE=20220211
#export VERSION=2.71.0
#export VERSIONDATE=20211217
#export VERSION=2.71.1
#export VERSIONDATE=20220128
#export VERSION=2.71.2
#export VERSIONDATE=20220216
#export VERSION=2.71.3
#export VERSIONDATE=20220305
#export VERSION=2.72.0
#export VERSIONDATE=20220318
#export VERSION=2.72.1
#export VERSIONDATE=20220414
#export VERSION=2.72.2
#export VERSIONDATE=20220531
#export VERSION=2.72.3
#export VERSIONDATE=20220701
#export VERSION=2.73.0
#export VERSIONDATE=20220528
#export VERSION=2.73.1
#export VERSIONDATE=20220620
#export VERSION=2.73.2
#export VERSIONDATE=20220713
#export VERSION=2.73.3
#export VERSIONDATE=20220806
#export VERSION=2.74.0
#export VERSIONDATE=20220918
#export VERSION=2.74.1
#export VERSIONDATE=20221026
#export VERSION=2.74.2
#export VERSIONDATE=20221126
#export VERSION=2.74.3
#export VERSIONDATE=20221202
#export VERSION=2.74.4
#export VERSIONDATE=20221222
#export VERSION=2.74.5
#export VERSIONDATE=20230120
#export VERSION=2.74.6
#export VERSIONDATE=20230224
#export VERSION=2.74.7
#export VERSIONDATE=20240107
#export VERSION=2.75.0
#export VERSIONDATE=20221110
#export VERSION=2.75.1
#export VERSIONDATE=20221222
#export VERSION=2.75.2
#export VERSIONDATE=20230106
#export VERSION=2.75.3
#export VERSIONDATE=20230214
#export VERSION=2.75.4
#export VERSIONDATE=20230303
#export VERSION=2.76.0
#export VERSIONDATE=20230311
#export VERSION=2.76.1
#export VERSIONDATE=20230322
#export VERSION=2.76.2
#export VERSIONDATE=20230422
#export VERSION=2.76.3
#export VERSIONDATE=20230523
#export VERSION=2.76.4
#export VERSIONDATE=20230707
#export VERSION=2.76.6
#export VERSIONDATE=20240107
#export VERSION=2.77.0
#export VERSIONDATE=20230707
#export VERSION=2.77.1
#export VERSIONDATE=20230731
#export VERSION=2.77.2
#export VERSIONDATE=20230813
#export VERSION=2.77.3
#export VERSIONDATE=20230831
#export VERSION=2.78.0
#export VERSIONDATE=20230909
#export VERSION=2.78.1
#export VERSIONDATE=20231025
#export VERSION=2.78.2
#export VERSIONDATE=20231206
#export VERSION=2.78.3
#export VERSIONDATE=20231207
#export VERSION=2.78.4
#export VERSIONDATE=20240122
#export VERSION=2.78.5
#export VERSIONDATE=20240508
#export VERSION=2.78.6
#export VERSIONDATE=20240509
#export DEPENDENCIES=pcre,pcre2,gettext,zlib,libffi
#export OPTIONALDEPENDENCIES=
#export BUILDDEPENDENCIES=meson,ninja,pkg-config
#export OPTIONALBUILDDEPENDENCIES=
#export VERSION=2.79.0
#export VERSIONDATE=20231223
#export VERSION=2.79.1
#export VERSIONDATE=20240123
#export VERSION=2.79.2
#export VERSIONDATE=20240213
#export VERSION=2.79.3
#export VERSIONDATE=20240227
####meson.build:2379:26: ERROR: python is missing modules: packaging
#export VERSION=2.80.0
#export VERSIONDATE=20240308
#export VERSION=2.80.1
#export VERSIONDATE=20240508
#export VERSION=2.80.2
#export VERSIONDATE=20240509
#export VERSION=2.80.3
#export VERSIONDATE=20240610
#export VERSION=2.80.4
#export VERSIONDATE=20240709
#export VERSION=2.80.5
#export VERSIONDATE=20240826
#export VERSION=2.81.0
#export VERSIONDATE=20240629
#export VERSION=2.81.1
#export VERSIONDATE=20240805
#export VERSION=2.81.2
#export VERSIONDATE=20240817
#export VERSION=2.82.0
#export VERSIONDATE=20240826
#export VERSION=2.82.1
#export VERSIONDATE=20240920
#export VERSION=2.82.2
#export VERSIONDATE=20241017
#export VERSION=2.82.3
#export VERSIONDATE=20241210
#export VERSION=2.82.4
#export VERSIONDATE=20241212
#export VERSION=2.82.5
#export VERSIONDATE=20250220
#export VERSION=2.83.0
#export VERSIONDATE=20241107
#export VERSION=2.83.2
#export VERSIONDATE=20241212
#export VERSION=2.83.3
#export VERSIONDATE=20250123
#export VERSION=2.83.4
#export VERSIONDATE=20250220
#export VERSION=2.83.5
#export VERSIONDATE=20250301
#export VERSION=2.84.0
#export VERSIONDATE=20250306
#export VERSION=2.84.1
#export VERSIONDATE=20250404
#export VERSION=2.84.2
#export VERSIONDATE=20250521
#export VERSION=2.84.3
#export VERSIONDATE=20250613
#export VERSION=2.84.4
#export VERSIONDATE=20250809
#export VERSION=2.85.0
#export VERSIONDATE=20250521
#export VERSION=2.85.1
#export VERSIONDATE=20250613
#export VERSION=2.85.2
#export VERSIONDATE=20250722
#export VERSION=2.85.3
#export VERSIONDATE=20250809
#export VERSION=2.85.4
#export VERSIONDATE=20250822
export VERSION=2.86.0
export VERSIONDATE=20250905
wl-showstatus --package-version
export DEPENDENCIES=pcre,pcre2,gettext,zlib,libffi
export OPTIONALDEPENDENCIES=gobject-introspection
export BUILDDEPENDENCIES=meson,ninja,pkg-config,pypackaging
export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
export LICENSEFILE=LICENSES/LGPL-2.1-or-later.txt
export LICENSETYPE=LGPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/glib/ glib-"
#export DOWNLOADURL="https://download.gnome.org/sources/glib/ glib-"
export DOWNLOADURL="https://gitlab.gnome.org/GNOME/glib/-/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/GNOME/sources/glib/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/glib-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://download.gnome.org/sources/glib/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/glib-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xJ --force-local -f $TARBALLDIR/$BASENAME/glib-$VERSION.tar.xz
cd glib-$VERSION
# fix definition of DllMain in static build (version >= 2.60.0)
patch -ulbf glib/glib-init.c << EOF
@@ -270,5 +270,5 @@
 }

-#if defined (G_OS_WIN32)
+#if defined(DLL_EXPORT) && defined (G_OS_WIN32)

 BOOL WINAPI DllMain (HINSTANCE hinstDLL,
EOF
patch -ulbf glib/ggettext.c << EOF
@@ -60,4 +60,6 @@

+#if defined(DLL_EXPORT)
   if (glib_dll != NULL)
     install_dir = g_win32_get_package_installation_directory_of_module (glib_dll);
+#endif

EOF
## fix glib/gutils.c (version <= 2.71.0)
#patch -ulbf glib/gutils.c << EOF
#@@ -135,6 +135,7 @@
#
#-#ifdef DLL_EXPORT
#+#ifndef DLL_EXPORT
#+  return NULL;
#+#else
#   if (glib_dll == NULL)
#     return NULL;
#-#endif
#
#@@ -163,2 +164,3 @@
#   return retval;
#+#endif
# }
#@@ -1972,2 +1974,3 @@
#
#+#ifdef DLL_EXPORT
#   if (glib_dll != NULL)
#@@ -1980,2 +1983,3 @@
#     }
#+#endif
#
#EOF
# fix missing qsort and unix specific functions in gio/gdesktopappinfo.c (version >= 2.64.2)
####TO DO: properlu fix desktop_file_dir_unindexed_get_tweaks() and get_list_of_mimetypes()
patch -ulbf gio/gdesktopappinfo.c << EOF
@@ -33,2 +33,3 @@
 #include <unistd.h>
+#include <stdlib.h>

@@ -752,2 +753,5 @@
 {
+#ifdef _WIN32
+  return NULL;
+#else
   UnindexedMimeTweaks *tweaks;
@@ -767,2 +771,3 @@
   return tweaks;
+#endif
 }
@@ -4095,2 +4100,5 @@
 {
+#ifdef _WIN32
+  return NULL;
+#else
   gchar *unaliased;
@@ -4127,2 +4135,3 @@
   return (gchar **) g_ptr_array_free (array, FALSE);
+#endif
 }
EOF
# fix already defined interface in gio/gdesktopappinfo.h (version >= 2.86.0)
sed -i.bak -e "s/\binterface\b/iface/" gio/gdesktopappinfo.h
# don't hardcode absolute Python path in shebang (version >= 2.64.3)
sed -i.bak -e "s/@PYTHON@/python.exe/" gobject/glib-mkenums.in gobject/glib-genmarshal.in gio/gdbus-2.0/codegen/gdbus-codegen.in glib/gtester-report.in
## fix missing python3 in meson.build (version >= 2.60.0)
#patch -ulbf meson.build << EOF
#@@ -1881,5 +1881,5 @@
#
#-python = import('python').find_installation('python3')
#+python = import('python').find_installation('python')
# # used for '#!/usr/bin/env <name>'
#-python_name = 'python3'
#+python_name = '$PYDIR/python.exe'
#
#EOF
# avoid building tests
sed -i.bak -e "s/subdir('tests')//" meson.build */meson.build
# also build gdesktopappinfo.c on Windows (version >= 2.64.2)
sed -i.bak2 -e "s/'gwin32appinfo.c'/&, 'gdesktopappinfo.c'/" meson.build gio/meson.build
# allow building both static and shared library in meson.build (version >= 2.71.1)
sed -i.bak3 -e "s/error.*On Windows default_library must be .* but not .*both/#&/" meson.build
# don't abort on int conversion warnings when using clang
sed -i.bak4 -e "s/'-Wno-unused-parameter',/& '-Wno-int-conversion',/" meson.build
## fix detection of Python (version >= 2.79.0)
##sed -i.bak5 -e "s/'python3'/'python.exe'/" meson.build
#sed -i.bak5 -e "s?'python3'?'$(cygpath -m $PYDIR/python.exe)'?" meson.build
# fix detection of Python (version >= 2.84.1)
sed -i.bak5 -e "s?^\(python_shebang.*python\)3?\1.exe?" meson.build
#sed -i.bak6 -e "s/modules: ['packaging']//" meson.build
mkdir -p build_both &&
 wl-showstatus configure &&
 #PKG_CONFIG= PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -D iconv=native -D selinux=disabled -D xattr=false -D libmount=false -D systemtap=false -D fam=false -D man=false -D gtk_doc=false . build_both &&
 #PKG_CONFIG= PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -D iconv=external -D selinux=disabled -D xattr=false -D libmount=false -D systemtap=false -D fam=false -D man=false -D gtk_doc=false . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -D iconv=external -D selinux=disabled -D xattr=false -D systemtap=false -D fam=false -D man=false -D gtk_doc=false . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -D iconv=external -D selinux=disabled -D xattr=false -D systemtap=false -D fam=false -D man=false -D gtk_doc=false -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Diconv=external -Dselinux=disabled -Dxattr=false -Dsystemtap=false -Dman=false -Dgtk_doc=false -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Diconv=external -Dselinux=disabled -Dxattr=false -Dsystemtap=false -Dman=false -Dgtk_doc=false -Dc_args="-Wno-int-conversion" -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dselinux=disabled -Dxattr=false -Dsystemtap=false -Dman=false -Dgtk_doc=false -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 #PKG_CONFIG=$(which pkg-config.exe) PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dlibelf=disabled -Dselinux=disabled -Dxattr=false -Dsystemtap=false -Dman=false -Dgtk_doc=false -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 PKG_CONFIG=$(which pkg-config.exe) PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dlibelf=disabled -Dselinux=disabled -Dxattr=false -Dsystemtap=false -Dman-pages=disabled -Ddocumentation=false -Dc_link_args="-Wl,--allow-multiple-definition" . build_both &&
 echo "#undef HAVE_POSIX_MEMALIGN" >> build_both/config.h &&
 echo "#undef HAVE_STPCPY" >> build_both/config.h &&
 #wl-showstatus build &&
 ##PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -C build_both &&
 #( PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -C build_both || ( cp build_both/gio/glib-compile-resources.exe build_both/gio/ && PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -C build_both )) &&
 wl-showstatus build-install &&
 #PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -Cbuild_both install &&
 #( PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -Cbuild_both install || PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -j1 -Cbuild_both install ) &&
 ( PATH=$PATH:$PYDIR PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} ninja -Cbuild_both install || PATH=$PATH:$PYDIR PYTHONPATH=$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} ninja -j1 -Cbuild_both install ) &&
 cp -u gio/gdesktopappinfo.h $INSTALLPREFIX/include/gio-win32-2.0/gio/ &&
 # don't install pcre2 (version >= 2.76.0)
 ( rm -f $INSTALLPREFIX/bin/libpcre2*.dll $INSTALLPREFIX/bin/pcre2*.exe $INSTALLPREFIX/include/pcre2*.h $INSTALLPREFIX/lib/libpcre2-*.a $INSTALLPREFIX/lib/pkgconfig/libpcre2-*.pc || true ) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf glib-$VERSION
####TO DO: better detection of static use (define GLIB_STATIC_COMPILATION/GOBJECT_STATIC_COMPILATION)



