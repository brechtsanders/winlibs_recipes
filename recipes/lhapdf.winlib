export NAME="LHAPDF"
export STATUS=
export URL=https://lhapdf.hepforge.org/
export BASENAME=lhapdf
export DESCRIPTION="LHAPDF is the standard tool for evaluating parton distribution functions (PDFs) in high-energy physics. PDFs encode the flavour and momentum structure of composite particles, such as protons, pions and nuclei; most cross-section calculations are based on parton-level matrix-elements which must be connected to the real interacting particles, hence PDFs are an essential ingredient of phenomenological and experimental studies at hadron and heavy-ion colliders (e.g. LHC, HERA, Tevatron, EIC, FCC) and in cosmic-ray physics."
export CATEGORY=math,science
export TYPE=library
#export VERSION=6.5.4
#export VERSIONDATE=20231218
#export VERSION=6.5.5
#export VERSIONDATE=20241217
export VERSION=6.5.6
export VERSIONDATE=20260221
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="https://lhapdf.hepforge.org/downloads/ ?f=LHAPDF-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://lhapdf.hepforge.org/downloads/?f=LHAPDF-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/*LHAPDF-$VERSION.tar.gz
cd LHAPDF-$VERSION
# fix undefined setenv() in src/Paths.cc (version >= 6.5.5)
patch -ulbf src/Paths.cc << EOF
@@ -37,3 +37,8 @@
   void setPaths(const string& pathstr) {
+#ifdef _WIN32
+    string envset = "LHAPDF_DATA_PATH=" + pathstr;
+    putenv(envset.c_str());
+#else
     setenv("LHAPDF_DATA_PATH", pathstr.c_str(), 1);
+#endif
   }
EOF
# skip building Python wrappers and examples
sed -i.bak -e "s/^\(SUBDIRS =.*\)wrappers\(.*\)examples\(.*\)/\1\2\3/" Makefile.in
wl-showstatus configure &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-python PYTHON=$PYDIR/python.exe --disable-doxygen &&
 # fix building DLLs
 sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 # fix detection of shared libraries
 sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1pass_all/" libtool &&
 wl-showstatus build-install &&
 make install-strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf LHAPDF-$VERSION



