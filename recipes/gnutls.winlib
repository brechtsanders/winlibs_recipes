export NAME="GnuTLS"
export STATUS=
export URL=http://www.gnu.org/software/gnutls/
export BASENAME=gnutls
#export DESCRIPTION="GnuTLS is a project that aims to develop a library which provides a secure layer, over a reliable transport layer. Currently the GnuTLS library implements the proposed standards by the IETF's TLS working group."
export DESCRIPTION="GnuTLS is a secure communications library implementing the SSL and TLS protocols and technologies around them. It provides a simple C language application programming interface (API) to access the secure communications protocols as well as APIs to parse and write X.509, PKCS #12, OpenPGP and other required structures. It is aimed to be portable and efficient with focus on security and interoperability."
export CATEGORY=security
export TYPE=library
#export VERSION=2.3.4
#export VERSION=2.3.9
#export VERSION=2.3.11
#export VERSION=2.5.4
#export VERSION=2.6.3
#export VERSION=2.6.4
#export VERSION=2.6.5
#export VERSION=2.6.6
#export VERSION=2.8.0
#export VERSION=2.8.1
#export VERSION=2.8.2
#export VERSION=2.8.3
#export VERSION=2.8.4
#export VERSION=2.8.5
#export VERSIONDATE=20091102
#export VERSION=2.8.6
#export VERSIONDATE=20100316
#export VERSION=2.10.0
#export VERSIONDATE=20100625
#export VERSION=2.10.1
#export VERSIONDATE=20100726
#export VERSION=2.10.2
#export VERSIONDATE=20100930
#export VERSION=2.10.3
#export VERSIONDATE=20101119
#export VERSION=2.10.4
#export VERSIONDATE=20101206
#export VERSION=2.10.5
#export VERSIONDATE=20110228
#export DEPENDENCIES=gettext,libgcrypt,readline,zlib,libgpg-error
#export VERSION=2.12.0
#export VERSIONDATE=20110325
####lib/nettle/egd.c:31:20: error: sys/un.h: No such file or directory
####lib/nettle/egd.c:107: error: 'S_IFSOCK' undeclared (first use in this function)
#export VERSION=2.12.1
#export VERSIONDATE=20110402
####lib/nettle/rnd.c:64: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'device_fd'
#export VERSION=2.12.2
#export VERSIONDATE=20110409
#export VERSION=2.12.3
#export VERSIONDATE=20110422
#export VERSION=2.12.4
#export VERSIONDATE=20110507
#export VERSION=2.12.5
#export VERSIONDATE=20110514
#export VERSION=2.12.6.1
#export VERSIONDATE=20110605
#export VERSION=2.12.7
#export VERSIONDATE=20110621
####undefined reference to `socket_used_without_requesting_gnulib_module_socket'
####undefined reference to `socket_used_without_requesting_gnulib_module_connect'
#export VERSION=2.12.8
#export VERSIONDATE=20110809
#export VERSION=2.12.9
#export VERSIONDATE=20110821
#export VERSION=2.12.10
#export VERSIONDATE=20110901
#export VERSION=2.12.11
#export VERSIONDATE=20110919
#export VERSION=2.12.12
#export VERSIONDATE=20111021
#export VERSION=2.12.13
#export VERSIONDATE=20111108
#export VERSION=2.12.14
#export VERSIONDATE=20111108
#export VERSION=2.12.16
#export VERSIONDATE=20120107
####make[4]: *** No rule to make target `libgnutls-26.def', needed by `all-am'.  Stop.
#export VERSION=2.12.17
#export VERSIONDATE=20120303
####lib/nettle/rnd.c:64: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'device_fd'
####lib/nettle/.libs/libcrypto.a(egd.o):egd.c:(.text+0x287): undefined reference to `socket_used_without_requesting_gnulib_module_connect'
#export VERSION=2.12.18
#export VERSIONDATE=20120317
#export VERSION=2.12.19
#export VERSIONDATE=20120506
#export VERSION=2.12.20
#export VERSIONDATE=20120610
#export VERSION=2.12.23
#export VERSIONDATE=20140613
#export VERSION=2.12.24
#export VERSIONDATE=20161104
####lib/nettle/pk.c:57:31: warning: 'struct dsa_public_key' declared inside parameter list [enabled by default]
####lib/nettle/pk.c:59:15: error: dereferencing pointer to incomplete type
#export VERSION=2.12.21
#export VERSIONDATE=20121109
####libextra/.libs/openssl_compat.o:openssl_compat.c:(.text+0x25): undefined reference to `_asn1_create_element'
#export DEPENDENCIES=gettext,libgcrypt,readline,zlib,libgpg-error,libnettle,pakchois
#export VERSION=3.0.8
#export VERSIONDATE=20111126
#export VERSION=3.0.9
#export VERSIONDATE=20111214
#export VERSION=3.0.10
#export VERSIONDATE=20120105
#export VERSION=3.0.11
#export VERSIONDATE=20120107
#export VERSION=3.0.12
#export VERSIONDATE=20120120
#export VERSION=3.0.13
#export VERSIONDATE=20120218
#export VERSION=3.0.14
#export VERSIONDATE=20120225
#export VERSION=3.0.15
#export VERSIONDATE=20120303
####src/libopts/libopts.c:(.text+0x748f): undefined reference to `fchmod'
#export VERSION=3.0.16
#export VERSIONDATE=20120317
####serv-args.h:62:3: error: #error option template version mismatches autoopts/options.h header
#export VERSION=3.0.17
#export VERSIONDATE=20120317
#export VERSION=3.0.18
#export VERSIONDATE=20120403
#export VERSION=3.0.19
#export VERSIONDATE=20120423
#export VERSION=3.0.20
#export VERSIONDATE=20120606
####undefined reference to `CertEnumCRLsInStore'
#export VERSION=3.0.21
#export VERSIONDATE=20120703
#export VERSION=3.0.22
#export VERSIONDATE=20120804
#export VERSION=3.0.23
#export VERSIONDATE=20120903
#export VERSION=3.0.24
#export VERSIONDATE=20120927
#export VERSION=3.0.25
#export VERSIONDATE=20121013
#export VERSION=3.0.26
#export VERSIONDATE=20121109
####lib/.libs/gnutls_x509.o:gnutls_x509.c:(.text+0x3369): undefined reference to `_CertEnumCRLsInStore'
####CertEnumCRLsInStore should be part of wincrypt.h
#export VERSION=3.1.0
#export VERSIONDATE=20120816
#export VERSION=3.1.1
#export VERSIONDATE=20120903
#export VERSION=3.1.2
#export VERSIONDATE=20120927
#export VERSION=3.1.3
#export VERSIONDATE=20121013
#export VERSION=3.1.4
#export VERSIONDATE=20121110
####libdane/dane.c:175:42: error: incomplete universal character name \U
#export VERSION=3.1.5
#export VERSIONDATE=20121125
#export VERSION=3.1.6
#export VERSIONDATE=20140825
#export VERSION=3.1.17
#export VERSIONDATE=20140825
#export VERSION=3.1.28
#export VERSIONDATE=20141110
#export VERSION=3.2.15
#export VERSIONDATE=20140612
#export VERSION=3.2.16
#export VERSIONDATE=20140724
#export VERSION=3.2.17
#export VERSIONDATE=20140825
#export VERSION=3.2.18
#export VERSIONDATE=20140918
#export VERSION=3.2.19
#export VERSIONDATE=20141013
####lib/vasprintf.c:45:2: error: #error No va_copy()!
#export VERSION=3.2.20
#export VERSIONDATE=20141110
#export VERSION=3.2.21
#export VERSIONDATE=20141211
#export VERSION=3.3.4
#export VERSIONDATE=20140612
#export VERSION=3.3.5
#export VERSIONDATE=20140627
#export VERSION=3.3.6
#export VERSIONDATE=20140724
#export VERSION=3.3.7
#export VERSIONDATE=20140825
#export VERSION=3.3.8
#export VERSIONDATE=20140918
#export VERSION=3.3.9
#export VERSIONDATE=20141013
####lib/gnutls_str.h:100:3: warning: 'libintl_printf' is an unrecognized format function type [-Wformat]
#export VERSION=3.3.10
#export VERSIONDATE=20141110
#export VERSION=3.3.11
#export VERSIONDATE=20141112
####lib/vasprintf.c:45:2: error: #error No va_copy()!
#export VERSION=3.3.12
#export VERSIONDATE=20150117
#export VERSION=3.3.13
#export VERSIONDATE=20150226
#export VERSION=3.3.14
#export VERSIONDATE=20150330
#export VERSION=3.3.15
#export VERSIONDATE=20150504
#export VERSION=3.3.16
#export VERSIONDATE=20150712
#export VERSION=3.3.17.1
#export VERSIONDATE=20150811
#export VERSION=3.3.18
#export VERSIONDATE=20150912
#export VERSION=3.3.19
#export VERSIONDATE=20151122
#export VERSION=3.3.20
#export VERSIONDATE=20160108
#export VERSION=3.3.21
#export VERSIONDATE=20160203
#export VERSION=3.3.22
#export VERSIONDATE=20160310
#export VERSION=3.3.23
#export VERSIONDATE=20160520
#export VERSION=3.3.24
#export VERSIONDATE=20160706
#export VERSION=3.3.26
#export VERSIONDATE=20170109
#export VERSION=3.3.27
#export VERSIONDATE=20170306
#export VERSION=3.3.28
#export VERSIONDATE=20170704
#export VERSION=3.3.29
#export VERSIONDATE=20180216
#export VERSION=3.3.30
#export VERSIONDATE=20180716
#export VERSION=3.4.0
#export VERSIONDATE=20150411
#export VERSION=3.4.1
#export VERSIONDATE=20150504
#export VERSION=3.4.2
#export VERSIONDATE=20150617
#export VERSION=3.4.3
#export VERSIONDATE=20150712
#export VERSION=3.4.4.1
#export VERSIONDATE=20150811
####Libnettle 3.1 was not found.
####cc1.exe: warning: ../../lib/minitasn1: No such file or directory [enabled by default]
####gl/sys/socket.h:68:3: error: #error "Please include config.h first."
#export VERSION=3.4.5
#export VERSIONDATE=20150912
####gl/sys/socket.h:68:3: error: #error "Please include config.h first."
#export VERSION=3.4.6
#export VERSIONDATE=20151021
#export VERSION=3.4.7
#export VERSIONDATE=20151122
#export VERSION=3.4.8
#export VERSIONDATE=20160108
#export VERSION=3.4.9
#export VERSIONDATE=20160203
#export VERSION=3.4.10
#export VERSIONDATE=20160303
#export VERSION=3.4.11
#export VERSIONDATE=20160411
#export VERSION=3.4.12
#export VERSIONDATE=20160520
#export VERSION=3.4.13
#export VERSIONDATE=20160607
#export VERSION=3.4.14
#export VERSIONDATE=20160706
#export VERSION=3.4.15
#export VERSIONDATE=20160908
#export VERSION=3.4.17
#export VERSIONDATE=20161208
#export VERSION=3.5.0
#export VERSIONDATE=20160509
#export VERSION=3.5.1
#export VERSIONDATE=20160615
#export VERSION=3.5.2
#export VERSIONDATE=20160706
#export VERSION=3.5.3
#export VERSIONDATE=20160809
#export VERSION=3.5.4
#export VERSIONDATE=20160908
#export VERSION=3.5.5
#export VERSIONDATE=20161010
#export VERSION=3.5.6
#export VERSIONDATE=20161104
#export VERSION=3.5.7
#export VERSIONDATE=20161208
#export VERSION=3.5.8
#export VERSIONDATE=20170109
#export VERSION=3.5.9
#export VERSIONDATE=20170212
#export VERSION=3.5.10
#export VERSIONDATE=20170306
#export VERSION=3.5.11
#export VERSIONDATE=20170407
#export VERSION=3.5.12
#export VERSIONDATE=20170511
#export VERSION=3.5.13
#export VERSIONDATE=20170607
#export VERSION=3.5.14
#export VERSIONDATE=20170704
#export VERSION=3.5.15
#export VERSIONDATE=20170821
#export VERSION=3.5.16
#export VERSIONDATE=20171021
#export VERSION=3.5.17
#export VERSIONDATE=20180117
#export VERSION=3.5.18
#export VERSIONDATE=20180216
#export VERSION=3.5.19
#export VERSIONDATE=20180716
#export VERSION=3.6.0
#export VERSIONDATE=20170821
#export VERSION=3.6.1
#export VERSIONDATE=20171021
#export DEPENDENCIES=gmp,libnettle,gettext,p11-kit,zlib,libgcrypt,libtasn1,readline,libgpg-error,pthreads
#export VERSION=3.6.2
#export VERSIONDATE=20180216
#export VERSION=3.6.3
#export VERSIONDATE=20180716
#export VERSION=3.6.10
#export VERSIONDATE=20191012
#export VERSION=3.6.14
#export VERSIONDATE=20200804
#export VERSION=3.6.16
#export VERSIONDATE=20211225
#export VERSION=3.7.0
#export VERSIONDATE=20201202
####configure: WARNING:
####*** GnuTLS will be build as a static library. That means that library
####*** constructors for gnutls_global_init will not be made available to
####*** linking applications. If you are building that library for arbitrary
####*** applications to link, do not enable static linking.
#export VERSION=3.7.2
#export VERSIONDATE=20211225
#export DEPENDENCIES=gmp,libnettle,gettext,p11-kit,zlib,libgcrypt,libtasn1,readline,libgpg-error,pthreads,libunistring
#export OPTIONALDEPENDENCIES=guile,libcfg+,gaa,unbound,trousers
#export BUILDDEPENDENCIES=pkg-config
#export OPTIONALBUILDDEPENDENCIES=
#export VERSION=3.7.7
#export VERSIONDATE=20220916
export VERSION=3.8.0
export VERSIONDATE=20230210
wl-showstatus --package-version
export DEPENDENCIES=gmp,libnettle,gettext,p11-kit,zlib,libgcrypt,libtasn1,readline,libgpg-error,pthreads,libunistring,libdl
export OPTIONALDEPENDENCIES=guile,libcfg+,gaa,unbound,trousers,tpm2-tss
export BUILDDEPENDENCIES=pkg-config
export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL3
export LICENSEFILE=LICENSE
export LICENSETYPE=LGPL
#export DOWNLOADURL="https://www.gnupg.org/ftp/gcrypt/gnutls/"
#export DOWNLOADURL="http://ftp.gnu.org/pub/gnu/gnutls/"
#export DOWNLOADURL="ftp://ftp.gnutls.org/gcrypt/gnutls/"
export DOWNLOADURL="https://www.gnupg.org/ftp/gcrypt/gnutls/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnu.org/pub/gnu/gnutls/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnu.org/pub/gnu/gnutls/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=ftp://ftp.gnutls.org/gcrypt/gnutls/v$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=ftp://ftp.gnutls.org/gcrypt/gnutls/v$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://www.gnupg.org/ftp/gcrypt/gnutls/v$(echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/")/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
## fix undefined reference to virtual base class abstract method
#mv includes/gnutls/gnutlsxx.h includes/gnutls/gnutlsxx.h.bak &&
#sed -e "s?\(virtual void set_ptr(.*)\)?\1 {} // ?" includes/gnutls/gnutlsxx.h.bak > includes/gnutls/gnutlsxx.h
# work around failed check for libgcrypt (version >= 2.8.0 <= 2.8.5)
#patch -ulbf configure << EOF
#--- configure  Thu Jun 11 11:47:18 2009
#+++ configure  Thu Jun 11 11:47:40 2009
#@@ -7492,10 +7492,2 @@
# 
#-  if test "\$ac_cv_libgcrypt" != yes; then
#-    as_fn_error "
#-***
#-*** libgcrypt was not found. You may want to get it from
#-*** ftp://ftp.gnupg.org/gcrypt/libgcrypt/
#-***
#-    " "\$LINENO" 5
#-  fi
#EOF
#patch -ulbf lib/configure << EOF
#--- lib/configure  Wed Jun 10 16:21:42 2009
#+++ lib/configure  Thu Jun 11 11:50:44 2009
#@@ -12527,10 +12527,2 @@
# 
#-  if test "\$ac_cv_libgcrypt" != yes; then
#-    as_fn_error "
#-***
#-*** libgcrypt was not found. You may want to get it from
#-*** ftp://ftp.gnupg.org/gcrypt/libgcrypt/
#-***
#-    " "\$LINENO" 5
#-  fi
#EOF
#patch -ulbf libextra/configure << EOF
#--- libextra/configure  Wed Jun 10 16:22:00 2009
#+++ libextra/configure  Thu Jun 11 11:54:06 2009
#@@ -11901,10 +11901,2 @@
# 
#-  if test "\$ac_cv_libgcrypt" != yes; then
#-    as_fn_error "
#-***
#-*** libgcrypt was not found. You may want to get it from
#-*** ftp://ftp.gnupg.org/gcrypt/libgcrypt/
#-***
#-    " "\$LINENO" 5
#-  fi
#EOF
## fix undefined references to rpl_fseeko and missing -e parameter to sed
#mv libextra/Makefile libextra/Makefile.bak &&
#sed -e "s?\(\$(libgnutls_[^ ]*_la_LINK).*\)?\1 -L../gl/.libs -lgnu?; s/\(sed\) \([\"\']\{0,1\}\)/\1 -e \2/" libextra/Makefile.bak > libextra/Makefile
## fix undefined references to rpl_fseeko
#mv lib/Makefile lib/Makefile.bak &&
#sed -e "s?\(\$(libgnutls_[^ ]*_la_LINK).*\)?\1 -L../gl/.libs -lgnu?" lib/Makefile.bak > lib/Makefile
## workaround for libgpg-error.la being searched in the wrong place
#mv libtool libtool.bak &&
#ln -s $MINGWPREFIX/bin/libtool .
## workaround for missing fchmod
#mv src/certtool.c src/certtool.c.bak &&
#echo "#define fchmod(f,p) 0" > src/certtool.c &&
#cat src/certtool.c.bak >> src/certtool.c
## fix missing HCRYPTPROV in lib/nettle/rnd.c (version >= 2.12.0 <= 2.12.21)
#mv lib/nettle/rnd.c lib/nettle/rnd.c.bak
#cat > lib/nettle/rnd.c << EOF
##include <windows.h>
##include <wincrypt.h>
#EOF
#cat lib/nettle/rnd.c.bak >> lib/nettle/rnd.c
# fix missing sys/un.h (version >= 2.12.0)
mkdir -p lib/nettle/sys
cat > lib/nettle/sys/un.h << EOF
#include <stdint.h>
//#include <winsock2.h>
//#define sockaddr_un sockaddr_in
#define UNIX_PATH_LEN 108
struct sockaddr_un {
  uint16_t  sun_family;
  char      sun_path[UNIX_PATH_LEN];
};
#define S_IFSOCK 0140000
#define AF_LOCAL 1
EOF
# fix lib/gl/sys/socket.h (version >= 2.12.0)
patch -ulbf lib/gl/sys_socket.in.h << EOF
--- lib/gl/sys_socket.in.h  2011-04-09 08:44:48 +0200
+++ lib/gl/sys_socket.in.h  2011-04-09 08:45:04 +0200
@@ -240,4 +240,4 @@
 #elif @HAVE_WINSOCK2_H@
-# undef socket
-# define socket socket_used_without_requesting_gnulib_module_socket
+//# undef socket
+//# define socket socket_used_without_requesting_gnulib_module_socket
 #elif defined GNULIB_POSIXCHECK
@@ -270,4 +270,4 @@
 #elif @HAVE_WINSOCK2_H@
-# undef connect
-# define connect socket_used_without_requesting_gnulib_module_connect
+//# undef connect
+//# define connect socket_used_without_requesting_gnulib_module_connect
 #elif defined GNULIB_POSIXCHECK
EOF
# fix redefined X509_NAME in libextra/gnutls_openssl.c (64-bit) (version >= 2.10.5)
patch -ulbf libextra/gnutls_openssl.c << EOF
--- libextra/gnutls_openssl.c  2010-08-01 22:37:30 +0200
+++ libextra/gnutls_openssl.c  2011-08-04 22:55:46 +0200
@@ -36,2 +36,3 @@
 #undef shutdown
+#undef X509_NAME

EOF
# fix redefined X509_NAME in libextra/openssl_compat.c (64-bit) (version >= 2.10.5)
patch -ulbf libextra/openssl_compat.c << EOF
--- libextra/openssl_compat.c  2010-08-01 22:37:30 +0200
+++ libextra/openssl_compat.c  2011-08-04 22:56:10 +0200
@@ -34,2 +34,3 @@
 #include <libtasn1.h>
+#undef X509_NAME
 #include <gnutls/x509.h>
EOF
# fix missing uint16_t on 64-bit in lib/nettle/egd.c (version >= 2.12.9)
mv lib/nettle/egd.c lib/nettle/egd.c.bak &&
echo "#include <stdint.h>" > lib/nettle/egd.c &&
cat lib/nettle/egd.c.bak >> lib/nettle/egd.c
# fix redefinition of X509_NAME in extra/includes/gnutls/openssl.h (version >= 3.0.8)
mv extra/includes/gnutls/openssl.h extra/includes/gnutls/openssl.h.bak &&
echo "#undef X509_NAME" > extra/includes/gnutls/openssl.h &&
cat extra/includes/gnutls/openssl.h.bak >> extra/includes/gnutls/openssl.h
# fix missing AI_ADDRCONFIG in src/serv.c (version >= 3.0.10)
mv src/serv.c src/serv.c.bak &&
echo "#define AI_ADDRCONFIG 0" > src/serv.c &&
cat src/serv.c.bak >> src/serv.c
# fix gl/netdb.h (version >= 3.0.12)
patch -ulbf gl/netdb.in.h << EOF
--- gl/netdb.in.h  2012-01-24 17:05:04 +0100
+++ gl/netdb.in.h  2012-01-24 17:05:10 +0100
@@ -161,3 +161,3 @@

-# if !@HAVE_DECL_GETADDRINFO@
+# if !@HAVE_DECL_GETADDRINFO@ && !defined(__MINGW32__)
 /* Translate name of a service location and/or a service name to set of
@@ -180,3 +180,3 @@

-# if !@HAVE_DECL_FREEADDRINFO@
+# if !@HAVE_DECL_FREEADDRINFO@ && !defined(__MINGW32__)
 /* Free 'addrinfo' structure AI including associated storage.
@@ -208,3 +208,3 @@

-# if !@HAVE_DECL_GETNAMEINFO@
+# if !@HAVE_DECL_GETNAMEINFO@ && !defined(__MINGW32__)
 /* Convert socket address to printable node and service names.
EOF
# fix gl/getaddrinfo.c (version >= 3.0.12)
patch -ulbf gl/getaddrinfo.c << EOF
--- gl/getaddrinfo.c  2012-01-12 11:08:54 +0100
+++ gl/getaddrinfo.c  2012-01-24 17:01:12 +0100
@@ -129,2 +129,3 @@

+#ifndef __MINGW32__
 /* Translate name of a service location and/or a service name to set of
@@ -444 +445,2 @@
 }
+#endif
EOF
# fix missing INDEX_OPT_0x00010000L in src/p11tool.c (version >= 3.0.13)
####src/p11tool.c:232: error: 'INDEX_OPT_0x00010000L' undeclared (first use in this function)
mv src/p11tool.c src/p11tool.c.bak
cat > src/p11tool.c << EOF
#include <windows.h>
#undef DELETE
EOF
cat src/p11tool.c.bak >> src/p11tool.c
# workaround for missing fchmod in src/libopts/makeshell.c (version >= 3.0.15)
mv src/libopts/makeshell.c src/libopts/makeshell.c.bak
echo "#define fchmod(f,p) 0" > src/libopts/makeshell.c
cat src/libopts/makeshell.c.bak >> src/libopts/makeshell.c
## fix invalid cdecl in lib/gl/msvc-inval.c (version >= 2.12.20 <= 3.6.3)
#mv lib/gl/msvc-inval.c lib/gl/msvc-inval.c.bak &&
#sed -e "s/\(cdecl\)/__\1/" lib/gl/msvc-inval.c.bak > lib/gl/msvc-inval.c
## fix invalid cdecl in gl/msvc-inval.c (version >= 2.12.20 <= 3.6.3)
#mv gl/msvc-inval.c gl/msvc-inval.c.bak &&
#sed -e "s/\(cdecl\)/__\1/" gl/msvc-inval.c.bak > gl/msvc-inval.c
# fix winsock.h/winsock2.h problems in lib/opencdk/main.c (version >= 2.12.20)
mv lib/opencdk/main.c lib/opencdk/main.c.bak
echo "#include <winsock2.h>" > lib/opencdk/main.c
cat lib/opencdk/main.c.bak >> lib/opencdk/main.c
## fix winsock.h/winsock2.h problems in lib/nettle/rnd.c (version >= 2.12.20 <= 2.12.21)
#mv lib/nettle/rnd.c lib/nettle/rnd.c.bak &&
#echo "#include <winsock2.h>" > lib/nettle/rnd.c
#cat lib/nettle/rnd.c.bak >> lib/nettle/rnd.c
# fix missing struct dsa_public_key in lib/nettle/pk.c for libnettle >= 3.0 (version >= 2.12.20)
if [ -f $MINGWPREFIX/include/nettle/dsa-compat.h ]; then
mv lib/nettle/pk.c lib/nettle/pk.c.bak &&
echo "#include <nettle/dsa-compat.h>" > lib/nettle/pk.c &&
cat lib/nettle/pk.c.bak >> lib/nettle/pk.c
fi
# fix missing camellia_ctx in lib/nettle/cipher.c for libnettle >= 3.0
if grep -qv camellia_ctx $MINGWPREFIX/include/nettle/camellia.h; then
mv lib/nettle/cipher.c lib/nettle/cipher.c.bak &&
echo "#define camellia_ctx camellia128_ctx" > lib/nettle/cipher.c &&
cat lib/nettle/cipher.c.bak >> lib/nettle/cipher.c
fi
# fix already defined strtok_r in gl/string.in.h (version >= 3.2.17)
patch -ulbf gl/string.in.h << EOF
--- gl/string.in.h  2014-04-05 01:38:14 +0200
+++ gl/string.in.h  2014-06-27 12:45:40 +0200
@@ -688,3 +688,3 @@
 #  endif
-#  if ! @HAVE_DECL_STRTOK_R@
+#  if ! @HAVE_DECL_STRTOK_R@ && !defined(__MINGW32__)
 _GL_FUNCDECL_SYS (strtok_r, char *,
EOF
# fix already defined strtok_r in src/gl/string.in.h (version >= 3.4.8)
patch -ulbf src/gl/string.in.h << EOF
--- src/gl/string.in.h  2015-09-26 14:02:10 +0200
+++ src/gl/string.in.h  2016-01-08 23:20:25 +0100
@@ -704,3 +704,3 @@
 #  endif
-#  if ! @HAVE_DECL_STRTOK_R@
+#  if ! @HAVE_DECL_STRTOK_R@ && (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 _GL_FUNCDECL_SYS (strtok_r, char *,
EOF
# fix missing gl/memxor.h (version >= 3.2.16)
touch gl/memxor.h
## fix missing arpa/inet.h in lib/x509/rfc2818_hostname.c (version = 3.2.16)
#mkdir -p arpa
#echo "#define inet_aton(opt,bind) ((bind)->s_addr = inet_addr(opt))" > arpa/inet.h
# fix missing arpa/inet.h (version >= 3.2.17)
mkdir -p winfix/arpa
touch winfix/arpa/inet.h
## fix inclusion of config.h in lib/gnutls_int.h (version >= 3.2.16 <= 3.4.5)
#mv lib/gnutls_int.h lib/gnutls_int.h.bak &&
#echo '#include "../config.h"' > lib/gnutls_int.h &&
#cat lib/gnutls_int.h.bak >> lib/gnutls_int.h
## fix missing restrict in lib/pkix_asn1_tab.c (version >= 3.2.16 <= 3.4.5)
#mv lib/pkix_asn1_tab.c lib/pkix_asn1_tab.c.bak &&
#echo '#include "../config.h"' > lib/pkix_asn1_tab.c &&
#cat lib/pkix_asn1_tab.c.bak >> lib/pkix_asn1_tab.c
## fix missing restrict in lib/gnutls_asn1_tab.c (version >= 3.2.16 <= 3.4.5)
#mv lib/gnutls_asn1_tab.c lib/gnutls_asn1_tab.c.bak &&
#echo '#include "../config.h"' > lib/gnutls_asn1_tab.c &&
#cat lib/gnutls_asn1_tab.c.bak >> lib/gnutls_asn1_tab.c
## fix missing restrict in lib/tpm.c (version >= 3.2.16 <= 3.4.5)
#mv lib/tpm.c lib/tpm.c.bak &&
#echo '#include "../config.h"' > lib/tpm.c &&
#cat lib/tpm.c.bak >> lib/tpm.c
## fix missing stdnoreturn.h in src/libopts/autoopts.h (version >= 3.2.17)
#mv src/libopts/autoopts.h src/libopts/autoopts.h.bak &&
#sed -e "s/#include <stdnoreturn.h>/#define noreturn/" src/libopts/autoopts.h.bak > src/libopts/autoopts.h
# fix missing va_copy in vasprintf.c (version >= 3.2.20)
####lib/vasprintf.c:45:2: error: #error No va_copy()!
mv lib/vasprintf.c lib/vasprintf.c.bak &&
echo "#define HAVE_VA_COPY 1" > lib/vasprintf.c &&
cat lib/vasprintf.c.bak >> lib/vasprintf.c
## fix rpl_fseek gl/stdio.h (should really be fixed in gl/stdio.h.in)
#patch -ulbf gl/stdio.h << EOF
#--- gl/stdio.h  2015-03-15 13:29:16 +0100
#+++ gl/stdio.h  2015-03-15 13:42:15 +0100
#@@ -767,5 +767,5 @@
# # endif
# # if 1
#-#  if !(defined __cplusplus && defined GNULIB_NAMESPACE)
#+#  if !(defined __cplusplus && defined GNULIB_NAMESPACE) && !defined(__MINGW32__)
# #   undef fseek
# #   define fseek rpl_fseek
#EOF
# fix rpl_fseek gl/stdio.in.h
patch -ulbf gl/stdio.in.h << EOF
--- gl/stdio.in.h  2015-09-26 14:02:10 +0200
+++ gl/stdio.in.h  2016-01-08 23:16:00 +0100
@@ -461,3 +461,3 @@
 # if @REPLACE_FSEEK@
-#  if !(defined __cplusplus && defined GNULIB_NAMESPACE)
+#  if !(defined __cplusplus && defined GNULIB_NAMESPACE) && (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 #   undef fseek
EOF
## fix redefinition of getaddrinfo/freeaddrinfo/getnameinfo in src/gl/netdb.h
#patch -ulbf src/gl/netdb.h << EOF
#--- src/gl/netdb.h  2015-03-15 13:51:22 +0100
#+++ src/gl/netdb.h  2015-03-15 14:03:33 +0100
#@@ -472,14 +472,2 @@
#
#-# if !0
#-/* Translate name of a service location and/or a service name to set of
#-   socket addresses.
#-   For more details, see the POSIX:2001 specification
#-   <http://www.opengroup.org/susv3xsh/getaddrinfo.html>.  */
#-_GL_FUNCDECL_SYS (getaddrinfo, int,
#-                  (const char *restrict nodename,
#-                   const char *restrict servname,
#-                   const struct addrinfo *restrict hints,
#-                   struct addrinfo **restrict res)
#-                  _GL_ARG_NONNULL ((4)));
#-# endif
# _GL_CXXALIAS_SYS (getaddrinfo, int,
#@@ -491,9 +479,2 @@
#
#-# if !0
#-/* Free 'addrinfo' structure AI including associated storage.
#-   For more details, see the POSIX:2001 specification
#-   <http://www.opengroup.org/susv3xsh/getaddrinfo.html>.  */
#-_GL_FUNCDECL_SYS (freeaddrinfo, void, (struct addrinfo *ai)
#-                                      _GL_ARG_NONNULL ((1)));
#-# endif
# _GL_CXXALIAS_SYS (freeaddrinfo, void, (struct addrinfo *ai));
#@@ -519,20 +500,2 @@
#
#-# if !0
#-/* Convert socket address to printable node and service names.
#-   For more details, see the POSIX:2001 specification
#-   <http://www.opengroup.org/susv3xsh/getnameinfo.html>.  */
#-_GL_FUNCDECL_SYS (getnameinfo, int,
#-                  (const struct sockaddr *restrict sa, socklen_t salen,
#-                   char *restrict node, socklen_t nodelen,
#-                   char *restrict service, socklen_t servicelen,
#-                   int flags)
#-                  _GL_ARG_NONNULL ((1)));
#-# endif
#-/* Need to cast, because on glibc systems, the seventh parameter is
#-                        unsigned int flags.  */
#-_GL_CXXALIAS_SYS_CAST (getnameinfo, int,
#-                       (const struct sockaddr *restrict sa, socklen_t salen,
#-                        char *restrict node, socklen_t nodelen,
#-                        char *restrict service, socklen_t servicelen,
#-                        int flags));
# _GL_CXXALIASWARN (getnameinfo);
#EOF
# fix redefinition of getaddrinfo/freeaddrinfo/getnameinfo in src/gl/netdb.in.h (version >= 3.4.8)
patch -ulbf src/gl/netdb.in.h << EOF
--- src/gl/netdb.in.h  2015-01-19 18:38:09 +0100
+++ src/gl/netdb.in.h  2016-01-08 23:38:01 +0100
@@ -158,7 +158,7 @@
 #  endif
 # endif

-# if !@HAVE_DECL_GETADDRINFO@
+# if !@HAVE_DECL_GETADDRINFO@ && (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 /* Translate name of a service location and/or a service name to set of
    socket addresses.
    For more details, see the POSIX:2001 specification
@@ -177,7 +177,7 @@
                    struct addrinfo **restrict res));
 _GL_CXXALIASWARN (getaddrinfo);

-# if !@HAVE_DECL_FREEADDRINFO@
+# if !@HAVE_DECL_FREEADDRINFO@ && (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 /* Free 'addrinfo' structure AI including associated storage.
    For more details, see the POSIX:2001 specification
    <http://www.opengroup.org/susv3xsh/getaddrinfo.html>.  */
@@ -205,7 +205,7 @@
 # endif
 _GL_CXXALIASWARN (gai_strerror);

-# if !@HAVE_DECL_GETNAMEINFO@
+# if !@HAVE_DECL_GETNAMEINFO@ && (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 /* Convert socket address to printable node and service names.
    For more details, see the POSIX:2001 specification
    <http://www.opengroup.org/susv3xsh/getnameinfo.html>.  */
@@ -216,6 +216,7 @@
                    int flags)
                   _GL_ARG_NONNULL ((1)));
 # endif
+# if (!defined(__MINGW32__) || defined(__MINGW64_VERSION_MAJOR))
 /* Need to cast, because on glibc systems, the seventh parameter is
                         unsigned int flags.  */
 _GL_CXXALIAS_SYS_CAST (getnameinfo, int,
@@ -224,6 +225,7 @@
                         char *restrict service, socklen_t servicelen,
                         int flags));
 _GL_CXXALIASWARN (getnameinfo);
+# endif

 /* Possible flags for getnameinfo.  */
 # ifndef NI_NUMERICHOST
EOF
# fix redefinition of getnameinfo in src/gl/getaddrinfo.c (version >= 3.4.8)
if ! gcc --version|grep "MinGW-W64">/dev/null; then
 mv src/gl/getaddrinfo.c src/gl/getaddrinfo.c.bak &&
 touch src/gl/getaddrinfo.c
fi
## fix redefinition of getaddrinfo/freeaddrinfo/getnameinfo in src/gl/netdb.h (version >= 3.4.6)
#patch -ulbf src/gl/netdb.h << EOF
#--- src/gl/netdb.h  2015-10-22 18:57:03 +0200
#+++ src/gl/netdb.h  2015-10-22 18:59:25 +0200
#@@ -470,7 +470,7 @@
# #  endif
# # endif
#
#-# if !0
#+# if 0
# /* Translate name of a service location and/or a service name to set of
#    socket addresses.
#    For more details, see the POSIX:2001 specification
#@@ -489,7 +489,7 @@
#                    struct addrinfo **restrict res));
# _GL_CXXALIASWARN (getaddrinfo);
#
#-# if !0
#+# if 0
# /* Free 'addrinfo' structure AI including associated storage.
#    For more details, see the POSIX:2001 specification
#    <http://www.opengroup.org/susv3xsh/getaddrinfo.html>.  */
#@@ -517,7 +517,7 @@
# # endif
# _GL_CXXALIASWARN (gai_strerror);
#
#-# if !0
#+# if 0
# /* Convert socket address to printable node and service names.
#    For more details, see the POSIX:2001 specification
#    <http://www.opengroup.org/susv3xsh/getnameinfo.html>.  */
#EOF
#mv src/gl/getaddrinfo.c src/gl/getaddrinfo.c.bak
#touch src/gl/getaddrinfo.c
## fix missing mkstemp in src/danetool.c (version >= 3.3.12)
#mv src/danetool.c src/danetool.c.bak
#cat > src/danetool.c << EOF
##include <config.h>
##include <fcntl.h> 
##define mkstemp(p) _open(_mktemp(p), _O_CREAT | _O_SHORT_LIVED | _O_EXCL) 
#EOF
#cat src/danetool.c.bak >> src/danetool.c
# fix missing endservent in src/socket.c (version >= 3.4.6)
mv src/socket.c src/socket.c.bak
echo "#define endservent()" > src/socket.c
cat src/socket.c.bak >> src/socket.c
# fix already defined DELETE in 3.4.6 (version >= 3.4.6)
####error: pasting "INDEX_OPT_" and "(" does not give a valid preprocessing token
mv -f src/systemkey.c src/systemkey.c.bak
cat > src/systemkey.c << EOF
#include <winsock2.h>
#include <windows.h>
#undef DELETE
EOF
cat src/systemkey.c.bak >> src/systemkey.c
## fix missing ncrypt.h for older MinGW versions (version >= 3.4.6 <= 3.5.2)
#cat > check_ncrypt_h.c << EOF
##include <windows.h>
##include <ncrypt.h>
#EOF
#gcc -c check_ncrypt_h.c -o check_ncrypt_h.o &> /dev/null || cp -f lib/system-keys-dummy.c lib/system-keys-win.c
# fix missing ncrypt.h for older MinGW versions (version >= 3.5.3)
cat > check_ncrypt_h.c << EOF
#include <windows.h>
#include <ncrypt.h>
EOF
gcc -c check_ncrypt_h.c -o check_ncrypt_h.o &> /dev/null || cp -f lib/system/keys-dummy.c lib/system/keys-win.c
## fix missing CertEnumCRLsInStore for older MinGW versions (version >= 3.4.6 <= 3.5.2)
#echo -e "#include<_mingw.h>\nint v=__MINGW64_VERSION_MAJOR;" | ${CC:-gcc} -c -xc - -o /dev/null &> /dev/null || (
# mv lib/system.c lib/system.c.bak &&
# sed -e "s/__MINGW32_MAJOR_VERSION <= 3 \&\& __MINGW32_MINOR_VERSION <= 20/1/" lib/system.c.bak > lib/system.c
#)
# fix missing CertEnumCRLsInStore for older MinGW versions (version >= 3.5.3)
echo -e "#include<_mingw.h>\nint v=__MINGW64_VERSION_MAJOR;" | ${CC:-gcc} -c -xc - -o /dev/null &> /dev/null || (
 mv lib/system.h lib/system.h.bak &&
 echo "#include <windows.h>" > lib/system.h &&
 echo "#include <wincrypt.h>" >> lib/system.h &&
 sed -e "s/__MINGW32_MAJOR_VERSION <= 3 \&\& __MINGW32_MINOR_VERSION <= 20/1/" lib/system.h.bak >> lib/system.h
)
# fix missing _Inout_ in tests/windows/crypt32.c (version >= 3.5.0)
mv tests/windows/crypt32.c tests/windows/crypt32.c.bak &&
sed -e "s/_Inout_//g" tests/windows/crypt32.c.bak > tests/windows/crypt32.c
# fix already defined off_t in src/gl/parse-datetime.c (version >= 3.5.7)
mv src/gl/parse-datetime.c src/gl/parse-datetime.c.bak &&
echo "#define __have_typedef_off_t" > src/gl/parse-datetime.c &&
cat src/gl/parse-datetime.c.bak >> src/gl/parse-datetime.c
# fix dynamic linkage with gmp (version >= 3.5.13)
mv lib/nettle/int/dsa-fips.h lib/nettle/int/dsa-fips.h.bak
cat > lib/nettle/int/dsa-fips.h << EOF
#ifdef DLL_EXPORT
# ifndef __GMP_LIBGMP_DLL
#  define __GMP_LIBGMP_DLL 1
# endif
#else
# ifndef STATIC_GMP
#  define STATIC_GMP 1
# endif
#endif
EOF
cat lib/nettle/int/dsa-fips.h.bak >> lib/nettle/int/dsa-fips.h
# fix dynamic linkage with gmp (version >= 3.5.13)
mv lib/gnutls_int.h lib/gnutls_int.h.bak
cat > lib/gnutls_int.h << EOF
#ifdef DLL_EXPORT
# ifndef __GMP_LIBGMP_DLL
#  define __GMP_LIBGMP_DLL 1
# endif
#else
# ifndef STATIC_GMP
#  define STATIC_GMP 1
# endif
#endif
EOF
cat lib/gnutls_int.h.bak >> lib/gnutls_int.h
## fix redefinition of inet_ntop/inet_pton (version >= 3.6.3)
#for F in $(find -name 'inet_[np]to[pn].c'); do
# mv -f $F $F.bak &&
# touch $F
#done
# fix missing nettle/nettle-stdint.h in lib/nettle/gost/nettle-write.h whe using newer libnettle (version >= 3.6.3)
ls -1 /custombuilt/include/nettle/nettle-stdint.h &> /dev/null || sed -i.bak -e "s?#include <nettle/nettle-stdint.h>?//&?" lib/nettle/gost/nettle-write.h
# fix dllimport in static library lib/includes/gnutls/gnutls.h.in (version >= 3.7.0)
patch -ulbf lib/includes/gnutls/gnutls.h.in << EOF
@@ -66,3 +66,3 @@

-#if !defined(GNUTLS_INTERNAL_BUILD) && defined(_WIN32)
+#if !defined(GNUTLS_INTERNAL_BUILD) && defined(_WIN32) && !defined(STATIC_GNUTLS) && !defined(STATIC)
 # define _SYM_EXPORT __declspec(dllimport)
EOF
# fix using static libunistring (version >= 3.7.0)
for F in lib/str-iconv.c lib/str-idna.c lib/str-unicode.c; do
 mv $F $F.bak &&
 echo -e "#ifndef DLL_EXPORT\n#define STATIC_LIBUNISTRING 1\n#endif" > $F &&
 cat $F.bak >> $F
done
## fix undefined reference to rpl_freeaddrinfo (version >= 3.7.0)
#sed -i.bak -e "s?#\s*define\s*freeaddrinfo\s*rpl_freeaddrinfo?//&?" gl/netdb.in.h src/gl/netdb.in.h &&
# skip making src/crywrap (version >= 3.0.8)
cat > src/crywrap/Makefile.in << EOF
clean:
all:
install:
install-strip:
EOF
# skip making doc (version >= 3.0.8)
cat > doc/Makefile.am << EOF
clean:
all:
install:
install-strip:
EOF
#cat > doc/Makefile.in << EOF
#clean:
#all:
#install:
#install-strip:
#EOF
# fix missing va_copy in vasprintf.c (version >= 3.5.0)
mv configure configure.bak &&
grep -v "Your system lacks vasprintf" configure.bak > configure
#make check
## remove dependancy on dynamic libstdc++ (GCC 4)
#mv libtool libtool.bak &&
#sed -e "s/-lstdc++/-lstdc++_s -lsupc++/" libtool.bak > libtool &&
##mv lib/libtool lib/libtool.bak &&
##sed -e "s/-lstdc++/-lstdc++_s -lsupc++/" lib/libtool.bak > lib/libtool &&
#wl-showstatus configure &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM CXXFLAGS="-Drestrict=__restrict" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##### checking for socklen_t equivalent... configure: error: Cannot find a type to use in place of socklen_t
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-rpath CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-rpath --with-included-libtasn CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-lintl -lgcrypt -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-static-libgcc -lintl -lgcrypt -Wl,--allow-multiple-definition"
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-static-libgcc -lintl -lgcrypt -Wl,--allow-multiple-definition -Wl,-no-undefined -Wl,--enable-auto-import" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-static-libgcc -lintl -lgcrypt -Wl,--allow-multiple-definition -Wl,-no-undefined -static-libstdc++" &&
##GUILE_LOAD_PATH=$MINGWPREFIX/share/guile/1.8 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 --enable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-static-libgcc -lintl -lgcrypt -static-libstdc++" &&
##./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --with-included-libtasn1 --disable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++" &&
#if ( echo $RUNPLATFORM | grep -qv x86_64 ); then
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --with-included-libtasn1 --disable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --disable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++" &&
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --disable-guile --without-p11-kit CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++" &&
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++" &&
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++" &&
# echo "#define _WIN32_WINNT 0x0501" >> config.h &&
# echo "#include <ws2tcpip.h>" >> config.h
#else
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --disable-hardware-acceleration --with-included-libtasn1 --disable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --disable-hardware-acceleration --disable-guile CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -static-libgcc -static-libstdc++"
# #64-bit: CFLAGS="-DASM_X86_64" ?
#fi &&
mkdir -p build_static build_shared &&
 wl-showstatus preconfigure &&
 autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
 ## allow building shared libraries when using clang
 #sed -i.bak -e "s/\$LD --help 2>&1 | \$GREP 'auto-import'/true/" configure &&
 if ( echo $RUNPLATFORM | grep -q "^i.86" ); then
  wl-showstatus configure static &&
  cd build_static &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS" CXXFLAGS="-DSTATIC_GNUTLS" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32" CXXFLAGS="-DSTATIC_GNUTLS" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-DSTATIC_GNUTLS" .. &&
  ../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=windows --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-DSTATIC_GNUTLS" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -I../../lib/minitasn1 -I$(pwd)/../winfix -DSTATIC_GMP -DSTATIC_GNUTLS" CXXFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -Drestrict=__restrict -DSTATIC_GMP -DSTATIC_GNUTLS" LDFLAGS="-fstack-protector-strong -Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #-D_FORTIFY_SOURCE=2 -lssp
  echo "#define _WIN32_WINNT 0x0501" >> config.h &&
  echo "#include <ws2tcpip.h>" >> config.h &&
  cd .. &&
  wl-showstatus configure shared &&
  cd build_shared &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" CFLAGS="-I$(pwd)/../winfix" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" CFLAGS="-I$(pwd)/../winfix  -I$MINGWPREFIX/include/libdl-win32" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" CFLAGS="-I$(pwd)/../winfix  -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  ../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=windows --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CXXFLAGS="-Drestrict=__restrict" CFLAGS="-I$(pwd)/../winfix  -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-guile --without-p11-kit --disable-tests CFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -I../../lib/minitasn1 -I$(pwd)/../winfix" CXXFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -Drestrict=__restrict" LDFLAGS="-fstack-protector-strong -Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  echo "#define _WIN32_WINNT 0x0501" >> config.h &&
  echo "#include <ws2tcpip.h>" >> config.h &&
  cd ..
 else
  wl-showstatus configure static &&
  cd build_static &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS" CXXFLAGS="-DSTATIC_GNUTLS" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32" CXXFLAGS="-DSTATIC_GNUTLS" LDFLAGS="-Wl,--as-needed -ldl" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-DSTATIC_GNUTLS" LDFLAGS="-Wl,--as-needed -ldl" .. &&
  ../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=windows --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -DSTATIC_GMP" CXXFLAGS="-Drestrict=__restrict -DSTATIC_GMP" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" CFLAGS="-DSTATIC_GNUTLS -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-DSTATIC_GNUTLS" LDFLAGS="-Wl,--as-needed -ldl" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests --disable-doc CFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -I../../lib/minitasn1 -I$(pwd)/../winfix -DSTATIC_GMP -DSTATIC_GNUTLS" CXXFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -Drestrict=__restrict -DSTATIC_GMP -DSTATIC_GNUTLS" LDFLAGS="-fstack-protector-strong -Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  cd .. &&
  wl-showstatus configure shared &&
  cd build_shared &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -I$MINGWPREFIX/include/libdl-win32" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  ../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=windows --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-I../../lib/minitasn1" CFLAGS="-I$(pwd)/../winfix -I$MINGWPREFIX/include/libdl-win32 -Wno-int-conversion" CXXFLAGS="-Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-Wl,--as-needed -lintl -lgcrypt -lws2_32 -ldl -static-libgcc -static-libstdc++" .. &&
  #../configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-static --enable-shared --enable-threads=win32 --disable-hardware-acceleration --disable-guile --without-p11-kit --disable-tests CFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -I../../lib/minitasn1 -I$(pwd)/../winfix" CXXFLAGS="-fstack-protector-strong -D_FORTIFY_SOURCE=2 -Drestrict=__restrict -Dsocklen_t=int" LDFLAGS="-fstack-protector-strong -Wl,--as-needed -lintl -lgcrypt -lws2_32 -static-libgcc -static-libstdc++" .. &&
  cd ..
  #64-bit: CFLAGS="-DASM_X86_64" ?
 fi &&
 # fix building DLLs
 sed -i.bak -e "s/\(deplibs_check_method=\"\)[^\"]*/\1pass_all/" build_shared/libtool &&
 # fix for building static library with against static gmp
 echo "#define STATIC_GMP 1" >> build_static/config.h &&
 # fix for building static library with against static libunistring
 echo "#define STATIC_LIBUNISTRING 1" >> build_static/config.h &&
 for D in build_static build_shared; do
  # fix missing _missing _set_invalid_parameter_handler
  echo "#undef HAVE_MSVC_INVALID_PARAMETER_HANDLER" >> $D/config.h &&
  #echo "#undef HAVE_MSVC_INVALID_PARAMETER_HANDLER" >> $D/lib/config.h &&
  # fix issue with single backslashes in UNBOUND_ROOT_KEY_FILE path in config.h (version >= 3.2.16)
  sed -i.bak -e "s/\(UNBOUND_ROOT_KEY_FILE *\"\).*\(root.key\"\)/\1\2/" $D/config.h &&
  ## fix missing va_copy (version >= 3.2.18)
  #echo "#define HAVE_VA_COPY 1" >> $D/config.h &&
  # fix missing VOLUME_NAME_NONE (version >= 3.6.3)
  sed -i.bak2 -e "s/^\(#define _WIN32_WINNT \)0x0501/\10x0600/" $D/config.h &&
  # fix redefinition of inet_ntop/inet_pton (version >= 3.6.3)
  sed -i.bak3 -e "s/^\(#define \)\(HAVE_DECL_INET_NTOP\|HAVE_DECL_INET_PTON\) 0/\1\2 1/; s/^.*#undef \(HAVE_INET_NTOP\|HAVE_INET_PTON\).*$/#define \1 1/" $D/config.h &&
  mkdir -p $D/gl/tests/arpa $D/src/gl/arpa $D/gl/arpa &&
  echo "#include <ws2tcpip.h>" > $D/gl/tests/arpa/inet.h &&
  echo "#include <ws2tcpip.h>" > $D/src/gl/arpa/inet.h &&
  echo "#include <ws2tcpip.h>" > $D/gl/arpa/inet.h
  # fix invalid characters in definition of UNBOUND_ROOT_KEY_FILE
  echo "#undef UNBOUND_ROOT_KEY_FILE" >> $D/config.h &&
  echo "#define UNBOUND_ROOT_KEY_FILE \"root.key\"" >> $D/config.h
 done &&
 wl-showstatus build static &&
 ( make -Cbuild_static || make -j1 -Cbuild_static ) &&
 wl-showstatus build shared &&
 ( make -Cbuild_shared || make -j1 -Cbuild_shared ) &&
 wl-showstatus build-install static &&
 make -Cbuild_static install-strip &&
 wl-showstatus build-install shared &&
 make -Cbuild_shared install-strip &&
 # add static libraries to .la files
 sed -i "s/^old_library=''/old_library='libgnutls.a'/" $INSTALLPREFIX/lib/libgnutls.la &&
 sed -i "s/^old_library=''/old_library='libgnutlsxx.a'/" $INSTALLPREFIX/lib/libgnutlsxx.la &&
 ( sed -i "s/^old_library=''/old_library='libgnutls-dane.a'/" $INSTALLPREFIX/lib/libgnutls-dane.la || true ) &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
#patch -ulbf gl/netdb.h << EOF
#--- gl/netdb.h  2012-01-24 16:49:38 +0100
#+++ gl/netdb.h  2012-01-24 16:57:36 +0100
#@@ -473,3 +473,3 @@
#
#-# if !0
#+# if 0
# /* Translate name of a service location and/or a service name to set of
#@@ -492,3 +492,3 @@
#
#-# if !0
#+# if 0
# /* Free 'addrinfo' structure AI including associated storage.
#@@ -520,3 +520,3 @@
#
#-# if !0
#+# if 0
# /* Convert socket address to printable node and service names.
#EOF



# disable assembler hardware acceleration for Windows on ARM64 in configure (version >= 3.7.7)
patch -ulbf configure << EOF
@@ -11540,3 +11540,3 @@
 case \$host_cpu in
-  armv8 | aarch64)
+  armv8)
       hw_accel="aarch64"
@@ -11548,3 +11548,3 @@
   ;;
-  i?86 | x86_64 | amd64)
+  i?86 | x86_64 | amd64 | aarch64)
       ac_fn_c_check_header_compile "\$LINENO" "cpuid.h" "ac_cv_header_cpuid_h"
"\$ac_includes_default"
EOF
