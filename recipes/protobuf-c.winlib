export NAME="protobuf-c"
export STATUS=
export URL=https://github.com/protobuf-c/protobuf-c
export BASENAME=protobuf-c
export DESCRIPTION="Protocol Buffers implementation in C"
export CATEGORY=dataprocessing
export TYPE=library,application
#export VERSION=1.2.1
#export VERSIONDATE=20170117
#export VERSION=1.3.0
#export VERSIONDATE=20170816
#export VERSION=1.3.1
#export VERSIONDATE=20180814
#export VERSION=1.3.2
#export VERSIONDATE=20190624
#export VERSION=1.3.3
#export VERSIONDATE=20200214
#export VERSION=1.4.0
#export VERSIONDATE=20210519
export VERSION=1.4.1
export VERSIONDATE=20220711
####make: *** [Makefile:2729: t/generated-code2/test-full-cxx-output.inc] Error 139
wl-showstatus --package-version
export DEPENDENCIES=protobuf
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=BSD
export DOWNLOADURL="https://github.com/protobuf-c/protobuf-c/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/protobuf-c/protobuf-c/releases/download/v$VERSION/$BASENAME-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfz $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
cd $BASENAME-$VERSION
## fix invalid --c_out= (version >= 1.3.0 <= 1.3.2)
#mv Makefile.in Makefile.in.bak &&
#sed -e "s/--c_out=/--cpp_out=/g" Makefile.in.bak > Makefile.in
## fix missing .exe extension in protoc-c (version >= 1.3.0 <= 1.3.2)
#mv Makefile.in Makefile.in.bak2 &&
#sed -e "s?ln -s \(protoc-gen-c\)\( .*/protoc-c\)\$?cp -f protoc-c/\1.exe\2.exe?g" Makefile.in.bak2 > Makefile.in
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM &&
 PKG_CONFIG=$(which pkg-config.exe) ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-valgrind-tests --disable-code-coverage &&
 wl-showstatus build-install &&
 #make install-strip &&
 ( make install-strip || make -j1 install-strip ) &&
 # fix missing .exe extension (version <= 3.3.0)
 mv -f $INSTALLPREFIX/bin/protoc-c $INSTALLPREFIX/bin/protoc-c.exe &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



