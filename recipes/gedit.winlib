#export NAME="gedit"
#export STATUS=
#export URL=http://www.gnome.org/projects/gedit
#export BASENAME=gedit
#export DESCRIPTION=""
#export CATEGORY=
#export TYPE=library
##export VERSION=2.31.6
##export VERSIONDATE=20101008
##export VERSION=3.0.0
##export VERSIONDATE=20110405
##export VERSION=3.0.1
##export VERSIONDATE=20110413
##export VERSION=3.0.2
##export VERSIONDATE=20110426
##export VERSION=3.0.3
##export VERSIONDATE=20110525
##export VERSION=3.0.4
##export VERSIONDATE=20110531
##export VERSION=3.0.5
##export VERSIONDATE=20110617
##export VERSION=3.0.6
##export VERSIONDATE=20110711
##export VERSION=3.1.1
##export VERSIONDATE=20110614
##export VERSION=3.1.2
##export VERSIONDATE=20110713
##export VERSION=3.1.3
##export VERSIONDATE=20110804
##export VERSION=3.1.4
##export VERSIONDATE=20110822
##export VERSION=3.1.5
##export VERSIONDATE=20110906
##export VERSION=3.1.6
##export VERSIONDATE=20110920
##export VERSION=3.2.0
##export VERSIONDATE=20110927
##export VERSION=3.2.1
##export VERSIONDATE=20111017
##export VERSION=3.2.2
##export VERSIONDATE=20111102
##export VERSION=3.2.3
##export VERSIONDATE=20111116
##export VERSION=3.3.1
##export VERSIONDATE=20111217
##export VERSION=3.3.2
##export VERSIONDATE=20120117
##export VERSION=3.3.3
##export VERSIONDATE=20120207
##export VERSION=3.3.4
##export VERSIONDATE=20120223
#####No package 'libpeas-1.0' found
#####No package 'libpeas-gtk-1.0' found
##export VERSION=3.3.5
##export VERSIONDATE=20120303
##export VERSION=3.3.6
##export VERSIONDATE=20120306
##export VERSION=3.3.7
##export VERSIONDATE=20120307
##export VERSION=3.3.8
##export VERSIONDATE=20120321
##export VERSION=3.4.1
##export VERSIONDATE=20120417
##export VERSION=3.5.1
##export VERSIONDATE=20120723
##export VERSION=3.5.2
##export VERSIONDATE=20120831
##export VERSION=3.5.3
##export VERSIONDATE=20120920
##export VERSION=3.6.0
##export VERSIONDATE=20120925
##export VERSION=3.6.1
##export VERSIONDATE=20121016
##export VERSION=3.6.2
##export VERSIONDATE=20121113
##export VERSION=3.7.1
##export VERSIONDATE=20121105
##export VERSION=3.7.2
##export VERSIONDATE=20121230
##export VERSION=3.7.3
##export VERSIONDATE=20130107
##export VERSION=3.7.4
##export VERSIONDATE=20130220
##export VERSION=3.7.5
##export VERSIONDATE=20130306
##export VERSION=3.7.6
##export VERSIONDATE=20130320
##export VERSION=3.8.0
##export VERSIONDATE=20130326
##export VERSION=3.8.1
##export VERSIONDATE=20130416
##export VERSION=3.8.2
##export VERSIONDATE=20130514
##export VERSION=3.8.3
##export VERSIONDATE=20130625
##export VERSION=3.9.1
##export VERSIONDATE=20130604
##export VERSION=3.9.2
##export VERSIONDATE=20130618
##export VERSION=3.9.3
##export VERSIONDATE=20130702
##export VERSION=3.9.4
##export VERSIONDATE=20130730
##export VERSION=3.10.0
##export VERSIONDATE=20130924
##export VERSION=3.10.1
##export VERSIONDATE=20131014
##export VERSION=3.10.2
##export VERSIONDATE=20131113
##export VERSION=3.10.3
##export VERSIONDATE=20131221
##export VERSION=3.10.4
##export VERSIONDATE=20140122
##export VERSION=3.11.1
##export VERSIONDATE=20131029
##export VERSION=3.11.2
##export VERSIONDATE=20140111
##export VERSION=3.11.3
##export VERSIONDATE=20140206
##export VERSION=3.12.0
##export VERSIONDATE=20140324
##export VERSION=3.12.1
##export VERSIONDATE=20140418
##export VERSION=3.12.2
##export VERSIONDATE=20140529
##export VERSION=3.13.1
##export VERSIONDATE=20140617
##export VERSION=3.13.2
##export VERSIONDATE=20140624
##export VERSION=3.13.3
##export VERSIONDATE=20140723
##export VERSION=3.13.4
##export VERSIONDATE=20140729
##export VERSION=3.13.5
##export VERSIONDATE=20140812
##export VERSION=3.14.0
##export VERSIONDATE=20140923
##export VERSION=3.14.1
##export VERSIONDATE=20141110
##export VERSION=3.14.2
##export VERSIONDATE=20141205
##export VERSION=3.14.3
##export VERSIONDATE=20150204
##export VERSION=3.14.4
##export VERSIONDATE=20150721
##export VERSION=3.15.1
##export VERSIONDATE=20150120
##export VERSION=3.16.0
##export VERSIONDATE=20150324
##export VERSION=3.16.1
##export VERSIONDATE=20150412
##export VERSION=3.16.2
##export VERSIONDATE=20150516
##export VERSION=3.16.3
##export VERSIONDATE=20150817
#export VERSION=3.16.4
#export VERSIONDATE=20151007
##export VERSION=3.17.0
##export VERSIONDATE=20150417
##export VERSION=3.17.1
##export VERSIONDATE=20150623
##export VERSION=3.17.2
##export VERSIONDATE=20150721
##export VERSION=3.18.0
##export VERSIONDATE=20150922
##export VERSION=3.18.1
##export VERSIONDATE=20151013
##export VERSION=3.18.2
##export VERSIONDATE=20151112
##export VERSION=3.18.3
##export VERSIONDATE=20160121
##export VERSION=3.19.1
##export VERSIONDATE=20151127
##export VERSION=3.19.2
##export VERSIONDATE=20151214
##export VERSION=3.19.3
##export VERSIONDATE=20160121
##export VERSION=3.19.4
##export VERSIONDATE=20160216
##export VERSION=3.19.5
##export VERSIONDATE=20160314
#####checking whether /E/Prog/Python26-32/python.exe version is >= 3.2.3... no
#####configure: error: Python interpreter is too old
##export VERSION=3.20.0
##export VERSIONDATE=20160321
##export VERSION=3.20.1
##export VERSIONDATE=20160407
##export VERSION=3.20.2
##export VERSIONDATE=20160508
##export VERSION=3.22.0
##export VERSIONDATE=20160919
##export VERSION=3.22.1
##export VERSIONDATE=20170815
##export VERSION=3.28.0
##export VERSIONDATE=20170815
##export VERSION=3.28.1
##export VERSIONDATE=20180409
##export VERSION=3.30.0
##export VERSIONDATE=20180903
##export VERSION=3.30.1
##export VERSIONDATE=20180925
##export VERSION=3.30.2
##export VERSIONDATE=20181022
##export VERSION=3.31.0
##export VERSIONDATE=20181008
##export VERSION=3.31.1
##export VERSIONDATE=20181010
##export VERSION=3.31.2
##export VERSIONDATE=20181113
##export VERSION=3.31.3
##export VERSIONDATE=20181211
##export VERSION=3.32.0
##export VERSIONDATE=20190311
##export VERSION=3.32.2
##export VERSIONDATE=20190515
##export VERSION=3.34.0
##export VERSIONDATE=20190910
##export VERSION=3.34.1
##export VERSIONDATE=20191121
##export VERSION=3.35.1
##export VERSIONDATE=20191122
##export VERSION=3.36.0
##export VERSIONDATE=20200307
##export VERSION=3.36.1
##export VERSIONDATE=20200320
##export VERSION=3.36.2
##export VERSIONDATE=20200426
##export VERSION=3.37.1
##export VERSIONDATE=20200425
##export VERSION=3.37.2
##export VERSIONDATE=20200530
##export VERSION=3.37.3
##export VERSIONDATE=20200703
#####Requested 'gtk+-3.0 >= 3.19.0' but version of GTK+ is 3.16.7
#####Requested 'gtksourceview-3.0 >= 3.19.4' but version of gtksourceview is 3.18.0
#####No package 'libpeas-1.0' found
#####No package 'libpeas-gtk-1.0' found
#wl-showstatus --package-version
#export DEPENDENCIES=libsoup-2.4,enchant,iso-codes,libpeas,gtk3,gtksourceview3,gsettings-desktop-schemas
#export OPTIONALDEPENDENCIES=
##export OPTIONALDEPENDENCIES=gspell
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gedit/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xj --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix undefined dbus gedit/gedit-dbus.c
#####gedit/gedit-dbus.c:178: error: 'dbus' undeclared (first use in this function)
#patch -ulbf gedit/gedit-dbus.c << EOF
#--- gedit/gedit-dbus.c  2012-02-18 11:04:02 +0100
#+++ gedit/gedit-dbus.c  2012-03-03 09:00:50 +0100
#@@ -174,5 +174,4 @@
#        g_clear_object (&dbus->priv->stdin_out_stream);
#        g_clear_object (&dbus->priv->stdin_in_stream);
#-#endif
#
#        if (dbus->priv->owner_id != 0)
#@@ -181,4 +180,5 @@
#                dbus->priv->owner_id = 0;
#        }
#+#endif
#
#        G_OBJECT_CLASS (gedit_dbus_parent_class)->dispose (object);
#EOF
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
#wl-showstatus configure &&
##PYTHON=$PYDIR/python.exe INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-introspection=no LDFLAGS="-Wl,-no-undefined" &&
#PYTHON=$PYDIR/python.exe INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --enable-introspection=no LDFLAGS="-Wl,-no-undefined" &&
##PYTHON=$PYDIR/python.exe INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared --disable-introspection --disable-spell LDFLAGS="-Wl,-no-undefined" &&
# wl-showstatus build-install &&
# # fix building DLLs on 64-bit
# if ( echo $RUNPLATFORM | grep -q x86_64 ); then
#  mv libtool libtool.bak &&
#  sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool
# fi &&
# make install-strip &&
#    echo OK
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION



export NAME="gedit"
export STATUS=
#export URL=http://www.gnome.org/projects/gedit
export URL=https://wiki.gnome.org/Apps/Gedit
export BASENAME=gedit
export DESCRIPTION="gedit is the text editor of the GNOME desktop environment."
export CATEGORY=office
export TYPE=library
#export VERSION=3.36.0
#export VERSIONDATE=20200307
#export VERSION=3.36.1
#export VERSIONDATE=20200320
#export VERSION=3.36.2
#export VERSIONDATE=20200426
#export VERSION=3.37.1
#export VERSIONDATE=20200425
#export VERSION=3.37.2
#export VERSIONDATE=20200530
#export VERSION=3.37.3
#export VERSIONDATE=20200703
#export VERSION=3.38.0
#export VERSIONDATE=20200912
#export VERSION=3.38.1
#export VERSIONDATE=20201120
#export VERSION=3.38.2
#export VERSIONDATE=20210328
####meson.build:53:0: ERROR: Dependency "tepl-5" not found, tried pkgconfig and cmake
#export VERSION=40.0
#export VERSIONDATE=20210320
#export VERSION=40.1
#export VERSIONDATE=20210417
####meson.build:45:0: ERROR: Dependency "tepl-6" not found, tried pkgconfig and cmake
#export VERSION=41.0
#export VERSIONDATE=20220214
#export VERSION=42.0
#export VERSIONDATE=20220402
#export VERSION=42.1
#export VERSIONDATE=20220527
#export VERSION=42.2
#export VERSIONDATE=20220729
#export VERSION=43.0
#export VERSIONDATE=20221103
#export VERSION=43.1
#export VERSIONDATE=20221104
#export VERSION=43.2
#export VERSIONDATE=20221118
#export VERSION=44.0
#export VERSIONDATE=20230102
#export VERSION=44.1
#export VERSIONDATE=20230105
#export VERSION=44.2
#export VERSIONDATE=20230120
export VERSION=45.0
export VERSIONDATE=20230624
wl-showstatus --package-version
export DEPENDENCIES=libsoup-2.4,enchant,iso-codes,libpeas,gtk3,gtksourceview3,gsettings-desktop-schemas,tepl,gobject-introspection
export OPTIONALDEPENDENCIES=
#export OPTIONALDEPENDENCIES=gspell
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gedit/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://download.gnome.org/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xJ --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix data/meson.build (version >= 43.0)
####data\meson.build:6:0: ERROR: Function does not take positional arguments.
patch -ulbf data/meson.build << EOF
@@ -6,3 +6,2 @@
 appdata_file = i18n.merge_file(
-  appdata,
   input: appdata + '.in',
@@ -25,3 +24,2 @@
 desktop_output_file = i18n.merge_file(
-  desktop_file,
   type: 'desktop',
EOF
# fix issue running git (version >= 45.0)
patch -ulbf meson.build << EOF
@@ -27,3 +27,3 @@
 # Subprojects
-if not get_option('buildtype').contains('plain')
+if not get_option('buildtype').contains('plain') and not get_option('buildtype').contains('release')
   run_command(
EOF
# fix missing python3
sed -i.bak -e "s/'python3'/'python'/" meson.build
mkdir -p build_both &&
 wl-showstatus configure &&
 #PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib PATH=$PYDIR:$PATH $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dvapi=false -Dintrospection=false -Dgtk_doc=false -Duser_documentation=false . build_both &&
 #PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib PATH=$PYDIR:$PATH $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dvapi=true -Dintrospection=true -Dgtk_doc=false -Duser_documentation=false . build_both &&
 #PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib PATH=$PYDIR:$PATH $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Denable-gvfs-metadata=yes -Dgtk_doc=false -Duser_documentation=false . build_both &&
 PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib PATH=$PYDIR:$PATH $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dgtk_doc=false -Duser_documentation=false . build_both &&
 # fix slash/backslash path issue when calling Python from Ninja
 #sed -i.bak -e "/COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
 ## fix Python path issues in meson_exe
 #sed -i.bak -e "s?$PYDIR?$(echo $PYDIR|sed -e "s?^/\([a-zA-Z]\)/?\1:/?")?" build_*/meson-private/meson_*.dat &&
 ## fix Python path issues in meson_exe
 #sed -i.bak -e "s?$PYDIR?$(echo $PYDIR|sed -e "s?^/\([a-zA-Z]\)/?\1:/?")?" build_both/meson-private/meson_exe_python.exe_*.dat &&
 wl-showstatus build-install &&
 #PKG_CONFIG= PATH=$PATH:$PYDIR PYTHONPATH=$PWD/winfix:$MINGWPREFIX/lib:$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} GETTEXTDATADIR=$MINGWPREFIX/share/gettext ninja -Cbuild_both install &&
 PATH=$PATH:$PYDIR PYTHONPATH=$PWD/winfix:$MINGWPREFIX/lib:$MINGWPREFIX/python/Lib/site-packages${PYTHONPATH:+:$PYTHONPATH} GETTEXTDATADIR=$MINGWPREFIX/share/gettext ninja -Cbuild_both install &&
 strip build_both/gedit/*.dll &&
 cp -u build_both/gedit/*.dll $INSTALLPREFIX/bin/ &&
 cp -u build_both/gedit/*.a $INSTALLPREFIX/lib/ &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
####TO DO: compiles but crashes



