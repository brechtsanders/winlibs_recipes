export NAME="FFmpeg 2"
export STATUS=
export URL=http://ffmpeg.org/
export BASENAME=ffmpeg2
export DESCRIPTION="FFmpeg is a complete solution to record, convert and stream audio and video. It includes libavcodec, the leading audio/video codec library."
export CATEGORY=video,codec
export TYPE=library
#export VERSION=2.0
#export VERSIONDATE=20130710
#export VERSION=2.0.1
#export VERSIONDATE=20130811
#export VERSION=2.0.2
#export VERSIONDATE=20131009
#export VERSION=2.0.3
#export VERSIONDATE=20131224
#export VERSION=2.0.4
#export VERSIONDATE=20140304
#export VERSION=2.0.5
#export VERSIONDATE=20140626
#export VERSION=2.0.6
#export VERSIONDATE=20141115
#export VERSION=2.1
#export VERSIONDATE=20131028
#export VERSION=2.1.1
#export VERSIONDATE=20131120
#export VERSION=2.1.2
#export VERSIONDATE=20140114
#export VERSION=2.1.3
#export VERSIONDATE=20140116
####non pthread threading without atomics not supported, try adding --enable-pthreads or --cpu=i486 or higher if you are on x86
#export VERSION=2.1.4
#export VERSIONDATE=20140224
#export VERSION=2.1.5
#export VERSIONDATE=20140624
#export VERSION=2.1.6
#export VERSIONDATE=20141129
#export VERSION=2.1.7
#export VERSIONDATE=20150101
#export VERSION=2.1.8
#export VERSIONDATE=20150501
#export VERSION=2.2
#export VERSIONDATE=20140324
#export VERSION=2.2.1
#export VERSIONDATE=20140410
#export VERSION=2.2.2
#export VERSIONDATE=20140505
#export VERSION=2.2.3
#export VERSIONDATE=20140603
#export VERSION=2.2.4
#export VERSIONDATE=20140624
#export VERSION=2.2.5
#export VERSIONDATE=20140715
#export VERSION=2.2.6
#export VERSIONDATE=20140806
#export VERSION=2.2.7
#export VERSIONDATE=20140812
#export VERSION=2.2.8
#export VERSIONDATE=20140921
#export VERSION=2.2.9
#export VERSIONDATE=20141006
#export VERSION=2.2.10
#export VERSIONDATE=20141102
#export VERSION=2.2.11
#export VERSIONDATE=20141210
#export VERSION=2.2.12
#export VERSIONDATE=20150120
#export VERSION=2.2.13
#export VERSIONDATE=20150220
#export VERSION=2.2.14
#export VERSIONDATE=20150315
#export VERSION=2.2.15
#export VERSIONDATE=20150417
#export VERSION=2.2.16
#export VERSIONDATE=20150619
#export VERSION=2.3
#export VERSIONDATE=20140716
#export VERSION=2.3.1
#export VERSIONDATE=20140731
#export VERSION=2.3.2
#export VERSIONDATE=20140812
#export VERSION=2.3.3
#export VERSIONDATE=20140817
#export VERSION=2.3.4
#export VERSIONDATE=20141003
#export VERSION=2.3.5
#export VERSIONDATE=20141101
#export VERSION=2.3.6
#export VERSIONDATE=20150107
#export VERSION=2.4
#export VERSIONDATE=20140915
#export VERSION=2.4.1
#export VERSIONDATE=20140922
#export VERSION=2.4.2
#export VERSIONDATE=20141005
#export VERSION=2.4.3
#export VERSIONDATE=20141102
#export VERSION=2.4.4
#export VERSIONDATE=20141201
#export VERSION=2.4.5
#export VERSIONDATE=20141220
#export VERSION=2.4.6
#export VERSIONDATE=20150114
#export VERSION=2.4.7
#export VERSIONDATE=20150215
#export VERSION=2.4.8
#export VERSIONDATE=20150330
#export VERSION=2.4.9
#export VERSIONDATE=20150427
#export VERSION=2.4.10
#export VERSIONDATE=20150603
#export VERSION=2.4.11
#export VERSIONDATE=20150825
#export VERSION=2.4.12
#export VERSIONDATE=20151012
#export VERSION=2.4.13
#export VERSIONDATE=20160203
#export VERSION=2.4.14
#export VERSIONDATE=20171231
#export VERSION=2.5
#export VERSIONDATE=20141204
#export VERSION=2.5.1
#export VERSIONDATE=20141216
#export VERSION=2.5.2
#export VERSIONDATE=20141223
#export VERSION=2.5.3
#export VERSIONDATE=20150110
#export VERSION=2.5.4
#export VERSIONDATE=20150214
#export VERSION=2.5.5
#export VERSIONDATE=20150322
#export VERSION=2.5.6
#export VERSIONDATE=20150419
#export VERSION=2.5.7
#export VERSIONDATE=20150523
#export VERSION=2.5.8
#export VERSIONDATE=20150731
#export VERSION=2.5.9
#export VERSIONDATE=20151207
#export VERSION=2.5.11
#export VERSIONDATE=20160203
#export VERSION=2.6
#export VERSIONDATE=20150307
#export VERSION=2.6.1
#export VERSIONDATE=20150317
#export VERSION=2.6.2
#export VERSIONDATE=20150412
#export VERSION=2.6.3
#export VERSIONDATE=20150517
#export VERSION=2.6.4
#export VERSIONDATE=20150725
#export VERSION=2.6.5
#export VERSIONDATE=20151123
#export VERSION=2.6.6
#export VERSIONDATE=20151223
#export VERSION=2.6.8
#export VERSIONDATE=20160201
#export VERSION=2.6.9
#export VERSIONDATE=20160503
#export VERSION=2.7
#export VERSIONDATE=20150610
#export VERSION=2.7.1
#export VERSIONDATE=20150620
#export VERSION=2.7.2
#export VERSIONDATE=20150720
#export VERSION=2.7.3
#export VERSIONDATE=20151119
#export VERSION=2.7.4
#export VERSIONDATE=20151222
#export VERSION=2.7.6
#export VERSIONDATE=20160201
#export VERSION=2.7.7
#export VERSIONDATE=20160501
#export VERSION=2.8
#export VERSIONDATE=20150909
#export VERSION=2.8.1
#export VERSIONDATE=20151014
#export VERSION=2.8.2
#export VERSIONDATE=20151112
#export VERSION=2.8.3
#export VERSIONDATE=20151128
#export VERSION=2.8.4
#export VERSIONDATE=20151220
#export VERSION=2.8.5
#export VERSIONDATE=20160116
#export VERSION=2.8.6
#export VERSIONDATE=20160201
#export VERSION=2.8.7
#export VERSIONDATE=20160430
#export VERSION=2.8.8
#export VERSIONDATE=20160919
#export VERSION=2.8.9
#export VERSIONDATE=20161204
#export VERSION=2.8.10
#export VERSIONDATE=20161206
#export VERSION=2.8.11
#export VERSIONDATE=20170210
#export VERSION=2.8.12
#export VERSIONDATE=20170606
#export VERSION=2.8.13
#export VERSIONDATE=20170902
#export VERSION=2.8.14
#export VERSIONDATE=20180220
#export VERSION=2.8.15
#export VERSIONDATE=20180716
#export VERSION=2.8.16
#export VERSIONDATE=20200428
#export VERSION=2.8.17
#export VERSIONDATE=20200708
#export VERSION=2.8.18
#export VERSIONDATE=20211021
#export VERSION=2.8.19
#export VERSIONDATE=20220427
#export VERSION=2.8.20
#export VERSIONDATE=20220515
export VERSION=2.8.21
export VERSIONDATE=20221031
wl-showstatus --package-version
export DEPENDENCIES=zlib,libbz2,libdl,freetype2,libgsm,lame,libogg,libvorbis,libtheora,opencore-amr,librtmp,schroedinger,libspeex,x264,libxavs,libvpx,frei0r
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=LICENSE
export LICENSEFILE=COPYING.LGPLv3
export LICENSETYPE="mostly LGPL, some parts MIT/X11/BSD-style, optional modules under GPL"
export DOWNLOADURL="http://ffmpeg.org/releases/ ffmpeg-"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ffmpeg.org/releases/ffmpeg-$VERSION.tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfj $TARBALLDIR/$BASENAME/ffmpeg-$VERSION.tar.bz2
cd ffmpeg-$VERSION
# fix redefinition of frm1 in libavcodec/kmvc.c (version >= 1.2.12)
mv libavcodec/kmvc.c libavcodec/kmvc.c.bak2
echo "#undef frm1" > libavcodec/kmvc.c
cat libavcodec/kmvc.c.bak2 >> libavcodec/kmvc.c
# fix redefinition of frm1 in libavcodec/sanm.c (version >= 1.2.12)
mv libavcodec/sanm.c libavcodec/sanm.c.bak2
cat > libavcodec/sanm.c << EOF
#undef frm1
#undef frm2
EOF
cat libavcodec/sanm.c.bak2 >> libavcodec/sanm.c
# fix redefinition of Rectangle in libavcodec/mss2.c (version >= 1.2.12)
cp libavcodec/mss2.c libavcodec/mss2.c.bak2
echo "#define Rectangle FFMPEG_Rectangle" > libavcodec/mss2.c
cat libavcodec/mss2.c.bak2 >> libavcodec/mss2.c
# fix redefinition of NO_DATA in libavcodec/amrnbdec.c (version >= 1.2.12)
echo "#undef NO_DATA" >> libavutil/common.h
# fix libavformat/cache.c for older MinGW (version >= 1.2.12)
for F in libavformat/*.c libavcodec/*.c; do
 mv $F $F.bak &&
 echo "#include <windows.h>" > $F &&
 echo "#undef near" >> $F &&
 cat $F.bak >> $F
done
# fix invalid use of lib.exe (version >= 0.8)
mv configure configure.bak
sed -e "s/\(SLIB_EXTRA_CMD=\)'-lib\.exe.*'/\1/" configure.bak > configure
# fix detection of MSYS2
mv configure configure.bak2
sed -e "s/\(mingw32\*\)/\1\|msys*\|mingw64*/" configure.bak2 > configure
## skip bad shell test
#mv configure configure.bak
#sed -e "s/^E2=.*$/E2=1/" configure.bak > configure
wl-showstatus configure &&
#./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=i586 --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-avfilter --enable-memalign-hack --disable-devices &&
#./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=i586 --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-postproc --enable-swscale --enable-avfilter --enable-memalign-hack --disable-devices --enable-runtime-cpudetect --disable-debug &&
#./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=i586 --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-postproc --enable-swscale --enable-avfilter --enable-memalign-hack --disable-devices --enable-runtime-cpudetect --disable-debug --extra-ldflags="-Wl,--allow-multiple-definition" &&
#./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo i586; else echo x86_64; fi) --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-postproc --enable-swscale --enable-avfilter --enable-memalign-hack --disable-devices --enable-runtime-cpudetect --disable-debug --extra-ldflags="-Wl,--allow-multiple-definition" &&
./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo i586; else echo x86_64; fi) --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-postproc --enable-swscale --enable-avfilter --enable-memalign-hack --disable-devices --enable-runtime-cpudetect --disable-debug --enable-zlib --enable-bzlib --enable-version3 --enable-avisynth --enable-frei0r --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfreetype --enable-libgsm --enable-libmp3lame --enable-librtmp --enable-libschroedinger --enable-libspeex --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libxavs --extra-cflags="-I$MINGWPREFIX/include/libdl-win32" --extra-ldflags="-Wl,--allow-multiple-definition" &&
#./configure --prefix=$INSTALLPREFIX/ffmpeg2 --arch=$(if ( echo $RUNPLATFORM | grep -qv x86_64 ); then echo i586; else echo x86_64; fi) --enable-static --enable-shared --enable-w32threads --enable-gpl --enable-incompatible-libav-abi --enable-postproc --enable-swscale --enable-avfilter --enable-memalign-hack --disable-devices --enable-runtime-cpudetect --disable-debug --enable-zlib --enable-bzlib --enable-version3 --enable-avisynth --enable-frei0r --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libfreetype --enable-libgsm --enable-libmp3lame --enable-librtmp --enable-libschroedinger --enable-libspeex --enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libxavs --extra-cflags="-I$MINGWPREFIX/include/libdl-win32" --extra-ldflags="-Wl,--allow-multiple-definition" &&
# --enable-libcelt
# --enable-nonfree --enable-libaacplus --enable-libfaac
# --enable-libnut --enable-libdc1394 --enable-libdirac --enable-libopencv --enable-libopenjpeg --enable-libvo-aacenc --enable-libvo-amrwbenc --enable-libxvid
 wl-showstatus build-install &&
 ( make all install || make all install SLIB_INSTALL_EXTRA_SHLIB='lib$(SLIBNAME:$(SLIBSUF)=.dll.a)' ) &&
 for F in $INSTALLPREFIX/lib/lib*.a; do
  B=`echo $F|sed -e "s?^$INSTALLPREFIX/lib/lib\(.*\)\.a?\1?"`
  if [ -f $INSTALLPREFIX/bin/lib$B.dll ]; then
   if [ ! -f $INSTALLPREFIX/lib/lib$B.dll.a ]; then
    dlltool -k -D $INSTALLPREFIX/bin/lib$B.dll -d lib$B/$B*.def -l $INSTALLPREFIX/lib/lib$B.dll.a
   fi
  fi
 done &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf ffmpeg-$VERSION



