export NAME="cpp-httplib"
export STATUS=
export URL=https://github.com/yhirose/cpp-httplib
export BASENAME=cpp-httplib
export DESCRIPTION="A C++ header-only HTTP/HTTPS server and client library"
export CATEGORY=communication
export TYPE=library
#export VERSION=0.6.5
#export VERSIONDATE=20200527
#export VERSION=0.6.6
#export VERSIONDATE=20200529
#export VERSION=0.6.7
#export VERSIONDATE=20200617
#export VERSION=0.7.0
#export VERSIONDATE=20200617
#export VERSION=0.7.1
#export VERSIONDATE=20200715
#export VERSION=0.7.2
#export VERSIONDATE=20200729
#export VERSION=0.7.3
#export VERSIONDATE=20200731
#export VERSION=0.7.4
#export VERSIONDATE=20200809
#export VERSION=0.7.5
#export VERSIONDATE=20200817
#export VERSION=0.7.6
#export VERSIONDATE=20200904
#export VERSION=0.7.7
#export VERSIONDATE=20200909
#export VERSION=0.7.8
#export VERSIONDATE=20200926
#export VERSION=0.7.9
#export VERSIONDATE=20201011
#export VERSION=0.7.10
#export VERSIONDATE=20201020
#export VERSION=0.7.11
#export VERSIONDATE=20201028
#export VERSION=0.7.12
#export VERSIONDATE=20201102
#export VERSION=0.7.13
#export VERSIONDATE=20201105
#export VERSION=0.7.14
#export VERSIONDATE=20201110
#export VERSION=0.7.15
#export VERSIONDATE=20201120
#export VERSION=0.7.16
#export VERSIONDATE=20201130
#export VERSION=0.7.17
#export VERSIONDATE=20201202
#export VERSION=0.7.18
#export VERSIONDATE=20201220
#export VERSION=0.8.0
#export VERSIONDATE=20210113
#export VERSION=0.8.1
#export VERSIONDATE=20210118
#export VERSION=0.8.2
#export VERSIONDATE=20210124
#export VERSION=0.8.3
#export VERSIONDATE=20210202
#export VERSION=0.8.4
#export VERSIONDATE=20210213
#export VERSION=0.8.5
#export VERSIONDATE=20210317
#export VERSION=0.8.6
#export VERSIONDATE=20210406
#export VERSION=0.8.7
#export VERSIONDATE=20210416
#export VERSION=0.8.8
#export VERSIONDATE=20210424
#export VERSION=0.8.9
#export VERSIONDATE=20210523
#export VERSION=0.9.0
#export VERSIONDATE=20210612
#export VERSION=0.9.1
#export VERSIONDATE=20210716
#export VERSION=0.9.2
#export VERSIONDATE=20210724
#export VERSION=0.9.3
#export VERSIONDATE=20210824
#export VERSION=0.9.4
#export VERSIONDATE=20210904
#export VERSION=0.9.5
#export VERSIONDATE=20210930
#export VERSION=0.9.6
#export VERSIONDATE=20211010
#export VERSION=0.9.7
#export VERSIONDATE=20211015
#export VERSION=0.9.8
#export VERSIONDATE=20211124
#export VERSION=0.9.9
#export VERSIONDATE=20211127
#export VERSION=0.9.10
#export VERSIONDATE=20211212
#export VERSION=0.10.0
#export VERSIONDATE=20211222
#export VERSION=0.10.1
#export VERSIONDATE=20211225
#export VERSION=0.10.2
#export VERSIONDATE=20220127
#export VERSION=10.3
#export VERSIONDATE=20220223
#export VERSION=0.10.3
#export VERSIONDATE=20220224
#export VERSION=0.10.4
#export VERSIONDATE=20220317
#export VERSION=0.10.5
#export VERSIONDATE=20220417
#export VERSION=0.10.6
#export VERSIONDATE=20220418
#export VERSION=0.10.7
#export VERSIONDATE=20220429
#export VERSION=0.10.8
#export VERSIONDATE=20220608
#export VERSION=0.10.9
#export VERSIONDATE=20220709
#export VERSION=0.11.0
#export VERSIONDATE=20220730
#export VERSION=0.11.1
#export VERSIONDATE=20220803
#export VERSION=0.11.2
#export VERSIONDATE=20220913
#export VERSION=0.11.3
#export VERSIONDATE=20221130
#export VERSION=0.11.4
#export VERSIONDATE=20230111
#export VERSION=0.12.0
#export VERSIONDATE=20230208
#export VERSION=0.12.1
#export VERSIONDATE=20230311
#export VERSION=0.12.2
#export VERSIONDATE=20230326
#export VERSION=0.12.3
#export VERSIONDATE=20230430
#export VERSION=0.12.4
#export VERSIONDATE=20230527
#export VERSION=0.12.5
#export VERSIONDATE=20230530
#export VERSION=0.12.6
#export VERSIONDATE=20230610
#export VERSION=0.13.0
#export VERSIONDATE=20230707
#export VERSION=0.13.1
#export VERSIONDATE=20230708
#export VERSION=0.13.2
#export VERSIONDATE=20230730
#export VERSION=0.13.3
#export VERSIONDATE=20230801
#export VERSION=0.14.0
#export VERSIONDATE=20230823
#export VERSION=0.14.1
#export VERSIONDATE=20231001
#export VERSION=0.14.2
#export VERSIONDATE=20231205
#export VERSION=0.15.0
#export VERSIONDATE=20240128
#export VERSION=0.15.1
#export VERSIONDATE=20240129
#export VERSION=0.15.2
#export VERSIONDATE=20240203
#export VERSION=0.15.3
#export VERSIONDATE=20240206
#export VERSION=0.16.0
#export VERSIONDATE=20240612
#export VERSION=0.16.1
#export VERSIONDATE=20240807
#export VERSION=0.16.2
#export VERSIONDATE=20240809
#export VERSION=0.16.3
#export VERSIONDATE=20240818
#export VERSION=0.17.0
#export VERSIONDATE=20240901
#export VERSION=0.17.1
#export VERSIONDATE=20240904
#export VERSION=0.17.2
#export VERSIONDATE=20240906
#export VERSION=0.17.3
#export VERSIONDATE=20240907
#export VERSION=0.18.0
#export VERSIONDATE=20240913
#export VERSION=0.18.1
#export VERSIONDATE=20241019
#export VERSION=0.18.2
#export VERSIONDATE=20241130
#export VERSION=0.18.3
#export VERSIONDATE=20241203
#export VERSION=0.18.4
#export VERSIONDATE=20250117
#export VERSION=0.18.5
#export VERSIONDATE=20250118
#export VERSION=0.18.6
#export VERSIONDATE=20250206
#export VERSION=0.18.7
#export VERSIONDATE=20250209
#export VERSION=0.19.0
#export VERSIONDATE=20250215
#export VERSION=0.20.0
#export VERSIONDATE=20250317
#export VERSION=0.20.1
#export VERSIONDATE=20250503
#export VERSION=0.21.0
#export VERSIONDATE=20250610
#export VERSION=0.22.0
#export VERSIONDATE=20250624
#export VERSION=0.23.0
#export VERSIONDATE=20250710
#export VERSION=0.23.1
#export VERSIONDATE=20250717
#export VERSION=0.24.0
#export VERSIONDATE=20250730
#export VERSION=0.25.0
#export VERSIONDATE=20250808
#export VERSION=0.26.0
#export VERSIONDATE=20250830
#export VERSION=0.27.0
#export VERSIONDATE=20251028
export VERSION=0.28.0
export VERSIONDATE=20251126
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=cmake,ninja
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=MIT
export DOWNLOADURL="https://github.com/yhirose/cpp-httplib/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/yhirose/cpp-httplib/archive/v$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://github.com/yhirose/cpp-httplib/archive/refs/tags/v.$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/v$VERSION.tar.gz
cd $BASENAME-$VERSION
#tar xz --force-local -f $TARBALLDIR/$BASENAME/v.$VERSION.tar.gz
#cd cpp-httplib-v.$VERSION
# fix undefined CreateFile2 in  httplib.h (version >= 0.16.0)
patch -ulbf httplib.h << EOF
@@ -2821,4 +2821,10 @@

+#if !defined(_WIN32_WINNT) || _WIN32_WINNT < 0x0602
+  hFile_ = ::CreateFileA(path, GENERIC_READ, FILE_SHARE_READ,
+                         NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL,
+                         NULL);
+#else
   hFile_ = ::CreateFile2(wpath.c_str(), GENERIC_READ, FILE_SHARE_READ,
                          OPEN_EXISTING, NULL);
+#endif

EOF
## fix CMakeLists.txt (version = 0.10.5)
#####No VERSION specified for WRITE_BASIC_CONFIG_VERSION_FILE()
#patch -ulbf CMakeLists.txt << EOF
#@@ -268,2 +268,3 @@
#                ARCH_INDEPENDENT
#+               VERSION "$VERSION"
#        )
#EOF
# fix CMakeLists.txt (version >= 0.25.0)
patch -ulbf CMakeLists.txt << EOF
@@ -120,3 +120,3 @@
 if(CMAKE_SYSTEM_NAME MATCHES "Windows" AND \${CMAKE_SYSTEM_VERSION} VERSION_LESS "10.0.0")
-       message(SEND_ERROR "Windows \${CMAKE_SYSTEM_VERSION} or lower is not supported. Please use Windows 10 or later.")
+       message(WARNING "Windows \${CMAKE_SYSTEM_VERSION} or lower is not supported. Please use Windows 10 or later.")
 endif()
@@ -136,6 +136,6 @@
 if(HTTPLIB_REQUIRE_OPENSSL)
-       find_package(OpenSSL \${_HTTPLIB_OPENSSL_MIN_VER} COMPONENTS Crypto SSL REQUIRED)
+       find_package(OpenSSL COMPONENTS Crypto SSL REQUIRED)
        set(HTTPLIB_IS_USING_OPENSSL TRUE)
 elseif(HTTPLIB_USE_OPENSSL_IF_AVAILABLE)
-       find_package(OpenSSL \${_HTTPLIB_OPENSSL_MIN_VER} COMPONENTS Crypto SSL QUIET)
+       find_package(OpenSSL COMPONENTS Crypto SSL QUIET)
        # Avoid a rare circumstance of not finding all components but the end-user did their
EOF
mkdir -p build_win &&
 wl-showstatus configure &&
 #cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DHTTPLIB_REQUIRE_ZLIB:BOOL=ON -DHTTPLIB_REQUIRE_OPENSSL:BOOL=ON -S. -Bbuild_win &&
 cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DHTTPLIB_REQUIRE_ZLIB:BOOL=ON -DHTTPLIB_REQUIRE_OPENSSL:BOOL=ON -DCMAKE_CXX_FLAGS:STRING="-fpermissive" -S. -Bbuild_win &&
 wl-showstatus build-install &&
 ninja -Cbuild_win install/strip &&
 wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
 #wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf cpp-httplib-v.$VERSION
####make -Ctest CXX="${CXX:-g++}" ZLIB_SUPPORT="-DCPPHTTPLIB_ZLIB_SUPPORT -lz -Wl,--as-needed -lws2_32"
####make -Cexample CXX="${CXX:-g++}" ZLIB_SUPPORT="-DCPPHTTPLIB_ZLIB_SUPPORT -lz -Wl,--as-needed -lws2_32"
####make -Cexample CXX=clang++ ZLIB_SUPPORT="-DCPPHTTPLIB_ZLIB_SUPPORT -lz -Wl,--as-needed -lws2_32"



