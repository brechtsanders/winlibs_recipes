#export NAME="Rygel"
#export STATUS=
#export URL=http://live.gnome.org/Rygel
#export BASENAME=rygel
#export DESCRIPTION="Rygel is a collection of DLNA (UPnP AV) services (devices in UPnP speak), implemented through a plug-in mechanism."
#export CATEGORY=
#export TYPE=library
##export VERSION=0.8.3
##export VERSIONDATE=20101115
##export VERSION=0.9.3
##export VERSIONDATE=20101110
##export VERSION=0.9.4
##export VERSIONDATE=20101129
##export VERSION=0.9.6
##export VERSIONDATE=20110115
#####No package 'gupnp-1.0' found
##export VERSION=0.9.8
##export VERSIONDATE=20110202
##export VERSION=0.9.9
##export VERSIONDATE=20110222
#####Requested 'gupnp-av-1.0 >= 0.7.0' but version of gupnp-av-1.0 is 0.6.3
##export VERSION=0.10.0
##export VERSIONDATE=20110415
##export VERSION=0.10.1
##export VERSIONDATE=20110417
##export VERSION=0.10.2
##export VERSIONDATE=20110601
##export VERSION=0.10.3
##export VERSIONDATE=20110713
##export VERSION=0.10.4
##export VERSIONDATE=20110720
##export VERSION=0.11.0
##export VERSIONDATE=20110609
#####src/plugins/tracker/rygel-tracker-root-container.c:219: undefined reference to `rygel_simple_container_get_type'
##export VERSION=0.11.1
##export VERSIONDATE=20110621
##export VERSION=0.11.2
##export VERSIONDATE=20110717
##export VERSION=0.11.3
##export VERSIONDATE=20110805
##export VERSION=0.12.0
##export VERSIONDATE=20110906
##export VERSION=0.12.1
##export VERSIONDATE=20110913
##export VERSION=0.12.3
##export VERSIONDATE=20110927
##export VERSION=0.12.4
##export VERSIONDATE=20111009
##export VERSION=0.12.5
##export VERSIONDATE=20111022
##export VERSION=0.12.7
##export VERSIONDATE=20120119
#####Requested 'gssdp-1.0 >= 0.11.0' but version of gssdp-1.0 is 0.10.0
##export VERSION=0.13.0
##export VERSIONDATE=20111123
#####Requested 'libsoup-2.4 <= 2.37.9999' but version of libsoup is 2.38.1
##export VERSION=0.13.1
##export VERSIONDATE=20120210
##export VERSION=0.13.2
##export VERSIONDATE=20120221
##export VERSION=0.13.3
##export VERSIONDATE=20120307
#####src/rygel/rygel-signal-handler.c:69: error: variable 'rygel_signal_handler_action' has initializer but incomplete type
##export VERSION=0.13.4
##export VERSIONDATE=20120320
##export VERSION=0.14.0
##export VERSIONDATE=20120326
##export VERSION=0.14.1
##export VERSIONDATE=20120429
##export VERSION=0.14.2
##export VERSIONDATE=20120614
##export VERSION=0.14.3
##export VERSIONDATE=20120808
#####src/plugins/tracker/rygel-tracker-root-container.c:173: undefined reference to `rygel_meta_config_get_default'
##export VERSION=0.15.0
##export VERSIONDATE=20120530
##export VERSION=0.15.0.1
##export VERSIONDATE=20120530
##export VERSION=0.15.1
##export VERSIONDATE=20120728
#####src/plugins/tracker/rygel-tracker-root-container.c:225: undefined reference to `rygel_simple_container_get_type'
##export VERSION=0.15.2
##export VERSIONDATE=20120824
##export VERSION=0.15.3
##export VERSIONDATE=20120904
##export VERSION=0.15.4
##export VERSIONDATE=20120918
##export VERSION=0.16.0
##export VERSIONDATE=20120927
##export VERSION=0.16.1
##export VERSIONDATE=20121011
##export VERSION=0.16.2
##export VERSIONDATE=20121113
##export VERSION=0.16.3
##export VERSIONDATE=20121113
##export VERSION=0.16.4
##export VERSIONDATE=20121222
#####No package 'tracker-sparql-0.14' found
##export VERSION=0.17.0
##export VERSIONDATE=20121006
##export VERSION=0.17.1
##export VERSIONDATE=20121029
##export VERSION=0.17.2
##export VERSIONDATE=20121121
##export VERSION=0.17.3
##export VERSIONDATE=20121201
##export VERSION=0.17.4
##export VERSIONDATE=20121205
##export VERSION=0.17.5
##export VERSIONDATE=20121215
##export VERSION=0.17.5.1
##export VERSIONDATE=20121216
##export VERSION=0.17.6
##export VERSIONDATE=20130111
##export VERSION=0.17.7
##export VERSIONDATE=20130126
##export VERSION=0.17.8
##export VERSIONDATE=20130220
##export VERSION=0.17.9
##export VERSIONDATE=20130306
##export VERSION=0.17.10
##export VERSIONDATE=20130319
##export VERSION=0.18.0
##export VERSIONDATE=20130326
##export VERSION=0.18.1
##export VERSIONDATE=20130416
##export VERSION=0.18.2
##export VERSIONDATE=20130513
##export VERSION=0.18.3
##export VERSIONDATE=20130724
##export VERSION=0.18.4
##export VERSIONDATE=20130810
##export VERSION=0.19.1
##export VERSIONDATE=20130430
##export VERSION=0.19.2
##export VERSIONDATE=20130528
##export VERSION=0.19.3
##export VERSIONDATE=20130630
##export VERSION=0.19.4
##export VERSIONDATE=20130730
##export VERSION=0.19.5
##export VERSIONDATE=20130821
##export VERSION=0.19.6
##export VERSIONDATE=20130902
##export VERSION=0.19.7
##export VERSIONDATE=20130917
##export VERSION=0.20.0
##export VERSIONDATE=20130924
##export VERSION=0.20.1
##export VERSIONDATE=20131014
##export VERSION=0.20.2
##export VERSIONDATE=20131112
##export VERSION=0.20.3
##export VERSIONDATE=20131222
##export VERSION=0.21.0
##export VERSIONDATE=20131031
##export VERSION=0.21.1
##export VERSIONDATE=20131119
##export VERSION=0.21.2
##export VERSIONDATE=20131221
##export VERSION=0.21.2.1
##export VERSIONDATE=20131222
##export VERSION=0.21.3
##export VERSIONDATE=20140115
##export VERSION=0.21.4
##export VERSIONDATE=20140204
##export VERSION=0.21.5
##export VERSIONDATE=20140307
##export VERSION=0.21.6
##export VERSIONDATE=20140318
##export VERSION=0.22.0
##export VERSIONDATE=20140325
##export VERSION=0.22.1
##export VERSIONDATE=20140418
#####No package 'tracker-sparql-0.16' found
##export VERSION=0.22.2
##export VERSIONDATE=20140529
##export VERSION=0.22.3
##export VERSIONDATE=20140726
##export VERSION=0.23.1
##export VERSIONDATE=20140624
##export VERSION=0.23.1.1
##export VERSIONDATE=20140626
#####No package 'tracker-sparql-1.0' found
##export DEPENDANCIES=glib2,gssdp,gupnp,gupnp-dlna,gupnp-av,gstreamer,libgee,libsoup-2.4,sqlite3
##export VERSION=0.23.2
##export VERSIONDATE=20140723
##export VERSION=0.23.3.1
##export VERSIONDATE=20140820
##export VERSION=0.24.0
##export VERSIONDATE=20140922
##export VERSION=0.24.1
##export VERSIONDATE=20141014
##export VERSION=0.24.2
##export VERSIONDATE=20141111
##export VERSION=0.24.3
##export VERSIONDATE=20150125
##export VERSION=0.24.4
##export VERSIONDATE=20150516
#####No package 'libmediaart-1.0' found
##export VERSION=0.25.0
##export VERSIONDATE=20141125
#####No package 'libmediaart-2.0' found
##export VERSION=0.25.1
##export VERSIONDATE=20150120
##export VERSION=0.25.2
##export VERSIONDATE=20150217
##export VERSION=0.25.2.1
##export VERSIONDATE=20150219
##export VERSION=0.25.3
##export VERSIONDATE=20150317
##export VERSION=0.26.0
##export VERSIONDATE=20150324
##export VERSION=0.26.1
##export VERSIONDATE=20150510
##export VERSION=0.27.1
##export VERSIONDATE=20150526
##export VERSION=0.27.2
##export VERSIONDATE=20150623
##export VERSION=0.27.3
##export VERSIONDATE=20150721
##export VERSION=0.27.4
##export VERSIONDATE=20150818
##export VERSION=0.27.5
##export VERSIONDATE=20150901
##export VERSION=0.27.6
##export VERSIONDATE=20150914
##export VERSION=0.28.0
##export VERSIONDATE=20150922
##export VERSION=0.28.1
##export VERSIONDATE=20151013
##export VERSION=0.28.2
##export VERSIONDATE=20151213
#####No package 'tracker-sparql-1.0' found
##export DEPENDANCIES=glib2,gssdp,gupnp,gupnp-dlna,gupnp-av,gstreamer,libgee,libsoup-2.4,sqlite3,libmediaart,tracker
##export VERSION=0.30.0
##export VERSIONDATE=20160406
##export VERSION=0.30.1
##export VERSIONDATE=20160412
##export VERSION=0.30.2
##export VERSIONDATE=20160510
#export VERSION=0.30.3
#export VERSIONDATE=20160524
##export VERSION=0.31.0
##export VERSIONDATE=20160426
##export VERSION=0.31.1
##export VERSIONDATE=20160524
##export VERSION=0.31.2
##export VERSIONDATE=20160621
##export VERSION=0.31.3
##export VERSIONDATE=20160719
##export VERSION=0.31.4
##export VERSIONDATE=20160816
##export VERSION=0.31.5
##export VERSIONDATE=20160830
##export VERSION=0.31.6
##export VERSIONDATE=20160913
##export VERSION=0.32.0
##export VERSIONDATE=20160920
##export VERSION=0.32.1
##export VERSIONDATE=20161011
##export VERSION=0.33.0
##export VERSIONDATE=20170117
##export VERSION=0.33.1
##export VERSIONDATE=20170214
##export VERSION=0.34.0
##export VERSIONDATE=20170320
##export VERSION=0.35.0
##export VERSIONDATE=20170816
##export VERSION=0.36.0
##export VERSIONDATE=20170912
##export VERSION=0.36.1
##export VERSIONDATE=20180206
##export VERSION=0.36.2
##export VERSIONDATE=20180905
##export VERSION=0.37.0
##export VERSIONDATE=20181113
##export VERSION=0.37.1
##export VERSIONDATE=20181210
##export VERSION=0.37.2
##export VERSIONDATE=20190206
##export VERSION=0.38.0
##export VERSIONDATE=20190312
##export VERSION=0.38.1
##export VERSIONDATE=20190525
#####src\librygel-core/rygel-basic-management-test.c:350: undefined reference to `setsid'
##export VERSION=0.38.2
##export VERSIONDATE=20191020
#####No package 'gupnp-1.2' found
#####No package 'gssdp-1.2' found
##export VERSION=0.38.3
##export VERSIONDATE=20191124
#####src\plugins\tracker\meson.build:40:0: ERROR: Dependency "tracker-sparql-2.0" not found, tried pkgconfig and cmake
#wl-showstatus --package-version
#export DEPENDANCIES=glib2,gssdp,gupnp,gupnp-dlna,gupnp-av,gstreamer,libgee,libsoup-2.4,sqlite3,libmediaart
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/rygel/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/`echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/'`/$BASENAME-$VERSION.tar.xz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
##tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
#tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
#cd $BASENAME-$VERSION
## fix signal stuff in src/rygel/rygel-signal-handler.c
##patch -ulbf src/rygel/rygel-signal-handler.c << EOF
##--- src/rygel/rygel-signal-handler.c  2010-11-29 16:39:00 +0100
##+++ src/rygel/rygel-signal-handler.c  2010-12-08 16:50:24 +0100
##@@ -67,4 +67,6 @@
## static RygelMain* rygel_signal_handler_main = NULL;
##+#ifndef __MINGW32__
## static struct sigaction rygel_signal_handler_action;
## static struct sigaction rygel_signal_handler_action = {0};
##+#endif
##
##@@ -97,2 +99,3 @@
## void rygel_signal_handler_setup (RygelMain* _main) {
##+#ifndef __MINGW32__
##        RygelMain* _tmp0_;
##@@ -112,2 +115,3 @@
##        sigaction (SIGHUP, &rygel_signal_handler_action, NULL);
##+#endif
## }
##@@ -124,2 +128,3 @@
## static void rygel_signal_handler_signal_handler (gint signum) {
##+#ifndef __MINGW32__
##        if (signum == SIGHUP) {
##@@ -129,2 +134,3 @@
##        }
##+#endif
## }
##EOF
### fix src/rygel/rygel-signal-handler.c (version <= 0.13.0)
##patch -ulbf src/rygel/rygel-signal-handler.c << EOF
##--- src/rygel/rygel-signal-handler.c  2011-11-23 17:01:50 +0100
##+++ src/rygel/rygel-signal-handler.c  2011-11-23 20:23:50 +0100
##@@ -65,8 +65,10 @@@
## static gpointer rygel_signal_handler_parent_class = NULL;
## static RygelMain* rygel_signal_handler_main;
## static RygelMain* rygel_signal_handler_main = NULL;
##+#ifndef __MINGW32__
## static struct sigaction rygel_signal_handler_action;
## static struct sigaction rygel_signal_handler_action = {0};
##+#endif
##
## GType rygel_signal_handler_get_type (void) G_GNUC_CONST;
## enum  {
##@@ -99,6 +101,7 @@
##
##
## void rygel_signal_handler_setup (RygelMain* _main) {
##+#ifndef __MINGW32__
##        RygelMain* _tmp0_;
##        RygelMain* _tmp1_;
##        struct sigaction _tmp2_ = {0};
##@@ -119,6 +122,7 @@
##        sigaction (SIGTERM, &_tmp4_, NULL);
##        _tmp5_ = rygel_signal_handler_action;
##        sigaction (SIGHUP, &_tmp5_, NULL);
##+#endif
## }
##
##
##@@ -166,6 +170,7 @@
## }
##
##
##+#ifndef __MINGW32__
## static void rygel_signal_handler_signal_handler (gint signum) {
##        RygelMain* _tmp0_;
##        gint _tmp1_;
##@@ -181,6 +186,7 @@
##                g_idle_add_full (G_PRIORITY_DEFAULT_IDLE, ____lambda15__gsource_func, NULL, NULL);
##        }
## }
##+#endif
##
##
## RygelSignalHandler* rygel_signal_handler_construct (GType object_type) {
##EOF
## fix src/rygel/rygel-signal-handler.c (version >= 0.13.0)
#patch -ulbf src/rygel/rygel-signal-handler.c << EOF
#--- src/rygel/rygel-signal-handler.c  2011-11-23 17:01:50 +0100
#+++ src/rygel/rygel-signal-handler.c  2012-04-30 09:50:58 +0200
#@@ -65,8 +65,10 @@
# static gpointer rygel_signal_handler_parent_class = NULL;
# static RygelMain* rygel_signal_handler_main;
# static RygelMain* rygel_signal_handler_main = NULL;
#+#ifndef __MINGW32__
# static struct sigaction rygel_signal_handler_action;
# static struct sigaction rygel_signal_handler_action = {0};
#+#endif
#
# GType rygel_signal_handler_get_type (void) G_GNUC_CONST;
# enum  {
#@@ -99,6 +101,7 @@
#
#
# void rygel_signal_handler_setup (RygelMain* _main) {
#+#ifndef __MINGW32__
#        RygelMain* _tmp0_;
#        RygelMain* _tmp1_;
#        struct sigaction _tmp2_ = {0};
#@@ -119,6 +122,7 @@
#        sigaction (SIGTERM, &_tmp4_, NULL);
#        _tmp5_ = rygel_signal_handler_action;
#        sigaction (SIGHUP, &_tmp5_, NULL);
#+#endif
# }
#
#
#@@ -175,9 +179,12 @@
#                return;
#        }
#        _tmp1_ = signum;
#+#ifndef __MINGW32__
#        if (_tmp1_ == SIGHUP) {
#                g_idle_add_full (G_PRIORITY_DEFAULT_IDLE, ____lambda14__gsource_func, NULL, NULL);
#-       } else {
#+       } else
#+#endif
#+       {
#                g_idle_add_full (G_PRIORITY_DEFAULT_IDLE, ____lambda15__gsource_func, NULL, NULL);
#        }
# }
#EOF
### fix src/rygel/rygel-signal-handler.c (version >= 0.13.4 <= 0.14.1)
##patch -ulbf src/rygel/rygel-signal-handler.c << EOF
##--- src/rygel/rygel-signal-handler.c  2012-03-20 08:19:00 +0100
##+++ src/rygel/rygel-signal-handler.c  2012-03-20 08:21:18 +0100
##@@ -65,8 +65,10 @@
## static gpointer rygel_signal_handler_parent_class = NULL;
## static RygelMain* rygel_signal_handler_main;
## static RygelMain* rygel_signal_handler_main = NULL;
##+#ifndef __MINGW32__
## static struct sigaction rygel_signal_handler_action;
## static struct sigaction rygel_signal_handler_action = {0};
##+#endif
##
## GType rygel_signal_handler_get_type (void) G_GNUC_CONST;
## enum  {
##@@ -99,6 +101,7 @@
##
##
## void rygel_signal_handler_setup (RygelMain* _main) {
##+#ifndef __MINGW32__
##        RygelMain* _tmp0_;
##        RygelMain* _tmp1_;
##        struct sigaction _tmp2_;
##@@ -117,6 +120,7 @@
##        sigaction (SIGTERM, &_tmp3_, NULL);
##        _tmp4_ = rygel_signal_handler_action;
##        sigaction (SIGHUP, &_tmp4_, NULL);
##+#endif
## }
##
##
##@@ -165,6 +169,7 @@
##
##
## static void rygel_signal_handler_signal_handler (gint signum) {
##+#ifndef __MINGW32__
##        RygelMain* _tmp0_;
##        gint _tmp1_;
##        _tmp0_ = rygel_signal_handler_main;
##@@ -178,6 +183,7 @@
##        } else {
##                g_idle_add_full (G_PRIORITY_DEFAULT_IDLE, ____lambda17__gsource_func, NULL, NULL);
##        }
##+#endif
## }
##EOF
## fix undefined uuid_generate/uuid_unparse in src/rygel/rygel-root-device-factory.c
#patch -ulbf src/rygel/rygel-root-device-factory.c << EOF
#--- src/rygel/rygel-root-device-factory.c  2010-11-29 16:39:00 +0100
#+++ src/rygel/rygel-root-device-factory.c  2010-12-08 17:05:12 +0100
#@@ -43,2 +43,5 @@
# #include <gobject/gvaluecollector.h>
#+#ifdef __MINGW32__
#+#include <windows.h>
#+#endif
# 
#@@ -236,4 +239,9 @@
# 
#+#ifndef __MINGW32__
# void uuid_generate (guchar* uuid);
# void uuid_unparse (guchar* uuid, guchar* output);
#+#else
#+#define uuid_generate(uuid) UuidCreate(&uuid)
#+#define uuid_unparse(uuid,uuid_string) { UCHAR* buf = NULL; UuidToString(&uuid, &buf); strcpy(uuid_string, (char*)buf); RpcStringFree(&buf); }
#+#endif
# GQuark root_device_factory_error_quark (void);
#EOF
## fix undefined uuid_generate/uuid_unparse in src/rygel/rygel-item-creator.c
#patch -ulbf src/rygel/rygel-item-creator.c << EOF
#--- src/rygel/rygel-item-creator.c  2011-11-23 17:01:50 +0100
#+++ src/rygel/rygel-item-creator.c  2011-11-23 20:45:48 +0100
#@@ -891,4 +891,9 @@
# static void rygel_item_creator_create_uri_ready (GObject* source_object, GAsyncResult* _res_, gpointer _user_data_);
#+#ifndef __MINGW32__
# void uuid_generate (guchar* uuid);
# void uuid_unparse (guchar* uuid, guchar* output);
#+#else
#+#define uuid_generate(uuid) UuidCreate(&uuid)
#+#define uuid_unparse(uuid,uuid_string) { UCHAR* buf = NULL; UuidToString(&uuid, &buf); strcpy(uuid_string, (char*)buf); RpcStringFree(&buf); }
#+#endif
# static void rygel_item_creator_wait_for_item_data_free (gpointer _data);
#EOF
## fix src/rygel/rygel-main.c (version >= 0.15.0)
#patch -ulbf src/rygel/rygel-main.c << EOF
#--- src/rygel/rygel-main.c  2012-05-29 17:38:50 +0200
#+++ src/rygel/rygel-main.c  2012-05-30 08:05:06 +0200
#@@ -34,3 +34,5 @@
# #include <config.h>
#+#ifndef _WIN32
# #include <glib-unix.h>
#+#endif
# #include <signal.h>
#@@ -453,2 +455,3 @@
#        g_signal_connect_object (_tmp7_, "plugin-available", (GCallback) _rygel_main_on_plugin_loaded_rygel_plugin_loader_plugin_available, self, 0);
#+#ifndef _WIN32
#        g_unix_signal_add_full (G_PRIORITY_DEFAULT, SIGHUP, ___lambda17__gsource_func, g_object_ref (self), g_object_unref);
#@@ -456,2 +459,3 @@
#        g_unix_signal_add_full (G_PRIORITY_DEFAULT, SIGTERM, ___lambda19__gsource_func, g_object_ref (self), g_object_unref);
#+#endif
#        gst_preset_set_app_dir (PRESET_DIR);
#EOF
## fix missing setsid/setpgid/killpg in src/librygel-core/rygel-basic-management-test.c (version >= 0.30.1)
#mv src/librygel-core/rygel-basic-management-test.c src/librygel-core/rygel-basic-management-test.c.bak
#cat > src/librygel-core/rygel-basic-management-test.c << EOF
##define setsid()
##define setpgid(pid,pgid)
##define killpg(pgrp,sig)
#EOF
#cat src/librygel-core/rygel-basic-management-test.c.bak >> src/librygel-core/rygel-basic-management-test.c
#wl-showstatus configure &&
##--enable-uninstalled
##autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# mv configure configure.bak
# sed -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure.bak > configure
#fi
## fix version detection of OSSP uuid
#mv configure configure.bak
#sed -e "s/^\(UUID_REQUIRED\)=.*/\1=1.4.2/" configure.bak > configure
## fix version detection of gio-unix
#mv configure configure.bak2
#sed -e "s/gio-unix/gio-windows/g" configure.bak2 > configure
##INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --disable-shared LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lrpcrt4" &&
#INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lrpcrt4" &&
##INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --without-systemduserunitdir --disable-vala --disable-introspection --disable-example-plugins --disable-apidocs LDFLAGS="-Wl,-no-undefined -Wl,--as-needed -lrpcrt4" &&
# wl-showstatus build-install &&
# # fix building DLLs on 64-bit
# mv libtool libtool.bak &&
# sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
# #sed -e "s/\(allow_undefined=\)yes/\1no/" `which libtool` > libtool &&
# make install-strip &&
#    echo OK
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
#####libgupnp/.libs/gupnp-service.o:gupnp-service.c:(.text+0x3e1): undefined reference to `__sync_fetch_and_sub_4'
##make clean; make CFLAGS="-march=i686" CXXFLAGS="-march=i686" && echo OK
#####TO DO: build DLL
#####echo "EXPORTS" > rygel.def
#####grep " rygel_" src/rygel/rygel.h|sed -e "s/^.*\s*\(rygel_\)/\1/; s/ .*$//" >> rygel.def
## fix src/rygel/rygel.h for building DLL
#mv src/rygel/rygel.h src/rygel/rygel.h.bak
#cat > src/rygel/rygel.h << EOF
##ifndef RYGEL_API_DECL
## ifdef _WIN32
##  ifdef DLL_EXPORT
##   define RYGEL_API_DECL __declspec(dllexport)
##  else
##   define RYGEL_API_DECL __declspec(dllimport)
##  endif
## else
##  define RYGEL_API_DECL
## endif
##endif
#EOF
#sed -e "s/^\([^#].* \(rygel_\|free_desktop_\|root_device_factory_error_quark\)\)/RYGEL_API_DECL \1/" src/rygel/rygel.h.bak >> src/rygel/rygel.h



export NAME="Rygel"
export STATUS=
export URL=http://live.gnome.org/Rygel
export BASENAME=rygel
export DESCRIPTION="Rygel is a collection of DLNA (UPnP AV) services (devices in UPnP speak), implemented through a plug-in mechanism."
export CATEGORY=
export TYPE=library
#export VERSION=0.38.3
#export VERSIONDATE=20191124
#export VERSION=0.38.4
#export VERSIONDATE=20200704
#export VERSION=0.39.1
#export VERSIONDATE=20200705
#export VERSION=0.39.2
#export VERSIONDATE=20200810
#export VERSION=0.40.0
#export VERSIONDATE=20200914
#export VERSION=0.40.1
#export VERSIONDATE=20210220
#export VERSION=0.40.2
#export VERSIONDATE=20210919
#export VERSION=0.40.3
#export VERSIONDATE=20220109
#export VERSION=0.40.4
#export VERSIONDATE=20220604
#export VERSION=0.41.0
#export VERSIONDATE=20220604
#export VERSION=0.41.1
#export VERSIONDATE=20220702
#export VERSION=0.41.2
#export VERSIONDATE=20220808
export VERSION=0.42.0
export VERSIONDATE=20220917
####ERROR: Vala library 'rygel-renderer-2.6' has no Vala or Genie source files.
wl-showstatus --package-version
export DEPENDANCIES=glib2,gssdp,gupnp,gupnp-dlna,gupnp-av,gstreamer,libgee,libsoup-2.4,sqlite3,libmediaart,tracker,vala,gobject-introspection
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=meson,ninja
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/rygel/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing gio-unix
sed -i.bak -e "s/gio-unix-/gio-/" meson.build
mkdir -p build_both &&
 wl-showstatus configure &&
 PKG_CONFIG= PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib $PYDIR/python.exe $(which meson.py) --prefix $INSTALLPREFIX --backend ninja --buildtype release --strip --default-library both -Dsystemd-user-units-dir=none -Dplugins="['external','gst-launch','lms','media-export','mpris','playbin','ruih']" -Dintrospection=disabled -Dapi-docs=false -Dexamples=false -Dtests=false . build_both &&
 wl-showstatus configure &&
 #sed -i.bak -e "/COMMAND =.*python\.exe/ s?\"/\([a-zA-Z]\)/?\"\1:/?; /COMMAND =.*python\.exe/ s?/?\\\\?g" build_*/build.ninja &&
 wl-showstatus build-install &&
 PATH=$PATH:$PYDIR PYTHONPATH=${PYTHONPATH:+$PYTHONPATH:}$MINGWPREFIX/lib ninja -Cbuild_both install &&
    echo OK && find . -name '*.a'
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



