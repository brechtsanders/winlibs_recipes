export NAME="GlusterFS"
export STATUS=
export URL=http://www.gluster.org/
export BASENAME=glusterfs
export DESCRIPTION="GlusterFS is an open source, distributed file system capable of scaling to several petabytes (actually, 72 brontobytes!) and handling thousands of clients. GlusterFS clusters together storage building blocks over Infiniband RDMA or TCP/IP interconnect, aggregating disk and memory resources and managing data in a single global namespace. GlusterFS is based on a stackable user space design and can deliver exceptional performance for diverse workloads."
export CATEGORY=system
export TYPE=library
#export VERSION=3.3.1
#export VERSIONDATE=20130701
#export VERSION=3.3.2
#export VERSIONDATE=20130715
#export VERSION=3.4.0
#export VERSIONDATE=20130715
#export VERSION=3.4.5
#export VERSIONDATE=20140814
#export VERSION=3.5.0
#export VERSIONDATE=20140425
#export VERSION=3.5.1
#export VERSIONDATE=20140626
#export VERSION=3.5.2
#export VERSIONDATE=20140814
####dict.c:17:21: fatal error: fnmatch.h: No such file or directory
#export VERSION=3.6.0
#export VERSIONDATE=20150520
#export VERSION=3.8.1
#export VERSIONDATE=20160714
#export VERSION=3.9.0
#export VERSIONDATE=20170113
#export VERSION=3.10.3
#export VERSIONDATE=20170601
#export VERSION=3.10.6
#export VERSIONDATE=20171003
#export VERSION=3.10.7
#export VERSIONDATE=20171031
#export VERSION=3.10.8
#export VERSIONDATE=20171130
#export VERSION=3.10.9
#export VERSIONDATE=20180103
#export VERSION=3.10.10
#export VERSIONDATE=20180131
#export VERSION=3.10.11
#export VERSIONDATE=20180302
#export VERSION=3.10.12
#export VERSIONDATE=20180426
#export VERSION=3.11.0
#export VERSIONDATE=20170601
#export VERSION=3.12.0
#export VERSIONDATE=20170906
#export VERSION=3.12.1
#export VERSIONDATE=20170912
#export VERSION=3.12.2
#export VERSIONDATE=20171013
#export VERSION=3.12.3
#export VERSIONDATE=20171114
#export VERSION=3.12.4
#export VERSIONDATE=20171214
#export VERSION=3.12.5
#export VERSIONDATE=20180113
#export VERSION=3.12.6
#export VERSIONDATE=20180214
#export VERSION=3.12.7
#export VERSIONDATE=20180321
#export VERSION=3.12.8
#export VERSIONDATE=20180413
#export VERSION=3.12.9
#export VERSIONDATE=20180426
#export VERSION=3.12.10
#export VERSIONDATE=20180614
#export VERSION=3.12.12
#export VERSIONDATE=20180712
#export VERSION=3.12.13
#export VERSIONDATE=20180822
#export VERSION=3.12.14
#export VERSIONDATE=20180907
#export VERSION=3.12.15
#export VERSIONDATE=20181014
#export VERSION=3.13.0
#export VERSIONDATE=20171130
#export VERSION=3.13.1
#export VERSIONDATE=20171221
#export VERSION=3.13.2
#export VERSIONDATE=20180121
#export VERSION=4.0.0
#export VERSIONDATE=20180306
#export VERSION=4.0.1
#export VERSIONDATE=20180322
#export VERSION=4.0.2
#export VERSIONDATE=20180426
#export VERSION=4.1.0
#export VERSIONDATE=20180613
#export VERSION=4.1.1
#export VERSIONDATE=20180626
#export VERSION=4.1.2
#export VERSIONDATE=20180725
#export VERSION=4.1.3
#export VERSIONDATE=20180828
#export VERSION=4.1.4
#export VERSIONDATE=20180907
#export VERSION=4.1.5
#export VERSIONDATE=20180922
#export VERSION=4.1.6
#export VERSIONDATE=20181115
#export VERSION=4.1.7
#export VERSIONDATE=20190117
#export VERSION=4.1.8
#export VERSIONDATE=20190328
#export VERSION=4.1.9
#export VERSIONDATE=20190611
#export VERSION=4.1.10
#export VERSIONDATE=20190718
#export VERSION=4.5.0
#export VERSIONDATE=20181018
#export VERSION=5.1
#export VERSIONDATE=20181115
#export VERSION=5.2
#export VERSIONDATE=20181213
#export VERSION=5.3
#export VERSIONDATE=20190117
#export VERSION=5.4
#export VERSIONDATE=20190228
#export VERSION=5.5
#export VERSIONDATE=20190316
#export VERSION=5.6
#export VERSIONDATE=20190412
#export VERSION=5.7
#export VERSIONDATE=20190703
#export VERSION=5.8
#export VERSIONDATE=20190720
#export VERSION=5.9
#export VERSIONDATE=20190808
#export VERSION=5.10
#export VERSIONDATE=20191010
#export VERSION=5.11
#export VERSIONDATE=20191212
#export VERSION=5.12
#export VERSIONDATE=20200227
#export VERSION=5.13
#export VERSIONDATE=20200408
#export VERSION=6.0
#export VERSIONDATE=20190320
#export VERSION=6.1
#export VERSIONDATE=20190413
#export VERSION=6.2
#export VERSIONDATE=20190525
#export VERSION=6.3
#export VERSIONDATE=20190612
#export VERSION=6.4
#export VERSIONDATE=20190718
#export VERSION=6.5
#export VERSIONDATE=20190808
#export VERSION=6.6
#export VERSIONDATE=20191029
#export VERSION=6.7
#export VERSIONDATE=20200103
#export VERSION=6.8
#export VERSIONDATE=20200303
#export VERSION=6.9
#export VERSIONDATE=20200423
#export VERSION=6.10
#export VERSIONDATE=20200810
#export VERSION=7.0
#export VERSIONDATE=20191015
#export VERSION=7.2
#export VERSIONDATE=20200116
#export VERSION=7.3
#export VERSIONDATE=20200218
#export VERSION=7.4
#export VERSIONDATE=20200319
#export VERSION=7.5
#export VERSIONDATE=20200417
#export VERSION=7.6
#export VERSIONDATE=20200519
#export VERSION=7.7
#export VERSIONDATE=20200721
#export VERSION=7.8
#export VERSIONDATE=20200929
#export VERSION=7.9
#export VERSIONDATE=20201202
#export VERSION=8.0
#export VERSIONDATE=20200707
#export VERSION=8.1
#export VERSIONDATE=20200826
#export VERSION=8.2
#export VERSIONDATE=20200917
#export VERSION=8.3
#export VERSIONDATE=20201202
#export VERSION=8.4
#export VERSIONDATE=20210224
#export VERSION=8.5
#export VERSIONDATE=20210510
#export VERSION=8.6
#export VERSIONDATE=20210820
#export VERSION=9.0
#export VERSIONDATE=20210119
#export VERSION=9.1
#export VERSIONDATE=20210331
#export VERSION=9.2
#export VERSIONDATE=20210510
####configure: error: `rpcgen` not found, glusterfs needs `rpcgen` exiting..
#export VERSION=9.3
#export VERSIONDATE=20210629
#export VERSION=9.4
#export VERSIONDATE=20211004
#export VERSION=9.5
#export VERSIONDATE=20220117
#export VERSION=9.6
#export VERSIONDATE=20220810
#export VERSION=10.0
#export VERSIONDATE=20211102
####gcc.exe: fatal error: cannot specify '-o' with '-c', '-S' or '-E' with multiple files
#export VERSION=10.1
#export VERSIONDATE=20220119
#export VERSION=10.2
#export VERSIONDATE=20220513
#export VERSION=10.3
#export VERSIONDATE=20220920
#export VERSION=10.4
#export VERSIONDATE=20230406
export VERSION=11.0
export VERSIONDATE=20230208
####checking for OpenSSL trusted certificates path... configure: error: Unable to detect path to OpenSSL trusted certificates
wl-showstatus --package-version
export DEPENDENCIES=
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=portablexdr
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING-LGPLV3
export LICENSETYPE="GPLv2/LGPLv3"
export DOWNLOADURL="http://download.gluster.org/pub/gluster/glusterfs/"
#export DOWNLOADURL="http://www.gluster.org/download/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://download.gluster.org/pub/gluster/glusterfs/`echo $VERSION|sed -e "s/^\([0-9]*\.[0-9]*\)\..*$/\1/"`/$VERSION/$BASENAME-$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://download.gluster.org/pub/gluster/glusterfs/$(echo $VERSION|sed -e "s/^\([0-9]*\)\..*$/\1/")/$VERSION/$BASENAME-$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xz --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix missing files
mkdir -p winfix/netinet winfix/sys winfix/arpa winfix/bin
echo "#include <winsock2.h>" > winfix/netinet/in.h
echo "#include <winsock2.h>" > winfix/sys/socket.h
touch winfix/sys/uio.h winfix/sys/statvfs.h winfix/netdb.h winfix/arpa/inet.h winfix/sys/poll.h winfix/alloca.h
cp -f $(which portable-rpcgen.exe) winfix/bin/rpcgen.exe
# avoid invalid compiler parameters
sed -i.bak -e "s/-MT \(.*\) -MD -MP -MF/\1/" $(find -name Makefile)
## fix building DLLs on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# echo "AM_GNU_GETTEXT_VERSION(`gettext --version|head -n1|sed -e "s/^.* \([0-9\.]*\) *$/\1/"`)" >> configure.ac &&
# autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
#fi
#INTLTOOL_PERL="$PERLDIR/bin/perl.exe" 
#PERL="$PERLDIR/bin/perl.exe -I$PERLDIR/lib" 
#PYTHON=$PYDIR/python.exe 
#PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} 
wl-showstatus configure &&
 mkdir -p m4 &&
 autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
 # don't use -rdynamic compiler flag
 sed -i.bak -e "s/-rdynamic//; s/as_fn_error\(.*Support for POSIX ACLs is required\)/echo\1/" configure &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed -Wl,-no-undefined" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed" &&
#./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM CFLAGS="-I$(pwd)/winfix" LDFLAGS="-Wl,--as-needed -lws2_32" &&
PATH=$(pwd)/winfix/bin:$PATH ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --disable-dependency-tracking --disable-syslog CFLAGS="-I$(pwd)/winfix" LDFLAGS="-Wl,--as-needed -lws2_32" PYTHON=$PYDIR/python.exe &&
 wl-showstatus build-install &&
 ## fix building DLLs
 #mv libtool libtool.bak &&
 #sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
 PATH=$(pwd)/winfix/bin:$PATH make install-strip &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION



