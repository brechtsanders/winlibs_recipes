export NAME="QCAD"
export STATUS=
#export URL=https://www.qcad.org/
export URL=https://github.com/qcad/qcad
export BASENAME=qcad
export DESCRIPTION="QCAD - The Open Source 2D CAD. QCAD is a crossplatform CAD solution for Windows, Mac OS X and Linux. It supports the DXF format and optionally the DWG format (through a proprietary plugin)."
export CATEGORY=graphics
export TYPE=application
#export VERSION=3.21.3.14
#export VERSIONDATE=20190116
#export VERSION=3.22.0.0
#export VERSIONDATE=20190117
#export VERSION=3.21.3.15
#export VERSIONDATE=20190125
#export VERSION=3.21.3.16
#export VERSIONDATE=20190211
#export VERSION=3.21.3.17
#export VERSIONDATE=20190215
#export VERSION=3.21.3.18
#export VERSIONDATE=20190219
#export VERSION=3.21.3.19
#export VERSIONDATE=20190225
#export VERSION=3.21.3.15
#export VERSIONDATE=20190328
#export VERSION=3.22.0.0
#export VERSIONDATE=20190227
#export VERSION=3.22.0.1
#export VERSIONDATE=20190306
#export VERSION=3.22.0.2
#export VERSIONDATE=20190309
#export VERSION=3.22.0.3
#export VERSIONDATE=20190318
#export VERSION=3.22.0.4
#export VERSIONDATE=20190321
#export VERSION=3.22.0.5
#export VERSIONDATE=20190325
#export VERSION=3.22.0.6
#export VERSIONDATE=20190404
#export VERSION=3.22.0.7
#export VERSIONDATE=20190413
#export VERSION=3.22.0.9
#export VERSIONDATE=20190425
#export VERSION=3.22.0.10
#export VERSIONDATE=20190501
#export VERSION=3.22.0.11
#export VERSIONDATE=20190508
#export VERSION=3.22.0.12
#export VERSIONDATE=20190516
#export VERSION=3.22.1.0
#export VERSIONDATE=20190518
#export VERSION=3.22.1.2
#export VERSIONDATE=20190611
#export VERSION=3.22.1.3
#export VERSIONDATE=20190628
#export VERSION=3.22.1.4
#export VERSIONDATE=20190709
#export VERSION=3.22.1.6
#export VERSIONDATE=20190715
#export VERSION=3.22.1.7
#export VERSIONDATE=20190718
#export VERSION=3.23.0.0
#export VERSIONDATE=20190718
#export VERSION=3.23.0.2
#export VERSIONDATE=20190909
#export VERSION=3.23.0.3
#export VERSIONDATE=20191007
#export VERSION=3.23.0.4
#export VERSIONDATE=20191021
#export VERSION=3.23.0.5
#export VERSIONDATE=20191024
#export VERSION=3.23.0.6
#export VERSIONDATE=20191113
#export VERSION=3.23.0.7
#export VERSIONDATE=20191115
#export VERSION=3.23.0.8
#export VERSIONDATE=20191122
#export VERSION=3.23.0.9
#export VERSIONDATE=20191126
#export VERSION=3.23.0.10
#export VERSIONDATE=20191212
#export VERSION=3.23.3.6
#export VERSIONDATE=20200520
#export VERSION=3.24.1.0
#export VERSIONDATE=20200106
#export VERSION=3.24.2.1
#export VERSIONDATE=20200113
#export VERSION=3.24.2.3
#export VERSIONDATE=20200204
#export VERSION=3.24.2.4
#export VERSIONDATE=20200207
#export VERSION=3.24.2.5
#export VERSIONDATE=20200212
#export VERSION=3.24.2.6
#export VERSIONDATE=20200214
#export VERSION=3.24.3.0
#export VERSIONDATE=20200317
#export VERSION=3.24.3.2
#export VERSIONDATE=20200417
#export VERSION=3.24.3.3
#export VERSIONDATE=20200417
#export VERSION=3.24.3.4
#export VERSIONDATE=20200425
#export VERSION=3.24.3.6
#export VERSIONDATE=20200521
#export VERSION=3.24.3.7
#export VERSIONDATE=20200528
#export VERSION=3.24.3.8
#export VERSIONDATE=20200604
#export VERSION=3.24.3.10
#export VERSIONDATE=20200625
#export VERSION=3.25.0.0
#export VERSIONDATE=20200820
#export VERSION=3.25.1.0
#export VERSIONDATE=20200831
#export VERSION=3.25.2.0
#export VERSIONDATE=20200905
#export VERSION=3.25.2.1
#export VERSIONDATE=20201015
####make[3]: *** No rule to make target '../../release/stemmer.lib', needed by '../../release/qcadstemmer.dll'.  Stop.
#export VERSION=3.25.2.2
#export VERSIONDATE=20201027
#export VERSION=3.25.2.3
#export VERSIONDATE=20201103
#export VERSION=3.25.2.4
#export VERSIONDATE=20201118
#export VERSION=3.25.2.7
#export VERSIONDATE=20201218
#export VERSION=3.25.2.8
#export VERSIONDATE=20201222
#export VERSION=3.25.2.9
#export VERSIONDATE=20210119
#export VERSION=3.25.2.11
#export VERSIONDATE=20210204
#export VERSION=3.25.2.12
#export VERSIONDATE=20210204
#export VERSION=3.25.2.13
#export VERSIONDATE=20210213
#export VERSION=3.26.0.0
#export VERSIONDATE=20210302
#export VERSION=3.26.0.1
#export VERSIONDATE=20210303
#export VERSION=3.26.1.0
#export VERSIONDATE=20210308
#export VERSION=3.26.2.0
#export VERSIONDATE=20210415
#export VERSION=3.26.3.0
#export VERSIONDATE=20210531
####release/libopennurbs.a(opennurbs_zlib.o):opennurbs_zlib.cpp:(.text+0x22): undefined reference to `z_inflateInit_'
#export VERSION=3.26.4.2
#export VERSIONDATE=20210608
#export VERSION=3.26.4.5
#export VERSIONDATE=20210721
#export VERSION=3.26.4.6
#export VERSIONDATE=20210824
#export VERSION=3.26.4.7
#export VERSIONDATE=20210825
#export VERSION=3.26.4.8
#export VERSIONDATE=20210921
#export VERSION=3.26.4.9
#export VERSIONDATE=20211012
#export VERSION=3.26.4.10
#export VERSIONDATE=20211015
#export VERSION=3.26.2.5
#export VERSIONDATE=20230915
#export VERSION=3.27.1.3
#export VERSIONDATE=20220122
#export VERSION=3.27.1.4
#export VERSIONDATE=20220125
#export VERSION=3.27.1.5
#export VERSIONDATE=20220126
#export VERSION=3.27.1.6
#export VERSIONDATE=20220127
#export VERSION=3.27.1.8
#export VERSIONDATE=20220325
#export VERSION=3.27.2.0
#export VERSIONDATE=20220426
#export VERSION=3.27.3.0
#export VERSIONDATE=20220429
#export VERSION=3.27.4.0
#export VERSIONDATE=20220504
#export VERSION=3.27.5.0
#export VERSIONDATE=20220508
#export VERSION=3.27.6.0
#export VERSIONDATE=20220518
#export VERSION=3.27.6.3
#export VERSIONDATE=20220601
#export VERSION=3.27.6.7
#export VERSIONDATE=20220708
#export VERSION=3.27.6.10
#export VERSIONDATE=20220925
#export VERSION=3.27.6.11
#export VERSIONDATE=20220927
#export VERSION=3.27.7.0
#export VERSIONDATE=20221003
#export VERSION=3.27.8.0
#export VERSIONDATE=20221006
#export VERSION=3.27.8.1
#export VERSIONDATE=20221027
#export VERSION=3.27.8.2
#export VERSIONDATE=20221031
#export VERSION=3.27.8.3
#export VERSIONDATE=20221102
#export VERSION=3.27.8.4
#export VERSIONDATE=20221109
#export VERSION=3.27.8.6
#export VERSIONDATE=20221217
#export VERSION=3.27.8.7
#export VERSIONDATE=20221220
#export VERSION=3.27.9.0
#export VERSIONDATE=20230116
#export VERSION=3.27.9.2
#export VERSIONDATE=20230222
#export VERSION=3.27.9.3
#export VERSIONDATE=20230224
#export VERSION=3.28.0.0
#export VERSIONDATE=20230328
#export VERSION=3.28.1.0
#export VERSIONDATE=20230331
#export VERSION=3.28.1.3
#export VERSIONDATE=20230715
#export VERSION=3.28.2.1
#export VERSIONDATE=20230904
#export VERSION=3.28.2.2
#export VERSIONDATE=20230905
#export VERSION=3.29.0.0
#export VERSIONDATE=20240108
#export VERSION=3.29.1.0
#export VERSIONDATE=20240116
#export VERSION=3.29.1.1
#export VERSIONDATE=20240117
#export VERSION=3.29.2.0
#export VERSIONDATE=20240117
#export VERSION=3.29.3.0
#export VERSIONDATE=20240123
#export VERSION=3.29.3.1
#export VERSIONDATE=20240125
#export VERSION=3.29.4.1
#export VERSIONDATE=20240207
export VERSION=3.29.5.0
export VERSIONDATE=20240325
####src/io/dxf/RDxfImporter.cpp:130:30: error: invalid cast of an rvalue expression of type 'std::ifstream' {aka 'std::basic_ifstream<char>'} to type 'std::istream&' {aka 'std::basic_istream<char>&'}
wl-showstatus --package-version
export DEPENDENCIES=qt,snowball
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE.txt
export LICENSETYPE=GPL
#export DOWNLOADURL="https://github.com/qcad/qcad/releases"
export DOWNLOADURL="https://github.com/qcad/qcad/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=https://github.com/qcad/qcad/archive/v$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://github.com/qcad/qcad/archive/refs/tags/v$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/v$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix windres C++ issue in src/3rdparty/dxflib/src/dl_dxf.h
patch -ulbf src/3rdparty/dxflib/src/dl_dxf.h << EOF
@@ -29,2 +29,3 @@

+#ifdef __cplusplus
 #include <limits>
@@ -57,2 +58,3 @@
 class DL_WriterA;
+#endif

@@ -102,2 +104,3 @@
 #define DL_DICTIONARY          210
+#ifdef __cplusplus

@@ -529,2 +532,3 @@
 #endif
+#endif

EOF
wl-showstatus configure &&
 #$MINGWPREFIX/qt/bin/qmake.exe -makefile qcad.pro &&
 $MINGWPREFIX/qt/bin/qmake.exe -makefile qcad.pro -spec $MINGWPREFIX/qt/mkspecs/win32-g++ &&
 #$MINGWPREFIX/qt/bin/qmake.exe -r CONFIG+=ractivated &&
 #sed -i.bak -e "s?^LIBS\s*=.*?& -Wl,--as-needed -lrpcrt4 -L$(pwd)/release -lzlib?" src/entity/Makefile.Release &&
 # fix zlib linking issues
 mkdir -p release &&
 pexports $MINGWPREFIX/bin/zlib1.dll | sed -e "s/^[a-z][^ ]*$/z_& = &/" > release/libzlib.def &&
 dlltool -D $MINGWPREFIX/bin/zlib1.dll -d release/libzlib.def -l release/libzlib.a &&
 wl-showstatus build &&
 #( make CXX="${CXX:-g++} -fpermissive" || ( cp -u release/libstemmer.a release/stemmer.lib && make CXX="${CXX:-g++} -fpermissive" )) &&
 (
  make CXX="${CXX:-g++} -fpermissive" || 
  # fix building src/entity
  ( sed -i.bak -e "s?-luser32\s*\$?& -L../../release -Wl,--as-needed -lzlib -lrpcrt4?" src/entity/Makefile.Release && make CXX="${CXX:-g++} -fpermissive" ) || 
  ( cp -u release/libstemmer.a release/stemmer.lib && make CXX="${CXX:-g++} -fpermissive" )
 ) &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION
#sed -e "s/^\(\s\s*\)\(.*\)$/\1z_\2 = \2/" $C/lib/zlib.def > zlib.def
#dlltool -d zlib.def -l release/libzlib.a



