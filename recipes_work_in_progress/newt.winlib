#export NAME="Newt"
#export STATUS=
#export URL=https://pagure.io/newt
#export BASENAME=newt
#export DESCRIPTION="Newt is a programming library for color text mode, widget based user interfaces.  Newt can be used to add stacked windows, entry widgets, checkboxes, radio buttons, labels, plain text fields, scrollbars, etc., to text mode user interfaces.  Newt is based on the slang library."
#export CATEGORY=
#export TYPE=library
##export VERSION=0.52.19
##export VERSIONDATE=20161124
##export VERSION=0.52.20
##export VERSIONDATE=20170419
##export VERSION=0.52.21
##export VERSIONDATE=20190527
##export VERSION=0.52.22
##export VERSIONDATE=20221121
##export VERSION=0.52.23
##export VERSIONDATE=20221129
##export VERSION=0.52.24
##export VERSIONDATE=20231025
#export VERSION=0.52.25
#export VERSIONDATE=20250310
#####newt.c:7:24: fatal error: sys/signal.h: No such file or directory
#wl-showstatus --package-version
#export DEPENDENCIES=
#export OPTIONALDEPENDENCIES=gpm
#export BUILDDEPENDENCIES=
#export OPTIONALBUILDDEPENDENCIES=
#export LICENSEFILE=COPYING
#export LICENSETYPE=LGPL
##export DOWNLOADURL="https://pagure.io/newt/releases"
##export DOWNLOADURL="https://pagure.io/releases/newt/"
#export DOWNLOADURL="https://releases.pagure.org/newt/"
#export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
##export DOWNLOADSOURCEURL=https://pagure.io/releases/newt/$BASENAME-$VERSION.tar.gz
#export DOWNLOADSOURCEURL=https://releases.pagure.org/newt/$BASENAME-$VERSION.tar.gz
#wl-showstatus download
#wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
#wl-wait4deps
#wl-showstatus extract
#tar xz --force-local -f $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.gz
#cd $BASENAME-$VERSION
#wl-showstatus configure &&
# mkdir -p m4 &&
# autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
# #./autogen.sh &&
# #    echo OK
# ## fix building DLLs on 64-bit
# #if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# # echo "AM_GNU_GETTEXT_VERSION([$(gettext --version|head -n1|sed -e "s/^.* \([0-9\.]*\) *$/\1/")])" >> configure.ac &&
# # autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
# #fi
# #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" 
# #PERL="$PERLDIR/bin/perl.exe -I$PERLDIR/lib" 
# #PYTHON=$PYDIR/python.exe 
# #PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} 
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed -Wl,-no-undefined" &&
# #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed" &&
# ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM &&
# ## fix building DLLs
# #mv libtool libtool.bak &&
# #sed -e "s/\(allow_undefined=\)yes/\1no/" libtool.bak > libtool &&
# wl-showstatus build &&
# make libnewt.a sharedlib SOEXT=.dll LIBNEWTSH=libnewt.dll.a LIBNEWTSH=newt.dll &&
# make SOEXT=.dll LIBNEWTSH=libnewt.dll.a LIBNEWTSH=newt.dll &&
# wl-showstatus build-install &&
# make install &&
#    echo OK
## wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



export NAME="newt"
export STATUS=
export URL=https://pagure.io/newt
#export URL=https://github.com/mlichvar/newt
export BASENAME=newt
export DESCRIPTION="Newt is a programming library for color text mode, widget based user interfaces.  Newt can be used to add stacked windows, entry widgets, checkboxes, radio buttons, labels, plain text fields, scrollbars, etc., to text mode user interfaces.  Newt is based on the slang library."
export CATEGORY=tui
export TYPE=library
export VERSION=r0-52-25
export VERSIONDATE=20260105
wl-showstatus --package-version
export DEPENDENCIES=wcwidth
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=LGPL
export DOWNLOADURL="https://github.com/mlichvar/newt/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/mlichvar/newt/archive/refs/tags/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xz --force-local -f $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix test.c (version >= r0-52-25)
patch -ulbf test.c << EOF
@@ -26,3 +26,5 @@
     newtSuspend();
+#ifdef SIGTSTP
     raise(SIGTSTP);
+#endif
     newtResume();
EOF
# fix newt.c (version >= r0-52-25)
patch -ulbf newt.c << EOF
@@ -6,6 +6,10 @@
 #include <string.h>
+#ifndef _WIN32
 #include <sys/signal.h>
+#endif
 #include <sys/time.h>
 #include <sys/types.h>
+#ifndef _WIN32
 #include <termios.h>
+#endif
 #include <time.h>
@@ -419,4 +423,6 @@

+#ifdef SIGWINCH
     SLsignal_intr(SIGWINCH, handleSigwinch);
     SLang_getkey_intr_hook = getkeyInterruptHook;
+#endif

@@ -975,2 +981,3 @@
     /* Then bind strings from termcap entries */
+#ifndef _WIN32
     for (curr = keymap; curr->code; curr++) {
@@ -983,2 +990,3 @@
     }
+#endif

EOF
# fix dialogboxes.h (version >= r0-52-25)
patch -ulbf dialogboxes.h << EOF
@@ -26,4 +26,8 @@

+#ifdef __MINGW32__
+#include <minmax.h>
+#else
 int min(int a, int b);
 int max(int a, int b);
+#endif

EOF
# fix dialogboxes.c (version >= r0-52-25)
patch -ulbf dialogboxes.c << EOF
@@ -26,2 +26,3 @@

+#ifndef __MINGW32__
 int max (int a, int b)
@@ -35,2 +36,3 @@
 }
+#endif

EOF
# fix redefinition of NO_ERROR in whiptail.c (version >= r0-52-25)
patch -ulbf whiptail.c << EOF
@@ -17,2 +17,3 @@

+#undef NO_ERROR
 enum { NO_ERROR = 0, WAS_ERROR = 1 };
EOF
# fix undeclared wcwidth() in textbox.c (version >= r0-52-25)
sed -i.bak2 -e "1i #include <compat/wcwidth.h>" $(grep -l wcwidth $(find -name '*.c'))
wl-showstatus preconfigure &&
 mkdir -p m4 &&
 ##libtoolize -f -i -c &&
 ##intltoolize -f -c &&
 autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
 wl-showstatus configure &&
 #./autogen.sh &&
 #    echo OK
 ## fix building DLLs on 64-bit
 #if ( echo $RUNPLATFORM | grep -q x86_64 ); then
 # echo "AM_GNU_GETTEXT_VERSION([$(gettext --version|head -n1|sed -e "s/^.* \([0-9\.]*\) *$/\1/")])" >> configure.ac &&
 # autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
 #fi
 ## allow building shared libraries when using clang
 #if ${CC:-gcc} --version|grep -q "^clang" && ! ${CC:-gcc} --help|grep auto-import; then
 # sed -i.bak -e "s/\$LD --help 2>&1 | \(\$GREP\|grep\) 'auto-import'/true/" configure
 # #sed -i.bak -e "s/\$LD --help 2>&1 | \(\$GREP\|grep\) 'auto-import'/true/" $(find -name configure)
 #fi &&
 ## fix confusion between MSVC and clang
 #if ${CC:-gcc} --version|grep -q "^clang"; then
 # sed -i.bak2 -e "s/\b\(cl\)\(\*\)/\1.exe\2/g; s/\(ld_shlibs\)=no/\1yes/" configure
 #fi &&
 #PATH=$PATH:$PERLDIR/../c/bin INTLTOOL_PERL="$PERLDIR/bin/perl.exe" 
 #PERL="$PERLDIR/bin/perl.exe -I$PERLDIR/lib" 
 #PYTHON=$PYDIR/python.exe 
 #PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$C_INCLUDE_PATH:$PYDIR/include 
 #PKG_CONFIG_PATH=$MINGWPREFIX/libav/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} 
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,-no-undefined -Wl,--as-needed" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-year2038 --with-tcl --without-python LDFLAGS="-Wl,-no-undefined -lws2_32 -lwcwidth" &&
 ## fix building DLLs
 #sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 ## fix detection of shared libraries
 #sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1file_magic ^x86 archive import|^x86 DLL|PE32+* executable (DLL)|pe-i386|pe-x86-64/; s/'file format pe-i386[^']*'/\"\$deplibs_check_method\"/" libtool &&
 #sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1none/" libtool &&
 #sed -i.bak2 -e "s/\(deplibs_check_method=\"\)[^\"]*/\1pass_all/" libtool &&
 wl-showstatus build &&
 make &&
 wl-showstatus build-install &&
 make install-strip &&
 #( make install-strip || ( make install && strip $INSTALLPREFIX/bin/*.{dll,exe} )) &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



