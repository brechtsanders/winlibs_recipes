export NAME="gnumeric"
export STATUS=
export URL=http://www.gnome.org/projects/gnumeric
export BASENAME=gnumeric
export DESCRIPTION="Gnumeric spreadsheet"
export CATEGORY=office
export TYPE=application
#export VERSION=1.10.9
#export VERSIONDATE=20101008
#export VERSION=1.10.13
#export VERSIONDATE=20110205
#export VERSION=1.10.14
#export VERSIONDATE=20110325
#export VERSION=1.10.15
#export VERSIONDATE=20110522
#export VERSION=1.10.16
#export VERSIONDATE=20110617
####C:\Users\Brecht\AppData\Local\Temp\ccKdHyie.s: Assembler messages:
####C:\Users\Brecht\AppData\Local\Temp\ccKdHyie.s:255: Error: can't resolve `.drectve' {.drectve section} - `Ltext0' {.text section}
#export VERSION=1.10.17
#export VERSIONDATE=20110801
#export VERSION=1.11.0
#export VERSIONDATE=20111125
#export VERSION=1.11.1
#export VERSIONDATE=20120118
#export VERSION=1.11.2
#export VERSIONDATE=20120303
#export VERSION=1.11.3
#export VERSIONDATE=20120422
#export VERSION=1.11.4
#export VERSIONDATE=20120626
#export VERSION=1.11.5
#export VERSIONDATE=20120716
#export VERSION=1.11.6
#export VERSIONDATE=20120907
#export VERSION=1.11.90
#export VERSIONDATE=20121117
#export VERSION=1.12.0
#export VERSIONDATE=20121219
#export VERSION=1.12.1
#export VERSIONDATE=20130310
#export VERSION=1.12.2
#export VERSIONDATE=20130427
#export VERSION=1.12.3
#export VERSIONDATE=20130626
#export VERSION=1.12.4
#export VERSIONDATE=20130715
####No package 'libgoffice-0.10' found
#export VERSION=1.12.5
#export VERSIONDATE=20130820
#export VERSION=1.12.6
#export VERSIONDATE=20130828
#export VERSION=1.12.7
#export VERSIONDATE=20130902
####src/gutils.c:87:23: error: called object '"plugins"' is not a function
#export VERSION=1.12.8
#export VERSIONDATE=20131008
#export VERSION=1.12.9
#export VERSIONDATE=20131129
####Error: can't resolve `.drectve' {.drectve section} - `Ltext0' {.text section}
#export VERSION=1.12.10
#export VERSIONDATE=20140212
#export VERSION=1.12.11
#export VERSIONDATE=20140217
#export VERSION=1.12.12
#export VERSIONDATE=20140304
#export VERSION=1.12.13
#export VERSIONDATE=20140319
#export VERSION=1.12.14
#export VERSIONDATE=20140414
####src/main-application.c:152:2: error: implicit declaration of function 'g_option_context_set_delocalize' [-Werror=implicit-function-declaration]
#export VERSION=1.12.15
#export VERSIONDATE=20140501
#export VERSION=1.12.16
#export VERSIONDATE=20140524
#export VERSION=1.12.17
#export VERSIONDATE=20140610
####C:\Users\brecht\AppData\Local\Temp\ccVFIx3h.s:156: Error: can't resolve `.drectve' {.drectve section} - `Ltext0' {.text section}
#export VERSION=1.12.18
#export VERSIONDATE=20140926
#export VERSION=1.12.19
#export VERSIONDATE=20150124
#export VERSION=1.12.20
#export VERSIONDATE=20150205
#export VERSION=1.12.21
#export VERSIONDATE=20150305
#export VERSION=1.12.22
#export VERSIONDATE=20150417
####src/libgnumeric.c:186:3: error: implicit declaration of function 'setenv' [-Werror=implicit-function-declaration]
#export VERSION=1.12.23
#export VERSIONDATE=20150729
#export VERSION=1.12.24
#export VERSIONDATE=20151014
#export VERSION=1.12.25
#export VERSIONDATE=20151226
#export VERSION=1.12.26
#export VERSIONDATE=20151229
#export VERSION=1.12.27
#export VERSIONDATE=20160207
#export VERSION=1.12.28
#export VERSIONDATE=20160323
#export VERSION=1.12.29
#export VERSIONDATE=20160507
#export VERSION=1.12.30
#export VERSIONDATE=20160618
#export VERSION=1.12.31
#export VERSIONDATE=20160630
#export VERSION=1.12.32
#export VERSIONDATE=20160821
#export VERSION=1.12.33
#export VERSIONDATE=20170131
#export VERSION=1.12.34
#export VERSIONDATE=20170321
#export VERSION=1.12.35
#export VERSIONDATE=20170707
####/tmp/ccijRqsR.s:172: Error: can't resolve `.drectve' {.drectve section} - `Ltext0' {.text section}
#export VERSION=1.12.36
#export VERSIONDATE=20171119
#export VERSION=1.12.37
#export VERSIONDATE=20171202
#export VERSION=1.12.38
#export VERSIONDATE=20171229
#export VERSION=1.12.39
#export VERSIONDATE=20180314
#export VERSION=1.12.40
#export VERSIONDATE=20180430
#export VERSION=1.12.41
#export VERSIONDATE=20180508
#export VERSION=1.12.42
#export VERSIONDATE=20180810
#export VERSION=1.12.43
#export VERSIONDATE=20180820
#export VERSION=1.12.44
#export VERSIONDATE=20181125
####src/tools/gnm-solver.c:2573:10: error: 'gnm__BOOLEAN__OBJECT_POINTER' undeclared (first use in this function)
#export VERSION=1.12.45
#export VERSIONDATE=20190604
#export VERSION=1.12.46
#export VERSIONDATE=20191107
#export VERSION=1.12.47
#export VERSIONDATE=20200510
#export VERSION=1.12.48
#export VERSIONDATE=20200813
#export VERSION=1.12.49
#export VERSIONDATE=20210321
#export VERSION=1.12.50
#export VERSIONDATE=20210611
#export VERSION=1.12.51
#export VERSIONDATE=20220121
#export VERSION=1.12.52
#export VERSIONDATE=20220419
#export VERSION=1.12.53
#export VERSIONDATE=20220918
#export VERSION=1.12.54
#export VERSIONDATE=20230120
export VERSION=1.12.55
export VERSIONDATE=20230203
####No package 'libgoffice-0.10' found
wl-showstatus --package-version
export DEPENDENCIES=libgoffice,libgsf,libxml2,gtk3
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
#export DOWNLOADURL="http://ftp.gnome.org/pub/GNOME/sources/gnumeric/"
export DOWNLOADURL="https://download.gnome.org/sources/gnumeric/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.bz2
#export DOWNLOADSOURCEURL=http://ftp.gnome.org/pub/gnome/sources/$BASENAME/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
#export DOWNLOADSOURCEURL=https://ftp.gnome.org/pub/GNOME/sources/gnumeric/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
export DOWNLOADSOURCEURL=https://download.gnome.org/sources/gnumeric/$(echo $VERSION|sed 's/^\([0-9]*\.[0-9]*\)\..*$/\1/')/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
## fix src/gutils.c (version >= 1.12.3)
#patch -ulbf src/gutils.c << EOF
#--- src/gutils.c  2013-04-17 01:30:02 +0200
#+++ src/gutils.c  2013-06-26 19:04:24 +0200
#@@ -86,3 +86,3 @@
#        gnumeric_extern_plugin_dir = g_build_filename (dir, "lib",
#-                                            "gnumeric", GNM_API_VERSION, "plugins"
#+                                            "gnumeric", GNM_API_VERSION, "plugins",
#                                             NULL);
#EOF
# fix invalid %a in src/mathfunc.c (version >= 1.12.10)
patch -ulbf src/mathfunc.c << EOF
--- src/mathfunc.c  2014-01-13 20:43:06 +0100
+++ src/mathfunc.c  2014-02-12 10:44:22 +0100
@@ -225,3 +225,2 @@
   gnm_float dl_ = d_ - dh_;                            \\
-  if (0) g_printerr ("Adding %.50g  (%a)\\n", d_, d_);  \\
   L += dl_;                                            \\
EOF
# avoid missing g_option_context_set_delocalize in src/main-application.c (version >= 1.12.10)
patch -ulbf src/main-application.c << EOF
--- src/main-application.c  2014-01-16 04:30:38 +0100
+++ src/main-application.c  2014-02-12 10:59:40 +0100
@@ -151,3 +151,3 @@
         * http://bugzilla.gnome.org/show_bug.cgi?id=361321 */
-       g_option_context_set_delocalize   (ocontext, FALSE);
+       //g_option_context_set_delocalize   (ocontext, FALSE);
 #endif
EOF
# fix invalid %hhx in plugins/excel/ms-escher.c (version >= 1.12.10)
patch -ulbf plugins/excel/ms-escher.c << EOF
--- plugins/excel/ms-escher.c  2013-11-21 00:48:24 +0100
+++ plugins/excel/ms-escher.c  2014-02-12 11:24:48 +0100
@@ -493,3 +493,3 @@
                                failure = TRUE;
-                               g_warning ("Unknown compression type %hhx;", compress);
+                               g_warning ("Unknown compression type %02x;", (int)compress);
                        }
EOF
# fix %hu and %hhu printf formats in plugins/excel/xls-read-pivot.c (version >= 1.12.15)
patch -ulbf plugins/excel/xls-read-pivot.c << EOF
--- plugins/excel/xls-read-pivot.c  2013-12-07 19:49:20 +0100
+++ plugins/excel/xls-read-pivot.c  2014-05-01 23:29:46 +0200
@@ -143,4 +143,4 @@

-                       d (1, g_printerr ("%hu-%hu-%hhuT%hhu:%hhu:%hhu (data);\n",
-                                      y, m, d, h, mi, se););
+                       d (1, g_printerr ("%u-%u-%uT%u:%u:%u (data);\n",
+                                      (unsigned int)y, (unsigned int)m, (unsigned int)d, (unsigned int)h, (unsigned int)mi, (unsigned int)se););

@@ -428,3 +428,3 @@
                                        GSF_LE_GET_GINT8 (q->data + i));
-                               d (1, g_printerr ("%hhu ", GSF_LE_GET_GINT8 (q->data + i)););
+                               d (1, g_printerr ("%u ", (unsigned int)GSF_LE_GET_GINT8 (q->data + i)););
                        }
EOF
# fix %hhu printf formats in plugins/xbase/xbase.c (version >= 1.12.15)
patch -ulbf plugins/xbase/xbase.c << EOF
--- plugins/xbase/xbase.c  2013-02-23 23:58:38 +0100
+++ plugins/xbase/xbase.c  2014-05-01 23:39:12 +0200
@@ -244,3 +244,3 @@
        default:
-               g_printerr ("unknown 0x%hhx\n", hdr[0]);
+               g_printerr ("unknown 0x%x\n", (unsigned int)hdr[0]);
        }
EOF
# fix missing setenv in src/libgnumeric.c (version >= 1.12.18)
patch -ulbf src/libgnumeric.c << EOF
--- src/libgnumeric.c  2014-09-24 00:04:20.000000000 +0200
+++ src/libgnumeric.c  2014-09-26 22:27:52.000000000 +0200
@@ -184,4 +184,6 @@
        /* Default value is bogus, see 732184.  */
+#ifndef __MINGW32__
        if (!getenv ("G_ENABLE_DIAGNOSTIC"))
                setenv ("G_ENABLE_DIAGNOSTIC", "0", FALSE);
+#endif

EOF
## fix problem detecting GNU gettext tools on 64-bit
#if ( echo $RUNPLATFORM | grep -q x86_64 ); then
# sed -i.bak -e "s/as_fn_error\(.*GNU gettext tools not found; required for intltool\)/as_echo\1/" configure
#fi
# remove -Werror=missing-prototypes
sed -i.bak2 -e "s/-Werror=missing-prototypes//" configure
wl-showstatus configure &&
 #PATH=$PATH:$PERLDIR/../c/bin INTLTOOL_PERL="$PERLDIR/bin/perl.exe" ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-no-undefined -Wl,-no-undefined" &&
 PATH=$PATH:$PERLDIR/../c/bin INTLTOOL_PERL="$PERLDIR/bin/perl.exe" PATH=$PATH:$PERLDIR/../c/bin ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared LDFLAGS="-Wl,-no-undefined" PERL="$PERLDIR/bin/perl.exe" PYTHON=$PYDIR/python.exe &&
 wl-showstatus build-install &&
 # fix building DLLs
 sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 ( PATH=$PYDIR:$PERLDIR/bin:$PERLDIR/../c/bin:$PATH PERLLIB=$PERLDIR/vendor/lib${PERLLIB:+:$PERLLIB} make install-strip GENMARSHAL_COMMAND="PYTHON=$PYDIR/python.exe $MINGWPREFIX/bin/glib-genmarshal" || (
  GDK_PIXBUF_MODULEDIR=$(ls -1d $MINGWPREFIX/lib/gdk-pixbuf*/*/loaders | tail -n 1) gdk-pixbuf-query-loaders > $(ls -1d $MINGWPREFIX/lib/gdk-pixbuf*/*/loaders.cache | tail -n 1) &&
  GDK_PIXBUF_MODULE_FILE=$(ls -1d $MINGWPREFIX/lib/gdk-pixbuf*/*/loaders.cache | tail -n 1) GDK_PIXBUF_MODULEDIR=$MINGWPREFIX/lib/gdk-pixbuf-2.0/2.10.0/loaders PATH=$PATH:$PERLDIR/../c/bin make install-strip
 )) &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION




