export NAME="OBS Studio"
export STATUS=
export URL=https://obsproject.com/
export BASENAME=obs-studio
export DESCRIPTION="OBS Studio - Free and open source software for live streaming and screen recording"
export CATEGORY=multimedia
export TYPE=application
#export VERSION=27.0.1
#export VERSIONDATE=20210826
#export VERSION=27.1.0
#export VERSIONDATE=20210928
#export VERSION=27.1.1
#export VERSIONDATE=20210929
#export VERSION=27.1.3
#export VERSIONDATE=20211005
#export VERSION=27.2.0
#export VERSIONDATE=20220215
#export VERSION=27.2.1
#export VERSIONDATE=20220222
#export VERSION=27.2.2
#export VERSIONDATE=20220302
#export VERSION=27.2.3
#export VERSIONDATE=20220303
#export VERSION=27.2.4
#export VERSIONDATE=20220330
#export VERSION=28.0.0
#export VERSIONDATE=20220901
export VERSION=28.0.1
export VERSIONDATE=20220903
wl-showstatus --package-version
export DEPENDANCIES=zlib,ffmpeg4,qt,libcurl,libjansson,detours
#export DEPENDANCIES=zlib,ffmpeg4,qt,libcurl,libjansson,detours,libdshowcapture
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=cmake,ninja,swig
export LICENSEFILE=COPYING
export LICENSETYPE=GPL
export DOWNLOADURL="https://github.com/obsproject/obs-studio/releases"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
export DOWNLOADSOURCEURL=https://github.com/obsproject/obs-studio/archive/refs/tags/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfz $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
# fix deps/CMakeLists.txt (version >= 28.0.1)
patch -ulbf deps/CMakeLists.txt << EOF
@@ -1,5 +1,3 @@
 if(OS_WINDOWS)
-  if(NOT MINGW)
     add_subdirectory(w32-pthreads)
-  endif()
   add_subdirectory(ipc-util)
EOF
mkdir -p build_win &&
 wl-showstatus configure &&
 C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} PKG_CONFIG_PATH=$MINGWPREFIX/ffmpeg4/lib/pkgconfig${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH} PATH=$MINGWPREFIX/ffmpeg4/bin:$MINGWPREFIX/qt/bin:$PATH QTDIR=$MINGWPREFIX/qt QMAKESPEC=$MINGWPREFIX/qt/mkspecs/win32-g++ C_INCLUDE_PATH=$MINGWPREFIX/ffmpeg4/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} LIBRARY_PATH=$MINGWPREFIX/ffmpeg4/lib${LIBRARY_PATH:+:$LIBRARY_PATH} cmake.exe -Wno-dev -GNinja -DCMAKE_INSTALL_PREFIX:PATH=$INSTALLPREFIX -DDepsPath:PATH=$MINGWPREFIX -DCMAKE_BUILD_TYPE:STRING=Release -DENABLE_PLUGINS:BOOL=OFF -DBUILD_BROWSER:BOOL=OFF -DBUILD_VST:BOOL=OFF -DDISABLE_PYTHON:BOOL=ON -S. -Bbuild_win &&
 #wl-showstatus build &&
 #ninja -Cbuild_win &&
 wl-showstatus build-install &&
 ninja -Cbuild_win install/strip &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



