export NAME="xorg-server"
export STATUS=
export URL=http://xorg.freedesktop.org/
export BASENAME=xorg-server
export DESCRIPTION="The X.Org project provides an open source implementation of the X Window System."
export CATEGORY=x
export TYPE=library
#export VERSION=1.9.0
#export VERSIONDATE=20101011
#export VERSION=1.9.0.902
#export VERSIONDATE=20101016
#export VERSION=1.9.1
#export VERSIONDATE=20101025
#export VERSION=1.9.2
#export VERSIONDATE=20101101
#export VERSION=1.9.3
#export VERSIONDATE=20101214
#export VERSION=1.9.4
#export VERSIONDATE=20110204
#export VERSION=1.9.5
#export VERSIONDATE=20110318
#export DEPENDANCIES=glproto,mesalib,libdrm,libpciaccess
#export VERSION=1.9.2.901
#export VERSIONDATE=20101114
#export VERSION=1.9.2.902
#export VERSIONDATE=20101204
#export VERSION=1.9.3.901
#export VERSIONDATE=20110109
#export VERSION=1.9.3.902
#export VERSIONDATE=20110202
#export VERSION=1.9.99.901
#export VERSIONDATE=20101207
#export VERSION=1.9.99.902
#export VERSIONDATE=20101219
####Requested 'randrproto >= 1.4' but version of RandrProto is 1.3.2
####Requested 'xextproto >= 7.1.99' but version of XExtProto is 7.1.2
#export VERSION=1.10.0
#export VERSIONDATE=20110226
####Requested 'xextproto >= 7.1.99' but version of XExtProto is 7.1.2
#export VERSION=1.10.0.901
#export VERSIONDATE=20110329
#export VERSION=1.10.0.902
#export VERSIONDATE=20110409
#export VERSION=1.10.1
#export VERSIONDATE=20110416
#export VERSION=1.10.1.901
#export VERSIONDATE=20110507
#export VERSION=1.10.1.902
#export VERSIONDATE=20110521
#export VERSION=1.10.2
#export VERSIONDATE=20110529
#export VERSION=1.10.2.901
#export VERSIONDATE=20110618
#export VERSION=1.10.2.902
#export VERSIONDATE=20110711
#export VERSION=1.10.3
#export VERSIONDATE=20110713
#export VERSION=1.10.3.902
#export VERSIONDATE=20110813
#export VERSION=1.10.4
#export VERSIONDATE=20110819
####shm.c:37:21: error: sys/ipc.h: No such file or directory
####shm.c:38:21: error: sys/shm.h: No such file or directory
####shm.c:367: error: 'S_IRGRP' undeclared (first use in this function)
#export VERSION=1.10.6
#export VERSIONDATE=20120211
#export DEPENDANCIES=fixesproto,damageproto,xcmiscproto,xtrans,bigreqsproto,xproto,randrproto,renderproto,xextproto,inputproto,kbproto,fontsproto,videoproto,compositeproto,recordproto,scrnsaverproto,resourceproto,xineramaproto,libxkbfile,pixman,libxfont,libxau,libxdmcp,windowswmproto,libdmx
#export VERSION=1.11.0
#export VERSIONDATE=20110827
####No package 'khronos-opengl-registry' found
#export VERSION=1.11.1
#export VERSIONDATE=20110924
#export VERSION=1.11.1.902
#export VERSIONDATE=20111029
#export VERSION=1.11.2
#export VERSIONDATE=20111105
####Xext/shm.c:37:21: error: sys/ipc.h: No such file or directory
####Xext/shm.c:38:21: error: sys/shm.h: No such file or directory
#export VERSION=1.11.99.1
#export VERSIONDATE=20111121
#export VERSION=1.11.2.901
#export VERSIONDATE=20111128
#export VERSION=1.11.2.902
#export VERSIONDATE=20111210
#export VERSION=1.11.3
#export VERSIONDATE=20111217
#export VERSION=1.11.3.901
#export VERSIONDATE=20120107
#export VERSION=1.11.3.902
#export VERSIONDATE=20120121
#export VERSION=1.11.4
#export VERSIONDATE=20120128
#export VERSION=1.11.99.2
#export VERSIONDATE=20111218
#export VERSION=1.11.99.901
#export VERSIONDATE=20111228
#export VERSION=1.11.99.902
#export VERSIONDATE=20120129
#export VERSION=1.12.0
#export VERSIONDATE=20120305
#export VERSION=1.12.0.901
#export VERSIONDATE=20120331
#export VERSION=1.12.0.902
#export VERSIONDATE=20120410
####Requested 'inputproto >= 2.1.99.3' but version of InputProto is 2.1
#export VERSION=1.12.1
#export VERSIONDATE=20120414
#export VERSION=1.12.1.901
#export VERSIONDATE=20120507
#export VERSION=1.12.1.902
#export VERSIONDATE=20120520
#export VERSION=1.12.2
#export VERSIONDATE=20120530
####Xext/shm.c:36:21: error: sys/ipc.h: No such file or directory
####Xext/shm.c:37:21: error: sys/shm.h: No such file or directory
#export VERSION=1.12.2.901
#export VERSIONDATE=20120530
#export VERSION=1.12.2.902
#export VERSIONDATE=20120702
#export VERSION=1.12.3
#export VERSIONDATE=20120709
#export VERSION=1.12.3.901
#export VERSIONDATE=20120804
#export VERSION=1.12.3.902
#export VERSIONDATE=20120824
#export VERSION=1.12.4
#export VERSIONDATE=20120527
#export VERSION=1.12.99.901
#export VERSIONDATE=20120711
#export VERSION=1.12.99.902
#export VERSIONDATE=20120718
#export VERSION=1.12.99.903
#export VERSIONDATE=20120726
#export VERSION=1.12.99.904
#export VERSIONDATE=20120808
#export VERSION=1.12.99.905
#export VERSIONDATE=20120825
#export VERSION=1.13.0
#export VERSIONDATE=20120906
#export VERSION=1.13.0.901
#export VERSIONDATE=20121123
#export VERSION=1.13.0.902
#export VERSIONDATE=20121207
#export VERSION=1.13.1
#export VERSIONDATE=20121214
####include/os.h:91:18: error: expected '=', ',', ';', 'asm' or '__attribute__' before 'void'
#export VERSION=1.13.1.901
#export VERSIONDATE=20130104
#export VERSION=1.13.99.901
#export VERSIONDATE=20121220
#export VERSION=1.13.99.902
#export VERSIONDATE=20130214
####Requested 'inputproto >= 2.2.99.1' but version of InputProto is 2.2
#export VERSION=1.13.2
#export VERSIONDATE=20130125
#export VERSION=-1.13.2.901
#export VERSIONDATE=20130216
#export VERSION=-1.13.2.902
#export VERSIONDATE=20130301
####os/utils.c:215:22: error: storage size of 'act' isn't known
####os/utils.c:215:27: error: storage size of 'oact' isn't known
#export VERSION=1.13.3
#export VERSIONDATE=20130309
#export VERSION=1.13.4
#export VERSIONDATE=20130417
#export VERSION=1.14.0
#export VERSIONDATE=20130307
#export VERSION=1.14.1
#export VERSIONDATE=20130417
#export VERSION=1.14.1.901
#export VERSIONDATE=20130531
#export VERSION=1.14.1.902
#export VERSIONDATE=20130614
#export VERSION=1.14.2
#export VERSIONDATE=20130625
#export VERSION=1.14.2.901
#export VERSIONDATE=20130726
#export VERSION=1.14.2.902
#export VERSIONDATE=20130823
#export VERSION=1.14.99.1
#export VERSIONDATE=20130425
#export VERSION=1.14.99.2
#export VERSIONDATE=20131005
#export VERSION=1.14.99.3
#export VERSIONDATE=20131019
#export VERSION=1.14.3
#export VERSIONDATE=20130913
#export VERSION=1.14.3.901
#export VERSIONDATE=20131027
#export VERSION=1.14.4
#export VERSIONDATE=20131101
#export VERSION=1.14.4.901
#export VERSIONDATE=20131122
#export VERSION=1.14.99.901
#export VERSIONDATE=20131101
#export VERSION=1.14.99.902
#export VERSIONDATE=20131114
#export VERSION=1.14.99.903
#export VERSIONDATE=20131125
#export VERSION=1.14.99.904
#export VERSIONDATE=20131211
#export VERSION=1.14.99.905
#export VERSIONDATE=20131220
####glx/glapitable.h:456:94: error: unknown type name 'GLchar'
####hw/xwin/winmultiwindowwindow.c:62:5: error: unknown type name 'wATOM'
#export VERSION=1.14.5
#export VERSIONDATE=20131213
#export VERSION=1.14.6
#export VERSIONDATE=20140414
#export VERSION=1.14.7
#export VERSIONDATE=20140606
#export DEPENDANCIES=fixesproto,damageproto,xcmiscproto,xtrans,bigreqsproto,xproto,randrproto,renderproto,xextproto,inputproto,kbproto,fontsproto,videoproto,compositeproto,recordproto,scrnsaverproto,resourceproto,xineramaproto,glproto,libxkbfile,pixman,libxfont,libxau,libxdmcp,windowswmproto,dmxproto,libdmx,khronos-opengl-registry
#export VERSION=1.15.0
#export VERSIONDATE=20131228
#export VERSION=1.15.1
#export VERSIONDATE=20140414
#export VERSION=1.15.2
#export VERSIONDATE=20140627
#export VERSION=1.15.99.901
#export VERSIONDATE=20140225
#export VERSION=1.15.99.902
#export VERSIONDATE=20140409
#export VERSION=1.15.99.903
#export VERSIONDATE=20140605
#export VERSION=1.15.99.904
#export VERSIONDATE=20140708
#export VERSION=1.16.0
#export VERSIONDATE=20140717
#export VERSION=1.16.0.901
#export VERSIONDATE=20140916
#export VERSION=1.16.1
#export VERSIONDATE=20140921
#export VERSION=1.16.1.901
#export VERSIONDATE=20141102
#export VERSION=1.16.2
#export VERSIONDATE=20141110
#export VERSION=1.16.2.901
#export VERSIONDATE=20141210
#export VERSION=1.16.3
#export VERSIONDATE=20141220
#export VERSION=1.16.4
#export VERSIONDATE=20150211
#export VERSION=1.16.99.902
#export VERSIONDATE=20150124
#export VERSION=1.17.0
#export VERSIONDATE=20150205
#export VERSION=1.17.1
#export VERSIONDATE=20150211
#export VERSION=1.17.2
#export VERSIONDATE=20150617
#export VERSION=1.17.3
#export VERSIONDATE=20151031
#export VERSION=1.17.99.901
#export VERSIONDATE=20150902
#export VERSION=1.17.99.902
#export VERSIONDATE=20151031
#export VERSION=1.17.4
#export VERSIONDATE=20151101
#export VERSION=1.18.0
#export VERSIONDATE=20151111
#export VERSION=1.18.2
#export VERSIONDATE=20160406
#export VERSION=1.18.3
#export VERSIONDATE=20160407
#export VERSION=1.18.4
#export VERSIONDATE=20160720
####configure: error: python3 not found
#export DEPENDANCIES=fixesproto,damageproto,xcmiscproto,xtrans,bigreqsproto,xproto,randrproto,renderproto,xextproto,inputproto,kbproto,fontsproto,videoproto,compositeproto,recordproto,scrnsaverproto,resourceproto,xineramaproto,glproto,libxkbfile,pixman,libxfont,libxau,libxdmcp,windowswmproto,dmxproto,libdmx,khronos-opengl-registry,presentproto
#export VERSION=1.18.99.2
#export VERSIONDATE=20160917
#export VERSION=1.18.99.901
#export VERSIONDATE=20160920
#export VERSION=1.18.99.902
#export VERSIONDATE=20161029
#export VERSION=1.19.0
#export VERSIONDATE=20161116
#export VERSION=1.19.1
#export VERSIONDATE=20170113
####configure: error: python3 not found
#export VERSION=1.19.2
#export VERSIONDATE=20170303
#export VERSION=1.19.3
#export VERSIONDATE=20170316
####configure: error: cannot find install-sh, install.sh, or shtool in "." "./.." "./../.."
#export VERSION=1.19.4
#export VERSIONDATE=20171005
#export VERSION=1.19.5
#export VERSIONDATE=20171013
#export VERSION=1.19.6
#export VERSIONDATE=20171221
#export VERSION=1.19.7
#export VERSIONDATE=20190303
#export VERSION=1.19.99.901
#export VERSIONDATE=20180301
#export VERSION=1.19.99.902
#export VERSIONDATE=20180330
#export VERSION=1.19.99.903
#export VERSIONDATE=20180403
#export VERSION=1.19.99.904
#export VERSIONDATE=20180411
#export VERSION=1.19.99.905
#export VERSIONDATE=20180425
#export VERSION=1.20.0
#export VERSIONDATE=20180511
#export VERSION=1.20.1
#export VERSIONDATE=20180808
#export VERSION=1.20.2
#export VERSIONDATE=20181016
#export VERSION=1.20.3
#export VERSIONDATE=20181025
#export VERSION=1.20.4
#export VERSIONDATE=20190227
#export DEPENDANCIES=fixesproto,damageproto,xcmiscproto,xtrans,bigreqsproto,xproto,randrproto,renderproto,xextproto,inputproto,kbproto,fontsproto,videoproto,compositeproto,recordproto,scrnsaverproto,resourceproto,xineramaproto,glproto,libxkbfile,pixman,libxfont,libxau,libxdmcp,windowswmproto,dmxproto,libdmx,khronos-opengl-registry,presentproto,libxfont2,xcbutil,xcbutilimage,xcbutilwm
#export OPTIONALDEPENDANCIES=
#export BUILDDEPENDANCIES=
#export VERSION=1.20.5
#export VERSIONDATE=20190531
####Requested 'randrproto >= 1.6.0' but version of RandrProto is 1.5.0
#export VERSION=1.20.6
#export VERSIONDATE=20191123
#export VERSION=1.20.7
#export VERSIONDATE=20200114
#export VERSION=1.20.8
#export VERSIONDATE=20200330
#export VERSION=1.20.9
#export VERSIONDATE=20200826
#export VERSION=1.20.10
#export VERSIONDATE=20201202
#export VERSION=1.20.11
#export VERSIONDATE=20210414
#export VERSION=1.20.12
#export VERSIONDATE=20210709
#export VERSION=1.20.13
#export VERSIONDATE=20210730
export VERSION=1.20.14
export VERSIONDATE=20211216
####include/os.h:720:32: error: unknown type name 'sigset_t'
#export VERSION=21.0.99.1
#export VERSIONDATE=20210706
#export VERSION=21.0.99.901
#export VERSIONDATE=20210922
#export VERSION=21.0.99.902
#export VERSIONDATE=20211015
#export VERSION=21.1.0
#export VERSIONDATE=20211027
#export VERSION=21.1.1
#export VERSIONDATE=20211107
#export VERSION=21.1.2
#export VERSIONDATE=20211115
#export VERSION=21.1.3
#export VERSIONDATE=20220103
#export VERSION=21.1.4
#export VERSIONDATE=20220712
wl-showstatus --package-version
export DEPENDANCIES=xorgproto,libdmx,xtrans,khronos-opengl-registry,libxfont2,xcbutil,xcbutilimage,xcbutilwm
#export DEPENDANCIES=xorgproto,libdmx,xtrans,khronos-opengl-registry,libxfont2,xcbutil,xcbutilimage,xcbutilwm,libxcvt
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=
export LICENSETYPE=
export DOWNLOADURL="http://xorg.freedesktop.org/archive/individual/xserver/"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=http://xorg.freedesktop.org/archive/individual/xserver/$BASENAME-$VERSION.tar.bz2
export DOWNLOADSOURCEURL=https://www.x.org/archive/individual/xserver/$BASENAME-$VERSION.tar.xz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
#tar xfj $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.bz2
tar xfJ $TARBALLDIR/$BASENAME/$BASENAME-$VERSION.tar.xz
cd $BASENAME-$VERSION
# fix missing files
mkdir -p winfix/sys
touch winfix/sys/wait.h
#mkdir -p Xext/sys
#touch Xext/sys/shm.h
#cat > Xext/sys/ipc.h << EOF
##define geteuid() 0
##define getegid() 0
##define S_IRGRP 0
##define S_IWGRP 0
##define S_IROTH 0
##define S_IWOTH 0
#EOF
## fix redefinition of ATOM in include/misc.h (version <= 1.11.0)
#patch -ulbf include/misc.h << EOF
#--- include/misc.h  2010-05-13 17:30:28 +0200
#+++ include/misc.h  2011-02-03 21:20:12 +0100
#@@ -94,3 +94,7 @@
# typedef unsigned long PIXEL;
#+#ifdef _WIN32
#+#include <windef.h>
#+#else
# typedef unsigned long ATOM;
#+#endif
#
#EOF
# fix redefinition of ATOM in include/misc.h (version >= 1.11.1)
patch -ulbf include/misc.h << EOF
--- include/misc.h  2011-05-13 23:06:04 +0200
+++ include/misc.h  2011-09-29 10:44:28 +0200
@@ -94,3 +94,7 @@

+#ifdef _WIN32
+#include <windef.h>
+#else
 typedef uint32_t ATOM;
+#endif

EOF
## fix missing files (version >= 1.9.5)
#mkdir -p sys
#touch sys/ipc.h sys/shm.h sys/wait.h
# fix configure
patch -ulbf configure << EOF
--- configure  2010-12-13 20:59:10 +0100
+++ configure  2011-02-03 20:51:56 +0100
@@ -22176,2 +22176,7 @@
                ;;
+         mingw*)
+               XORG_OS="freebsd"
+               XORG_OS_SUBDIR="bsd"
+               xorg_bus_bsdpci="no"
+               ;;
          netbsd*)
EOF
# fix os/osinit.c (version >= 1.13.0)
patch -ulbf os/osinit.c << EOF
--- os/osinit.c  2012-08-18 01:18:42 +0200
+++ os/osinit.c  2012-09-06 21:14:44 +0200
@@ -100,2 +100,3 @@

+#ifndef __MINGW32__
 /*
@@ -148,2 +149,3 @@
 }
+#endif

@@ -153,3 +155,7 @@
     static Bool been_here = FALSE;
+#ifdef __MINGW32__
+    static const char *devnull = "NUL:";
+#else
     static const char *devnull = "/dev/null";
+#endif
     char fname[PATH_MAX];
@@ -157,2 +163,3 @@
     if (!been_here) {
+#ifndef __MINGW32__
         struct sigaction act, oact;
@@ -183,2 +190,3 @@
         }
+#endif
 #ifdef HAVE_BACKTRACE
@@ -243,4 +251,6 @@

+#ifndef __MINGW32__
         if (getpgrp() == 0)
             setpgid(0, 0);
+#endif

EOF
# fix os/utils.c (version >= 1.13.0)
patch -ulbf os/utils.c << EOF
--- os/utils.c  2012-08-27 17:06:10 +0200
+++ os/utils.c  2012-09-06 21:52:52 +0200
@@ -63,2 +63,10 @@
 #endif
+#ifdef __MINGW32__
+#define sleep(t) _sleep((t) * 1000)
+#define getpid() 0
+#define kill(p, s) 0
+#define fchmod(f,p) 0
+#define link(src,dst) -1
+#define O_NOFOLLOW 0
+#endif

@@ -211,2 +219,3 @@

+#ifndef __MINGW32__
 OsSigHandlerPtr
@@ -225,2 +234,3 @@
 }
+#endif

@@ -238,3 +248,3 @@
 static Bool StillLocking = FALSE;
-static char LockFile[PATH_MAX];
+static char Lock_File[PATH_MAX];
 static Bool nolock = FALSE;
@@ -265,6 +275,6 @@
     len += strlen(tmppath) + strlen(port) + strlen(LOCK_SUFFIX) + 1;
-    if (len > sizeof(LockFile))
+    if (len > sizeof(Lock_File))
         FatalError("Display name `%s' is too long\n", port);
     (void) sprintf(tmp, "%s" LOCK_TMP_PREFIX "%s" LOCK_SUFFIX, tmppath, port);
-    (void) sprintf(LockFile, "%s" LOCK_PREFIX "%s" LOCK_SUFFIX, tmppath, port);
+    (void) sprintf(Lock_File, "%s" LOCK_PREFIX "%s" LOCK_SUFFIX, tmppath, port);

@@ -310,3 +320,3 @@
     while ((!haslock) && (i++ < 3)) {
-        haslock = (link(tmp, LockFile) == 0);
+        haslock = (link(tmp, Lock_File) == 0);
         if (haslock) {
@@ -321,6 +331,6 @@
              */
-            lfd = open(LockFile, O_RDONLY | O_NOFOLLOW);
+            lfd = open(Lock_File, O_RDONLY | O_NOFOLLOW);
             if (lfd < 0) {
                 unlink(tmp);
-                FatalError("Can't read lock file %s\n", LockFile);
+                FatalError("Can't read lock file %s\n", Lock_File);
             }
@@ -331,3 +341,3 @@
                  */
-                unlink(LockFile);
+                unlink(Lock_File);
                 close(lfd);
@@ -348,3 +358,3 @@
                  */
-                unlink(LockFile);
+                unlink(Lock_File);
                 continue;
@@ -359,3 +369,3 @@
                      port, "\tIf this server is no longer running, remove",
-                     LockFile, "\tand start again.");
+                     Lock_File, "\tand start again.");
             }
@@ -365,3 +375,3 @@
     if (!haslock)
-        FatalError("Could not create server lock file: %s\n", LockFile);
+        FatalError("Could not create server lock file: %s\n", Lock_File);
     StillLocking = FALSE;
@@ -381,3 +391,3 @@

-        (void) unlink(LockFile);
+        (void) unlink(Lock_File);
     }
@@ -1105,2 +1115,3 @@
 {
+#ifndef __MINGW32__
     struct itimerval timer;
@@ -1114,2 +1125,3 @@
     (void) setitimer(ITIMER_REAL, &timer, 0);
+#endif
 }
@@ -1119,2 +1131,3 @@
 {
+#ifndef __MINGW32__
     struct itimerval timer;
@@ -1128,2 +1141,3 @@
     setitimer(ITIMER_REAL, &timer, 0);
+#endif
 }
@@ -1139,2 +1153,3 @@
 {
+#ifndef __MINGW32__
     struct sigaction act;
@@ -1154,2 +1169,3 @@
     }
+#endif
 }
@@ -1213,2 +1229,3 @@
 #endif
+    return 1;
 }
EOF
# fix missing MONITOR_DEFAULTTONULL in hw/xwin/wincreatewnd.c
mv hw/xwin/wincreatewnd.c hw/xwin/wincreatewnd.c.bak
echo "#define _WIN32_WINNT 0x0500" > hw/xwin/wincreatewnd.c
cat hw/xwin/wincreatewnd.c.bak >> hw/xwin/wincreatewnd.c
# fix missing VK_VOLUME_MUTE in hw/xwin/winkeybd.h
mv hw/xwin/winkeybd.c hw/xwin/winkeybd.c.bak
echo "#define _WIN32_WINNT 0x0500" > hw/xwin/winkeybd.c
cat hw/xwin/winkeybd.c.bak >> hw/xwin/winkeybd.c
# fix missing MONITOR_DEFAULTTOPRIMARY in hw/xwin/winprocarg.c
mv hw/xwin/winprocarg.c hw/xwin/winprocarg.c.bak
echo "#define _WIN32_WINNT 0x0500" > hw/xwin/winprocarg.c
cat hw/xwin/winprocarg.c.bak >> hw/xwin/winprocarg.c
# fix include/resource.h (version >= 1.20.11)
patch -ulbf include/resource.h << EOF
@@ -195,2 +195,6 @@

+#ifdef _WIN32
+#undef FreeResource
+#define FreeResource XFreeResource
+#endif
 extern _X_EXPORT void FreeResource(XID /*id */ ,
EOF
# fix include/window.h (version >= 1.20.11)
patch -ulbf include/window.h << EOF
@@ -101,2 +101,6 @@

+#ifdef _WIN32
+#undef CreateWindow
+#define CreateWindow XCreateWindow
+#endif
 extern _X_EXPORT WindowPtr CreateWindow(Window /*wid */ ,
EOF
# fix include/os.h (version >= 1.20.11)
patch -ulbf include/os.h << EOF
@@ -718,2 +718,3 @@

+#ifndef _WIN32
 #include <signal.h>
@@ -722,2 +723,3 @@
 xthread_sigmask(int how, const sigset_t *set, sigset_t *oldest);
+#endif

EOF
# fix dix/colormap.c (version >= 1.20.11)
patch -ulbf dix/colormap.c << EOF
@@ -106,2 +106,6 @@

+#ifdef _WIN32
+#undef UpdateColors
+#define UpdateColors XUpdateColors
+#endif
 static void UpdateColors(ColormapPtr    /*pmap */
EOF
# fix dix/events.c (version >= 1.20.11)
patch -ulbf dix/events.c << EOF
@@ -4757,3 +4757,3 @@
     if ((focusID == None) || (focusID == PointerRoot))
-        focusWin = (WindowPtr) (long) focusID;
+        focusWin = (WindowPtr) (intptr_t) focusID;
     else if ((focusID == FollowKeyboard) && followOK) {
EOF
# fix dix/pixmap.c (version >= 1.20.11)
patch -ulbf dix/pixmap.c << EOF
@@ -139,3 +139,3 @@
      ScreenPtr pScreen = slave_pixmap->drawable.pScreen;
-     pScreen->SetSharedPixmapBacking(slave_pixmap, ((void *)(long)ihandle));
+     pScreen->SetSharedPixmapBacking(slave_pixmap, ((void *)(uintptr_t)ihandle));
 }
EOF
# fix dix/resource.c (version >= 1.20.11)
patch -ulbf dix/resource.c << EOF
@@ -809,3 +809,3 @@
         ErrorF("[dix] AddResource(%lx, %x, %lx), client=%d \\n",
-               (unsigned long) id, type, (unsigned long) value, client);
+               (unsigned long) id, type, (uintptr_t) value, client);
         FatalError("client not in use\\n");
EOF
# fix mi/miline.h (version >= 1.20.11)
sed -i.bak -e "s/(unsigned long)\(\s*(unsigned long\*)\)/(uintptr_t\1/" mi/miline.h
# fix dix/pixmap.c (version >= 21.0.99.902)
patch -ulbf dix/pixmap.c << EOF
@@ -138,3 +138,3 @@
      ScreenPtr pScreen = secondary_pixmap->drawable.pScreen;
-     pScreen->SetSharedPixmapBacking(secondary_pixmap, ((void *)(long)ihandle));
+     pScreen->SetSharedPixmapBacking(secondary_pixmap, ((void *)(intptr_t)ihandle));
 }
EOF
# fix missing math.h in dix/inpututils.c (version >= 21.1.1)
mv dix/inpututils.c dix/inpututils.c.bak &&
echo "#include <math.h>" > dix/inpututils.c &&
cat dix/inpututils.c.bak >> dix/inpututils.c
wl-showstatus configure &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-windowswm --disable-libdrm LDFLAGS="-Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-windowswm --disable-libdrm --without-xmlto LDFLAGS="-Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared --enable-windowswm --disable-libdrm --without-xmlto GL_CFLAGS=" " GL_LIBS="-Wl,--as-needed -lopengl32 -lglu32" LDFLAGS="-Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-xorg --disable-xv --disable-dmx --disable-mitshm --disable-aiglx --disable-glx --disable-dri --disable-dri2 --disable-libdrm --disable-install-setuid CPPFLAGS='-DwBOOL=WINBOOL' &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-xorg --disable-xv --disable-dmx --disable-mitshm --disable-aiglx --disable-glx --disable-dri --disable-dri2 --disable-libdrm --disable-install-setuid CPPFLAGS="-I$(pwd)/winfix" CPPFLAGS="-I$(pwd)/winfix -DwBOOL=WINBOOL" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --disable-xorg --disable-xv --disable-dmx --disable-mitshm --disable-aiglx --disable-glx --disable-dri --disable-dri2 --disable-libdrm --disable-install-setuid --disable-unit-tests CPPFLAGS="-I$(pwd)/winfix" CPPFLAGS="-I$(pwd)/winfix -DwBOOL=WINBOOL" &&
 wl-showstatus build-install &&
 sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 # fix error: array subscript is above array bounds in hw/xwin/wincursor.c
 sed -i.bak -e "s/-Werror=array-bounds//" hw/xwin/Makefile &&
 make install-strip &&
 #make install-strip BASE_CFLAGS= CWARNFLAGS= &&
    ls -l $INSTALLPREFIX/lib/pkgconfig
    make install-pkgconfigDATA
####No package 'pciaccess' found
#wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf $BASENAME-$VERSION
cat > Xext/Makefile << EOF
clean:
all:
install:
install-strip:
EOF
####See also: https://github.com/rpavlik/Xserver/wiki/Build-Instructions
####See also: http://kemovitra.blogspot.be/2013/01/compiling-xming-with-mingw.html
####See also: http://www.straightrunning.com/XmingCode/xserver/



