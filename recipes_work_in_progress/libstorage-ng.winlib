export NAME="libstorage-ng"
export STATUS=
export URL=https://github.com/openSUSE/libstorage-ng
export BASENAME=libstorage-ng
export DESCRIPTION="libstorage-ng is the designated successor of libstorage, a C++ library used by YaST to perform most storage related tasks. The main idea of libstorage-ng compared to libstorage is to keep all information about storage devices in a graph instead of lists."
export CATEGORY=
export TYPE=library
#export VERSION=4.2.18
#export VERSIONDATE=20191028
#export VERSION=4.2.19
#export VERSIONDATE=20191031
#export VERSION=4.2.20
#export VERSIONDATE=20191106
#export VERSION=4.2.21
#export VERSIONDATE=20191106
#export VERSION=4.2.22
#export VERSIONDATE=20191107
#export VERSION=4.2.23
#export VERSIONDATE=20191107
#export VERSION=4.2.25
#export VERSIONDATE=20191109
#export VERSION=4.2.26
#export VERSIONDATE=20191110
#export VERSION=4.2.27
#export VERSIONDATE=20191113
#export VERSION=4.2.29
#export VERSIONDATE=20191126
#export VERSION=4.2.30
#export VERSIONDATE=20191127
#export VERSION=4.2.31
#export VERSIONDATE=20191129
#export VERSION=4.2.32
#export VERSIONDATE=20191129
####configure: error: Python interpreter is too old
#export VERSION=4.2.33
#export VERSIONDATE=20191202
#export VERSION=4.2.34
#export VERSIONDATE=20191203
#export VERSION=4.2.36
#export VERSIONDATE=20191205
#export VERSION=4.2.38
#export VERSIONDATE=20191211
#export VERSION=4.2.40
#export VERSIONDATE=20191212
#export VERSION=4.2.41
#export VERSIONDATE=20191216
#export VERSION=4.2.42
#export VERSIONDATE=20191219
#export VERSION=4.2.43
#export VERSIONDATE=20191219
#export VERSION=4.2.44
#export VERSIONDATE=20200104
#export VERSION=4.2.45
#export VERSIONDATE=20200107
#export VERSION=4.2.46
#export VERSIONDATE=20200108
#export VERSION=4.2.49
#export VERSIONDATE=20200109
#export VERSION=4.2.50
#export VERSIONDATE=20200114
#export VERSION=4.2.51
#export VERSIONDATE=20200114
#export VERSION=4.2.53
#export VERSIONDATE=20200115
#export VERSION=4.2.54
#export VERSIONDATE=20200115
#export VERSION=4.2.55
#export VERSIONDATE=20200116
#export VERSION=4.2.56
#export VERSIONDATE=20200118
#export VERSION=4.2.57
#export VERSIONDATE=20200120
#export VERSION=4.2.58
#export VERSIONDATE=20200204
#export VERSION=4.2.59
#export VERSIONDATE=20200205
#export VERSION=4.2.60
#export VERSIONDATE=20200206
#export VERSION=4.2.61
#export VERSIONDATE=20200211
#export VERSION=4.2.62
#export VERSIONDATE=20200217
#export VERSION=4.2.63
#export VERSIONDATE=20200217
#export VERSION=4.2.64
#export VERSIONDATE=20200220
#export VERSION=4.2.65
#export VERSIONDATE=20200221
#export VERSION=4.2.66
#export VERSIONDATE=20200305
#export VERSION=4.2.68
#export VERSIONDATE=20200313
#export VERSION=4.2.70
#export VERSIONDATE=20200325
#export VERSION=4.2.71
#export VERSIONDATE=20200326
#export VERSION=4.2.72
#export VERSIONDATE=20200401
#export VERSION=4.2.73
#export VERSIONDATE=20200418
#export VERSION=4.2.74
#export VERSIONDATE=20200420
#export VERSION=4.3.0
#export VERSIONDATE=20200420
#export VERSION=4.3.1
#export VERSIONDATE=20200422
#export VERSION=4.3.2
#export VERSIONDATE=20200424
#export VERSION=4.3.3
#export VERSIONDATE=20200429
#export VERSION=4.3.4
#export VERSIONDATE=20200430
#export VERSION=4.3.5
#export VERSIONDATE=20200501
#export VERSION=4.3.6
#export VERSIONDATE=20200504
#export VERSION=4.3.7
#export VERSIONDATE=20200505
#export VERSION=4.3.8
#export VERSIONDATE=20200505
#export VERSION=4.3.9
#export VERSIONDATE=20200506
#export VERSION=4.3.10
#export VERSIONDATE=20200507
#export VERSION=4.3.11
#export VERSIONDATE=20200507
#export VERSION=4.3.12
#export VERSIONDATE=20200508
#export VERSION=4.3.13
#export VERSIONDATE=20200511
#export VERSION=4.3.15
#export VERSIONDATE=20200512
#export VERSION=4.3.16
#export VERSIONDATE=20200513
#export VERSION=4.3.18
#export VERSIONDATE=20200514
#export VERSION=4.3.20
#export VERSIONDATE=20200515
#export VERSION=4.3.21
#export VERSIONDATE=20200519
#export VERSION=4.3.23
#export VERSIONDATE=20200520
#export VERSION=4.3.24
#export VERSIONDATE=20200523
#export VERSION=4.3.25
#export VERSIONDATE=20200603
#export VERSION=4.3.26
#export VERSIONDATE=20200606
#export VERSION=4.3.27
#export VERSIONDATE=20200615
#export VERSION=4.3.28
#export VERSIONDATE=20200622
#export VERSION=4.3.30
#export VERSIONDATE=20200629
#export VERSION=4.3.31
#export VERSIONDATE=20200630
#export VERSION=4.3.32
#export VERSIONDATE=20200630
#export VERSION=4.3.33
#export VERSIONDATE=20200706
#export VERSION=4.3.34
#export VERSIONDATE=20200707
#export VERSION=4.3.35
#export VERSIONDATE=20200717
#export VERSION=4.3.36
#export VERSIONDATE=20200722
#export VERSION=4.3.37
#export VERSIONDATE=20200722
#export VERSION=4.3.39
#export VERSIONDATE=20200729
#export VERSION=4.3.40
#export VERSIONDATE=20200828
#export VERSION=4.3.41
#export VERSIONDATE=20200910
#export VERSION=4.3.42
#export VERSIONDATE=20200916
#export VERSION=4.3.43
#export VERSIONDATE=20201001
#export VERSION=4.3.44
#export VERSIONDATE=20201009
#export VERSION=4.3.45
#export VERSIONDATE=20201012
#export VERSION=4.3.47
#export VERSIONDATE=20201013
#export VERSION=4.3.48
#export VERSIONDATE=20201014
#export VERSION=4.3.49
#export VERSIONDATE=20201014
#export VERSION=4.3.50
#export VERSIONDATE=20201015
#export VERSION=4.3.51
#export VERSIONDATE=20201019
#export VERSION=4.3.52
#export VERSIONDATE=20201024
#export VERSION=4.3.53
#export VERSIONDATE=20201029
#export VERSION=4.3.54
#export VERSIONDATE=20201030
#export VERSION=4.3.56
#export VERSIONDATE=20201103
#export VERSION=4.3.58
#export VERSIONDATE=20201104
#export VERSION=4.3.59
#export VERSIONDATE=20201104
#export VERSION=4.3.60
#export VERSIONDATE=20201105
#export VERSION=4.3.62
#export VERSIONDATE=20201106
#export VERSION=4.3.65
#export VERSIONDATE=20201110
#export VERSION=4.3.67
#export VERSIONDATE=20201111
#export VERSION=4.3.70
#export VERSIONDATE=20201112
#export VERSION=4.3.71
#export VERSIONDATE=20201113
#export VERSION=4.3.72
#export VERSIONDATE=20201207
#export VERSION=4.3.73
#export VERSIONDATE=20201215
#export VERSION=4.3.75
#export VERSIONDATE=20201216
#export VERSION=4.3.76
#export VERSIONDATE=20201230
#export VERSION=4.3.77
#export VERSIONDATE=20210105
#export VERSION=4.3.78
#export VERSIONDATE=20210106
#export VERSION=4.3.80
#export VERSIONDATE=20210108
#export VERSION=4.3.82
#export VERSIONDATE=20210118
#export VERSION=4.3.84
#export VERSIONDATE=20210120
#export VERSION=4.3.85
#export VERSIONDATE=20210121
#export VERSION=4.3.86
#export VERSIONDATE=20210129
#export VERSION=4.3.87
#export VERSIONDATE=20210201
#export VERSION=4.3.88
#export VERSIONDATE=20210204
#export VERSION=4.3.89
#export VERSIONDATE=20210226
#export VERSION=4.3.91
#export VERSIONDATE=20210310
#export VERSION=4.3.92
#export VERSIONDATE=20210315
#export VERSION=4.3.93
#export VERSIONDATE=20210315
#export VERSION=4.3.94
#export VERSIONDATE=20210316
#export VERSION=4.3.95
#export VERSIONDATE=20210316
#export VERSION=4.3.96
#export VERSIONDATE=20210319
#export VERSION=4.3.97
#export VERSIONDATE=20210320
#export VERSION=4.3.98
#export VERSIONDATE=20210323
#export VERSION=4.3.99
#export VERSIONDATE=20210323
#export VERSION=4.3.100
#export VERSIONDATE=20210324
#export VERSION=4.3.101
#export VERSIONDATE=20210324
#export VERSION=4.3.102
#export VERSIONDATE=20210325
#export VERSION=4.3.103
#export VERSIONDATE=20210325
#export VERSION=4.3.104
#export VERSIONDATE=20210329
#export VERSION=4.3.105
#export VERSIONDATE=20210401
#export VERSION=4.3.106
#export VERSIONDATE=20210408
#export VERSION=4.4.1
#export VERSIONDATE=20210428
#export VERSION=4.4.2
#export VERSIONDATE=20210504
#export VERSION=4.4.3
#export VERSIONDATE=20210505
#export VERSION=4.4.4
#export VERSIONDATE=20210507
#export VERSION=4.4.5
#export VERSIONDATE=20210509
#export VERSION=4.4.6
#export VERSIONDATE=20210513
#export VERSION=4.4.7
#export VERSIONDATE=20210515
#export VERSION=4.4.8
#export VERSIONDATE=20210518
#export VERSION=4.4.9
#export VERSIONDATE=20210522
#export VERSION=4.4.10
#export VERSIONDATE=20210528
#export VERSION=4.4.11
#export VERSIONDATE=20210531
#export VERSION=4.4.12
#export VERSIONDATE=20210608
#export VERSION=4.4.13
#export VERSIONDATE=20210609
#export VERSION=4.4.14
#export VERSIONDATE=20210610
#export VERSION=4.4.15
#export VERSIONDATE=20210621
#export VERSION=4.4.16
#export VERSIONDATE=20210628
#export VERSION=4.4.17
#export VERSIONDATE=20210629
#export VERSION=4.4.18
#export VERSIONDATE=20210630
#export VERSION=4.4.19
#export VERSIONDATE=20210701
#export VERSION=4.4.20
#export VERSIONDATE=20210702
#export VERSION=4.4.21
#export VERSIONDATE=20210702
#export VERSION=4.4.22
#export VERSIONDATE=20210705
#export VERSION=4.4.23
#export VERSIONDATE=20210709
####storage/Filesystems/BlkFilesystemImpl.cc:24:10: fatal error: glob.h: No such file or directory
#export VERSION=4.4.25
#export VERSIONDATE=20210710
#export VERSION=4.4.27
#export VERSIONDATE=20210711
#export VERSION=4.4.28
#export VERSIONDATE=20210715
#export VERSION=4.4.29
#export VERSIONDATE=20210724
#export VERSION=4.4.30
#export VERSIONDATE=20210726
#export VERSION=4.4.31
#export VERSIONDATE=20210731
#export VERSION=4.4.32
#export VERSIONDATE=20210805
#export VERSION=4.4.33
#export VERSIONDATE=20210809
#export VERSION=4.4.34
#export VERSIONDATE=20210816
#export VERSION=4.4.35
#export VERSIONDATE=20210818
#export VERSION=4.4.36
#export VERSIONDATE=20210905
#export VERSION=4.4.37
#export VERSIONDATE=20210921
#export VERSION=4.4.38
#export VERSIONDATE=20210930
#export VERSION=4.4.39
#export VERSIONDATE=20211002
#export VERSION=4.4.41
#export VERSIONDATE=20211004
#export VERSION=4.4.42
#export VERSIONDATE=20211005
#export VERSION=4.4.43
#export VERSIONDATE=20211008
#export VERSION=4.4.44
#export VERSIONDATE=20211011
#export VERSION=4.4.46
#export VERSIONDATE=20211014
#export VERSION=4.4.47
#export VERSIONDATE=20211015
#export VERSION=4.4.48
#export VERSIONDATE=20211016
#export VERSION=4.4.49
#export VERSIONDATE=20211017
#export VERSION=4.4.50
#export VERSIONDATE=20211019
#export VERSION=4.4.51
#export VERSIONDATE=20211020
#export VERSION=4.4.52
#export VERSIONDATE=20211022
#export VERSION=4.4.76
#export VERSIONDATE=20220122
#export VERSION=4.4.77
#export VERSIONDATE=20220127
#export VERSION=4.4.78
#export VERSIONDATE=20220128
#export VERSION=4.4.79
#export VERSIONDATE=20220203
#export VERSION=4.4.81
#export VERSIONDATE=20220207
#export VERSION=4.4.82
#export VERSIONDATE=20220216
#export VERSION=4.4.83
#export VERSIONDATE=20220217
#export VERSION=4.4.84
#export VERSIONDATE=20220218
#export VERSION=4.4.86
#export VERSIONDATE=20220218
#export VERSION=4.4.88
#export VERSIONDATE=20220221
#export VERSION=4.4.89
#export VERSIONDATE=20220222
#export VERSION=4.4.90
#export VERSIONDATE=20220222
#export VERSION=4.4.91
#export VERSIONDATE=20220223
#export VERSION=4.4.92
#export VERSIONDATE=20220224
#export VERSION=4.4.93
#export VERSIONDATE=20220307
#export VERSION=4.4.94
#export VERSIONDATE=20220318
#export VERSION=4.5.0
#export VERSIONDATE=20220330
#export VERSION=4.5.1
#export VERSIONDATE=20220401
#export VERSION=4.5.2
#export VERSIONDATE=20220408
#export VERSION=4.5.3
#export VERSIONDATE=20220411
#export VERSION=4.5.4
#export VERSIONDATE=20220416
#export VERSION=4.5.5
#export VERSIONDATE=20220425
#export VERSION=4.5.6
#export VERSIONDATE=20220428
#export VERSION=4.5.8
#export VERSIONDATE=20220503
#export VERSION=4.5.9
#export VERSIONDATE=20220505
#export VERSION=4.5.10
#export VERSIONDATE=20220506
#export VERSION=4.5.11
#export VERSIONDATE=20220513
#export VERSION=4.5.12
#export VERSIONDATE=20220520
#export VERSION=4.5.13
#export VERSIONDATE=20220523
#export VERSION=4.5.14
#export VERSIONDATE=20220525
#export VERSION=4.5.15
#export VERSIONDATE=20220530
export VERSION=4.5.16
export VERSIONDATE=20220531
####/include/boost/integer_fwd.hpp:82:33: error: 'long_long_type' is not a member of 'boost'
wl-showstatus --package-version
export DEPENDANCIES=unixem
export OPTIONALDEPENDANCIES=
export BUILDDEPENDANCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=GPL
#export DOWNLOADURL="https://github.com/openSUSE/libstorage-ng/releases"
export DOWNLOADURL="https://github.com/openSUSE/libstorage-ng/tags"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=https://github.com/openSUSE/libstorage-ng/archive/$VERSION.tar.gz
export DOWNLOADSOURCEURL=https://github.com/openSUSE/libstorage-ng/archive/refs/tags/$VERSION.tar.gz
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
tar xfz $TARBALLDIR/$BASENAME/$VERSION.tar.gz
cd $BASENAME-$VERSION
## fix already defined stdout/stderr
#sed -i.bak -e "s/\(parse_mkfs_output.* \)stdout/\1std_out/" storage/Filesystems/BtrfsImpl.cc storage/Filesystems/BtrfsImpl.h
#sed -i.bak -e "s/\bstdout\b/std_out/g; s/\bstderr\b/std_err/g" storage/SystemInfo/CmdParted.h storage/SystemInfo/CmdUdevadm.h
# fix already defined stdout/stderr
for F in $(grep -lw "stdout\|stderr" $(find -name '*.h')); do
mv $F $F.bak
cat > $F << EOF
#ifndef STORAGE_STDOUT_STDERR_REDEFINED
#define STORAGE_STDOUT_STDERR_REDEFINED
#include <stdio.h>
#undef stdout
#define stdout STORAGEstdout
#undef stderr
#define stderr STORAGEstderr
#endif
EOF
cat $F.bak >> $F
done
# fix already defined ERROR in storage/Utils/Logger.h
mv storage/Utils/Logger.h storage/Utils/Logger.h.bak2
cat > storage/Utils/Logger.h << EOF
#undef ERROR
#define ERROR STORAGEERROR
EOF
cat storage/Utils/Logger.h.bak2 >> storage/Utils/Logger.h
# fix already definee ERROR in storage/Utils/LoggerImpl.h
sed -i.bak2 "s/storage::LogLevel::ERROR/(storage::LogLevel)3/" storage/Utils/LoggerImpl.h
# fix already definee ERROR in storage/Utils/Exception.h
sed -i.bak2 -e "s/LogLevel::ERROR/(LogLevel)3/" storage/Utils/Exception.h
# fix missing VERSION
echo "$VERSION" > VERSION
# fix missing sys/sysmacros.h
mkdir -p winfix/sys;
cat > winfix/sys/sysmacros.h << EOF
#define major(dev) ((dev & 0x000FFF00) >> 8)
#define minor(dev) ((dev & 0x000000FF) | ((dev >> 12) & 0x000FFF00))
EOF
touch winfix/sys/poll.h
## fix missing struct pollfd
#mv storage/Utils/XmlFile.h storage/Utils/XmlFile.h.bak
#cat > storage/Utils/XmlFile.h << EOF
##if _WIN32_WINNT < 0x0600
##undef _WIN32_WINNT
##define _WIN32_WINNT 0x0600
##endif
#EOF
#cat storage/Utils/XmlFile.h.bak >> storage/Utils/XmlFile.htouch winfix/sys/poll.h
## fix missing struct pollfd in storage/Utils/SystemCmd.h
#mv storage/Utils/SystemCmd.h storage/Utils/SystemCmd.h.bak2
#cat > storage/Utils/SystemCmd.h << EOF
##if !defined(_WIN32_WINNT) || _WIN32_WINNT < 0x0600
##undef _WIN32_WINNT
##define _WIN32_WINNT 0x0600
##endif
##include <winsock2.h>
#EOF
#cat storage/Utils/SystemCmd.h.bak2 >> storage/Utils/SystemCmd.h
# fix missing struct pollfd
for F in $(grep -l "#include.*SystemCmd\.h" $(find -name '*.cc')); do
mv $F $F.bak2
cat > $F << EOF
#if !defined(_WIN32_WINNT) || _WIN32_WINNT < 0x0600
#undef _WIN32_WINNT
#define _WIN32_WINNT 0x0600
#endif
#include <winsock2.h>
EOF
cat $F.bak2 >> $F
done
# fix missing makedev in storage/SystemInfo/CmdDmsetup.cc
mv storage/SystemInfo/CmdDmsetup.cc storage/SystemInfo/CmdDmsetup.cc.bak3
cat > storage/SystemInfo/CmdDmsetup.cc << EOF
#ifdef __MINGW32__
#define makedev(x,y) (dev_t)((x)<<8|(y))
#endif
EOF
cat storage/SystemInfo/CmdDmsetup.cc.bak3 >> storage/SystemInfo/CmdDmsetup.cc
# fix missing makedev in storage/SystemInfo/CmdUdevadm.cc
mv storage/SystemInfo/CmdUdevadm.cc storage/SystemInfo/CmdUdevadm.cc.bak3
cat > storage/SystemInfo/CmdUdevadm.cc << EOF
#ifdef __MINGW32__
#define makedev(x,y) (dev_t)((x)<<8|(y))
#endif
EOF
cat storage/SystemInfo/CmdUdevadm.cc.bak3 >> storage/SystemInfo/CmdUdevadm.cc
# fix missing O_CLOEXEC
sed -i.bak4 -e "s?| O_CLOEXEC?/*&*/?" $(grep -l "| O_CLOEXEC" $(find -name '*.cc'))
## fix missing long_long_type in storage/CompoundAction/Formatter/Partition.cc (version >= 4.4.83)
#mv storage/CompoundAction/Formatter/Partition.cc storage/CompoundAction/Formatter/Partition.cc.bak &&
#echo "#include <boost/config.hpp>" > storage/CompoundAction/Formatter/Partition.cc &&
#cat storage/CompoundAction/Formatter/Partition.cc.bak >> storage/CompoundAction/Formatter/Partition.cc
wl-showstatus configure &&
 mkdir -p m4 &&
 autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal &&
 #./autogen.sh &&
 #    echo OK
 ## fix building DLLs on 64-bit
 #if ( echo $RUNPLATFORM | grep -q x86_64 ); then
 # echo "AM_GNU_GETTEXT_VERSION([$(gettext --version|head -n1|sed -e "s/^.* \([0-9\.]*\) *$/\1/")])" >> configure.ac &&
 # autoreconf -f -i -I m4 -I $MINGWPREFIX/share/aclocal
 #fi
 #INTLTOOL_PERL="$PERLDIR/bin/perl.exe" 
 #PERL="$PERLDIR/bin/perl.exe -I$PERLDIR/lib" 
 #PYTHON=$PYDIR/python.exe 
 #PYTHON=$PYDIR/python.exe C_INCLUDE_PATH=$PYDIR/include${C_INCLUDE_PATH:+:$C_INCLUDE_PATH} 
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed -Wl,-no-undefined" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM LDFLAGS="-Wl,--as-needed" &&
 #./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared PYTHON=$PYDIR/python.exe CXXFLAGS="-fpermissive -I$(pwd)/winfix" &&
 ./configure --prefix=$INSTALLPREFIX --build=$BUILDPLATFORM --host=$RUNPLATFORM --enable-static --enable-shared PYTHON=$PYDIR/python.exe CXXFLAGS="-fpermissive -I$MINGWPREFIX/include/unixemulation -I$(pwd)/winfix" LDFLAGS="-Wl,--as-needed -lunixem" &&
 ## fix building DLLs
 #sed -i.bak -e "s/\(allow_undefined=\)yes/\1no/" libtool &&
 wl-showstatus build &&
 ( make || make CXX="${CXX:-g++} -D_WIN32_WINNT=0x0600" ) &&
 wl-showstatus build-install &&
 make install-strip &&
    ls -l $INSTALLPREFIX/lib/pkgconfig $INSTALLPREFIX/share/pkgconfig
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$VERSION



