export NAME="busybox-w32"
export STATUS=
export URL=https://frippery.org/busybox/
#export URL=https://github.com/rmyorston/busybox-w32/
export BASENAME=busybox-w32
export DESCRIPTION="BusyBox is a single binary that contains many common Unix tools. It's often found in embedded Linux systems like routers, in Android smartphones, in Linux containers and anywhere else it would be handy to have a compact set of Unix command line tools."
export CATEGORY=system
export TYPE=library
#export VERSION=1.31.1
#export VERSIONDATE=20200214
#export VERSION=1.33.0
#export VERSIONDATE=20210304
#export VERSION=1.33.2
#export VERSIONDATE=20230215
#export VERSION=1.34.1
#export VERSIONDATE=20211019
#export VERSION=1.35.0
#export VERSIONDATE=20230215
export VERSION=1.36.0
export VERSIONDATE=20230215
wl-showstatus --package-version
export DEPENDENCIES=mman-win32,sys_wait_h
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=LICENSE
export LICENSETYPE=GPL
#export DOWNLOADURL="https://github.com/rmyorston/busybox-w32/releases"
export DOWNLOADURL="https://github.com/rmyorston/busybox-w32/tags"
#export DOWNLOADURL="https://gitlab.com/rmyorston/busybox-w32/-/tags?sort=updated_desc"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=https://github.com/rmyorston/busybox-w32/archive/$(echo $VERSION|tr . _).tar.gz
#export DOWNLOADSOURCEURL=https://github.com/rmyorston/busybox-w32/archive/refs/tags/$(echo $VERSION|tr . _).tar.gz
export DOWNLOADSOURCEURL=https://gitlab.com/rmyorston/busybox-w32/-/archive/$(echo $VERSION|tr . _)/busybox-w32-$(echo $VERSION|tr . _).tar.bz2
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
wl-showstatus extract
#tar xz --force-local -f $TARBALLDIR/$BASENAME/$(echo $VERSION|tr . _).tar.gz
tar xj --force-local -f $TARBALLDIR/$BASENAME/busybox-w32-$(echo $VERSION|tr . _).tar.bz2
cd $BASENAME-$(echo $VERSION|tr . _)
# fix scripts/basic/fixdep.c (version >= 1.36.0)
patch -ulbf scripts/basic/fixdep.c << EOF
@@ -114,3 +114,5 @@
 #include <ctype.h>
+#ifndef _WIN32
 #include <arpa/inet.h>
+#endif
 //bbox disabled: #include <alloca.h>
EOF
#make help
wl-showstatus build &&
 make HOSTCC="${CC:-gcc} -I$MINGWPREFIX/include/mman-win32 -I$MINGWPREFIX/win32ports/include" &&
 wl-showstatus install &&
 make install CONFIG_PREFIX=$INSTALLPREFIX &&
    echo OK
# wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && wl-showstatus cleanup && rm -rf $BASENAME-$(echo $VERSION|tr . _)



