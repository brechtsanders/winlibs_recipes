export NAME="ocre"
export STATUS=
export URL=http://lem.eui.upm.es/ocre.html
export BASENAME=ocre
export DESCRIPTION="o.c.r. easy (and free/libre)"
export CATEGORY=ocr
export TYPE=application
#export VERSION=0.031
#export VERSION=0.032
#export VERSION=0.033
#export VERSIONDATE=20091120
#export VERSION=0.034
#export VERSIONDATE=20100227
#export VERSION=0.035
#export VERSIONDATE=20110429
#export VERSION=0.036
#export VERSIONDATE=20110516
#export VERSION=0.037
#export VERSIONDATE=20110615
#export VERSION=0.038
#export VERSIONDATE=20110713
#export VERSION=0.039
#export VERSIONDATE=20110729
#export VERSION=0.040
#export VERSIONDATE=20120418
#export VERSION=0.041
#export VERSIONDATE=20120427
#export VERSION=0.042
#export VERSIONDATE=20120618
#export VERSION=0.043
#export VERSIONDATE=20130908
export VERSION=0.044
export VERSIONDATE=20170424
wl-showstatus --package-version
export DEPENDENCIES=aspell
export OPTIONALDEPENDENCIES=
export BUILDDEPENDENCIES=
export OPTIONALBUILDDEPENDENCIES=
export LICENSEFILE=ocre/GPL
export LICENSETYPE=GPL
#export DOWNLOADURL="ftp://lem.eui.upm.es/pub/ocre/ ocre_v .tgz"
export DOWNLOADURL="https://fossies.org/linux/privat/ ocre_v .tgz"
export INSTALLPREFIX=`pwd`/inst_$BASENAME-$VERSION
#export DOWNLOADSOURCEURL=ftp://lem.eui.upm.es/pub/ocre/ocre_v$(echo $VERSION|sed -e "s/\./_/g").tgz
#export DOWNLOADSOURCEURL=https://fossies.org/linux/privat/ocre_v$(echo $VERSION|sed -e "s/\./_/g").tgz
export DOWNLOADSOURCEURL=https://fossies.org/linux/privat/old/ocre_v$(echo $VERSION|sed -e "s/\./_/g").tgz/
wl-showstatus download
wl-download -v -d $TARBALLDIR/$BASENAME $DOWNLOADSOURCEURL
wl-wait4deps
tar xz --force-local -f $TARBALLDIR/$BASENAME/ocre_v`echo $VERSION|sed -e "s/\./_/g"`.tgz &> /tmp/$BASENAME.err
sed -e "s/^tar: \([^:]*\/\)\([^:\/]*\): Cannot create symlink to \`\([^']*\)': No such file or directory/ln -s \\1\\3 \\1\\2/" -e "s/^\(tar:.*\)$/#\\1/" /tmp/$BASENAME.err | sh
rm /tmp/$BASENAME.err
cd ocre-$VERSION
# fix compiler used
mv id3/Makefile id3/Makefile.bak
sed -e "s/\(cc -\)/g\1/" id3/Makefile.bak > id3/Makefile
# fix paths generated by pkg-config in ocre/Makefile
mv ocre/Makefile ocre/Makefile.bak
sed -e "s/\(pkg-config \)/\1--dont-define-prefix /g" ocre/Makefile.bak > ocre/Makefile
# fix missing sys/wait.h in ocre/src/reconoce.c
mkdir ocre/src/sys
touch ocre/src/sys/wait.h
# fix struct lista in ocre/src/lista.h
mv ocre/src/lista.h ocre/src/lista.h.bak
sed -e "s/\(struct lista\)/\1_/" ocre/src/lista.h.bak > ocre/src/lista.h
# fix ocre/src/diccionarios.c
patch -ulbf ocre/src/diccionarios.c << EOF
--- ocre/src/diccionarios.c  2011-05-16 10:56:02 +0200
+++ ocre/src/diccionarios.c  2011-07-29 08:15:26 +0200
@@ -316,3 +316,3 @@
   if (! listaVacia(l)) {
-     *mlGlifo = l->primero->aitem ;
+     memcpy(mlGlifo, l->primero->aitem, sizeof(tglifo));
     return TRUE;
@@ -607,3 +607,3 @@
   // si -> quitar incognita de glifo palabra
-  glifoIncognita = listaIncognitas->primero->aitem;
+       memcpy(&glifoIncognita, listaIncognitas->primero->aitem, sizeof(tglifo));
   ventIncognita = glifoIncognita->venDeGlifo;
EOF
# fix ocre/src/estadDistancs.c
patch -ulbf ocre/src/estadDistancs.c << EOF
--- ocre/src/estadDistancs.c  2008-12-01 23:37:10 +0100
+++ ocre/src/estadDistancs.c  2011-07-29 08:20:04 +0200
@@ -33,3 +33,3 @@
   // glifo1 = (tglifo) (enesimoNodoDeLista(listaaes,2)->aitem);
-  glifo1 = listaaes->primero->siguiente->aitem;
+       memcpy(glifo1, listaaes->primero->siguiente->aitem, sizeof(tglifo));
   vent1 = glifo1->venDeGlifo;
EOF
# fix missing random in ocre/src/distribDistans.c
mv ocre/src/distribDistans.c ocre/src/distribDistans.c.bak
echo "#define random rand" > ocre/src/distribDistans.c
cat ocre/src/distribDistans.c.bak >> ocre/src/distribDistans.c# fix search path
mv ocre/ddepend ocre/ddepend.bak &&
sed -e "s?/usr/?$MINGWPREFIX/?g; s?/lib/i386-linux-gnu/?/lib/?g" ocre/ddepend.bak > ocre/ddepend
wl-showstatus build &&
 make -C id3 &&
 ( make -C ocre || (
  mv ocre/ddepend ocre/ddepend.bak &&
  sed -e "s?/mingw32[^ ]*??g" ocre/ddepend.bak > ocre/ddepend &&
  make -C ocre CC=G++
 )) &&
 wl-showstatus build-install &&
    echo OK
#make -C ocre CC=g++ LDLIBS=" -lintl -laspell `$PKG_CONFIG --libs gtk+-2.0`"
####src/reconoce.c:6:22: sys/wait.h: No such file or directory
####src/reconoce.c: In function `presentayPregunta2':
####src/reconoce.c:79: warning: implicit declaration of function `kill'
####src/reconoce.c:80: warning: implicit declaration of function `wait'
#wl-makepackage -c -d && wl-install -d $BASENAME-$VERSION && cd .. && rm -rf ocre-$VERSION



